<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Frameset//EN" >
<HTML>
<HEAD>
<TITLE>Monkeybread Xojo plugin - Example: /Compression/RBZ Library version 1.1/rbz</TITLE>
<script src="../platforms.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../help.css" >
<link rel="stylesheet" type="text/css" href="../screen.css" media="screen">
<link rel="stylesheet" type="text/css" href="../print.css" media="print">
<link rel="stylesheet" type="text/css" href="../allitems.css" title="Default">
<link rel="alternate stylesheet" type="text/css" href="../macitems.css" title="Mac">
<link rel="alternate stylesheet" type="text/css" href="../winitems.css" title="Win">
<link rel="alternate stylesheet" type="text/css" href="../linuxitems.css" title="Linux">
<link rel="alternate stylesheet" type="text/css" href="../crossitems.css" title="Crossplatform">
<meta http-equiv="content-type" content="text/html; charset=x-mac-roman">
<META NAME="description" CONTENT="Example">
</head>
<BODY BGCOLOR="#FFFFFF">
<H2 lang="en">Example: /Compression/RBZ Library version 1.1/rbz</h2>
<p><a href="http://www.monkeybreadsoftware.net">Online Documentation</a> &nbsp; - &nbsp; <a href="stats.html">Statistics</a> &nbsp; - &nbsp; <a href="topic-faq.html">FAQ</a> &nbsp; - &nbsp; <a href="parts.html">Plugin Parts</a> (<a href="partsall.html">All</a>, <a href="plugindeps.html">Dependencies</a>) &nbsp; - &nbsp; <a href="hierarchy.html">Class hierarchy</a></p>
<p>New in Version 
<a href="newinversion213.html">21.3</a> 
<a href="newinversion214.html">21.4</a> 
<a href="newinversion215.html">21.5</a> 
<a href="newinversion220.html">22.0</a> 
<a href="newinversion221.html">22.1</a> 
<a href="newinversion222.html">22.2</a> 
<a href="newinversion223.html">22.3</a> 
<a href="newinversion224.html">22.4</a> 
<a href="newinversion225.html">22.5</a> 
<a href="newinversion230.html">23.0</a> 
<a href="newinversion231.html">23.1</a> 
<a href="newinversion232.html">23.2</a> 
</p>
<p>The list of the &nbsp; <a href="themes.html">topics</a>, 
 &nbsp; <a href="classes.html">classes</a>,
 &nbsp; <a href="interfaces.html">interfaces</a>,
 &nbsp; <a href="controls.html">controls</a>,
 &nbsp; <a href="modules.html">modules</a>,
 &nbsp; <a href="globaltopic.html">global methods by category</a>,
 &nbsp; <a href="globalname.html">global methods by name</a>,
 &nbsp; <a href="screenshots.html">screenshots</a>,
 &nbsp; <a href="licenses.html">licenses</a> &nbsp;
 and &nbsp; <a href="examples.html">examples</a>.</p>
<p id=PlatformChooserMBS>Platforms to show: <a class="isA" href="javascript:all();">All</a> <a class="isM" href="javascript:mac();">Mac</a> <a class="isW" href="javascript:win();">Windows</a> <a class="isL" href="javascript:linux();">Linux</a> <a class="isC" href="javascript:crossplatform();">Cross-Platform</a></p>
<div class="">
<b><A name="1">/Compression/RBZ Library version 1.1/rbz</A></b><br>
<B>Function:</B> 
<br>
Required plugins for this example: MBS Compression Plugin<BR>
You find this example project in your Plugins Download as a Xojo project file within the examples folder: /Compression/RBZ Library version 1.1/rbz<BR>
This example is the version from Sun, 5th Nov 2022.<BR>

<div class="RB_Code">Project <span style="color:#6500FE">&quot;rbz.xojo_binary_project&quot;</span></div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> App <span style="color:#0000FF;font-weight: bold">Inherits</span> Application</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kEditClear = <span style="color:#6500FE">&quot;&amp;Delete&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kFileQuit = <span style="color:#6500FE">&quot;&amp;Quit&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kFileQuitShortcut = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> winMain <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnAddDirectory <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnAddDirectory <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				prgProgress.Maximum = <span style="color:#326598">0</span>
				source = selectfolder
				thrAddDirectory.Run
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnAddFile <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnAddFile <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				prgProgress.Maximum = <span style="color:#326598">0</span>
				source = GetOpenFolderItem(<span style="color:#6500FE">&quot;&quot;</span>)
				thrAddFile.Run
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnOpenArchive <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnOpenArchive <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> folderitem = GetOpenFolderItem(ZipArchive.getFileType)
				<span style="color:#0000FF;font-weight: bold">if</span> f = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				archive = f.openAsZipArchive
				refreshList
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnNewArchive <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnNewArchive <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> folderitem = GetSaveFolderItem(ZipArchive.getFileType,<span style="color:#6500FE">&quot;archive.zip&quot;</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> f = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				archive = f.createAsZipArchive
				refreshList
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control lstArchive <span style="color:#0000FF;font-weight: bold">Inherits</span> Listbox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance lstArchive <span style="color:#0000FF;font-weight: bold">Inherits</span> Listbox</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> ExpandRow(row <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>)
				<span style="color:#0000FF;font-weight: bold">dim</span> item <span style="color:#0000FF;font-weight: bold">as</span> Zipitem = <span style="color:#0000FF;font-weight: bold">me</span>.celltag(row,<span style="color:#326598">0</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> item.isDirectory <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> children() <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = item.getChildren
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
						<span style="color:#0000FF;font-weight: bold">if</span> children(i).isDirectory <span style="color:#0000FF;font-weight: bold">then</span>
							lstArchive.AddFolder children(i).getName
						<span style="color:#0000FF;font-weight: bold">else</span>
							lstArchive.AddRow children(i).getName
						<span style="color:#0000FF;font-weight: bold">end</span>
						lstArchive.CellTag(lstArchive.LastIndex,<span style="color:#326598">0</span>) = children(i)
					<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnDelete <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnDelete <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				prgProgress.Maximum = <span style="color:#326598">0</span>
				thrDelete.run
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnExpand <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnExpand <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				prgProgress.Maximum = <span style="color:#326598">0</span>
				destination = selectfolder
				thrExpand.run
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control thrAddDirectory <span style="color:#0000FF;font-weight: bold">Inherits</span> Thread</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance thrAddDirectory <span style="color:#0000FF;font-weight: bold">Inherits</span> Thread</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Run()
				<span style="color:#0000FF;font-weight: bold">if</span> archive = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> source = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem
				<span style="color:#0000FF;font-weight: bold">if</span> lstArchive.ListIndex = -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">or</span> lstArchive.ListCount = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					item = archive
				<span style="color:#0000FF;font-weight: bold">else</span>
					item = lstArchive.CellTag(lstArchive.ListIndex,<span style="color:#326598">0</span>)
					<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> item.isDirectory <span style="color:#0000FF;font-weight: bold">then</span> item = item.getParent
				<span style="color:#0000FF;font-weight: bold">end</span>
				item.addChild source, <span style="color:#0000FF;font-weight: bold">self</span>
				refreshList
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control prgProgress <span style="color:#0000FF;font-weight: bold">Inherits</span> ProgressBar</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance prgProgress <span style="color:#0000FF;font-weight: bold">Inherits</span> ProgressBar</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control thrAddFile <span style="color:#0000FF;font-weight: bold">Inherits</span> Thread</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance thrAddFile <span style="color:#0000FF;font-weight: bold">Inherits</span> Thread</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Run()
				<span style="color:#0000FF;font-weight: bold">if</span> archive = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> source = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem
				<span style="color:#0000FF;font-weight: bold">if</span> lstArchive.ListIndex = -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">or</span> lstArchive.ListCount = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					item = archive
				<span style="color:#0000FF;font-weight: bold">else</span>
					item = lstArchive.CellTag(lstArchive.ListIndex,<span style="color:#326598">0</span>)
					<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> item.isDirectory <span style="color:#0000FF;font-weight: bold">then</span> item = item.getParent
				<span style="color:#0000FF;font-weight: bold">end</span>
				item.addChild source, <span style="color:#0000FF;font-weight: bold">self</span>
				refreshList
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control thrExpand <span style="color:#0000FF;font-weight: bold">Inherits</span> Thread</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance thrExpand <span style="color:#0000FF;font-weight: bold">Inherits</span> Thread</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Run()
				<span style="color:#0000FF;font-weight: bold">if</span> archive = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> destination = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem
				<span style="color:#0000FF;font-weight: bold">if</span> lstArchive.ListIndex = -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">or</span> lstArchive.ListCount = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					item = archive
				<span style="color:#0000FF;font-weight: bold">else</span>
					item = lstArchive.CellTag(lstArchive.ListIndex,<span style="color:#326598">0</span>)
				<span style="color:#0000FF;font-weight: bold">end</span>
				item.expand destination, <span style="color:#0000FF;font-weight: bold">self</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control thrDelete <span style="color:#0000FF;font-weight: bold">Inherits</span> Thread</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance thrDelete <span style="color:#0000FF;font-weight: bold">Inherits</span> Thread</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Run()
				<span style="color:#0000FF;font-weight: bold">if</span> archive = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem
				<span style="color:#0000FF;font-weight: bold">if</span> lstArchive.ListIndex = -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">or</span> lstArchive.ListCount = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					item = archive
				<span style="color:#0000FF;font-weight: bold">else</span>
					item = lstArchive.CellTag(lstArchive.ListIndex,<span style="color:#326598">0</span>)
				<span style="color:#0000FF;font-weight: bold">end</span>
				item.delete <span style="color:#0000FF;font-weight: bold">self</span>
				refreshList
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> refreshList()
			lstArchive.DeleteAllRows
			<span style="color:#0000FF;font-weight: bold">if</span> archive = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> children() <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = archive.getChildren
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
				<span style="color:#0000FF;font-weight: bold">if</span> children(i).isDirectory <span style="color:#0000FF;font-weight: bold">then</span>
					lstArchive.AddFolder children(i).getName
				<span style="color:#0000FF;font-weight: bold">else</span>
					lstArchive.AddRow children(i).getName
				<span style="color:#0000FF;font-weight: bold">end</span>
				lstArchive.CellTag(lstArchive.LastIndex,<span style="color:#326598">0</span>) = children(i)
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> update(complete <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">ProgressMonitor</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			prgProgress.maximum = <span style="color:#326598">1000</span>
			prgProgress.Value = prgProgress.Maximum * complete
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> archive <span style="color:#0000FF;font-weight: bold">As</span> ZipArchive</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> destination <span style="color:#0000FF;font-weight: bold">As</span> FolderItem</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> source <span style="color:#0000FF;font-weight: bold">As</span> FolderItem</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	MenuBar MenuBar1</div>
<div class="RB_Code">		MenuItem FileMenu = <span style="color:#6500FE">&quot;&amp;File&quot;</span></div>
<div class="RB_Code">			MenuItem FileQuit = <span style="color:#6500FE">&quot;#App.kFileQuit&quot;</span></div>
<div class="RB_Code">		MenuItem EditMenu = <span style="color:#6500FE">&quot;&amp;Edit&quot;</span></div>
<div class="RB_Code">			MenuItem EditUndo = <span style="color:#6500FE">&quot;&amp;Undo&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu1 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditCut = <span style="color:#6500FE">&quot;Cu&amp;t&quot;</span></div>
<div class="RB_Code">			MenuItem EditCopy = <span style="color:#6500FE">&quot;&amp;Copy&quot;</span></div>
<div class="RB_Code">			MenuItem EditPaste = <span style="color:#6500FE">&quot;&amp;Paste&quot;</span></div>
<div class="RB_Code">			MenuItem EditClear = <span style="color:#6500FE">&quot;#App.kEditClear&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu0 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditSelectAll = <span style="color:#6500FE">&quot;Select</span> <span style="color:#6500FE">&amp;All&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> MenuBar</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Interface</span> StreamReader</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> eof() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">boolean</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getPosition() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readAll(encoding <span style="color:#0000FF;font-weight: bold">as</span> TextEncoding = <span style="color:#0000FF;font-weight: bold">nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readCString(encoding <span style="color:#0000FF;font-weight: bold">as</span> TextEncoding = <span style="color:#0000FF;font-weight: bold">nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readInt16() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int16</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readInt32() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int32</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readInt64() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int64</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readInt8() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int8</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readPString(encoding <span style="color:#0000FF;font-weight: bold">as</span> TextEncoding = <span style="color:#0000FF;font-weight: bold">nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readString(bytes <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>, encoding <span style="color:#0000FF;font-weight: bold">as</span> TextEncoding = <span style="color:#0000FF;font-weight: bold">nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readUInt16() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Uint16</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readUInt32() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Uint32</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readUInt64() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Uint64</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readUInt8() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Uint8</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> skip(bytes <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>)</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Interface</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Interface</span> StreamWriter</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> flush()</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getPosition() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> rewind(bytes <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> skip(bytes <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeCString(text <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeInt16(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">int16</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeInt32(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">int32</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeInt64(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int64</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeInt8(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">int8</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writePString(text <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeString(text <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeUInt16(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint16</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeUInt32(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint32</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeUInt64(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint64</span>)</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeUInt8(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint8</span>)</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Interface</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> FileStream</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> EndOfFile() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">Readable</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.EOF
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Read(Count <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, encoding <span style="color:#0000FF;font-weight: bold">As</span> TextEncoding = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">Readable</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.read(count,encoding)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> ReadError() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">Readable</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadError
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Rewind(bytes <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint64</span>)
			stream.Position = stream.Position - bytes
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Write(text <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">Writeable</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.Write(text)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> WriteError() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">Writeable</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.WriteError
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> constructor(b <span style="color:#0000FF;font-weight: bold">as</span> binaryStream)
			stream = b
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> constructor(file <span style="color:#0000FF;font-weight: bold">as</span> folderItem, type <span style="color:#0000FF;font-weight: bold">as</span> filetype = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> file.Exists <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">if</span> type = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					stream = file.CreateBinaryFile(<span style="color:#6500FE">&quot;&quot;</span>)
				<span style="color:#0000FF;font-weight: bold">else</span>
					stream = file.CreateBinaryFile(type)
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				stream = file.OpenAsBinaryFile(<span style="color:#0000FF;font-weight: bold">true</span>)
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> constructor(file <span style="color:#0000FF;font-weight: bold">as</span> folderItem, type <span style="color:#0000FF;font-weight: bold">as</span> filetype = <span style="color:#0000FF;font-weight: bold">nil</span>, littleEndian <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>)
			constructor (file, type)
			stream.LittleEndian = littleEndian
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> eof() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">Readable</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.EOF
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> flush()
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.Flush
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getLength() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span>
			<span style="color:#0000FF;font-weight: bold">return</span> stream.Length
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getPosition() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.Position
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getString() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StringProvider</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> pos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = stream.Position
			stream.Position = <span style="color:#326598">0</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> text <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = stream.Read(stream.Length)
			stream.Position = pos
			<span style="color:#0000FF;font-weight: bold">return</span> text
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readAll(encoding <span style="color:#0000FF;font-weight: bold">as</span> textEncoding = <span style="color:#0000FF;font-weight: bold">nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">return</span> readString(stream.Length-stream.Position,encoding)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readCString(encoding <span style="color:#0000FF;font-weight: bold">as</span> TextEncoding = <span style="color:#0000FF;font-weight: bold">nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readInt16() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int16</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadInt16
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readInt32() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int32</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadInt32
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readInt64() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int64</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadInt64
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readInt8() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int8</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadInt8
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readPString(encoding <span style="color:#0000FF;font-weight: bold">as</span> TextEncoding = <span style="color:#0000FF;font-weight: bold">nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> len <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint8</span> = readUInt8
			<span style="color:#0000FF;font-weight: bold">return</span> readString(len,encoding)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readString(bytes <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>, encoding <span style="color:#0000FF;font-weight: bold">as</span> TextEncoding = <span style="color:#0000FF;font-weight: bold">nil</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.Read(bytes,encoding)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readUInt16() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Uint16</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadUInt16
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readUInt32() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Uint32</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadUInt32
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readUInt64() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Uint64</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadUInt64
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> readUInt8() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Uint8</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> stream.ReadUInt8
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> setPosition(pos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uInt64</span>)
			stream.Position = pos
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> setString(Str <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StringInterface</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.Position = <span style="color:#326598">0</span>
			stream.Write str
			stream.Length = stream.Position
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> skip(bytes <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamReader</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.Position = stream.Position + bytes
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> truncate()
			<span style="color:#7F0000;text-style:italic">//truncate</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">current</span> <span style="color:#7F0000;text-style:italic">position</span>
			stream.Length = stream.Position
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeCString(text <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.Write(text)
			stream.WriteUInt8 <span style="color:#326598">0</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeInt16(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">int16</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.WriteInt16 value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeInt32(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">int32</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.WriteInt32 value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeInt64(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int64</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.WriteInt64 value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeInt8(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">int8</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.WriteInt8 value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writePString(text <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> ln <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt8</span> = min(text.lenb,<span style="color:#326598">255</span>)
			stream.WriteInt8 ln
			stream.Write text.LeftB(ln)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeString(text <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.Write text
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeUInt16(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint16</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.WriteUInt16 value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeUInt32(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint32</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.WriteUInt32 value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeUInt64(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint64</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.WriteUInt64 value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> writeUInt8(value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Uint8</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">StreamWriter</span> <span style="color:#7F0000;text-style:italic">interface.</span>
			
			stream.WriteUInt8 value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> stream <span style="color:#0000FF;font-weight: bold">As</span> binaryStream</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Module</span> RBZ</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemAcornRISCOS = <span style="color:#326598">13</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemAlternateMVS = <span style="color:#326598">15</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemAmiga = <span style="color:#326598">1</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemAtari = <span style="color:#326598">5</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemBeOS = <span style="color:#326598">16</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemCP_M = <span style="color:#326598">9</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemFAT = <span style="color:#326598">0</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemHPFS = <span style="color:#326598">6</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemMVS = <span style="color:#326598">11</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemMacintosh = <span style="color:#326598">7</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemNTFS = <span style="color:#326598">10</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemOSX = <span style="color:#326598">19</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemOS_400 = <span style="color:#326598">18</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemTandem = <span style="color:#326598">17</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemUnix = <span style="color:#326598">3</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemVFAT = <span style="color:#326598">14</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemVM = <span style="color:#326598">4</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemVMS = <span style="color:#326598">2</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemVSE = <span style="color:#326598">12</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> FilesystemZSystem = <span style="color:#326598">8</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> Version = <span style="color:#006532">1.1</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Enum</span> CompressionMethod
			none
			deflate
			unsupported
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Enum</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Enum</span> DeflateLevel
			maximum
			normal
			fast
			fastest
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Enum</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> createAsZipArchive(<span style="color:#0000FF;font-weight: bold">extends</span> archive <span style="color:#0000FF;font-weight: bold">as</span> folderItem) <span style="color:#0000FF;font-weight: bold">As</span> ZipArchive
			<span style="color:#0000FF;font-weight: bold">if</span> archive.Exists <span style="color:#0000FF;font-weight: bold">then</span> archive.Delete
			<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipArchive(archive)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> openAsZipArchive(<span style="color:#0000FF;font-weight: bold">extends</span> archive <span style="color:#0000FF;font-weight: bold">as</span> folderItem) <span style="color:#0000FF;font-weight: bold">As</span> ZipArchive
			<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipArchive(archive)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> unzip(<span style="color:#0000FF;font-weight: bold">extends</span> archive <span style="color:#0000FF;font-weight: bold">as</span> folderitem, destination <span style="color:#0000FF;font-weight: bold">as</span> folderitem)
			<span style="color:#0000FF;font-weight: bold">dim</span> z <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipArchive(archive)
			z.expand destination
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> unzip(<span style="color:#0000FF;font-weight: bold">extends</span> archive <span style="color:#0000FF;font-weight: bold">as</span> folderitem, destination <span style="color:#0000FF;font-weight: bold">as</span> folderitem, options <span style="color:#0000FF;font-weight: bold">as</span> expansionOptions)
			<span style="color:#0000FF;font-weight: bold">dim</span> z <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipArchive(archive)
			z.expand destination, options
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> zip(<span style="color:#0000FF;font-weight: bold">extends</span> source <span style="color:#0000FF;font-weight: bold">as</span> folderitem, archive <span style="color:#0000FF;font-weight: bold">as</span> folderitem, comment <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#6500FE">&quot;&quot;</span>)
			<span style="color:#0000FF;font-weight: bold">dim</span> z <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipArchive(archive)
			z.addChild source, comment
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> zip(<span style="color:#0000FF;font-weight: bold">extends</span> source <span style="color:#0000FF;font-weight: bold">as</span> folderitem, archive <span style="color:#0000FF;font-weight: bold">as</span> folderitem, comment <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#6500FE">&quot;&quot;</span>, options <span style="color:#0000FF;font-weight: bold">as</span> compressionOptions)
			<span style="color:#0000FF;font-weight: bold">dim</span> z <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipArchive(archive)
			z.addChild source, comment, options
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Structure</span> CompressionOptions
			method <span style="color:#0000FF;font-weight: bold">as</span> CompressionMethod
			deflateLevel <span style="color:#0000FF;font-weight: bold">as</span> DeflateLevel
			deflateWindow <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Structure</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Structure</span> ExpansionOptions
			ignoreChecksum <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			replaceFiles <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			ignoreErrors <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Structure</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Module</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> ZipItem</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> addChild(item <span style="color:#0000FF;font-weight: bold">as</span> folderitem, progress <span style="color:#0000FF;font-weight: bold">as</span> ProgressMonitor)
			addChild item, <span style="color:#6500FE">&quot;&quot;</span>, progress
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> addChild(item <span style="color:#0000FF;font-weight: bold">as</span> folderitem, comment <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#6500FE">&quot;&quot;</span>, options <span style="color:#0000FF;font-weight: bold">as</span> CompressionOptions, progress <span style="color:#0000FF;font-weight: bold">as</span> ProgressMonitor = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">compression</span> <span style="color:#7F0000;text-style:italic">options</span>
			compressionOptions = options
			
			<span style="color:#7F0000;text-style:italic">//add</span> <span style="color:#7F0000;text-style:italic">child</span>
			addChild item, comment, progress
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> addChild(item <span style="color:#0000FF;font-weight: bold">as</span> folderitem, comment <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#6500FE">&quot;&quot;</span>, progress <span style="color:#0000FF;font-weight: bold">as</span> ProgressMonitor = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#7F0000;text-style:italic">//add</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">item</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">directory</span>
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> isDirectory <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">does</span> <span style="color:#7F0000;text-style:italic">nothing</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">item</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">directory</span>
			<span style="color:#0000FF;font-weight: bold">if</span> item.name = <span style="color:#6500FE">&quot;.DS_Store&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">don&#39;t</span> <span style="color:#7F0000;text-style:italic">store</span> <span style="color:#7F0000;text-style:italic">system</span> <span style="color:#7F0000;text-style:italic">files</span>
			<span style="color:#0000FF;font-weight: bold">if</span> item.Alias <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">don&#39;t</span> <span style="color:#7F0000;text-style:italic">store</span> <span style="color:#7F0000;text-style:italic">aliases</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> zp <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				zp = <span style="color:#0000FF;font-weight: bold">new</span> ZipProgress(z_precalculateSizes(item) + <span style="color:#326598">1</span>,progress)
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			z_addChild item, comment, zp <span style="color:#7F0000;text-style:italic">//add</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">internal</span> <span style="color:#7F0000;text-style:italic">structure</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">write</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">record</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">archive</span>
			z_writeFileHeaders <span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">records</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> zp.increment <span style="color:#326598">1</span> <span style="color:#7F0000;text-style:italic">//notify</span> <span style="color:#7F0000;text-style:italic">completion</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> constructor(parent <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> parent &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				
				<span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">parent</span>
				z_setParent parent
				
				<span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">defaults</span>
				compressionOptions = parent.compressionOptions
				expansionOptions = parent.expansionOptions
				
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> delete(progress <span style="color:#0000FF;font-weight: bold">as</span> ProgressMonitor = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#0000FF;font-weight: bold">dim</span> zp <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				zp = <span style="color:#0000FF;font-weight: bold">new</span> ZipProgress(<span style="color:#326598">1</span>,progress)
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			z_tagForDeletion <span style="color:#7F0000;text-style:italic">//recursively</span> <span style="color:#7F0000;text-style:italic">mark</span> <span style="color:#7F0000;text-style:italic">self</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">children</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">deletion</span>
			z_compact zp <span style="color:#7F0000;text-style:italic">//compact</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">file</span>
			z_delete <span style="color:#7F0000;text-style:italic">//recursively</span> <span style="color:#7F0000;text-style:italic">delete</span> <span style="color:#7F0000;text-style:italic">self</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">children</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">archive</span>
			z_writeFileHeaders <span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">records</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> zp.increment <span style="color:#326598">1</span> <span style="color:#7F0000;text-style:italic">//notify</span> <span style="color:#7F0000;text-style:italic">completion</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> expand(destinationDirectory <span style="color:#0000FF;font-weight: bold">as</span> folderItem, options <span style="color:#0000FF;font-weight: bold">as</span> ExpansionOptions, progress <span style="color:#0000FF;font-weight: bold">as</span> ProgressMonitor = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#0000FF;font-weight: bold">dim</span> zp <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				zp = <span style="color:#0000FF;font-weight: bold">new</span> ZipProgress(getCompressedSize + <span style="color:#326598">1</span>,progress)
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			z_expand destinationDirectory, zp, options
			
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> zp.increment <span style="color:#326598">1</span> <span style="color:#7F0000;text-style:italic">//notify</span> <span style="color:#7F0000;text-style:italic">completion</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> expand(destinationDirectory <span style="color:#0000FF;font-weight: bold">as</span> folderItem, progress <span style="color:#0000FF;font-weight: bold">as</span> ProgressMonitor = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#7F0000;text-style:italic">//neccessary</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">duplicate</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">code</span> <span style="color:#7F0000;text-style:italic">due</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">strange</span> <span style="color:#7F0000;text-style:italic">crash</span> <span style="color:#7F0000;text-style:italic">which</span>
			<span style="color:#7F0000;text-style:italic">//occurs</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">attempt</span> <span style="color:#7F0000;text-style:italic">tp</span> <span style="color:#7F0000;text-style:italic">call</span> <span style="color:#7F0000;text-style:italic">other</span> <span style="color:#7F0000;text-style:italic">expand</span> <span style="color:#7F0000;text-style:italic">function</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> zp <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				zp = <span style="color:#0000FF;font-weight: bold">new</span> ZipProgress(getCompressedSize + <span style="color:#326598">1</span>,progress)
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			z_expand destinationDirectory, zp, expansionOptions
			
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> zp.increment <span style="color:#326598">1</span> <span style="color:#7F0000;text-style:italic">//notify</span> <span style="color:#7F0000;text-style:italic">completion</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getArchive() <span style="color:#0000FF;font-weight: bold">As</span> zipArchive
			<span style="color:#0000FF;font-weight: bold">return</span> archive
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getChildren() <span style="color:#0000FF;font-weight: bold">As</span> ZipItem()
			<span style="color:#7F0000;text-style:italic">//return</span> <span style="color:#7F0000;text-style:italic">clone</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">children</span> <span style="color:#7F0000;text-style:italic">array</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> c() <span style="color:#0000FF;font-weight: bold">as</span> ZipItem
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
				c.Append children(i)
			<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">return</span> c
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getComment() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">return</span> comment
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getCompressedSize() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span>
			<span style="color:#0000FF;font-weight: bold">if</span> isDirectory <span style="color:#0000FF;font-weight: bold">and</span> compressedSize = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> UBound(children)
					compressedSize = compressedSize + children(i).getCompressedSize
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> compressedSize
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> getCompressionOptions(<span style="color:#0000FF;font-weight: bold">byref</span> options <span style="color:#0000FF;font-weight: bold">as</span> CompressionOptions)
			options = compressionOptions
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> getExpansionOptions(<span style="color:#0000FF;font-weight: bold">byref</span> options <span style="color:#0000FF;font-weight: bold">as</span> ExpansionOptions)
			options = expansionOptions
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getModified() <span style="color:#0000FF;font-weight: bold">As</span> date
			<span style="color:#0000FF;font-weight: bold">return</span> modified
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getName() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">return</span> name
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getParent() <span style="color:#0000FF;font-weight: bold">As</span> ZipItem
			<span style="color:#0000FF;font-weight: bold">return</span> parent
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getPath() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> path <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#0000FF;font-weight: bold">me</span>.path
			<span style="color:#0000FF;font-weight: bold">if</span> path.leftb(<span style="color:#326598">1</span>) = <span style="color:#6500FE">&quot;/&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span> path = path.midb(<span style="color:#326598">2</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> path &lt;&gt; <span style="color:#6500FE">&quot;&quot;</span> <span style="color:#0000FF;font-weight: bold">and</span> directory <span style="color:#0000FF;font-weight: bold">and</span> path.rightb(<span style="color:#326598">1</span>) &lt;&gt; <span style="color:#6500FE">&quot;/&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span> path = path + <span style="color:#6500FE">&quot;/&quot;</span>
			<span style="color:#0000FF;font-weight: bold">return</span> path
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getUncompressedSize() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span>
			<span style="color:#0000FF;font-weight: bold">if</span> isDirectory <span style="color:#0000FF;font-weight: bold">and</span> uncompressedSize = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> UBound(children)
					uncompressedSize = uncompressedSize + children(i).getUncompressedSize
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> uncompressedSize
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> isDirectory() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">return</span> directory
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> setExpansionOptions(options <span style="color:#0000FF;font-weight: bold">as</span> ExpansionOptions)
			expansionOptions = options
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_addChild(item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> isDirectory <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//not</span> <span style="color:#7F0000;text-style:italic">permitted</span>
			
			<span style="color:#7F0000;text-style:italic">//compare</span> <span style="color:#7F0000;text-style:italic">paths</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> mypath <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = getPath
			<span style="color:#0000FF;font-weight: bold">dim</span> childPath <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = item.getPath
			
			<span style="color:#0000FF;font-weight: bold">if</span> childPath.lenb &lt;= myPath.lenb <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//something&#39;s</span> <span style="color:#7F0000;text-style:italic">gone</span> <span style="color:#7F0000;text-style:italic">wrong</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> childPath.leftb(mypath.lenb) &lt;&gt; mypath <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//something&#39;s</span> <span style="color:#7F0000;text-style:italic">gone</span> <span style="color:#7F0000;text-style:italic">wrong</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> relativePath <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = childPath.midb(mypath.lenb)
			<span style="color:#0000FF;font-weight: bold">if</span> relativePath.LeftB(<span style="color:#326598">1</span>) = <span style="color:#6500FE">&quot;/&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span> relativePath = relativePath.midb(<span style="color:#326598">2</span>) <span style="color:#7F0000;text-style:italic">//removing</span> <span style="color:#7F0000;text-style:italic">leading</span> <span style="color:#7F0000;text-style:italic">slash</span>
			<span style="color:#0000FF;font-weight: bold">if</span> relativePath.rightb(<span style="color:#326598">1</span>) = <span style="color:#6500FE">&quot;/&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span> relativePath = relativePath.leftb(relativePath.lenb-<span style="color:#326598">1</span>) <span style="color:#7F0000;text-style:italic">//removing</span> <span style="color:#7F0000;text-style:italic">trailing</span> <span style="color:#7F0000;text-style:italic">slash</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> relativePath = item.name <span style="color:#0000FF;font-weight: bold">then</span>
				
				<span style="color:#7F0000;text-style:italic">//place</span> <span style="color:#7F0000;text-style:italic">item</span> <span style="color:#7F0000;text-style:italic">directly</span> <span style="color:#7F0000;text-style:italic">into</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">directory</span>
				children.Append item
				item.z_setParent <span style="color:#0000FF;font-weight: bold">me</span>
				
				<span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">defaults</span>
				item.compressionOptions.deflateWindow = <span style="color:#0000FF;font-weight: bold">me</span>.compressionOptions.deflateWindow
				item.expansionOptions = <span style="color:#0000FF;font-weight: bold">me</span>.expansionOptions
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> nextDirectory <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = nthfield(relativePath,<span style="color:#6500FE">&quot;/&quot;</span>,<span style="color:#326598">1</span>) <span style="color:#7F0000;text-style:italic">//name</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">path</span>
				
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
					<span style="color:#0000FF;font-weight: bold">if</span> children(i).name = nextDirectory <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#7F0000;text-style:italic">//add</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">existing</span> <span style="color:#7F0000;text-style:italic">directory</span>
						children(i).z_addChild(item)
						<span style="color:#0000FF;font-weight: bold">return</span>
					<span style="color:#0000FF;font-weight: bold">end</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				<span style="color:#7F0000;text-style:italic">//create</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">new</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">item</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> dir <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipItem(<span style="color:#0000FF;font-weight: bold">me</span>)
				children.Append dir
				dir.name = nextDirectory <span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">name</span>
				dir.directory = <span style="color:#0000FF;font-weight: bold">true</span> <span style="color:#7F0000;text-style:italic">//is</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">(obviously)</span>
				dir.path = getPath + dir.name
				
				<span style="color:#7F0000;text-style:italic">//add</span> <span style="color:#7F0000;text-style:italic">child</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">new</span> <span style="color:#7F0000;text-style:italic">item</span>
				dir.z_addChild(item)
				
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_addChild(item <span style="color:#0000FF;font-weight: bold">as</span> folderitem, comment <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#6500FE">&quot;&quot;</span>, progress <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> isDirectory <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//not</span> <span style="color:#7F0000;text-style:italic">permitted</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> child <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipItem(<span style="color:#0000FF;font-weight: bold">me</span>)
			child.name = z_cleanFileName(item.Name) <span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">name</span>
			child.path = path +<span style="color:#6500FE">&quot;/&quot;</span> + child.name <span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">path</span>
			child.comment = comment.ConvertEncoding(Encodings.DOSLatinUS) <span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">comment</span>
			child.modified = item.ModificationDate <span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">modification</span> <span style="color:#7F0000;text-style:italic">date</span>
			child.directory = item.Directory <span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">status</span>
			child.uncompressedSize = item.Length <span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">uncompressed</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">size</span>
			children.Append child <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">add</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">internal</span> <span style="color:#7F0000;text-style:italic">children</span> <span style="color:#7F0000;text-style:italic">array</span>
			
			<span style="color:#7F0000;text-style:italic">//handle</span> <span style="color:#7F0000;text-style:italic">children</span> <span style="color:#7F0000;text-style:italic">(do</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">before</span> <span style="color:#7F0000;text-style:italic">writing</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">records</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">can</span> <span style="color:#7F0000;text-style:italic">tell</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">directories</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">empty)</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> item.Count
				<span style="color:#0000FF;font-weight: bold">if</span> item.item(i).name &lt;&gt; <span style="color:#6500FE">&quot;.DS_Store&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span> child.z_addChild item.Item(i), progress <span style="color:#7F0000;text-style:italic">//repeat</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">item</span> <span style="color:#7F0000;text-style:italic">contents</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">record</span>
			<span style="color:#0000FF;font-weight: bold">if</span> child.directory <span style="color:#0000FF;font-weight: bold">then</span>
				child.z_writeFileRecord <span style="color:#0000FF;font-weight: bold">nil</span>, progress <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">write</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">record</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				child.z_writeFileRecord <span style="color:#0000FF;font-weight: bold">new</span> FileStream(item), progress <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">write</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">record</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_cleanFileName(name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#7F0000;text-style:italic">//encode</span> <span style="color:#7F0000;text-style:italic">filename</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">dos</span> <span style="color:#7F0000;text-style:italic">compatibility</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> cleaned <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = name.ConvertEncoding(Encodings.DOSLatinUS)
			cleaned = cleaned.ReplaceAllB(<span style="color:#6500FE">&quot;/&quot;</span>,<span style="color:#6500FE">&quot;:&quot;</span>)
			
			<span style="color:#7F0000;text-style:italic">//avoid</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">clashes</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">siblings</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
				<span style="color:#0000FF;font-weight: bold">while</span> children(i).name = cleaned
					cleaned = z_incrementName(cleaned)
				<span style="color:#0000FF;font-weight: bold">wend</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> cleaned
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_collateItems(offsets() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>, items() <span style="color:#0000FF;font-weight: bold">as</span> ZipItem)
			<span style="color:#0000FF;font-weight: bold">if</span> isDirectory <span style="color:#0000FF;font-weight: bold">and</span> ubound(children) &gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
				
				<span style="color:#7F0000;text-style:italic">//non-empty</span> <span style="color:#7F0000;text-style:italic">directories</span> <span style="color:#7F0000;text-style:italic">aren&#39;t</span> <span style="color:#7F0000;text-style:italic">stored</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">archive,</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">skip</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">deal</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">children</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
					children(i).z_collateItems offsets, items
				<span style="color:#0000FF;font-weight: bold">next</span>
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				<span style="color:#7F0000;text-style:italic">//insert</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">order</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">offset</span>
				<span style="color:#7F0000;text-style:italic">//binary</span> <span style="color:#7F0000;text-style:italic">insertion</span> <span style="color:#7F0000;text-style:italic">sort</span> <span style="color:#7F0000;text-style:italic">would</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">faster</span> <span style="color:#7F0000;text-style:italic">but</span> <span style="color:#7F0000;text-style:italic">speed</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">function</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">unlikely</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">bottleneck</span>
				<span style="color:#0000FF;font-weight: bold">if</span> ubound(offsets) = -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">or</span> relativeOffset &gt; offsets(ubound(offsets)) <span style="color:#0000FF;font-weight: bold">then</span>
					offsets.Append relativeOffset
					items.Append <span style="color:#0000FF;font-weight: bold">me</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = ubound(offsets) <span style="color:#0000FF;font-weight: bold">downto</span> <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">if</span> offsets(i) &gt; relativeOffset <span style="color:#0000FF;font-weight: bold">then</span>
							offsets.Insert i, relativeOffset
							items.Insert i, <span style="color:#0000FF;font-weight: bold">me</span>
							<span style="color:#0000FF;font-weight: bold">return</span>
						<span style="color:#0000FF;font-weight: bold">end</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">end</span>
				
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_compact(progress <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress)
			<span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">data</span>
			ZipItem(archive).z_compact progress
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_delete()
			<span style="color:#7F0000;text-style:italic">//delete</span> <span style="color:#7F0000;text-style:italic">children</span>
			<span style="color:#7F0000;text-style:italic">//work</span>  <span style="color:#7F0000;text-style:italic">on</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">duplicate</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">children</span> <span style="color:#7F0000;text-style:italic">array</span> <span style="color:#7F0000;text-style:italic">as</span>
			<span style="color:#7F0000;text-style:italic">//array</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">manipulated</span> <span style="color:#7F0000;text-style:italic">by</span> <span style="color:#7F0000;text-style:italic">deletion</span> <span style="color:#7F0000;text-style:italic">process</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> children() <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = getChildren
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
				children(i).z_delete
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#7F0000;text-style:italic">//remove</span> <span style="color:#7F0000;text-style:italic">self</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">parent</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(ZipItem(parent).children)
				<span style="color:#0000FF;font-weight: bold">if</span> ZipItem(parent).children(i) = <span style="color:#0000FF;font-weight: bold">me</span> <span style="color:#0000FF;font-weight: bold">then</span>
					ZipItem(parent).children.Remove i
					<span style="color:#0000FF;font-weight: bold">exit</span>
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_expand(destinationDirectory <span style="color:#0000FF;font-weight: bold">as</span> folderItem,  progress <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress, options <span style="color:#0000FF;font-weight: bold">as</span> ExpansionOptions)
			<span style="color:#7F0000;text-style:italic">//must</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">valid</span> <span style="color:#7F0000;text-style:italic">destination</span> <span style="color:#7F0000;text-style:italic">directory</span>
			<span style="color:#0000FF;font-weight: bold">if</span> destinationDirectory = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span> <span style="color:#0000FF;font-weight: bold">not</span> destinationDirectory.exists <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> destinationDirectory.directory <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
			
			<span style="color:#7F0000;text-style:italic">//handle</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">clashes</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#0000FF;font-weight: bold">me</span>.name
			<span style="color:#0000FF">#if</span> TargetMacOS
				name = name.ReplaceAllB(<span style="color:#6500FE">&quot;:&quot;</span>,<span style="color:#6500FE">&quot;/&quot;</span>)
			<span style="color:#0000FF">#endif</span>
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> options.replaceFiles <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> destinationDirectory.Count
					<span style="color:#0000FF;font-weight: bold">while</span> destinationDirectory.item(i).name = name
						<span style="color:#7F0000;text-style:italic">//rename</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">avoid</span> <span style="color:#7F0000;text-style:italic">clash</span>
						name = z_incrementName(name)
					<span style="color:#0000FF;font-weight: bold">wend</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> directory <span style="color:#0000FF;font-weight: bold">then</span>
				
				<span style="color:#7F0000;text-style:italic">//create</span> <span style="color:#7F0000;text-style:italic">directory</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> dir <span style="color:#0000FF;font-weight: bold">as</span> FolderItem = destinationDirectory.Child(name)
				dir.CreateAsFolder
				
				<span style="color:#7F0000;text-style:italic">//handle</span> <span style="color:#7F0000;text-style:italic">children</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
					children(i).z_expand dir, progress, options
				<span style="color:#0000FF;font-weight: bold">next</span>
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				<span style="color:#7F0000;text-style:italic">//create</span> <span style="color:#7F0000;text-style:italic">file</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> file <span style="color:#0000FF;font-weight: bold">as</span> FolderItem = destinationDirectory.Child(name)
				z_writeFile <span style="color:#0000FF;font-weight: bold">new</span> FileStream(file), options, progress
				
				<span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">modification</span> <span style="color:#7F0000;text-style:italic">date</span>
				<span style="color:#0000FF;font-weight: bold">if</span> modified &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> file.ModificationDate = modified
				
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_incrementName(name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#7F0000;text-style:italic">//increment</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">prevent</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">clashes</span>
			<span style="color:#7F0000;text-style:italic">//for</span> <span style="color:#7F0000;text-style:italic">example</span> <span style="color:#7F0000;text-style:italic">foo.txt</span> <span style="color:#7F0000;text-style:italic">becomes</span> <span style="color:#7F0000;text-style:italic">foo</span> <span style="color:#7F0000;text-style:italic">1.txt,</span> <span style="color:#7F0000;text-style:italic">foo</span> <span style="color:#7F0000;text-style:italic">1.txt</span> <span style="color:#7F0000;text-style:italic">becomes</span> <span style="color:#7F0000;text-style:italic">foo</span> <span style="color:#7F0000;text-style:italic">2.txt,</span> <span style="color:#7F0000;text-style:italic">etc</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> extension <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> theName <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">if</span> CountFields(name,<span style="color:#6500FE">&quot;.&quot;</span>) &gt; <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
				extension = <span style="color:#6500FE">&quot;.&quot;</span> + NthField(name,<span style="color:#6500FE">&quot;.&quot;</span>,CountFields(name,<span style="color:#6500FE">&quot;.&quot;</span>))
				theName = NthField(name,<span style="color:#6500FE">&quot;.&quot;</span>,CountFields(name,<span style="color:#6500FE">&quot;.&quot;</span>) - <span style="color:#326598">1</span>)
			<span style="color:#0000FF;font-weight: bold">else</span>
				theName = name
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> number <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = theName.LenB <span style="color:#0000FF;font-weight: bold">downto</span> <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> char <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = theName.MidB(i,<span style="color:#326598">1</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> AscB(char) &lt; <span style="color:#326598">48</span> <span style="color:#0000FF;font-weight: bold">or</span> AscB(char) &gt; <span style="color:#326598">57</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">if</span> char &lt;&gt; <span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span> number = <span style="color:#6500FE">&quot;&quot;</span>
					<span style="color:#0000FF;font-weight: bold">exit</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					number = char + number
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> number &lt;&gt; <span style="color:#6500FE">&quot;&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> theName.LeftB(theName.LenB - number.LenB) + str(val(number) + <span style="color:#326598">1</span>) + extension
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">return</span> theName + <span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">1&quot;</span> + extension
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_precalculateSizes(item <span style="color:#0000FF;font-weight: bold">as</span> folderitem) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> item.Directory <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#7F0000;text-style:italic">//handle</span> <span style="color:#7F0000;text-style:italic">children</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> item.Count
					<span style="color:#0000FF;font-weight: bold">if</span> item.item(i).name &lt;&gt; <span style="color:#6500FE">&quot;.DS_Store&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
						total = total + z_precalculateSizes(item.Item(i)) <span style="color:#7F0000;text-style:italic">//repeat</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">item</span> <span style="color:#7F0000;text-style:italic">contents</span>
					<span style="color:#0000FF;font-weight: bold">end</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">return</span> total
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> total + item.Length
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_setParent(parent <span style="color:#0000FF;font-weight: bold">as</span> ZipItem)
			<span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">parent</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">archive</span> <span style="color:#7F0000;text-style:italic">properties</span>
			<span style="color:#0000FF;font-weight: bold">me</span>.parent = parent
			<span style="color:#0000FF;font-weight: bold">if</span> parent <span style="color:#0000FF;font-weight: bold">isa</span> ZipArchive <span style="color:#0000FF;font-weight: bold">then</span>
				archive = ZipArchive(parent)
			<span style="color:#0000FF;font-weight: bold">else</span>
				archive = parent.archive
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_tagForDeletion()
			<span style="color:#7F0000;text-style:italic">//delete</span> <span style="color:#7F0000;text-style:italic">children</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
				children(i).z_tagForDeletion
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#7F0000;text-style:italic">//tag</span>
			deleted = <span style="color:#0000FF;font-weight: bold">true</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeFile(sw <span style="color:#0000FF;font-weight: bold">as</span> StreamWriter, item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = <span style="color:#0000FF;font-weight: bold">nil</span>, options <span style="color:#0000FF;font-weight: bold">as</span> ExpansionOptions, progress <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress)
			<span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">data</span>
			ZipItem(archive).z_writeFile sw, <span style="color:#0000FF;font-weight: bold">me</span>, options, progress
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeFileHeader(sw <span style="color:#0000FF;font-weight: bold">as</span> StreamWriter, item <span style="color:#0000FF;font-weight: bold">as</span> Zipitem = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">header</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">item</span>
			ZipItem(archive).z_writeFileHeader sw, <span style="color:#0000FF;font-weight: bold">me</span>
			
			<span style="color:#7F0000;text-style:italic">//handle</span> <span style="color:#7F0000;text-style:italic">children</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
				children(i).z_writeFileHeader sw
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeFileHeaders()
			ZipItem(archive).z_writeFileHeaders
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeFileRecord(item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = <span style="color:#0000FF;font-weight: bold">nil</span>, data <span style="color:#0000FF;font-weight: bold">as</span> FileStream, progress <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress)
			ZipItem(archive).z_writeFileRecord <span style="color:#0000FF;font-weight: bold">me</span>, data, progress
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> archive <span style="color:#0000FF;font-weight: bold">As</span> ZipArchive</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> children() <span style="color:#0000FF;font-weight: bold">As</span> ZipItem</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> comment <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> compressedSize <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> compressionOptions <span style="color:#0000FF;font-weight: bold">As</span> CompressionOptions</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> crc <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint32</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> deleted <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">boolean</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> directory <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">boolean</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> expansionOptions <span style="color:#0000FF;font-weight: bold">As</span> ExpansionOptions</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> extraData <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> modified <span style="color:#0000FF;font-weight: bold">As</span> Date</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> parent <span style="color:#0000FF;font-weight: bold">As</span> ZipItem</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> path <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> relativeOffset <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> uncompressedSize <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> ZipArchive <span style="color:#0000FF;font-weight: bold">Inherits</span> ZipItem</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> useMBS = <span style="color:#0000FF;font-weight: bold">true</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> constructor(archive <span style="color:#0000FF;font-weight: bold">as</span> folderitem)
			<span style="color:#7F0000;text-style:italic">//only</span> <span style="color:#7F0000;text-style:italic">call</span> <span style="color:#7F0000;text-style:italic">once</span>
			<span style="color:#0000FF;font-weight: bold">if</span> archiveFile &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
			
			<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">default</span> <span style="color:#7F0000;text-style:italic">settings</span>
			z_setDefaultOptions
			
			archiveFile = archive <span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">archive</span> <span style="color:#7F0000;text-style:italic">file</span>
			directory = <span style="color:#0000FF;font-weight: bold">true</span> <span style="color:#7F0000;text-style:italic">//archive</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">always</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">directory</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> archive.Exists <span style="color:#0000FF;font-weight: bold">then</span>
				
				<span style="color:#7F0000;text-style:italic">//open</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">archive</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> sr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> FileStream(archive,<span style="color:#0000FF;font-weight: bold">true</span>)
				
				<span style="color:#7F0000;text-style:italic">//find</span> <span style="color:#7F0000;text-style:italic">end</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">record</span>
				
				<span style="color:#7F0000;text-style:italic">//work</span> <span style="color:#7F0000;text-style:italic">backwards</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">find</span> <span style="color:#7F0000;text-style:italic">signature</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = sr.getLength - <span style="color:#326598">4</span> <span style="color:#0000FF;font-weight: bold">downto</span> <span style="color:#326598">0</span>
					sr.setPosition i
					<span style="color:#0000FF;font-weight: bold">dim</span> signature <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt32</span> = sr.readUInt32
					<span style="color:#0000FF;font-weight: bold">if</span> signature = <span style="color:#326598">&amp;h06054b50</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">exit</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> sr.getPosition = <span style="color:#326598">4</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#7F0000;text-style:italic">//failed</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">find</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">may</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">corrupt</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">zip</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">at</span> <span style="color:#7F0000;text-style:italic">all</span>
					<span style="color:#0000FF;font-weight: bold">return</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					
					sr.skip <span style="color:#326598">6</span>
					<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">entries</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> entries <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span> = sr.readUInt16
					
					<span style="color:#7F0000;text-style:italic">//find</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">go</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">start</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span>
					sr.skip <span style="color:#326598">4</span>
					centralDirectoryStart = sr.readUInt32
					sr.setPosition centralDirectoryStart
					
					<span style="color:#7F0000;text-style:italic">//parse</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">headers</span>
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> entries
						z_addChild z_readFileHeader(sr)
					<span style="color:#0000FF;font-weight: bold">next</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span>
				
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> delete(progress <span style="color:#0000FF;font-weight: bold">as</span> ProgressMonitor = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#0000FF;font-weight: bold">dim</span> zp <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				zp = <span style="color:#0000FF;font-weight: bold">new</span> ZipProgress(<span style="color:#326598">1</span>,progress)
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#7F0000;text-style:italic">//tag</span> <span style="color:#7F0000;text-style:italic">children</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">deletion</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> children() <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = getChildren
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
				children(i).z_tagForDeletion
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#7F0000;text-style:italic">//compact</span> <span style="color:#7F0000;text-style:italic">file</span>
			z_compact zp
			
			<span style="color:#7F0000;text-style:italic">//delete</span> <span style="color:#7F0000;text-style:italic">children</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(children)
				children(i).z_delete
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">records</span>
			z_writeFileHeaders
			
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> zp.increment <span style="color:#326598">1</span> <span style="color:#7F0000;text-style:italic">//notify</span> <span style="color:#7F0000;text-style:italic">completion</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getArchive() <span style="color:#0000FF;font-weight: bold">As</span> ZipArchive
			<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">me</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getFileCount() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint32</span>
			<span style="color:#0000FF;font-weight: bold">return</span> files
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Shared</span> <span style="color:#0000FF;font-weight: bold">Function</span> getFileType() <span style="color:#0000FF;font-weight: bold">As</span> FileType
			<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> FileType
			f.Name = <span style="color:#6500FE">&quot;zip&quot;</span>
			f.Extensions = <span style="color:#6500FE">&quot;.zip&quot;</span>
			<span style="color:#0000FF;font-weight: bold">return</span> f
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getName() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">return</span> archiveFile.Name
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> getParent() <span style="color:#0000FF;font-weight: bold">As</span> ZipItem
			<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> setCompressionOptions(options <span style="color:#0000FF;font-weight: bold">as</span> CompressionOptions)
			compressionOptions = options
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_compact(progress <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress)
			<span style="color:#7F0000;text-style:italic">//sort</span> <span style="color:#7F0000;text-style:italic">all</span> <span style="color:#7F0000;text-style:italic">items</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">archive</span> <span style="color:#7F0000;text-style:italic">by</span> <span style="color:#7F0000;text-style:italic">offset</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> offsets() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> items() <span style="color:#0000FF;font-weight: bold">as</span> ZipItem
			z_collateItems offsets, items
			offsets.Append centralDirectoryStart
			
			<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#7F0000;text-style:italic">//calculate</span> <span style="color:#7F0000;text-style:italic">amount</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">that</span> <span style="color:#7F0000;text-style:italic">must</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">moved</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> counterStarted <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Boolean</span> = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(items)
					<span style="color:#0000FF;font-weight: bold">if</span> items(i).deleted <span style="color:#0000FF;font-weight: bold">then</span>
						counterStarted = <span style="color:#0000FF;font-weight: bold">true</span>
					<span style="color:#0000FF;font-weight: bold">elseif</span> counterStarted <span style="color:#0000FF;font-weight: bold">then</span>
						progress.total = progress.total + offsets(i+<span style="color:#326598">1</span>) - offsets(i)
					<span style="color:#0000FF;font-weight: bold">end</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> shift <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = offsets(<span style="color:#326598">0</span>) <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">would</span> <span style="color:#7F0000;text-style:italic">normally</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">zero,</span> <span style="color:#7F0000;text-style:italic">but</span> <span style="color:#7F0000;text-style:italic">just</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">case...</span>
			
			<span style="color:#7F0000;text-style:italic">//open</span> <span style="color:#7F0000;text-style:italic">archive</span> <span style="color:#7F0000;text-style:italic">input</span> <span style="color:#7F0000;text-style:italic">stream</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">skip</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">location</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> fs <span style="color:#0000FF;font-weight: bold">as</span> FileStream = <span style="color:#0000FF;font-weight: bold">new</span> FileStream(archiveFile,<span style="color:#0000FF;font-weight: bold">true</span>)
			
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(items)
				
				<span style="color:#0000FF;font-weight: bold">dim</span> offset <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = offsets(i)
				<span style="color:#0000FF;font-weight: bold">dim</span> length <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt64</span> = offsets(i+<span style="color:#326598">1</span>) - offset
				
				<span style="color:#0000FF;font-weight: bold">dim</span> item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = items(i)
				<span style="color:#0000FF;font-weight: bold">if</span> item.deleted <span style="color:#0000FF;font-weight: bold">then</span>
					
					<span style="color:#7F0000;text-style:italic">//adjust</span> <span style="color:#7F0000;text-style:italic">shift</span>
					shift = shift + length
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> shift &gt; <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					
					<span style="color:#7F0000;text-style:italic">//shift</span> <span style="color:#7F0000;text-style:italic">offset</span>
					item.relativeOffset = item.relativeOffset - shift
					
					<span style="color:#7F0000;text-style:italic">//move</span> <span style="color:#7F0000;text-style:italic">data</span>
					fs.setPosition offset
					<span style="color:#0000FF;font-weight: bold">dim</span> total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = length
					<span style="color:#0000FF;font-weight: bold">while</span> total &gt; <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">dim</span> chunk <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span> = min(total,compressionOptions.deflateWindow)
						<span style="color:#0000FF;font-weight: bold">dim</span> data <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = fs.readString(chunk)
						fs.setPosition offset - shift
						fs.writeString data
						total = total - chunk
						<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span>  <span style="color:#0000FF;font-weight: bold">then</span> progress.increment chunk
					<span style="color:#0000FF;font-weight: bold">wend</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span>
				
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			centralDirectoryStart = fs.getPosition
			fs.truncate
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_getCRC(previous <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint32</span> = <span style="color:#326598">0</span>, data <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint32</span>
			<span style="color:#0000FF">#pragma</span> BoundsChecking <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF">#pragma</span> NilObjectChecking <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF">#pragma</span> BackgroundTasks <span style="color:#0000FF;font-weight: bold">false</span>
			
			<span style="color:#0000FF">#if</span> useMBS
				
				<span style="color:#0000FF;font-weight: bold">static</span> z <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZLibCompressMBS
				
				<span style="color:#7F0000;text-style:italic">//use</span> <span style="color:#7F0000;text-style:italic">mbs</span> <span style="color:#7F0000;text-style:italic">zlib</span> <span style="color:#7F0000;text-style:italic">crc</span> <span style="color:#7F0000;text-style:italic">function</span>
				<span style="color:#0000FF;font-weight: bold">return</span> z.CRC32(previous, data)
				
			<span style="color:#0000FF">#else</span>
				
				<span style="color:#7F0000;text-style:italic">//create</span> <span style="color:#7F0000;text-style:italic">crc</span> <span style="color:#7F0000;text-style:italic">table</span>
				<span style="color:#0000FF;font-weight: bold">if</span> crc32Table(<span style="color:#326598">0</span>) = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					
					<span style="color:#7F0000;text-style:italic">&#39;this</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">official</span> <span style="color:#7F0000;text-style:italic">polynomial</span> <span style="color:#7F0000;text-style:italic">used</span> <span style="color:#7F0000;text-style:italic">by</span> <span style="color:#7F0000;text-style:italic">CRC32</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">PKZip.</span>
					<span style="color:#7F0000;text-style:italic">&#39;often</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">polynomial</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">shown</span> <span style="color:#7F0000;text-style:italic">reversed</span> <span style="color:#7F0000;text-style:italic">(04C11DB7).</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> dwPolynomial <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Int32</span> = <span style="color:#326598">&amp;hEDB88320</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, j <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Integer</span>
					
					<span style="color:#0000FF;font-weight: bold">dim</span> dwCrc <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int32</span>
					
					<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">255</span>
						dwCrc = i
						<span style="color:#0000FF;font-weight: bold">for</span> j = <span style="color:#326598">8</span> <span style="color:#0000FF;font-weight: bold">downto</span> <span style="color:#326598">1</span>
							<span style="color:#0000FF;font-weight: bold">If</span> ((dwCrc <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">1</span>) &gt; <span style="color:#326598">0</span>) <span style="color:#0000FF;font-weight: bold">Then</span>
								dwCrc = ((dwCrc <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;hFFFFFFFE</span>) \ <span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;h7FFFFFFF</span>
								dwCrc = dwCrc xor dwPolynomial
							<span style="color:#0000FF;font-weight: bold">Else</span>
								dwCrc = (((dwCrc <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;hFFFFFFFE</span>) \ <span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;h7FFFFFFF</span>)
							<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
						<span style="color:#0000FF;font-weight: bold">next</span>
						crc32Table(i) = dwCrc
					<span style="color:#0000FF;font-weight: bold">next</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span>
				
				<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">crc</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> crc <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint32</span> = Bitwise.OnesComplement(previous)
				<span style="color:#0000FF;font-weight: bold">dim</span> iLookup <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> size <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint32</span> = data.LenB
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint32</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> size
					iLookup = (crc <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;hFF</span>) Xor data.MidB(i,<span style="color:#326598">1</span>).Asc
					crc = ((crc <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;hFFFFFF00</span>) \ <span style="color:#326598">&amp;h100</span>) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">16777215</span>
					crc = crc <span style="color:#0000FF;font-weight: bold">or</span> crc32Table(iLookup)
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				<span style="color:#0000FF;font-weight: bold">return</span> Bitwise.OnesComplement(crc)
				
			<span style="color:#0000FF">#endif</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_getCompressionBits(options <span style="color:#0000FF;font-weight: bold">as</span> CompressionOptions) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint16</span>
			<span style="color:#0000FF;font-weight: bold">if</span> options.method &lt;&gt; CompressionMethod.deflate <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#7F0000;text-style:italic">//leave</span> <span style="color:#7F0000;text-style:italic">bits</span> <span style="color:#7F0000;text-style:italic">empty</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">&amp;b0000000000000000</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> options.deflateLevel
			<span style="color:#0000FF;font-weight: bold">case</span> DeflateLevel.normal
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">&amp;b0000000000000000</span>
			<span style="color:#0000FF;font-weight: bold">case</span> DeflateLevel.maximum
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">&amp;b0000000000000010</span>
			<span style="color:#0000FF;font-weight: bold">case</span> DeflateLevel.fast
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">&amp;b0000000000000100</span>
			<span style="color:#0000FF;font-weight: bold">case</span> DeflateLevel.fastest
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">&amp;b0000000000000110</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">Raise</span> <span style="color:#0000FF;font-weight: bold">new</span> UnsupportedFormatException
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_getDeflateLevel(flags <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span>) <span style="color:#0000FF;font-weight: bold">As</span> DeflateLevel
			flags = Bitwise.BitAnd(flags,<span style="color:#326598">&amp;b0000000000000110</span>)
			<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> flags
			<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">return</span> DeflateLevel.normal
			<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">return</span> DeflateLevel.maximum
			<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">2</span>
				<span style="color:#0000FF;font-weight: bold">return</span> DeflateLevel.fast
			<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">3</span>
				<span style="color:#0000FF;font-weight: bold">return</span> DeflateLevel.fastest
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_getMBSCompressionLevel(level <span style="color:#0000FF;font-weight: bold">as</span> DeflateLevel) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint8</span>
			<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> level
			<span style="color:#0000FF;font-weight: bold">case</span> DeflateLevel.maximum
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">9</span>
			<span style="color:#0000FF;font-weight: bold">case</span> DeflateLevel.normal
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">6</span>
			<span style="color:#0000FF;font-weight: bold">case</span> DeflateLevel.fast
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">3</span>
			<span style="color:#0000FF;font-weight: bold">case</span> DeflateLevel.fastest
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">0</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">Raise</span> <span style="color:#0000FF;font-weight: bold">new</span> UnsupportedFormatException
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_getZLibHeader(item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF">#if</span> useMBS
				<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">zlib</span> <span style="color:#7F0000;text-style:italic">header</span>
				<span style="color:#0000FF;font-weight: bold">return</span> CompressZLibMBS(<span style="color:#6500FE">&quot;foo&quot;</span>,z_getMBSCompressionLevel(item.compressionOptions.deflateLevel)).leftb(<span style="color:#326598">2</span>)
			<span style="color:#0000FF">#endif</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_readCompressionMethod(sr <span style="color:#0000FF;font-weight: bold">as</span> StreamReader) <span style="color:#0000FF;font-weight: bold">As</span> CompressionMethod
			<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> sr.readUInt16
			<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">8</span>
				<span style="color:#0000FF;font-weight: bold">return</span> CompressionMethod.deflate
			<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">return</span> CompressionMethod.none
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">return</span> CompressionMethod.unsupported
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_readFileHeader(sr <span style="color:#0000FF;font-weight: bold">as</span> StreamReader) <span style="color:#0000FF;font-weight: bold">As</span> ZipItem
			<span style="color:#0000FF;font-weight: bold">dim</span> item <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZipItem
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">header</span> <span style="color:#7F0000;text-style:italic">signature</span>
			<span style="color:#0000FF;font-weight: bold">if</span> sr.readUInt32&lt;&gt; <span style="color:#326598">&amp;h02014b50</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#7F0000;text-style:italic">//possibly</span> <span style="color:#7F0000;text-style:italic">corrupt?</span>
			
			<span style="color:#7F0000;text-style:italic">//version</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt8
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">system</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt8
			
			<span style="color:#7F0000;text-style:italic">//required</span> <span style="color:#7F0000;text-style:italic">version</span>
			<span style="color:#0000FF;font-weight: bold">if</span> sr.readUInt16/<span style="color:#326598">10</span>  &gt; <span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#7F0000;text-style:italic">//can&#39;t</span> <span style="color:#7F0000;text-style:italic">read</span> <span style="color:#7F0000;text-style:italic">it</span>
			
			<span style="color:#7F0000;text-style:italic">//general</span> <span style="color:#7F0000;text-style:italic">purpose</span> <span style="color:#7F0000;text-style:italic">bit</span> <span style="color:#7F0000;text-style:italic">flags</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> flags <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span> = sr.readUInt16
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000000001</span> <span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">encrypted</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000000110</span> <span style="color:#7F0000;text-style:italic">//compression</span> <span style="color:#7F0000;text-style:italic">bits</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000001000</span> <span style="color:#7F0000;text-style:italic">//crc32</span> <span style="color:#7F0000;text-style:italic">field</span> <span style="color:#7F0000;text-style:italic">blank</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000010000</span> <span style="color:#7F0000;text-style:italic">//reserved</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">method</span> <span style="color:#7F0000;text-style:italic">8</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000100000</span> <span style="color:#7F0000;text-style:italic">//patch</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000001000000</span> <span style="color:#7F0000;text-style:italic">//strong</span> <span style="color:#7F0000;text-style:italic">encryption</span>
			item.compressionOptions.deflateLevel = z_getDeflateLevel(flags)
			
			<span style="color:#7F0000;text-style:italic">//compression</span> <span style="color:#7F0000;text-style:italic">method</span>
			item.compressionOptions.method = z_readCompressionMethod(sr)
			
			<span style="color:#7F0000;text-style:italic">//time</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">date</span>
			item.modified = z_readTimeStamp(sr)
			
			<span style="color:#7F0000;text-style:italic">//crc</span> <span style="color:#7F0000;text-style:italic">32</span>
			item.crc = sr.readUInt32
			<span style="color:#7F0000;text-style:italic">//compressed</span> <span style="color:#7F0000;text-style:italic">size</span>
			item.compressedSize = sr.readUInt32
			<span style="color:#7F0000;text-style:italic">//uncompressed</span> <span style="color:#7F0000;text-style:italic">size</span>
			item.uncompressedSize = sr.readUInt32
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">length</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> pathLength <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span>= sr.readUInt16
			<span style="color:#7F0000;text-style:italic">//extra</span> <span style="color:#7F0000;text-style:italic">field</span> <span style="color:#7F0000;text-style:italic">length</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> extraFieldLength <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span>= sr.readUInt16
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">comment</span> <span style="color:#7F0000;text-style:italic">length</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> commentLength <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span>= sr.readUInt16
			
			<span style="color:#7F0000;text-style:italic">//disk</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">start</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt16
			
			<span style="color:#7F0000;text-style:italic">//internal</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">attributes</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt16
			
			<span style="color:#7F0000;text-style:italic">//external</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">attibutes</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt32
			
			<span style="color:#7F0000;text-style:italic">//relative</span> <span style="color:#7F0000;text-style:italic">offset</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">local</span> <span style="color:#7F0000;text-style:italic">header</span>
			item.relativeOffset = sr.readUInt32
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">name</span>
			item.path = sr.readString(pathLength,encodings.DOSLatinUS)
			item.name = NthField(item.path,<span style="color:#6500FE">&quot;/&quot;</span>,CountFields(item.path,<span style="color:#6500FE">&quot;/&quot;</span>))
			<span style="color:#0000FF;font-weight: bold">if</span> item.name = <span style="color:#6500FE">&quot;&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
				item.name = NthField(item.path,<span style="color:#6500FE">&quot;/&quot;</span>,CountFields(item.path,<span style="color:#6500FE">&quot;/&quot;</span>)-<span style="color:#326598">1</span>)
				item.directory = <span style="color:#0000FF;font-weight: bold">true</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#7F0000;text-style:italic">//extra</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readString(extraFieldLength)
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">comment</span>
			item.comment = sr.readString(commentLength)
			
			<span style="color:#0000FF;font-weight: bold">return</span> item
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> z_readTimeStamp(sr <span style="color:#0000FF;font-weight: bold">as</span> StreamReader) <span style="color:#0000FF;font-weight: bold">As</span> Date
			<span style="color:#0000FF;font-weight: bold">dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> Date
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">get</span> <span style="color:#7F0000;text-style:italic">time</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> time <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span> = sr.readUInt16
			d.Hour = Bitwise.BitAnd(time,<span style="color:#326598">63488</span>) \ <span style="color:#326598">2048</span>
			d.Minute = Bitwise.BitAnd(time,<span style="color:#326598">2016</span>) \ <span style="color:#326598">32</span>
			d.Second = Bitwise.BitAnd(time,<span style="color:#326598">31</span>) * <span style="color:#326598">2</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">get</span> <span style="color:#7F0000;text-style:italic">date</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> date <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span> = sr.readUInt16
			d.Year = Bitwise.BitAnd(date,<span style="color:#326598">65024</span>) \ <span style="color:#326598">512</span> + <span style="color:#326598">1980</span>
			d.Month =  Bitwise.BitAnd(date,<span style="color:#326598">480</span>) \ <span style="color:#326598">32</span>
			d.Day = Bitwise.BitAnd(date,<span style="color:#326598">31</span>)
			
			<span style="color:#0000FF;font-weight: bold">return</span> d
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_setDefaultOptions()
			<span style="color:#7F0000;text-style:italic">//compression</span> <span style="color:#7F0000;text-style:italic">options</span>
			<span style="color:#0000FF">#if</span> useMBS <span style="color:#0000FF;font-weight: bold">then</span>
				compressionOptions.method = CompressionMethod.deflate
			<span style="color:#0000FF">#else</span>
				compressionOptions.method = CompressionMethod.none
			<span style="color:#0000FF">#endif</span>
			compressionOptions.deflateLevel = DeflateLevel.normal
			compressionOptions.deflateWindow = <span style="color:#326598">32768</span>
			
			<span style="color:#7F0000;text-style:italic">//decompression</span> <span style="color:#7F0000;text-style:italic">options</span>
			expansionOptions.ignoreChecksum = <span style="color:#0000FF;font-weight: bold">false</span>
			expansionOptions.ignoreErrors = <span style="color:#0000FF;font-weight: bold">false</span>
			expansionOptions.replaceFiles = <span style="color:#0000FF;font-weight: bold">false</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeCompressionMethod(sw <span style="color:#0000FF;font-weight: bold">as</span> StreamWriter, method <span style="color:#0000FF;font-weight: bold">as</span> CompressionMethod)
			<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> method
			<span style="color:#0000FF;font-weight: bold">case</span> CompressionMethod.deflate
				sw.writeUInt16 <span style="color:#326598">8</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				sw.writeUInt16 <span style="color:#326598">0</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeFile(sw <span style="color:#0000FF;font-weight: bold">as</span> StreamWriter, item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = <span style="color:#0000FF;font-weight: bold">nil</span>, options <span style="color:#0000FF;font-weight: bold">as</span> ExpansionOptions, progress <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress)
			<span style="color:#7F0000;text-style:italic">//open</span> <span style="color:#7F0000;text-style:italic">archive</span> <span style="color:#7F0000;text-style:italic">input</span> <span style="color:#7F0000;text-style:italic">stream</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">skip</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">location</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> sr <span style="color:#0000FF;font-weight: bold">as</span> FileStream = <span style="color:#0000FF;font-weight: bold">new</span> FileStream(archiveFile,<span style="color:#0000FF;font-weight: bold">true</span>)
			sr.setPosition item.relativeOffset
			
			<span style="color:#7F0000;text-style:italic">//local</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">header</span> <span style="color:#7F0000;text-style:italic">signature</span>
			<span style="color:#0000FF;font-weight: bold">if</span> sr.readUInt32 &lt;&gt; <span style="color:#326598">&amp;h04034b50</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//not</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">valid</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">record</span>
			
			<span style="color:#7F0000;text-style:italic">//required</span> <span style="color:#7F0000;text-style:italic">version</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> version <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">single</span> = sr.readUInt16/<span style="color:#326598">10</span>
			<span style="color:#0000FF;font-weight: bold">if</span> version &gt; <span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#7F0000;text-style:italic">//incompatible</span> <span style="color:#7F0000;text-style:italic">version</span>
			
			<span style="color:#7F0000;text-style:italic">//general</span> <span style="color:#7F0000;text-style:italic">purpose</span> <span style="color:#7F0000;text-style:italic">bit</span> <span style="color:#7F0000;text-style:italic">flags</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt16
			
			<span style="color:#7F0000;text-style:italic">//compression</span> <span style="color:#7F0000;text-style:italic">method</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt16
			
			<span style="color:#7F0000;text-style:italic">//last</span> <span style="color:#7F0000;text-style:italic">modified</span> <span style="color:#7F0000;text-style:italic">time</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt16
			<span style="color:#7F0000;text-style:italic">//last</span> <span style="color:#7F0000;text-style:italic">modified</span> <span style="color:#7F0000;text-style:italic">date</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt16
			
			<span style="color:#7F0000;text-style:italic">//crc</span> <span style="color:#7F0000;text-style:italic">32</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt32
			<span style="color:#7F0000;text-style:italic">//compressed</span> <span style="color:#7F0000;text-style:italic">size</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt32
			<span style="color:#7F0000;text-style:italic">//uncompressed</span> <span style="color:#7F0000;text-style:italic">size</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readUInt32
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">length</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> pathLength <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span>= sr.readUInt16
			<span style="color:#7F0000;text-style:italic">//extra</span> <span style="color:#7F0000;text-style:italic">field</span> <span style="color:#7F0000;text-style:italic">length</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> extraFieldLength <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint16</span>= sr.readUInt16
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">name</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readString(pathLength,encodings.DOSLatinUS)
			<span style="color:#7F0000;text-style:italic">//extra</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#0000FF;font-weight: bold">call</span> sr.readString(extraFieldLength)
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#0000FF;font-weight: bold">if</span> useMBS <span style="color:#0000FF;font-weight: bold">and</span> item.compressionOptions.method = CompressionMethod.deflate <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF">#if</span> useMBS
					<span style="color:#7F0000;text-style:italic">//deflate</span> <span style="color:#7F0000;text-style:italic">(requires</span> <span style="color:#7F0000;text-style:italic">mbs)</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = item.getCompressedSize
					<span style="color:#0000FF;font-weight: bold">dim</span> z <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZLibDecompressMBS
					z.InitZip
					<span style="color:#0000FF;font-weight: bold">call</span> z.setInput z_getZLibHeader(item)
					<span style="color:#0000FF;font-weight: bold">do</span>
						<span style="color:#0000FF;font-weight: bold">if</span> z.OutputSize = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">and</span> z.InputAvail = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">dim</span> chunk <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span> = min(total,compressionOptions.deflateWindow)
							<span style="color:#0000FF;font-weight: bold">call</span> z.setInput  sr.readString(chunk)
							total = total - chunk
							<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> progress.increment chunk
						<span style="color:#0000FF;font-weight: bold">end</span>
						z.ProcessZip
						sw.writeString z.GetOutput
					<span style="color:#0000FF;font-weight: bold">loop</span> <span style="color:#0000FF;font-weight: bold">until</span> z.OutputSize = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">and</span> z.InputAvail = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">and</span> total = <span style="color:#326598">0</span>
					z.EndZip
				<span style="color:#0000FF">#endif</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#7F0000;text-style:italic">//no</span> <span style="color:#7F0000;text-style:italic">compression</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = item.getCompressedSize
				<span style="color:#0000FF;font-weight: bold">while</span> total &gt; <span style="color:#326598">0</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> chunk <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span> = min(total,compressionOptions.deflateWindow)
					sw.writeString sr.readString(chunk)
					total = total - chunk
					<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> progress.increment chunk
				<span style="color:#0000FF;font-weight: bold">wend</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeFileHeader(sw <span style="color:#0000FF;font-weight: bold">as</span> StreamWriter, item <span style="color:#0000FF;font-weight: bold">as</span> Zipitem = <span style="color:#0000FF;font-weight: bold">nil</span>)
			<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">compression</span> <span style="color:#7F0000;text-style:italic">options</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> compressionOptions <span style="color:#0000FF;font-weight: bold">as</span> CompressionOptions = item.compressionOptions
			<span style="color:#0000FF">#if</span> <span style="color:#0000FF;font-weight: bold">not</span> useMBS
				compressionOptions.method = CompressionMethod.none
			<span style="color:#0000FF">#endif</span>
			
			<span style="color:#7F0000;text-style:italic">//only</span> <span style="color:#7F0000;text-style:italic">write</span> <span style="color:#7F0000;text-style:italic">files</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">empty</span> <span style="color:#7F0000;text-style:italic">directories</span>
			<span style="color:#0000FF;font-weight: bold">if</span> item.isDirectory <span style="color:#0000FF;font-weight: bold">then</span>
				directories = directories + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">if</span> ubound(item.getChildren) &gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				compressionOptions.method = CompressionMethod.none
				emptyDirectories = emptyDirectories + <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				files = files + <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">header</span> <span style="color:#7F0000;text-style:italic">signature</span>
			sw.writeUInt32 <span style="color:#326598">&amp;h02014b50</span>
			
			<span style="color:#7F0000;text-style:italic">//version</span>
			sw.writeUInt8  <span style="color:#326598">2</span>*<span style="color:#326598">10</span> + <span style="color:#326598">1</span>
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">system</span>
			<span style="color:#0000FF">#if</span> TargetWin32
				<span style="color:#7F0000;text-style:italic">//should</span> <span style="color:#7F0000;text-style:italic">check</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">other</span> <span style="color:#7F0000;text-style:italic">windows</span> <span style="color:#7F0000;text-style:italic">filesystem</span> <span style="color:#7F0000;text-style:italic">types</span>
				sw.writeUInt8 FilesystemFAT
			<span style="color:#0000FF">#elseif</span> TargetMacOS
				sw.writeUInt8 FilesystemOSX
			<span style="color:#0000FF">#elseif</span> TargetLinux
				sw.writeUInt8 FilesystemUnix
			<span style="color:#0000FF">#endif</span>
			
			<span style="color:#7F0000;text-style:italic">//required</span> <span style="color:#7F0000;text-style:italic">version</span>
			sw.writeUInt16 <span style="color:#326598">2</span>*<span style="color:#326598">10</span> + <span style="color:#326598">0</span>
			
			<span style="color:#7F0000;text-style:italic">//general</span> <span style="color:#7F0000;text-style:italic">purpose</span> <span style="color:#7F0000;text-style:italic">bit</span> <span style="color:#7F0000;text-style:italic">flags</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> flags <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000000001</span> <span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">encrypted</span>
			flags = flags + z_getCompressionBits(compressionOptions) <span style="color:#7F0000;text-style:italic">//compression</span> <span style="color:#7F0000;text-style:italic">bits</span>
			<span style="color:#0000FF;font-weight: bold">if</span> compressionOptions.method = CompressionMethod.deflate <span style="color:#0000FF;font-weight: bold">then</span>
				flags = flags + <span style="color:#326598">&amp;b0000000000001000</span> <span style="color:#7F0000;text-style:italic">//crc32</span> <span style="color:#7F0000;text-style:italic">field</span> <span style="color:#7F0000;text-style:italic">blank</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000010000</span> <span style="color:#7F0000;text-style:italic">//reserved</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">method</span> <span style="color:#7F0000;text-style:italic">8</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000100000</span> <span style="color:#7F0000;text-style:italic">//patch</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000001000000</span> <span style="color:#7F0000;text-style:italic">//strong</span> <span style="color:#7F0000;text-style:italic">encryption</span>
			sw.writeUInt16 flags
			
			<span style="color:#7F0000;text-style:italic">//compression</span> <span style="color:#7F0000;text-style:italic">method</span>
			z_writeCompressionMethod sw,compressionOptions.method
			
			<span style="color:#7F0000;text-style:italic">//time</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">date</span>
			z_writeTimeStamp sw,item.modified
			
			<span style="color:#7F0000;text-style:italic">//crc</span> <span style="color:#7F0000;text-style:italic">32</span>
			sw.writeUInt32 item.crc
			<span style="color:#7F0000;text-style:italic">//compressed</span> <span style="color:#7F0000;text-style:italic">size</span>
			sw.writeUInt32 item.getCompressedSize
			<span style="color:#7F0000;text-style:italic">//uncompressed</span> <span style="color:#7F0000;text-style:italic">size</span>
			sw.writeUInt32 item.getUncompressedSize
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">length</span>
			sw.writeUInt16 item.getPath.LenB
			<span style="color:#7F0000;text-style:italic">//extra</span> <span style="color:#7F0000;text-style:italic">field</span> <span style="color:#7F0000;text-style:italic">length</span>
			sw.writeUInt16 item.extraData.LenB
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">comment</span> <span style="color:#7F0000;text-style:italic">length</span>
			sw.writeUInt16 item.getComment.LenB
			
			<span style="color:#7F0000;text-style:italic">//disk</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">start</span>
			sw.writeUInt16 <span style="color:#326598">0</span>
			
			<span style="color:#7F0000;text-style:italic">//internal</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">attributes</span>
			sw.writeUInt16 <span style="color:#326598">0</span>
			
			<span style="color:#7F0000;text-style:italic">//external</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">attibutes</span>
			sw.writeUInt32 <span style="color:#326598">&amp;h81a44000</span>  <span style="color:#7F0000;text-style:italic">//temporary</span>
			
			<span style="color:#7F0000;text-style:italic">//relative</span> <span style="color:#7F0000;text-style:italic">offset</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">local</span> <span style="color:#7F0000;text-style:italic">header</span>
			sw.writeUInt32 item.relativeOffset
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">path</span>
			sw.writeString item.getPath
			<span style="color:#7F0000;text-style:italic">//extra</span> <span style="color:#7F0000;text-style:italic">field</span>
			sw.writeString item.extraData
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">comment</span>
			sw.writeString item.getComment
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeFileHeaders()
			<span style="color:#7F0000;text-style:italic">//reset</span> <span style="color:#7F0000;text-style:italic">counters</span>
			files = <span style="color:#326598">0</span>
			directories = <span style="color:#326598">0</span>
			emptyDirectories = <span style="color:#326598">0</span>
			
			<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">output</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">stream</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> sw <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> FileStream(archiveFile,<span style="color:#0000FF;font-weight: bold">true</span>)
			sw.skip centralDirectoryStart
			
			<span style="color:#0000FF;font-weight: bold">dim</span> items() <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = getChildren
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ubound(items)
				items(i).z_writeFileHeader sw
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#7F0000;text-style:italic">//digital</span> <span style="color:#7F0000;text-style:italic">signature</span> <span style="color:#7F0000;text-style:italic">------------</span>
			
			<span style="color:#7F0000;text-style:italic">&#39;sw.writeUInt32</span> <span style="color:#7F0000;text-style:italic">&amp;h05054b50</span> <span style="color:#7F0000;text-style:italic">//header</span> <span style="color:#7F0000;text-style:italic">signature</span>
			<span style="color:#7F0000;text-style:italic">&#39;sw.writeUInt16</span> <span style="color:#7F0000;text-style:italic">0</span> <span style="color:#7F0000;text-style:italic">//data</span> <span style="color:#7F0000;text-style:italic">size</span>
			<span style="color:#7F0000;text-style:italic">&#39;no</span> <span style="color:#7F0000;text-style:italic">data</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> cdLength <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint32</span> = sw.getLength - centralDirectoryStart
			<span style="color:#0000FF;font-weight: bold">dim</span> cdItems <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint32</span> = files + emptyDirectories
			
			<span style="color:#7F0000;text-style:italic">//end</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">record</span>
			sw.writeUInt32 <span style="color:#326598">&amp;h06054b50</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">signature</span>
			sw.writeUInt16 <span style="color:#326598">0</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">disk</span> <span style="color:#7F0000;text-style:italic">number</span>
			sw.writeUInt16 <span style="color:#326598">0</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">disk</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">start</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span>
			sw.writeUInt16 cdItems <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">total</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">entries</span> <span style="color:#7F0000;text-style:italic">on</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">disk</span>
			sw.writeUInt16 cdItems <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">total</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">entries</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span>
			sw.writeUInt32 cdLength <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">size</span>
			sw.writeUInt32 centralDirectoryStart <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">central</span> <span style="color:#7F0000;text-style:italic">directory</span> <span style="color:#7F0000;text-style:italic">offset</span>
			sw.writeUInt16 <span style="color:#326598">0</span> <span style="color:#7F0000;text-style:italic">//comment</span> <span style="color:#7F0000;text-style:italic">length</span>
			<span style="color:#7F0000;text-style:italic">&#39;no</span> <span style="color:#7F0000;text-style:italic">comment</span>
			
			<span style="color:#7F0000;text-style:italic">//truncate</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">length</span>
			sw.truncate
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeFileRecord(item <span style="color:#0000FF;font-weight: bold">as</span> ZipItem = <span style="color:#0000FF;font-weight: bold">nil</span>, data <span style="color:#0000FF;font-weight: bold">as</span> FileStream, progress <span style="color:#0000FF;font-weight: bold">as</span> ZipProgress)
			<span style="color:#0000FF">#pragma</span> NilObjectChecking <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF">#pragma</span> BoundsChecking <span style="color:#0000FF;font-weight: bold">false</span>
			
			<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">compression</span> <span style="color:#7F0000;text-style:italic">options</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> compressionOptions <span style="color:#0000FF;font-weight: bold">as</span> CompressionOptions = item.compressionOptions
			<span style="color:#0000FF">#if</span> <span style="color:#0000FF;font-weight: bold">not</span> useMBS
				compressionOptions.method = CompressionMethod.none
			<span style="color:#0000FF">#endif</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> item.isDirectory <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#7F0000;text-style:italic">//only</span> <span style="color:#7F0000;text-style:italic">write</span> <span style="color:#7F0000;text-style:italic">files</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">empty</span> <span style="color:#7F0000;text-style:italic">directories</span>
				<span style="color:#0000FF;font-weight: bold">if</span> ubound(item.getChildren) &gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span>
				<span style="color:#7F0000;text-style:italic">//don&#39;t</span> <span style="color:#7F0000;text-style:italic">compress</span> <span style="color:#7F0000;text-style:italic">directories</span>
				compressionOptions.method = CompressionMethod.none
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> item.uncompressedSize = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#7F0000;text-style:italic">//don&#39;t</span> <span style="color:#7F0000;text-style:italic">compress</span> <span style="color:#7F0000;text-style:italic">empty</span> <span style="color:#7F0000;text-style:italic">files</span>
				compressionOptions.method = CompressionMethod.none
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#7F0000;text-style:italic">//size</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">buffer</span> <span style="color:#7F0000;text-style:italic">used</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">copying</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#0000FF;font-weight: bold">const</span> bufferSize = <span style="color:#326598">1048576</span> <span style="color:#7F0000;text-style:italic">//1</span> <span style="color:#7F0000;text-style:italic">megabyte</span>
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">type</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> FileType
			f.Name = <span style="color:#6500FE">&quot;zip&quot;</span>
			f.Extensions = <span style="color:#6500FE">&quot;.zip&quot;</span>
			
			<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">output</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">stream</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> sw <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> FileStream(archiveFile,f,<span style="color:#0000FF;font-weight: bold">true</span>)
			<span style="color:#7F0000;text-style:italic">//skip</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">end</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">existing</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">records</span>
			sw.skip centralDirectoryStart
			
			<span style="color:#7F0000;text-style:italic">//set</span> <span style="color:#7F0000;text-style:italic">relative</span> <span style="color:#7F0000;text-style:italic">offset</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">record</span>
			item.relativeOffset = sw.getPosition
			
			sw.writeUInt32 <span style="color:#326598">&amp;h04034b50</span> <span style="color:#7F0000;text-style:italic">//local</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">header</span> <span style="color:#7F0000;text-style:italic">signature</span>
			
			<span style="color:#7F0000;text-style:italic">//required</span> <span style="color:#7F0000;text-style:italic">version</span>
			sw.writeUInt16 <span style="color:#326598">2</span>*<span style="color:#326598">10</span> + <span style="color:#326598">0</span>
			
			<span style="color:#7F0000;text-style:italic">//general</span> <span style="color:#7F0000;text-style:italic">purpose</span> <span style="color:#7F0000;text-style:italic">bit</span> <span style="color:#7F0000;text-style:italic">flags</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> flags <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000000001</span> <span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">encrypted</span>
			flags = flags + z_getCompressionBits(compressionOptions) <span style="color:#7F0000;text-style:italic">//compression</span> <span style="color:#7F0000;text-style:italic">bits</span>
			<span style="color:#0000FF;font-weight: bold">if</span> compressionOptions.method = CompressionMethod.deflate <span style="color:#0000FF;font-weight: bold">then</span>
				flags = flags + <span style="color:#326598">&amp;b0000000000001000</span> <span style="color:#7F0000;text-style:italic">//crc32</span> <span style="color:#7F0000;text-style:italic">field</span> <span style="color:#7F0000;text-style:italic">blank</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000010000</span> <span style="color:#7F0000;text-style:italic">//reserved</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">method</span> <span style="color:#7F0000;text-style:italic">8</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000000100000</span> <span style="color:#7F0000;text-style:italic">//patch</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#7F0000;text-style:italic">&#39;flags</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">flags</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">&amp;b0000000001000000</span> <span style="color:#7F0000;text-style:italic">//strong</span> <span style="color:#7F0000;text-style:italic">encryption</span>
			sw.writeUInt16 flags
			
			<span style="color:#7F0000;text-style:italic">//compression</span> <span style="color:#7F0000;text-style:italic">method</span>
			z_writeCompressionMethod sw,compressionOptions.method
			
			<span style="color:#7F0000;text-style:italic">//time</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">date</span>
			z_writeTimeStamp sw,item.modified
			
			<span style="color:#7F0000;text-style:italic">//get</span> <span style="color:#7F0000;text-style:italic">crc</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">uncompressed</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#0000FF;font-weight: bold">if</span> data &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">if</span> compressionOptions.method &lt;&gt; CompressionMethod.deflate <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = item.uncompressedSize
					<span style="color:#0000FF;font-weight: bold">while</span> total &gt; <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">dim</span> chunk <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span> = min(total,compressionOptions.deflateWindow)
						item.crc = z_getCRC(item.crc,data.readString(chunk))
						total = total - chunk
						<span style="color:#0000FF">#if</span> <span style="color:#0000FF;font-weight: bold">not</span> useMBS
							<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> progress.increment chunk*<span style="color:#006532">0.75</span>
						<span style="color:#0000FF">#endif</span>
					<span style="color:#0000FF;font-weight: bold">wend</span>
					data.setPosition <span style="color:#326598">0</span>
					item.compressedSize = item.uncompressedSize
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				item.crc = <span style="color:#326598">0</span>
				item.compressedSize = <span style="color:#326598">0</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> Bitwise.BitAnd(flags,<span style="color:#326598">&amp;b0000000000001000</span>) &gt; <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#7F0000;text-style:italic">//crc</span> <span style="color:#7F0000;text-style:italic">32</span>
				sw.writeUInt32 <span style="color:#326598">0</span>
				<span style="color:#7F0000;text-style:italic">//compressed</span> <span style="color:#7F0000;text-style:italic">size</span>
				sw.writeUInt32 <span style="color:#326598">0</span>
				<span style="color:#7F0000;text-style:italic">//uncompressed</span> <span style="color:#7F0000;text-style:italic">size</span>
				sw.writeUInt32 <span style="color:#326598">0</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#7F0000;text-style:italic">//crc</span> <span style="color:#7F0000;text-style:italic">32</span>
				sw.writeUInt32 item.crc
				<span style="color:#7F0000;text-style:italic">//compressed</span> <span style="color:#7F0000;text-style:italic">size</span>
				sw.writeUInt32 item.getCompressedSize
				<span style="color:#7F0000;text-style:italic">//uncompressed</span> <span style="color:#7F0000;text-style:italic">size</span>
				sw.writeUInt32 item.getUncompressedSize
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">length</span>
			sw.writeUInt16 item.getPath.LenB
			<span style="color:#7F0000;text-style:italic">//extra</span> <span style="color:#7F0000;text-style:italic">field</span> <span style="color:#7F0000;text-style:italic">length</span>
			sw.writeUInt16 item.extraData.LenB
			
			<span style="color:#7F0000;text-style:italic">//file</span> <span style="color:#7F0000;text-style:italic">name</span>
			sw.writeString item.getPath
			<span style="color:#7F0000;text-style:italic">//extra</span> <span style="color:#7F0000;text-style:italic">data</span>
			sw.writeString item.extraData
			
			<span style="color:#7F0000;text-style:italic">//output</span>
			<span style="color:#7F0000;text-style:italic">&#39;dim</span> <span style="color:#7F0000;text-style:italic">output</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">string</span>
			<span style="color:#0000FF;font-weight: bold">if</span> data &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">if</span> useMBS <span style="color:#0000FF;font-weight: bold">and</span> compressionOptions.method = CompressionMethod.deflate <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#7F0000;text-style:italic">//deflate</span> <span style="color:#7F0000;text-style:italic">(requires</span> <span style="color:#7F0000;text-style:italic">mbs)</span>
					<span style="color:#0000FF">#if</span> useMBS
						<span style="color:#0000FF;font-weight: bold">dim</span> total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = item.uncompressedSize
						<span style="color:#0000FF;font-weight: bold">dim</span> z <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> ZLibCompressMBS
						<span style="color:#0000FF;font-weight: bold">dim</span> stripHeader <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = <span style="color:#0000FF;font-weight: bold">true</span>
						z.InitZip z_getMBSCompressionLevel(compressionOptions.deflateLevel)
						<span style="color:#0000FF;font-weight: bold">do</span>
							<span style="color:#0000FF;font-weight: bold">if</span> z.InputAvail = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
								<span style="color:#7F0000;text-style:italic">//add</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">compression</span> <span style="color:#7F0000;text-style:italic">buffer</span>
								<span style="color:#0000FF;font-weight: bold">dim</span> chunk <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span> = min(total,compressionOptions.deflateWindow)
								<span style="color:#0000FF;font-weight: bold">dim</span> block <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = data.readString(chunk)
								<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> z.setInput(block) <span style="color:#0000FF;font-weight: bold">then</span>
									beep
								<span style="color:#0000FF;font-weight: bold">end</span>
								total = total - chunk
								<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> progress.increment chunk
							<span style="color:#0000FF;font-weight: bold">end</span>
							z.ProcessZip <span style="color:#7F0000;text-style:italic">//process</span> <span style="color:#7F0000;text-style:italic">data</span>
							<span style="color:#0000FF;font-weight: bold">if</span> stripHeader <span style="color:#0000FF;font-weight: bold">then</span>
								<span style="color:#7F0000;text-style:italic">//remove</span> <span style="color:#7F0000;text-style:italic">2</span> <span style="color:#7F0000;text-style:italic">byte</span> <span style="color:#7F0000;text-style:italic">zlib</span> <span style="color:#7F0000;text-style:italic">header</span>
								<span style="color:#0000FF;font-weight: bold">if</span> z.OutputSize &gt;= <span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">then</span>
									item.compressedSize = item.compressedSize + z.OutputSize - <span style="color:#326598">2</span>
									sw.writeString z.GetOutput.midb(<span style="color:#326598">3</span>) <span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">all</span> <span style="color:#7F0000;text-style:italic">except</span> <span style="color:#7F0000;text-style:italic">first</span> <span style="color:#7F0000;text-style:italic">2</span> <span style="color:#7F0000;text-style:italic">bytes</span>
									stripHeader = <span style="color:#0000FF;font-weight: bold">false</span>
								<span style="color:#0000FF;font-weight: bold">end</span>
							<span style="color:#0000FF;font-weight: bold">else</span>
								<span style="color:#7F0000;text-style:italic">//write</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">chunk</span>
								item.compressedSize = item.compressedSize + z.OutputSize
								sw.writeString z.GetOutput
							<span style="color:#0000FF;font-weight: bold">end</span>
						<span style="color:#0000FF;font-weight: bold">loop</span> <span style="color:#0000FF;font-weight: bold">until</span> z.InputAvail = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">and</span> total = <span style="color:#326598">0</span>
						z.EndZip
						item.compressedSize = item.compressedSize + z.OutputSize
						sw.writeString z.GetOutput
						sw.Rewind <span style="color:#326598">4</span> <span style="color:#7F0000;text-style:italic">//skip</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">last</span> <span style="color:#7F0000;text-style:italic">4</span> <span style="color:#7F0000;text-style:italic">bytes</span>
						item.compressedSize = item.compressedSize - <span style="color:#326598">4</span>
						sw.writeString <span style="color:#6500FE">&quot;PK&quot;</span> + chrb(<span style="color:#326598">7</span>) + chrb(<span style="color:#326598">8</span>) <span style="color:#7F0000;text-style:italic">//bomarchiver</span> <span style="color:#7F0000;text-style:italic">puts</span> <span style="color:#7F0000;text-style:italic">pkzip</span> <span style="color:#7F0000;text-style:italic">footer</span> <span style="color:#7F0000;text-style:italic">here,</span> <span style="color:#7F0000;text-style:italic">but</span> <span style="color:#7F0000;text-style:italic">seems</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">optional</span>
					<span style="color:#0000FF">#endif</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#7F0000;text-style:italic">//no</span> <span style="color:#7F0000;text-style:italic">compression</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span> = item.uncompressedSize
					<span style="color:#0000FF;font-weight: bold">while</span> total &gt; <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">dim</span> chunk <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">UInt16</span> = min(total,compressionOptions.deflateWindow)
						sw.writeString data.readString(chunk)
						total = total - chunk
						<span style="color:#0000FF">#if</span> useMBS
							<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> progress.increment chunk
						<span style="color:#0000FF">#else</span>
							<span style="color:#0000FF;font-weight: bold">if</span> progress &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> progress.increment chunk*<span style="color:#006532">0.25</span>
						<span style="color:#0000FF">#endif</span>
					<span style="color:#0000FF;font-weight: bold">wend</span>
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> Bitwise.BitAnd(flags,<span style="color:#326598">&amp;b0000000000001000</span>) &gt; <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#7F0000;text-style:italic">//crc</span> <span style="color:#7F0000;text-style:italic">32</span>
				sw.writeUInt32 item.crc
				<span style="color:#7F0000;text-style:italic">//compressed</span> <span style="color:#7F0000;text-style:italic">size</span>
				sw.writeUInt32 item.getCompressedSize
				<span style="color:#7F0000;text-style:italic">//uncompressed</span> <span style="color:#7F0000;text-style:italic">size</span>
				sw.writeUInt32 item.getUncompressedSize
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#7F0000;text-style:italic">//truncate</span> <span style="color:#7F0000;text-style:italic">file</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">length</span>
			centralDirectoryStart = sw.getPosition
			sw.truncate
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> z_writeTimeStamp(sw <span style="color:#0000FF;font-weight: bold">as</span> StreamWriter, date <span style="color:#0000FF;font-weight: bold">as</span> Date)
			<span style="color:#7F0000;text-style:italic">//if</span> <span style="color:#7F0000;text-style:italic">date</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">known,</span> <span style="color:#7F0000;text-style:italic">set</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">current</span> <span style="color:#7F0000;text-style:italic">time</span>
			<span style="color:#0000FF;font-weight: bold">if</span> date = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> date = <span style="color:#0000FF;font-weight: bold">new</span> date
			
			<span style="color:#7F0000;text-style:italic">//time</span>
			sw.writeUInt16 date.Hour * <span style="color:#326598">2048</span> + date.Minute * <span style="color:#326598">32</span> + date.Second \ <span style="color:#326598">2</span>
			
			<span style="color:#7F0000;text-style:italic">//date</span>
			sw.writeUInt16 (max(date.Year,<span style="color:#326598">1980</span>) - <span style="color:#326598">1980</span>) * <span style="color:#326598">512</span> + date.Month * <span style="color:#326598">32</span> + date.Day
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> archiveFile <span style="color:#0000FF;font-weight: bold">As</span> folderitem</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> centralDirectoryStart <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Shared</span> crc32Table(<span style="color:#326598">255</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">int32</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> directories <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint32</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> emptyDirectories <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint32</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> files <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint32</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> ZipProgress</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> constructor(total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>, monitor <span style="color:#0000FF;font-weight: bold">as</span> ProgressMonitor)
			<span style="color:#0000FF;font-weight: bold">me</span>.total = total
			<span style="color:#0000FF;font-weight: bold">me</span>.monitor = monitor
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> increment(amount <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">uint64</span>)
			complete = complete + amount
			monitor.update complete / total
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> complete <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> monitor <span style="color:#0000FF;font-weight: bold">As</span> ProgressMonitor</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> total <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">uint64</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Interface</span> ProgressMonitor</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> update(complete <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>)</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Interface</span></div>
</div>
<div class="RB_Code"><span style="color:#0000FF;font-weight: bold">End</span> Project</div>

</div>
<p>The items on this page are in the following plugins: <a href="plugins-mbscompressionplugin.html">MBS Compression Plugin</a>.</p>
<!-- Ende Content-->

<br>
<div style="width: 200pt; margin: 0pt; padding: 5pt; border-color:#ccc; border-style:solid; background-color: #eee; border-width: 2pt; border-radius: 10pt; " lang="en">
&#128172; <a href="https://www.monkeybreadsoftware.com/feedback/?what=xojo&path=example-compression-rbzlibraryversion11-rbz">Ask a question or report a problem</a>
</div>

</BODY>
</HTML>

