<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Frameset//EN" >
<HTML>
<HEAD>
<TITLE>Monkeybread Xojo plugin - Example: /Picture/Image effects/imagetransformation</TITLE>
<script src="../platforms.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../help.css" >
<link rel="stylesheet" type="text/css" href="../screen.css" media="screen">
<link rel="stylesheet" type="text/css" href="../print.css" media="print">
<link rel="stylesheet" type="text/css" href="../allitems.css" title="Default">
<link rel="alternate stylesheet" type="text/css" href="../macitems.css" title="Mac">
<link rel="alternate stylesheet" type="text/css" href="../winitems.css" title="Win">
<link rel="alternate stylesheet" type="text/css" href="../linuxitems.css" title="Linux">
<link rel="alternate stylesheet" type="text/css" href="../crossitems.css" title="Crossplatform">
<meta http-equiv="content-type" content="text/html; charset=x-mac-roman">
<META NAME="description" CONTENT="Example">
</head>
<BODY BGCOLOR="#FFFFFF">
<H2 lang="en">Example: /Picture/Image effects/imagetransformation</h2>
<p><a href="http://www.monkeybreadsoftware.net">Online Documentation</a> &nbsp; - &nbsp; <a href="stats.html">Statistics</a> &nbsp; - &nbsp; <a href="topic-faq.html">FAQ</a> &nbsp; - &nbsp; <a href="parts.html">Plugin Parts</a> (<a href="partsall.html">All</a>, <a href="plugindeps.html">Dependencies</a>) &nbsp; - &nbsp; <a href="hierarchy.html">Class hierarchy</a></p>
<p>New in Version 
<a href="newinversion213.html">21.3</a> 
<a href="newinversion214.html">21.4</a> 
<a href="newinversion215.html">21.5</a> 
<a href="newinversion220.html">22.0</a> 
<a href="newinversion221.html">22.1</a> 
<a href="newinversion222.html">22.2</a> 
<a href="newinversion223.html">22.3</a> 
<a href="newinversion224.html">22.4</a> 
<a href="newinversion225.html">22.5</a> 
<a href="newinversion230.html">23.0</a> 
<a href="newinversion231.html">23.1</a> 
<a href="newinversion232.html">23.2</a> 
</p>
<p>The list of the &nbsp; <a href="themes.html">topics</a>, 
 &nbsp; <a href="classes.html">classes</a>,
 &nbsp; <a href="interfaces.html">interfaces</a>,
 &nbsp; <a href="controls.html">controls</a>,
 &nbsp; <a href="modules.html">modules</a>,
 &nbsp; <a href="globaltopic.html">global methods by category</a>,
 &nbsp; <a href="globalname.html">global methods by name</a>,
 &nbsp; <a href="screenshots.html">screenshots</a>,
 &nbsp; <a href="licenses.html">licenses</a> &nbsp;
 and &nbsp; <a href="examples.html">examples</a>.</p>
<p id=PlatformChooserMBS>Platforms to show: <a class="isA" href="javascript:all();">All</a> <a class="isM" href="javascript:mac();">Mac</a> <a class="isW" href="javascript:win();">Windows</a> <a class="isL" href="javascript:linux();">Linux</a> <a class="isC" href="javascript:crossplatform();">Cross-Platform</a></p>
<div class="">
<b><A name="1">/Picture/Image effects/imagetransformation</A></b><br>
<B>Function:</B> 
<br>
Required plugins for this example: MBS Picture Plugin<BR>
You find this example project in your Plugins Download as a Xojo project file within the examples folder: /Picture/Image effects/imagetransformation<BR>
This example is the version from Fri, 17th Nov 2016.<BR>

<div class="RB_Code">Project <span style="color:#6500FE">&quot;imagetransformation.xojo_binary_project&quot;</span></div>
<div class="RB_MainItem">
<div class="RB_Code">	FileTypes</div>
<div class="RB_Code">		Filetype text</div>
<div class="RB_Code">		Filetype special/any</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> FileTypes</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> Window1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control source <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance source <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> DropObject(obj <span style="color:#0000FF;font-weight: bold">As</span> DragItem, action <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>)
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> picture
				<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> folderItem
				<span style="color:#0000FF;font-weight: bold">do</span>
					<span style="color:#0000FF;font-weight: bold">if</span> obj.pictureAvailable <span style="color:#0000FF;font-weight: bold">then</span>
						p = obj.picture
					<span style="color:#0000FF;font-weight: bold">elseif</span> obj.folderItemavailable <span style="color:#0000FF;font-weight: bold">then</span>
						f = obj.folderItem
						p = f.openaspicture
					<span style="color:#0000FF;font-weight: bold">end</span>
					LoadPicture p
				<span style="color:#0000FF;font-weight: bold">loop</span> <span style="color:#0000FF;font-weight: bold">until</span> <span style="color:#0000FF;font-weight: bold">not</span> obj.NextItem
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
				<span style="color:#0000FF;font-weight: bold">me</span>.acceptpictureDrop
				<span style="color:#0000FF;font-weight: bold">me</span>.acceptfileDrop(<span style="color:#6500FE">&quot;special/any&quot;</span>)
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Paint(g <span style="color:#0000FF;font-weight: bold">As</span> Graphics, areas() <span style="color:#0000FF;font-weight: bold">As</span> REALbasic.Rect)
				<span style="color:#0000FF;font-weight: bold">if</span> sourcepicture = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					g.drawstring <span style="color:#6500FE">&quot;Drag</span> <span style="color:#6500FE">picture</span> <span style="color:#6500FE">here&quot;</span>,<span style="color:#326598">10</span>,<span style="color:#0000FF;font-weight: bold">me</span>.height/<span style="color:#326598">2</span>
					g.drawrect <span style="color:#326598">0</span>,<span style="color:#326598">0</span>,<span style="color:#0000FF;font-weight: bold">me</span>.width,<span style="color:#0000FF;font-weight: bold">me</span>.height
				<span style="color:#0000FF;font-weight: bold">else</span>
					g.drawpicture sourcepicture,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,g.Width,g.Height,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,sourcepicture.Width,sourcepicture.Height
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control destination <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance destination <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Function</span> MouseDown(X <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, Y <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
				<span style="color:#0000FF;font-weight: bold">Dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> DragItem
				<span style="color:#0000FF;font-weight: bold">if</span> destinationpicture&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					d=<span style="color:#0000FF;font-weight: bold">New</span> DragItem(<span style="color:#0000FF;font-weight: bold">self</span>, <span style="color:#0000FF;font-weight: bold">Me</span>.left,<span style="color:#0000FF;font-weight: bold">Me</span>.top,<span style="color:#0000FF;font-weight: bold">Me</span>.width,<span style="color:#0000FF;font-weight: bold">Me</span>.height)
					d.picture=destinationpicture
					d.Drag <span style="color:#7F0000;text-style:italic">//Allow</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">drag</span>
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Paint(g <span style="color:#0000FF;font-weight: bold">As</span> Graphics, areas() <span style="color:#0000FF;font-weight: bold">As</span> REALbasic.Rect)
				<span style="color:#0000FF;font-weight: bold">if</span> destinationpicture = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					g.drawrect <span style="color:#326598">0</span>,<span style="color:#326598">0</span>,<span style="color:#0000FF;font-weight: bold">me</span>.width,<span style="color:#0000FF;font-weight: bold">me</span>.height
				<span style="color:#0000FF;font-weight: bold">else</span>
					g.drawpicture destinationpicture,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,<span style="color:#0000FF;font-weight: bold">me</span>.width,<span style="color:#0000FF;font-weight: bold">me</span>.height,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,destinationpicture.width,destinationpicture.height
					
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureMatrix3DMBS
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">matrix</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">gray</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureMatrix3DMBS
					p.Matrix(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.3</span>
					p.Matrix(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.59</span>
					p.Matrix(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.11</span>
					p.Matrix(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.3</span>
					p.Matrix(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.59</span>
					p.Matrix(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.11</span>
					p.Matrix(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.3</span>
					p.Matrix(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.59</span>
					p.Matrix(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.11</span>
					
					p.SourcePicture=sourcepicture
					t=Ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.run
					t=ticks-t
					
					destinationpicture=p.DestinationPicture
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.3</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.59</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.11</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.3</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.59</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.11</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.3</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.59</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.11</span>
					
					t=Ticks
					destinationpicture = sourcepicture.matrix3d(m,checkdither.value)
					t=Ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				destination.refresh
				
				
				StaticText6.text=str(t)
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton2 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton2 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureMatrix3DMBS
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">matrix</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">sepia</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureMatrix3DMBS
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.3</span> * <span style="color:#326598">255</span>/<span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.59</span> * <span style="color:#326598">255</span>/<span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.11</span> * <span style="color:#326598">255</span>/<span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.3</span> * <span style="color:#326598">168</span>/<span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.59</span> * <span style="color:#326598">168</span>/<span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.11</span> * <span style="color:#326598">168</span>/<span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.3</span> * <span style="color:#326598">60</span>/<span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.59</span> * <span style="color:#326598">60</span>/<span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.11</span> * <span style="color:#326598">60</span>/<span style="color:#326598">255</span>
					
					p.SourcePicture=sourcepicture
					t=Ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.run
					t=ticks-t
					
					destinationpicture=p.DestinationPicture
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.3</span> * <span style="color:#326598">255</span>/<span style="color:#326598">255</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.59</span> * <span style="color:#326598">255</span>/<span style="color:#326598">255</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.11</span> * <span style="color:#326598">255</span>/<span style="color:#326598">255</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.3</span> * <span style="color:#326598">168</span>/<span style="color:#326598">255</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.59</span> * <span style="color:#326598">168</span>/<span style="color:#326598">255</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.11</span> * <span style="color:#326598">168</span>/<span style="color:#326598">255</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.3</span> * <span style="color:#326598">60</span>/<span style="color:#326598">255</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.59</span> * <span style="color:#326598">60</span>/<span style="color:#326598">255</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.11</span> * <span style="color:#326598">60</span>/<span style="color:#326598">255</span>
					
					t=ticks
					destinationpicture = sourcepicture.matrix3d(m,checkdither.value)
					t=Ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				StaticText7.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton3 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton3 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> m(<span style="color:#326598">3</span>,<span style="color:#326598">3</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureMatrix3DMBS
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">matrix</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">video</span> <span style="color:#7F0000;text-style:italic">component</span> <span style="color:#7F0000;text-style:italic">YCbCr</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureMatrix3DMBS
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.5</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = -<span style="color:#006532">0.42</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = -<span style="color:#006532">0.08</span>
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.3</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.59</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.11</span>
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = -<span style="color:#006532">0.17</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = -<span style="color:#006532">0.33</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.5</span>
					
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">128</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">128</span>
					
					p.SourcePicture=sourcepicture
					t=Ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.run
					t=ticks-t
					
					destinationpicture=p.DestinationPicture
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = <span style="color:#006532">0.5</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = -<span style="color:#006532">0.42</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = -<span style="color:#006532">0.08</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.3</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.59</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#006532">0.11</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = -<span style="color:#006532">0.17</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = -<span style="color:#006532">0.33</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = <span style="color:#006532">0.5</span>
					
					m(<span style="color:#326598">0</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">128</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">128</span>
					
					t=ticks
					destinationpicture = sourcepicture.matrix3dwithconstants(m,checkdither.value)
					t=Ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				StaticText8.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText2 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText2 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton4 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton4 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> h(<span style="color:#326598">2</span>),v(<span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureConvolutionMBS
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureConvolutionMBS
					
					p.hor(<span style="color:#326598">0</span>) = <span style="color:#006532">0.25</span>
					p.hor(<span style="color:#326598">1</span>) = <span style="color:#006532">0.5</span>
					p.hor(<span style="color:#326598">2</span>) = <span style="color:#006532">0.25</span>
					
					p.ver(<span style="color:#326598">0</span>) = <span style="color:#006532">0.25</span>
					p.ver(<span style="color:#326598">1</span>) = <span style="color:#006532">0.5</span>
					p.ver(<span style="color:#326598">2</span>) = <span style="color:#006532">0.25</span>
					
					p.ValueCount=<span style="color:#326598">3</span>
					
					p.SourcePicture=sourcepicture
					t=ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.run(<span style="color:#326598">7</span>)
					t=ticks-t
					destinationpicture=p.destinationpicture
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">simple</span> <span style="color:#7F0000;text-style:italic">blur</span>
					
					h(<span style="color:#326598">0</span>) = <span style="color:#006532">0.25</span>
					h(<span style="color:#326598">1</span>) = <span style="color:#006532">0.5</span>
					h(<span style="color:#326598">2</span>) = <span style="color:#006532">0.25</span>
					
					v(<span style="color:#326598">0</span>) = <span style="color:#006532">0.25</span>
					v(<span style="color:#326598">1</span>) = <span style="color:#006532">0.5</span>
					v(<span style="color:#326598">2</span>) = <span style="color:#006532">0.25</span>
					
					t=ticks
					destinationpicture = sourcepicture.convolution(h,v,<span style="color:#326598">7</span>)
					t=ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				StaticText11.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton5 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton5 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> h(<span style="color:#326598">2</span>),v(<span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureConvolutionMBS
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">simple</span> <span style="color:#7F0000;text-style:italic">sharpen</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureConvolutionMBS
					
					p.hor(<span style="color:#326598">0</span>) = -<span style="color:#006532">0.25</span>
					p.hor(<span style="color:#326598">1</span>) = <span style="color:#006532">1.5</span>
					p.hor(<span style="color:#326598">2</span>) = -<span style="color:#006532">0.25</span>
					
					p.ver(<span style="color:#326598">0</span>) = -<span style="color:#006532">0.25</span>
					p.ver(<span style="color:#326598">1</span>) = <span style="color:#006532">1.5</span>
					p.ver(<span style="color:#326598">2</span>) = -<span style="color:#006532">0.25</span>
					
					p.ValueCount=<span style="color:#326598">3</span>
					
					p.SourcePicture=sourcepicture
					t=ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.run(<span style="color:#326598">7</span>)
					t=ticks-t
					destinationpicture=p.destinationpicture
				<span style="color:#0000FF;font-weight: bold">else</span>
					h(<span style="color:#326598">0</span>) = -<span style="color:#006532">0.25</span>
					h(<span style="color:#326598">1</span>) = <span style="color:#006532">1.5</span>
					h(<span style="color:#326598">2</span>) = -<span style="color:#006532">0.25</span>
					
					v(<span style="color:#326598">0</span>) = -<span style="color:#006532">0.25</span>
					v(<span style="color:#326598">1</span>) = <span style="color:#006532">1.5</span>
					v(<span style="color:#326598">2</span>) = -<span style="color:#006532">0.25</span>
					
					t=ticks
					destinationpicture = sourcepicture.convolution(h,v,<span style="color:#326598">7</span>)
					t=ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				StaticText12.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton6 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton6 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> lut(<span style="color:#326598">16</span>,<span style="color:#326598">16</span>,<span style="color:#326598">16</span>,<span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> r,g,b <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> surf <span style="color:#0000FF;font-weight: bold">as</span> rgbSurface
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureLut3DMBS
				<span style="color:#0000FF;font-weight: bold">dim</span> x,y <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> lutinput <span style="color:#0000FF;font-weight: bold">as</span> picture
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureLut3DMBS
					<span style="color:#0000FF;font-weight: bold">for</span> r = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">15</span>
						<span style="color:#0000FF;font-weight: bold">for</span> g = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">15</span>
							<span style="color:#0000FF;font-weight: bold">for</span> b = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">15</span>
								p.Table(r,g,b,<span style="color:#326598">0</span>) = <span style="color:#326598">255</span> - <span style="color:#326598">17</span>*r
								p.Table(r,g,b,<span style="color:#326598">1</span>) = <span style="color:#326598">255</span> - <span style="color:#326598">17</span>*g
								p.Table(r,g,b,<span style="color:#326598">2</span>) = <span style="color:#326598">255</span> - <span style="color:#326598">17</span>*b
							<span style="color:#0000FF;font-weight: bold">next</span>
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					p.SourcePicture=sourcepicture
					t=ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.Run
					t=ticks-t
					destinationpicture=p.destinationpicture
				<span style="color:#0000FF;font-weight: bold">else</span>
					
					<span style="color:#0000FF;font-weight: bold">for</span> r = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">15</span>
						<span style="color:#0000FF;font-weight: bold">for</span> g = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">15</span>
							<span style="color:#0000FF;font-weight: bold">for</span> b = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">15</span>
								lut(r,g,b,<span style="color:#326598">0</span>) = <span style="color:#326598">255</span> - <span style="color:#326598">17</span>*r
								lut(r,g,b,<span style="color:#326598">1</span>) = <span style="color:#326598">255</span> - <span style="color:#326598">17</span>*g
								lut(r,g,b,<span style="color:#326598">2</span>) = <span style="color:#326598">255</span> - <span style="color:#326598">17</span>*b
							<span style="color:#0000FF;font-weight: bold">next</span>
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					t=ticks
					
					destinationpicture = sourcepicture.lut3d(lut,checkdither.value)
					t=ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				StaticText13.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText3 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText3 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton7 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton7 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> lut(<span style="color:#326598">16</span>,<span style="color:#326598">16</span>,<span style="color:#326598">16</span>,<span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> r,g,b <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">selective</span> <span style="color:#7F0000;text-style:italic">pure</span> <span style="color:#7F0000;text-style:italic">red</span> <span style="color:#7F0000;text-style:italic">will</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">changed</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">blue,</span> <span style="color:#7F0000;text-style:italic">very</span> <span style="color:#7F0000;text-style:italic">primitive</span> <span style="color:#7F0000;text-style:italic">version</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureLut3DMBS
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureLut3DMBS
					
					<span style="color:#0000FF;font-weight: bold">for</span> r = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">16</span>
						<span style="color:#0000FF;font-weight: bold">for</span> g = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">16</span>
							<span style="color:#0000FF;font-weight: bold">for</span> b = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">16</span>
								<span style="color:#0000FF;font-weight: bold">if</span> r&gt;g*<span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">and</span> r&gt;b*<span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">then</span>
									p.table(r,g,b,<span style="color:#326598">0</span>) = <span style="color:#326598">15</span>*b
									p.table(r,g,b,<span style="color:#326598">1</span>) = <span style="color:#326598">15</span>*g
									p.table(r,g,b,<span style="color:#326598">2</span>) = <span style="color:#326598">15</span>*r
								<span style="color:#0000FF;font-weight: bold">else</span>
									p.table(r,g,b,<span style="color:#326598">0</span>) = <span style="color:#326598">15</span>*r
									p.table(r,g,b,<span style="color:#326598">1</span>) = <span style="color:#326598">15</span>*g
									p.table(r,g,b,<span style="color:#326598">2</span>) = <span style="color:#326598">15</span>*b
								<span style="color:#0000FF;font-weight: bold">end</span>
							<span style="color:#0000FF;font-weight: bold">next</span>
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					p.SourcePicture=sourcepicture
					t=ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.run
					t=ticks-t
					destinationpicture=p.DestinationPicture
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#0000FF;font-weight: bold">for</span> r = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">16</span>
						<span style="color:#0000FF;font-weight: bold">for</span> g = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">16</span>
							<span style="color:#0000FF;font-weight: bold">for</span> b = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">16</span>
								<span style="color:#0000FF;font-weight: bold">if</span> r&gt;g*<span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">and</span> r&gt;b*<span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">then</span>
									LUT(r,g,b,<span style="color:#326598">0</span>) = <span style="color:#326598">15</span>*b
									LUT(r,g,b,<span style="color:#326598">1</span>) = <span style="color:#326598">15</span>*g
									LUT(r,g,b,<span style="color:#326598">2</span>) = <span style="color:#326598">15</span>*r
								<span style="color:#0000FF;font-weight: bold">else</span>
									LUT(r,g,b,<span style="color:#326598">0</span>) = <span style="color:#326598">15</span>*r
									LUT(r,g,b,<span style="color:#326598">1</span>) = <span style="color:#326598">15</span>*g
									LUT(r,g,b,<span style="color:#326598">2</span>) = <span style="color:#326598">15</span>*b
								<span style="color:#0000FF;font-weight: bold">end</span>
							<span style="color:#0000FF;font-weight: bold">next</span>
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					t=ticks
					destinationpicture = sourcepicture.lut3d(lut,checkdither.value)
					t=ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				StaticText14.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText4 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText4 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText5 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText5 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton8 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton8 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> p,pattern,src,dest <span style="color:#0000FF;font-weight: bold">as</span> picture
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">let&#39;s</span> <span style="color:#7F0000;text-style:italic">do</span> <span style="color:#7F0000;text-style:italic">some</span> <span style="color:#7F0000;text-style:italic">compositing</span>
				
				p = <span style="color:#0000FF;font-weight: bold">New</span> Picture(source.width,source.height,<span style="color:#326598">32</span>)
				p.graphics.forecolor = rgb(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)
				p.graphics.fillrect <span style="color:#326598">0</span>,<span style="color:#326598">0</span>,p.width,p.height
				p.mask.graphics.clearrect <span style="color:#326598">0</span>,<span style="color:#326598">0</span>,p.width,p.height
				
				pattern = <span style="color:#0000FF;font-weight: bold">New</span> Picture(<span style="color:#326598">4</span>*source.width,<span style="color:#326598">4</span>*source.height,<span style="color:#326598">32</span>)
				pattern.mask.graphics.clearrect <span style="color:#326598">0</span>,<span style="color:#326598">0</span>,pattern.width,pattern.height
				pattern.mask.graphics.forecolor = rgb(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)
				pattern.mask.graphics.textsize = <span style="color:#326598">256</span>
				pattern.mask.graphics.drawstring <span style="color:#6500FE">&quot;title&quot;</span>,pattern.width/<span style="color:#326598">2</span>,pattern.height/<span style="color:#326598">2</span>
				pattern.mask.graphics.filloval <span style="color:#326598">20</span>, <span style="color:#326598">20</span>, <span style="color:#326598">400</span>, <span style="color:#326598">400</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">fill</span> <span style="color:#7F0000;text-style:italic">picture</span>
				pattern.graphics.forecolor = rgb(<span style="color:#326598">255</span>,<span style="color:#326598">255</span>,<span style="color:#326598">255</span>)
				pattern.graphics.fillrect <span style="color:#326598">0</span>,<span style="color:#326598">0</span>,pattern.width,pattern.height
				p.graphics.drawpicture pattern,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,p.width,p.height,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,pattern.width,pattern.height
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">fill</span> <span style="color:#7F0000;text-style:italic">mask</span>
				pattern.graphics.forecolor = rgb(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)
				pattern.graphics.fillrect <span style="color:#326598">0</span>,<span style="color:#326598">0</span>,pattern.width,pattern.height
				p.mask.graphics.drawpicture pattern,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,p.width,p.height,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,pattern.width,pattern.height
				
				
				destinationpicture = <span style="color:#0000FF;font-weight: bold">New</span> Picture (p.width,p.height,<span style="color:#326598">32</span>)
				destinationpicture.graphics.drawpicture sourcepicture,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
				
				sourcepicture.graphics.drawpicture p,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
				source.refresh
				
				t=ticks
				destinationpicture.graphics.drawpicture p.unmultiply,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
				t=ticks-t
				destination.refresh
				
				StaticText15.text=str(t)
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton9 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton9 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> m,m2,m3 <span style="color:#0000FF;font-weight: bold">as</span> memoryBlock
				<span style="color:#0000FF;font-weight: bold">dim</span> x,y <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> offset <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> s,s3 <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> surf <span style="color:#0000FF;font-weight: bold">as</span> rgbSurface
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				
				t=ticks
				m = newmemoryBlock(sourcepicture.width*sourcepicture.height*<span style="color:#326598">4</span>)
				
				surf = sourcepicture.rgbSurface
				<span style="color:#0000FF;font-weight: bold">for</span> x = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> sourcepicture.width-<span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">for</span> y = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> sourcepicture.height-<span style="color:#326598">1</span>
						m.colorValue(offset,<span style="color:#326598">32</span>) = surf.pixel(x,y)
						offset = offset + <span style="color:#326598">4</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				s = m.stringValue(<span style="color:#326598">0</span>,m.size)
				
				m2 = m.RunLengthEncode
				
				msgBox <span style="color:#6500FE">&quot;Compressed</span> <span style="color:#6500FE">&quot;</span> + format(m2.size/m.size,<span style="color:#6500FE">&quot;0%&quot;</span>)
				
				m3 = m2.RunLengthDecode
				
				s3 = m3.stringValue(<span style="color:#326598">0</span>,m3.size)
				
				<span style="color:#0000FF;font-weight: bold">if</span> strcomp(s,s3,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					msgbox <span style="color:#6500FE">&quot;Compression-Decompression</span> <span style="color:#6500FE">succeeded&quot;</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					msgbox <span style="color:#6500FE">&quot;Compression-Decompression</span> <span style="color:#6500FE">failed&quot;</span>
				<span style="color:#0000FF;font-weight: bold">end</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> destinationpicture = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					destinationpicture = <span style="color:#0000FF;font-weight: bold">New</span> Picture(sourcepicture.width,sourcepicture.height,<span style="color:#326598">32</span>)
				<span style="color:#0000FF;font-weight: bold">end</span>
				
				offset = <span style="color:#326598">0</span>
				
				surf = destinationpicture.rgbSurface
				<span style="color:#0000FF;font-weight: bold">for</span> x = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> destinationpicture.width-<span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">for</span> y = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> destinationpicture.height-<span style="color:#326598">1</span>
						surf.pixel(x,y) = m.colorValue(offset,<span style="color:#326598">32</span>)
						offset = offset + <span style="color:#326598">4</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				t=ticks-t
				StaticText16.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton11 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton11 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureMatrix3DMBS
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">matrix</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">identity</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureMatrix3DMBS
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">1</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">1</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">1</span>
					
					p.SourcePicture=sourcepicture
					t=Ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.run
					t=ticks-t
					
					destinationpicture=p.DestinationPicture
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">1</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">1</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">1</span>
					
					t=ticks
					destinationpicture = sourcepicture.matrix3d(m)
					t=Ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				StaticText9.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton10 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton10 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> m(<span style="color:#326598">3</span>,<span style="color:#326598">3</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> PictureMatrix3DMBS
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">matrix</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">invert</span> <span style="color:#7F0000;text-style:italic">uses</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> CheckPlugin.Value <span style="color:#0000FF;font-weight: bold">then</span>
					p=<span style="color:#0000FF;font-weight: bold">new</span> PictureMatrix3DMBS
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = -<span style="color:#326598">1</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = -<span style="color:#326598">1</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = -<span style="color:#326598">1</span>
					
					p.matrix(<span style="color:#326598">0</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">1</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">255</span>
					p.matrix(<span style="color:#326598">2</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">255</span>
					
					p.matrix(<span style="color:#326598">3</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">3</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					p.matrix(<span style="color:#326598">3</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					
					p.SourcePicture=sourcepicture
					t=Ticks
					<span style="color:#0000FF;font-weight: bold">call</span> p.run
					t=ticks-t
					
					destinationpicture=p.DestinationPicture
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>) = -<span style="color:#326598">1</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>) = -<span style="color:#326598">1</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>) = <span style="color:#326598">0</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>) = -<span style="color:#326598">1</span>
					
					m(<span style="color:#326598">0</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">255</span>
					m(<span style="color:#326598">1</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">255</span>
					m(<span style="color:#326598">2</span>,<span style="color:#326598">3</span>) = <span style="color:#326598">255</span>
					
					
					t=ticks
					destinationpicture = sourcepicture.matrix3dwithConstants(m,checkdither.value)
					t=Ticks-t
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				StaticText10.text=str(t)
				
				destination.refresh
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText6 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText6 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText7 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText7 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText8 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText8 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText9 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText9 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText10 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText10 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control CheckPlugin <span style="color:#0000FF;font-weight: bold">Inherits</span> CheckBox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance CheckPlugin <span style="color:#0000FF;font-weight: bold">Inherits</span> CheckBox</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText11 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText11 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText12 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText12 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText13 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText13 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText14 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText14 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText15 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText15 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText16 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText16 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control CheckDither <span style="color:#0000FF;font-weight: bold">Inherits</span> CheckBox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance CheckDither <span style="color:#0000FF;font-weight: bold">Inherits</span> CheckBox</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			LoadPicture toni
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> LoadPicture(p <span style="color:#0000FF;font-weight: bold">as</span> picture)
			<span style="color:#0000FF;font-weight: bold">if</span> p&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				sourcepicture = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
				sourcepicture.graphics.drawpicture p,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,p.width,p.Height,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>,p.width,p.height
				<span style="color:#0000FF;font-weight: bold">me</span>.refresh
				
				pushButton1.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton2.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton3.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton4.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton5.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton6.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton7.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton8.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton9.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushbutton10.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				pushButton11.enabled = <span style="color:#0000FF;font-weight: bold">true</span>
				
				
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> destinationpicture <span style="color:#0000FF;font-weight: bold">As</span> picture</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> sourcepicture <span style="color:#0000FF;font-weight: bold">As</span> picture</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	MenuBar MenuBar1</div>
<div class="RB_Code">		MenuItem UntitledMenu1 = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">		MenuItem FileMenu = <span style="color:#6500FE">&quot;&amp;File&quot;</span></div>
<div class="RB_Code">			MenuItem FileQuit = <span style="color:#6500FE">&quot;Quit&quot;</span></div>
<div class="RB_Code">		MenuItem EditMenu = <span style="color:#6500FE">&quot;&amp;Edit&quot;</span></div>
<div class="RB_Code">			MenuItem EditUndo = <span style="color:#6500FE">&quot;Undo&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu0 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditCut = <span style="color:#6500FE">&quot;Cut&quot;</span></div>
<div class="RB_Code">			MenuItem EditCopy = <span style="color:#6500FE">&quot;Copy&quot;</span></div>
<div class="RB_Code">			MenuItem EditPaste = <span style="color:#6500FE">&quot;Paste&quot;</span></div>
<div class="RB_Code">			MenuItem EditClear = <span style="color:#6500FE">&quot;Clear&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> MenuBar</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> App <span style="color:#0000FF;font-weight: bold">Inherits</span> Application</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Module</span> ImageTransformations</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Convolution(<span style="color:#0000FF;font-weight: bold">extends</span> p <span style="color:#0000FF;font-weight: bold">as</span> picture, hor() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, ver() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, channels <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> p2, intermediate, result <span style="color:#0000FF;font-weight: bold">as</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> insurf,intermediatesurf, outsurf <span style="color:#0000FF;font-weight: bold">as</span> rgbSurface
			<span style="color:#0000FF;font-weight: bold">dim</span> x,y,w,h,r2,g2,b2,i,ub,ub2 <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> start, ende <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">color</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> r,g,b <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Double</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> p=<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">verify</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">picture</span> <span style="color:#7F0000;text-style:italic">has</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">rgbsurface</span>
			insurf = p.rgbSurface
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				p2 = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> p2&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					p2.graphics.drawpicture p,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
					insurf = p2.rgbSurface
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			intermediate = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> intermediate&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				intermediatesurf = intermediate.rgbSurface
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			result = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> result&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				outsurf = result.rgbSurface
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span> intermediatesurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span> outsurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			w = p.width-<span style="color:#326598">1</span>
			h = p.height-<span style="color:#326598">1</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">borders</span> <span style="color:#7F0000;text-style:italic">will</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">treated.</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">somebody</span> <span style="color:#7F0000;text-style:italic">want</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">get</span> <span style="color:#7F0000;text-style:italic">until</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">border,</span> <span style="color:#7F0000;text-style:italic">he</span> <span style="color:#7F0000;text-style:italic">can</span> <span style="color:#7F0000;text-style:italic">provide</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">larger</span> <span style="color:#7F0000;text-style:italic">picture.</span>
			
			ub = ubound(hor)
			ub2 = ub\<span style="color:#326598">2</span>
			start = ub2
			ende = w - ub2
			
			<span style="color:#0000FF;font-weight: bold">for</span> x = start <span style="color:#0000FF;font-weight: bold">to</span> ende
				<span style="color:#0000FF;font-weight: bold">for</span> y = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> h
					<span style="color:#0000FF;font-weight: bold">if</span> bitwiseand(channels,<span style="color:#326598">1</span>) = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						r = <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ub
							r = r + insurf.pixel(x-ub2+i,y).red * hor(i)
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						r = insurf.pixel(x,y).red
					<span style="color:#0000FF;font-weight: bold">end</span>
					<span style="color:#0000FF;font-weight: bold">if</span> bitwiseand(channels,<span style="color:#326598">2</span>) = <span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">then</span>
						g = <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ub
							g = g + insurf.pixel(x-ub2+i,y).green * hor(i)
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						g = insurf.pixel(x,y).green
					<span style="color:#0000FF;font-weight: bold">end</span>
					<span style="color:#0000FF;font-weight: bold">if</span> bitwiseand(channels,<span style="color:#326598">4</span>) = <span style="color:#326598">4</span> <span style="color:#0000FF;font-weight: bold">then</span>
						b = <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ub
							b = b + insurf.pixel(x-ub2+i,y).blue * hor(i)
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						b = insurf.pixel(x,y).blue
					<span style="color:#0000FF;font-weight: bold">end</span>
					intermediatesurf.pixel(x,y) = rgb(r,g,b)
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			ub = ubound(ver)
			ub2 = ub/<span style="color:#326598">2</span>
			start = ub2
			ende = h - ub2
			
			<span style="color:#0000FF;font-weight: bold">for</span> x = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> w
				<span style="color:#0000FF;font-weight: bold">for</span> y = start <span style="color:#0000FF;font-weight: bold">to</span> ende
					<span style="color:#0000FF;font-weight: bold">if</span> bitwiseand(channels,<span style="color:#326598">1</span>) = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						r = <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ub
							r = r + intermediatesurf.pixel(x,y-ub2+i).red * ver(i)
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						r = intermediatesurf.pixel(x,y).red
					<span style="color:#0000FF;font-weight: bold">end</span>
					<span style="color:#0000FF;font-weight: bold">if</span> bitwiseand(channels,<span style="color:#326598">2</span>)= <span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">then</span>
						g = <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ub
							g = g + intermediatesurf.pixel(x,y-ub2+i).green * ver(i)
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						g = intermediatesurf.pixel(x,y).green
					<span style="color:#0000FF;font-weight: bold">end</span>
					<span style="color:#0000FF;font-weight: bold">if</span> bitwiseand(channels,<span style="color:#326598">4</span>)= <span style="color:#326598">4</span> <span style="color:#0000FF;font-weight: bold">then</span>
						b = <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ub
							b = b + intermediatesurf.pixel(x,y-ub2+i).blue * ver(i)
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						b = intermediatesurf.pixel(x,y).blue
					<span style="color:#0000FF;font-weight: bold">end</span>
					
					outsurf.pixel(x,y) = rgb(r,g,b)
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">return</span> result
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> LUT3d(<span style="color:#0000FF;font-weight: bold">extends</span> p <span style="color:#0000FF;font-weight: bold">as</span> picture, lut(,,,) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, dither <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = <span style="color:#0000FF;font-weight: bold">false</span>) <span style="color:#0000FF;font-weight: bold">As</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> p2, result <span style="color:#0000FF;font-weight: bold">as</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> insurf,outsurf <span style="color:#0000FF;font-weight: bold">as</span> rgbSurface
			<span style="color:#0000FF;font-weight: bold">dim</span> x,y,r,g,b,w,h,r2,g2,b2 <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> nx,ny,nz,nx1,ny1,nz1,i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> rrest, grest, brest <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> sxyz, fx,fy,fz <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>  <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">sxyz</span> <span style="color:#7F0000;text-style:italic">neu</span> <span style="color:#7F0000;text-style:italic">double!</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">color</span>
			
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">expects</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">LUT(16,16,16,2),</span> <span style="color:#7F0000;text-style:italic">eg</span> <span style="color:#7F0000;text-style:italic">17</span> <span style="color:#7F0000;text-style:italic">values</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">each</span> <span style="color:#7F0000;text-style:italic">dimension,</span> <span style="color:#7F0000;text-style:italic">which</span> <span style="color:#7F0000;text-style:italic">makes</span> <span style="color:#7F0000;text-style:italic">even</span> <span style="color:#7F0000;text-style:italic">steps</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">0..15.30..255</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> p=<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">verify</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">picture</span> <span style="color:#7F0000;text-style:italic">has</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">rgbsurface</span>
			insurf = p.rgbSurface
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				p2 = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> p2&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					p2.graphics.drawpicture p,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
					insurf = p2.rgbSurface
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			result = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> result&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				outsurf = result.rgbSurface
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span> outsurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			w = p.width-<span style="color:#326598">1</span>
			h = p.height-<span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">for</span> y = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> h
				<span style="color:#0000FF;font-weight: bold">for</span> x = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> w
					c = insurf.Pixel(x,y)
					r = c.red
					g = c.green
					b = c.blue
					
					nx = r \ <span style="color:#326598">17</span>
					ny = g \ <span style="color:#326598">17</span>
					nz = b \ <span style="color:#326598">17</span>
					
					nx1 = min(nx+<span style="color:#326598">1</span>,<span style="color:#326598">15</span>)
					ny1 = min(ny+<span style="color:#326598">1</span>,<span style="color:#326598">15</span>)
					nz1 = min(nz+<span style="color:#326598">1</span>,<span style="color:#326598">15</span>)
					
					fx = (r <span style="color:#0000FF;font-weight: bold">mod</span> <span style="color:#326598">17</span>) / <span style="color:#006532">17.0</span>
					fy = (g <span style="color:#0000FF;font-weight: bold">mod</span> <span style="color:#326598">17</span>) / <span style="color:#006532">17.0</span>
					fz = (b <span style="color:#0000FF;font-weight: bold">mod</span> <span style="color:#326598">17</span>) / <span style="color:#006532">17.0</span>
					
					
					<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">2</span>
						<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">tetraeder</span> <span style="color:#7F0000;text-style:italic">interpolation.</span>
						<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">would</span> <span style="color:#7F0000;text-style:italic">probably</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">faster</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">each</span> <span style="color:#7F0000;text-style:italic">channel</span> <span style="color:#7F0000;text-style:italic">coded</span>  <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">for-loop</span>
						
						<span style="color:#0000FF;font-weight: bold">if</span> (fx &gt; fy) <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">if</span> (fy &gt; fz) <span style="color:#0000FF;font-weight: bold">then</span>
								Sxyz = (<span style="color:#006532">1.0</span>-fx)* LUT( nx , ny , nz, i ) + (fx-fy)* LUT(nx1, ny , nz, i ) + (fy-fz)* LUT(nx1,ny1, nz, i ) + (fz)* LUT(nx1,ny1,nz1,i)
							<span style="color:#0000FF;font-weight: bold">elseif</span> (fx &gt; fz) <span style="color:#0000FF;font-weight: bold">then</span>
								Sxyz = (<span style="color:#006532">1.0</span>-fx)* LUT( nx , ny , nz, i ) + (fx-fz)* LUT(nx1, ny , nz, i ) + (fz-fy)* LUT(nx1, ny ,nz1, i) + (fy)* LUT(nx1,ny1,nz1,i)
							<span style="color:#0000FF;font-weight: bold">else</span>
								Sxyz = (<span style="color:#006532">1.0</span>-fz)* LUT( nx , ny , nz, i) + (fz-fx)* LUT( nx , ny ,nz1, i) + (fx-fy)* LUT(nx1, ny ,nz1,i)+ (fy)* LUT(nx1,ny1,nz1,i)
							<span style="color:#0000FF;font-weight: bold">end</span>
						<span style="color:#0000FF;font-weight: bold">else</span>
							<span style="color:#0000FF;font-weight: bold">if</span> (fz &gt; fy) <span style="color:#0000FF;font-weight: bold">then</span>
								Sxyz = (<span style="color:#006532">1.0</span>-fz)* LUT( nx , ny , nz,i ) + (fz-fy)* LUT( nx , ny ,nz1,i) + (fy-fx)* LUT( nx ,ny1,nz1,i) + (fx)* LUT(nx1,ny1,nz1,i)
							<span style="color:#0000FF;font-weight: bold">elseif</span> (fz &gt; fx) <span style="color:#0000FF;font-weight: bold">then</span>
								Sxyz = (<span style="color:#006532">1.0</span>-fy)* LUT( nx , ny , nz,i ) + (fy-fz)* LUT( nx ,ny1, nz ,i) + (fz-fx)* LUT( nx ,ny1,nz1,i) + (fx)* LUT(nx1,ny1,nz1,i)
							<span style="color:#0000FF;font-weight: bold">else</span>
								Sxyz = (<span style="color:#006532">1.0</span>-fy)* LUT( nx , ny , nz,i ) + (fy-fx)* LUT( nx ,ny1, nz ,i) + (fx-fz)* LUT(nx1,ny1, nz ,i) + (fz)* LUT(nx1,ny1,nz1,i)
							<span style="color:#0000FF;font-weight: bold">end</span>
						<span style="color:#0000FF;font-weight: bold">end</span>
						
						<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> i
						<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">0</span>
							<span style="color:#0000FF;font-weight: bold">if</span> dither <span style="color:#0000FF;font-weight: bold">then</span> r = r + rrest
							r = Sxyz
							rrest = Sxyz-r
						<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">1</span>
							<span style="color:#0000FF;font-weight: bold">if</span> dither <span style="color:#0000FF;font-weight: bold">then</span> g = g + grest
							g = Sxyz
							grest = Sxyz-g
						<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">2</span>
							<span style="color:#0000FF;font-weight: bold">if</span> dither <span style="color:#0000FF;font-weight: bold">then</span> b = b + brest
							b = Sxyz
							brest = Sxyz-b
						<span style="color:#0000FF;font-weight: bold">end</span>
						
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					outsurf.pixel(x,y) = rgb(r,g,b)
				<span style="color:#0000FF;font-weight: bold">next</span>
				
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			
			<span style="color:#0000FF;font-weight: bold">return</span> result
			
			<span style="color:#0000FF;font-weight: bold">exception</span> err <span style="color:#0000FF;font-weight: bold">as</span> outofboundsException
			
			msgBox <span style="color:#6500FE">&quot;matrix</span> <span style="color:#6500FE">too</span> <span style="color:#6500FE">small&quot;</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Matrix3d(<span style="color:#0000FF;font-weight: bold">extends</span> p <span style="color:#0000FF;font-weight: bold">as</span> picture, m(,) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, dither <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = <span style="color:#0000FF;font-weight: bold">false</span>) <span style="color:#0000FF;font-weight: bold">As</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> p2, result <span style="color:#0000FF;font-weight: bold">as</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> insurf,outsurf <span style="color:#0000FF;font-weight: bold">as</span> rgbSurface
			<span style="color:#0000FF;font-weight: bold">dim</span> x,y,r,g,b,w,h,r2,g2,b2 <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> rd,gd,bd <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> rrest, grest, brest <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">color</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> p=<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">verify</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">picture</span> <span style="color:#7F0000;text-style:italic">has</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">rgbsurface</span>
			insurf = p.rgbSurface
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				p2 = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> p2&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					p2.graphics.drawpicture p,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
					insurf = p2.rgbSurface
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			result = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> result&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				outsurf = result.rgbSurface
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span> outsurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			w = p.width-<span style="color:#326598">1</span>
			h = p.height-<span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">for</span> x = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> w
				<span style="color:#0000FF;font-weight: bold">for</span> y = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> h
					c = insurf.pixel(x,y)
					r = c.red
					g = c.green
					b = c.blue
					
					rd = m(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)*r + m(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>)*g + m(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>)*b
					gd = m(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>)*r + m(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>)*g + m(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>)*b
					bd = m(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>)*r + m(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>)*g + m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>)*b
					
					<span style="color:#0000FF;font-weight: bold">if</span> dither <span style="color:#0000FF;font-weight: bold">then</span>
						rd = rd + rrest
						r2 = rd
						rrest = rd -r2
						gd = gd + grest
						g2 = gd
						grest = gd -g2
						bd = bd + brest
						b2 = bd
						brest = bd -b2
					<span style="color:#0000FF;font-weight: bold">else</span>
						r2 = rd
						g2 = gd
						b2 = bd
					<span style="color:#0000FF;font-weight: bold">end</span>
					
					outsurf.pixel(x,y) = rgb(r2,g2,b2)
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> result
			
			<span style="color:#0000FF;font-weight: bold">exception</span> err <span style="color:#0000FF;font-weight: bold">as</span> outofboundsException
			
			msgBox <span style="color:#6500FE">&quot;matrix</span> <span style="color:#6500FE">too</span> <span style="color:#6500FE">small&quot;</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Matrix3dwithConstants(<span style="color:#0000FF;font-weight: bold">extends</span> p <span style="color:#0000FF;font-weight: bold">as</span> picture, m(,) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, dither <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = <span style="color:#0000FF;font-weight: bold">false</span>) <span style="color:#0000FF;font-weight: bold">As</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> p2, result <span style="color:#0000FF;font-weight: bold">as</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> insurf,outsurf <span style="color:#0000FF;font-weight: bold">as</span> rgbSurface
			<span style="color:#0000FF;font-weight: bold">dim</span> x,y,r,g,b,w,h,r2,g2,b2 <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> rd,gd,bd,rrest,grest,brest <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">color</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> p=<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">verify</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">picture</span> <span style="color:#7F0000;text-style:italic">has</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">rgbsurface</span>
			insurf = p.rgbSurface
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				p2 = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> p2&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					p2.graphics.drawpicture p,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
					insurf = p2.rgbSurface
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			result = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> result&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				outsurf = result.rgbSurface
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span> outsurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			w = p.width-<span style="color:#326598">1</span>
			h = p.height-<span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">for</span> x = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> w
				<span style="color:#0000FF;font-weight: bold">for</span> y = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> h
					c = insurf.pixel(x,y)
					r = c.red + m(<span style="color:#326598">0</span>,<span style="color:#326598">3</span>)
					g = c.green + m(<span style="color:#326598">1</span>,<span style="color:#326598">3</span>)
					b = c.blue + m(<span style="color:#326598">2</span>,<span style="color:#326598">3</span>)
					
					rd = m(<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)*r + m(<span style="color:#326598">1</span>,<span style="color:#326598">0</span>)*g + m(<span style="color:#326598">2</span>,<span style="color:#326598">0</span>)*b + m(<span style="color:#326598">3</span>,<span style="color:#326598">0</span>)
					gd = m(<span style="color:#326598">0</span>,<span style="color:#326598">1</span>)*r + m(<span style="color:#326598">1</span>,<span style="color:#326598">1</span>)*g + m(<span style="color:#326598">2</span>,<span style="color:#326598">1</span>)*b + m(<span style="color:#326598">3</span>,<span style="color:#326598">1</span>)
					bd = m(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>)*r + m(<span style="color:#326598">1</span>,<span style="color:#326598">2</span>)*g + m(<span style="color:#326598">2</span>,<span style="color:#326598">2</span>)*b + m(<span style="color:#326598">3</span>,<span style="color:#326598">2</span>)
					
					<span style="color:#0000FF;font-weight: bold">if</span> dither <span style="color:#0000FF;font-weight: bold">then</span>
						rd = rd + rrest
						r2 = rd
						rrest = rd -r2
						gd = gd + grest
						g2 = gd
						grest = gd -g2
						bd = bd + brest
						b2 = bd
						brest = bd -b2
					<span style="color:#0000FF;font-weight: bold">else</span>
						r2 = rd
						g2 = gd
						b2 = bd
					<span style="color:#0000FF;font-weight: bold">end</span>
					
					outsurf.pixel(x,y) = rgb(r2,g2,b2)
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> result
			
			<span style="color:#0000FF;font-weight: bold">exception</span> err <span style="color:#0000FF;font-weight: bold">as</span> outofboundsException
			
			msgBox <span style="color:#6500FE">&quot;matrix</span> <span style="color:#6500FE">too</span> <span style="color:#6500FE">small&quot;</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> RunLengthDecode(<span style="color:#0000FF;font-weight: bold">extends</span> m <span style="color:#0000FF;font-weight: bold">as</span> memoryBlock) <span style="color:#0000FF;font-weight: bold">As</span> memoryBlock
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">must</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">dynamically</span> <span style="color:#7F0000;text-style:italic">resized.</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">start</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">2</span> <span style="color:#7F0000;text-style:italic">times</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">length</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> i,j <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> count <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> test,b <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> st <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> run <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> moffset, resultoffset <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> result <span style="color:#0000FF;font-weight: bold">as</span> memoryBlock
			<span style="color:#0000FF;font-weight: bold">dim</span> s <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			result = newmemoryBlock(m.size*<span style="color:#326598">2</span>)
			
			
			<span style="color:#7F0000;text-style:italic">//Loop</span> <span style="color:#7F0000;text-style:italic">until</span> <span style="color:#7F0000;text-style:italic">you</span> <span style="color:#7F0000;text-style:italic">get</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">unpacked</span> <span style="color:#7F0000;text-style:italic">bytes</span> <span style="color:#7F0000;text-style:italic">you</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">expecting:</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">Read</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">source</span> <span style="color:#7F0000;text-style:italic">byte</span> <span style="color:#7F0000;text-style:italic">into</span> <span style="color:#7F0000;text-style:italic">n.</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">If</span> <span style="color:#7F0000;text-style:italic">n</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">between</span> <span style="color:#7F0000;text-style:italic">0</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">127</span> <span style="color:#7F0000;text-style:italic">inclusive,</span> <span style="color:#7F0000;text-style:italic">copy</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">n+1</span> <span style="color:#7F0000;text-style:italic">bytes</span> <span style="color:#7F0000;text-style:italic">literally.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Else</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">n</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">between</span> <span style="color:#7F0000;text-style:italic">-127</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">-1</span> <span style="color:#7F0000;text-style:italic">inclusive,</span> <span style="color:#7F0000;text-style:italic">copy</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">byte</span> <span style="color:#7F0000;text-style:italic">-n+1</span> <span style="color:#7F0000;text-style:italic">times.</span>
			<span style="color:#7F0000;text-style:italic">//Else</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">n</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">-128,</span> <span style="color:#7F0000;text-style:italic">noop.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Endloop</span>
			
			<span style="color:#7F0000;text-style:italic">//-127</span> <span style="color:#7F0000;text-style:italic">signed</span> <span style="color:#7F0000;text-style:italic">char</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">129</span> <span style="color:#7F0000;text-style:italic">unsigned</span> <span style="color:#7F0000;text-style:italic">char</span>
			
			s = m.size
			
			<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> s-<span style="color:#326598">1</span>
				test = m.byte(moffset)
				moffset = moffset + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">if</span> test&gt;=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">and</span> test&lt;=<span style="color:#326598">127</span> <span style="color:#0000FF;font-weight: bold">then</span>
					st = m.stringValue(moffset,test+<span style="color:#326598">1</span>)
					moffset = moffset + test + <span style="color:#326598">1</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> result.size &lt; resultoffset + test + <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						result.size = resultoffset + test + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">end</span>
					result.stringValue(resultoffset,test+<span style="color:#326598">1</span>) = st
					resultoffset = resultoffset + test + <span style="color:#326598">1</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> test = <span style="color:#326598">128</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">nop</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					test = test - <span style="color:#326598">256</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">make</span> <span style="color:#7F0000;text-style:italic">signed</span>
					b = m.byte(moffset)
					moffset = moffset + <span style="color:#326598">1</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> result.size &lt; resultoffset - test + <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						result.size = resultoffset - test + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">end</span>
					<span style="color:#0000FF;font-weight: bold">for</span> j = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> -test + <span style="color:#326598">1</span>
						result.byte(resultoffset) = b
						resultoffset = resultoffset + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">end</span>
				i = moffset
			<span style="color:#0000FF;font-weight: bold">next</span>
			result.size = resultoffset
			<span style="color:#0000FF;font-weight: bold">return</span> result
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> RunLengthEncode(<span style="color:#0000FF;font-weight: bold">extends</span> m <span style="color:#0000FF;font-weight: bold">as</span> memoryBlock) <span style="color:#0000FF;font-weight: bold">As</span> memoryBlock
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Decode:</span>
			<span style="color:#7F0000;text-style:italic">//Loop</span> <span style="color:#7F0000;text-style:italic">until</span> <span style="color:#7F0000;text-style:italic">you</span> <span style="color:#7F0000;text-style:italic">get</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">unpacked</span> <span style="color:#7F0000;text-style:italic">bytes</span> <span style="color:#7F0000;text-style:italic">you</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">expecting:</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">Read</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">source</span> <span style="color:#7F0000;text-style:italic">byte</span> <span style="color:#7F0000;text-style:italic">into</span> <span style="color:#7F0000;text-style:italic">n.</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">If</span> <span style="color:#7F0000;text-style:italic">n</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">between</span> <span style="color:#7F0000;text-style:italic">0</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">127</span> <span style="color:#7F0000;text-style:italic">inclusive,</span> <span style="color:#7F0000;text-style:italic">copy</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">n+1</span> <span style="color:#7F0000;text-style:italic">bytes</span> <span style="color:#7F0000;text-style:italic">literally.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Else</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">n</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">between</span> <span style="color:#7F0000;text-style:italic">-127</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">-1</span> <span style="color:#7F0000;text-style:italic">inclusive,</span> <span style="color:#7F0000;text-style:italic">copy</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">byte</span> <span style="color:#7F0000;text-style:italic">-n+1</span> <span style="color:#7F0000;text-style:italic">times.</span>
			<span style="color:#7F0000;text-style:italic">//Else</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">n</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">-128,</span> <span style="color:#7F0000;text-style:italic">noop.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Endloop</span>
			
			<span style="color:#7F0000;text-style:italic">//-127</span> <span style="color:#7F0000;text-style:italic">signed</span> <span style="color:#7F0000;text-style:italic">char</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">129</span> <span style="color:#7F0000;text-style:italic">unsigned</span> <span style="color:#7F0000;text-style:italic">char</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">worst</span> <span style="color:#7F0000;text-style:italic">case:</span> <span style="color:#7F0000;text-style:italic">result</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">128/127</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">1</span> <span style="color:#7F0000;text-style:italic">byte</span> <span style="color:#7F0000;text-style:italic">longer</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> count <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> test,old,oldold <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> st <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> run <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> moffset, resultoffset <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> result <span style="color:#0000FF;font-weight: bold">as</span> memoryBlock
			<span style="color:#0000FF;font-weight: bold">dim</span> s <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			result = newmemoryBlock(m.size*<span style="color:#326598">128</span>/<span style="color:#326598">127</span>+<span style="color:#326598">1</span>)
			
			<span style="color:#7F0000;text-style:italic">//test</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">declare</span>
			
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">toolbox</span> <span style="color:#7F0000;text-style:italic">function</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">mac,</span> <span style="color:#7F0000;text-style:italic">but</span> <span style="color:#7F0000;text-style:italic">i</span> <span style="color:#7F0000;text-style:italic">never</span> <span style="color:#7F0000;text-style:italic">got</span> <span style="color:#7F0000;text-style:italic">it</span> <span style="color:#7F0000;text-style:italic">working.</span>
			<span style="color:#7F0000;text-style:italic">&#39;dim</span> <span style="color:#7F0000;text-style:italic">memIn,memOut</span>  <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">memoryblock</span>
			<span style="color:#7F0000;text-style:italic">&#39;</span>
			<span style="color:#7F0000;text-style:italic">&#39;if</span> <span style="color:#7F0000;text-style:italic">s</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">0</span> <span style="color:#7F0000;text-style:italic">then</span>
			<span style="color:#7F0000;text-style:italic">&#39;return</span>
			<span style="color:#7F0000;text-style:italic">&#39;end</span>
			<span style="color:#7F0000;text-style:italic">&#39;</span>
			<span style="color:#7F0000;text-style:italic">&#39;memIn</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">newmemoryBlock(s)</span>
			<span style="color:#7F0000;text-style:italic">&#39;for</span> <span style="color:#7F0000;text-style:italic">i</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">0</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">s-1</span>
			<span style="color:#7F0000;text-style:italic">&#39;memin.byte(i)</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">m.readbyte</span>
			<span style="color:#7F0000;text-style:italic">&#39;next</span>
			<span style="color:#7F0000;text-style:italic">&#39;memOut</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">newmemoryBlock(s+(s+126)/127)</span>
			<span style="color:#7F0000;text-style:italic">&#39;</span>
			<span style="color:#7F0000;text-style:italic">&#39;Declare</span> <span style="color:#7F0000;text-style:italic">Sub</span> <span style="color:#7F0000;text-style:italic">PackBits</span> <span style="color:#7F0000;text-style:italic">Lib</span> <span style="color:#7F0000;text-style:italic">&quot;InterfaceLib&quot;</span> <span style="color:#7F0000;text-style:italic">(srcPtr</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">Ptr,</span> <span style="color:#7F0000;text-style:italic">dstPtr</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">Ptr,</span> <span style="color:#7F0000;text-style:italic">srcBytes</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">Integer)</span>
			<span style="color:#7F0000;text-style:italic">&#39;</span>
			<span style="color:#7F0000;text-style:italic">&#39;PackBits</span> <span style="color:#7F0000;text-style:italic">memIn,memOut,s</span>
			<span style="color:#7F0000;text-style:italic">&#39;</span>
			<span style="color:#7F0000;text-style:italic">&#39;for</span> <span style="color:#7F0000;text-style:italic">i</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">0</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">s+(s+126)/127-1</span>
			<span style="color:#7F0000;text-style:italic">&#39;</span>
			<span style="color:#7F0000;text-style:italic">&#39;next</span>
			<span style="color:#7F0000;text-style:italic">&#39;</span>
			<span style="color:#7F0000;text-style:italic">&#39;return</span>
			
			test=-<span style="color:#326598">1</span>
			old = -<span style="color:#326598">1</span>
			oldold=-<span style="color:#326598">1</span>
			count = -<span style="color:#326598">1</span>
			run = <span style="color:#0000FF;font-weight: bold">false</span>
			st=<span style="color:#6500FE">&quot;&quot;</span>
			s = m.size
			<span style="color:#0000FF;font-weight: bold">for</span> i = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> s-<span style="color:#326598">1</span>
				test = m.byte(moffset)
				moffset = moffset + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">if</span> run <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">if</span> test = old <span style="color:#0000FF;font-weight: bold">then</span>
						count = count -<span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">if</span> count = <span style="color:#326598">129</span>  <span style="color:#0000FF;font-weight: bold">then</span>
							result.byte(resultoffset) = count
							resultoffset = resultoffset + <span style="color:#326598">1</span>
							result.byte(resultoffset) = test
							resultoffset = resultoffset + <span style="color:#326598">1</span>
							run = <span style="color:#0000FF;font-weight: bold">false</span>
							test = -<span style="color:#326598">1</span>
							count = -<span style="color:#326598">1</span>
							st = <span style="color:#6500FE">&quot;&quot;</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						result.byte(resultoffset) = count
						resultoffset = resultoffset + <span style="color:#326598">1</span>
						result.byte(resultoffset) = old
						resultoffset = resultoffset + <span style="color:#326598">1</span>
						run = <span style="color:#0000FF;font-weight: bold">false</span>
						count = <span style="color:#326598">0</span>
						st =chrb(test)
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#0000FF;font-weight: bold">if</span> test = old <span style="color:#0000FF;font-weight: bold">and</span> test = oldold <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">if</span> count &gt; <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
							result.byte(resultoffset) = count-<span style="color:#326598">2</span>
							resultoffset = resultoffset + <span style="color:#326598">1</span>
							result.stringvalue(resultoffset,lenb(st)) = st
							resultoffset = resultoffset + lenb(st)
							resultoffset = resultoffset - <span style="color:#326598">2</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">last</span> <span style="color:#7F0000;text-style:italic">2</span> <span style="color:#7F0000;text-style:italic">bytes</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">wrong</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						run = <span style="color:#0000FF;font-weight: bold">true</span>
						count = <span style="color:#326598">254</span>
						st =<span style="color:#6500FE">&quot;&quot;</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						st = st + chrb(test)
						count = count + <span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">if</span> count = <span style="color:#326598">127</span> <span style="color:#0000FF;font-weight: bold">then</span>
							result.byte(resultoffset) = count
							resultoffset = resultoffset + <span style="color:#326598">1</span>
							result.stringvalue(resultoffset,lenb(st)) = st
							resultoffset = resultoffset + lenb(st)
							run = <span style="color:#0000FF;font-weight: bold">false</span>
							test = -<span style="color:#326598">1</span>
							count = -<span style="color:#326598">1</span>
							st = <span style="color:#6500FE">&quot;&quot;</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				oldold = old
				old = test
				
			<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">if</span> count &gt;-<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">if</span> run <span style="color:#0000FF;font-weight: bold">then</span>
					result.byte(resultoffset) = count
					resultoffset = resultoffset + <span style="color:#326598">1</span>
					result.byte(resultoffset) = test
					resultoffset = resultoffset + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					result.byte(resultoffset) = count
					resultoffset = resultoffset + <span style="color:#326598">1</span>
					result.stringvalue(resultoffset,lenb(st)) = st
					resultoffset = resultoffset + lenb(st)
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			result.size = resultoffset
			<span style="color:#0000FF;font-weight: bold">return</span> result
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Unmultiply(<span style="color:#0000FF;font-weight: bold">extends</span> p <span style="color:#0000FF;font-weight: bold">as</span> picture) <span style="color:#0000FF;font-weight: bold">As</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> p2, maskpicture, result <span style="color:#0000FF;font-weight: bold">as</span> picture
			<span style="color:#0000FF;font-weight: bold">dim</span> insurf,masksurf,outsurf <span style="color:#0000FF;font-weight: bold">as</span> rgbSurface
			<span style="color:#0000FF;font-weight: bold">dim</span> x,y,r,g,b,m,w,h <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">color</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> p=<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">verify</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">picture</span> <span style="color:#7F0000;text-style:italic">has</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">rgbsurface</span>
			insurf = p.rgbSurface
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				p2 = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> p2&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					p2.graphics.drawpicture p,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
					insurf = p2.rgbSurface
				<span style="color:#0000FF;font-weight: bold">end</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				p2 = p
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			maskpicture = p2.mask
			masksurf = maskpicture.rgbsurface
			
			result = <span style="color:#0000FF;font-weight: bold">New</span> Picture(p.width,p.height,<span style="color:#326598">32</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> result&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				outsurf = result.rgbSurface
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> insurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span> masksurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span>  outsurf = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span>
			
			w = p.width-<span style="color:#326598">1</span>
			h = p.height-<span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">for</span> x = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> w
				<span style="color:#0000FF;font-weight: bold">for</span> y = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> h
					c = insurf.pixel(x,y)
					r = c.red
					g = c.green
					b = c.blue
					m = <span style="color:#326598">255</span>-masksurf.pixel(x,y).green
					
					<span style="color:#0000FF;font-weight: bold">if</span> m &gt; <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
						r = r * <span style="color:#326598">255</span> / m
						g = g * <span style="color:#326598">255</span> / m
						b = b * <span style="color:#326598">255</span> / m
					<span style="color:#0000FF;font-weight: bold">end</span>
					
					outsurf.pixel(x,y) = rgb(r,g,b)
				<span style="color:#0000FF;font-weight: bold">next</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			result.mask.graphics.drawpicture maskpicture,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> result
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;About</span> <span style="color:#6500FE">PictureConvolutionMBS&quot;</span>
<div class="RB_Comment">			Class PictureConvolutionMBS
			
			Filter a picture using a custom defined horizontal and vertical convolution.
			A conviolution is a filter window applied iteratively over the pixels.
			Convolution filtering is a basic image-processing function used for 
			applications like blurring, sharpening, edge detection and resampling.
			The filters are provides to the plugin as arrays of doubles. If the sum of the 
			values is not 1, then the resulting picture will be darker or brighter.
			The border pixels (filtersize/2) will not be processed but return white.
			If you need the filter until the border, then you need to provide a larger
			picture with either a black border or the last pixel repeated, whatever is
			more appropriate for you.
			
			Properties:
			- Hor() as double                :   filter set for horizontal filtering.
			- Ver() as double                :   filter set for vertical filtering
			- MaxX ??
			- MaxY ??
			- MinX ??
			- MinY ??
			- sourcePicture as Picture
			- destinationPicture as Picture
			
			Methods:
			- Run                            :    transform the sourcePicture into the destinationPicture
			- Close</div>
</div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;About</span> <span style="color:#6500FE">PictureLut3dMBS&quot;</span>
<div class="RB_Comment">			Class PictureLut3dMBS
			
			Color correction of a picture using a three-dimensional lookup table.
			Lookup tables are used to speed up color corrections of an image. 
			A three-dimensional lookup table can modelise any correction and even 
			corrections based on experimental data, where no mathematical model is available.
			To be efficient, the lookup table cannot contain all values (17 million), 
			but only some values in a regular grid. The values are then interpolated.
			If you retain the corner values 0 and 255, there is a limited number of possible 
			grid sizes, all of which must be dividers of 255.
			We retain a table with 16*16*16 values which gives a good interpolation while keeping the size of the table small.
			
			Properties:
			- Table(15,15,15,2) as Double     :   look up table. The dimesions define red, green, blue and the channel.
			- MaxX ??
			- MaxY ??
			- MinX ??
			- MinY ??
			- sourcePicture as Picture
			- destinationPicture as Picture
			- dither as Boolean              :    dither rounding errors to avoid stepping artefacts
			
			Methods:
			- Run                            :    transform the sourcePicture into the destinationPicture
			- Close</div>
</div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;About</span> <span style="color:#6500FE">PictureMatrix3DMBS&quot;</span>
<div class="RB_Comment">			Class PictureMatrix3dMBS
			
			Transformation of a picture in the RGB color space. 
			Each new color is defined as a linear combination of the old color. 
			This transformation can be used to make a picture gray or tinted or 
			to transform the picture into another color space like the video component space. 
			The matrix (0,0) - (2,2) define the multiplication factors.
			The vector (0,3) - (2,3) defines the constants added before the multiplication to the source channel.
			The vector (3,0) - (3,2) defines the constants added after the multiplication to the source channel.
			The value (3,3) is unused.
			Red, for example, is calculated using the following formula:
			red = Matrix(0,0)*(r+Matrix(0,3)) + Matrix(1,0)*(g+Matrix(1,3)) + Matrix(2,0)*(b+Matrix(2,3)) + Matrix(3,0)
			
			Properties:
			- Matrix(3,3) as Double          :    
			- MaxX ??
			- MaxY ??
			- MinX ??
			- MinY ??
			- sourcePicture as Picture
			- destinationPicture as Picture
			- dither as Boolean              :    dither rounding errors to avoid stepping artefacts
			
			Methods:
			- Run                            :    transform the sourcePicture into the destinationPicture
			- Close</div>
</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Module</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	ExternalFile toni</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> ExternalFile</div>
</div>
<div class="RB_Code"><span style="color:#0000FF;font-weight: bold">End</span> Project</div>

<p>See also:<ul>
<li><A href="example-picture-imageeffects-colourtinter.html">/Picture/Image effects/ColourTinter</A></li>
</ul></p>
</div>
<p>The items on this page are in the following plugins: <a href="plugins-mbspictureplugin.html">MBS Picture Plugin</a>.</p>
<!-- Ende Content-->

<br>
<div style="width: 200pt; margin: 0pt; padding: 5pt; border-color:#ccc; border-style:solid; background-color: #eee; border-width: 2pt; border-radius: 10pt; " lang="en">
&#128172; <a href="https://www.monkeybreadsoftware.com/feedback/?what=xojo&path=example-picture-imageeffects-imagetransformation">Ask a question or report a problem</a>
</div>

</BODY>
</HTML>

