<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Frameset//EN" >
<HTML>
<HEAD>
<TITLE>Monkeybread Xojo plugin - Example: /Util/JSON/JSONItem clone</TITLE>
<script src="../platforms.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../help.css" >
<link rel="stylesheet" type="text/css" href="../screen.css" media="screen">
<link rel="stylesheet" type="text/css" href="../print.css" media="print">
<link rel="stylesheet" type="text/css" href="../allitems.css" title="Default">
<link rel="alternate stylesheet" type="text/css" href="../macitems.css" title="Mac">
<link rel="alternate stylesheet" type="text/css" href="../winitems.css" title="Win">
<link rel="alternate stylesheet" type="text/css" href="../linuxitems.css" title="Linux">
<link rel="alternate stylesheet" type="text/css" href="../crossitems.css" title="Crossplatform">
<meta http-equiv="content-type" content="text/html; charset=x-mac-roman">
<META NAME="description" CONTENT="Example">
</head>
<BODY BGCOLOR="#FFFFFF">
<H2 lang="en">Example: /Util/JSON/JSONItem clone</h2>
<p><a href="http://www.monkeybreadsoftware.net">Online Documentation</a> &nbsp; - &nbsp; <a href="stats.html">Statistics</a> &nbsp; - &nbsp; <a href="topic-faq.html">FAQ</a> &nbsp; - &nbsp; <a href="parts.html">Plugin Parts</a> (<a href="partsall.html">All</a>, <a href="plugindeps.html">Dependencies</a>) &nbsp; - &nbsp; <a href="hierarchy.html">Class hierarchy</a></p>
<p>New in Version 
<a href="newinversion213.html">21.3</a> 
<a href="newinversion214.html">21.4</a> 
<a href="newinversion215.html">21.5</a> 
<a href="newinversion220.html">22.0</a> 
<a href="newinversion221.html">22.1</a> 
<a href="newinversion222.html">22.2</a> 
<a href="newinversion223.html">22.3</a> 
<a href="newinversion224.html">22.4</a> 
<a href="newinversion225.html">22.5</a> 
<a href="newinversion230.html">23.0</a> 
<a href="newinversion231.html">23.1</a> 
<a href="newinversion232.html">23.2</a> 
</p>
<p>The list of the &nbsp; <a href="themes.html">topics</a>, 
 &nbsp; <a href="classes.html">classes</a>,
 &nbsp; <a href="interfaces.html">interfaces</a>,
 &nbsp; <a href="controls.html">controls</a>,
 &nbsp; <a href="modules.html">modules</a>,
 &nbsp; <a href="globaltopic.html">global methods by category</a>,
 &nbsp; <a href="globalname.html">global methods by name</a>,
 &nbsp; <a href="screenshots.html">screenshots</a>,
 &nbsp; <a href="licenses.html">licenses</a> &nbsp;
 and &nbsp; <a href="examples.html">examples</a>.</p>
<p id=PlatformChooserMBS>Platforms to show: <a class="isA" href="javascript:all();">All</a> <a class="isM" href="javascript:mac();">Mac</a> <a class="isW" href="javascript:win();">Windows</a> <a class="isL" href="javascript:linux();">Linux</a> <a class="isC" href="javascript:crossplatform();">Cross-Platform</a></p>
<div class="">
<b><A name="1">/Util/JSON/JSONItem clone</A></b><br>
<B>Function:</B> 
<br>
Required plugins for this example: MBS Util Plugin<BR>
You find this example project in your Plugins Download as a Xojo project file within the examples folder: /Util/JSON/JSONItem clone<BR>
This example is the version from Wed, 4th Oct 2022.<BR>

<div class="RB_Code">Project <span style="color:#6500FE">&quot;JSONItem</span> <span style="color:#6500FE">clone.xojo_binary_project&quot;</span></div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> App <span style="color:#0000FF;font-weight: bold">Inherits</span> Application</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kEditClear = <span style="color:#6500FE">&quot;&amp;Delete&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kFileQuit = <span style="color:#6500FE">&quot;&amp;Quit&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kFileQuitShortcut = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> Window1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> constJSON_Test1 = <span style="color:#6500FE">&quot;[&quot;</span><span style="color:#6500FE">&quot;a&quot;</span><span style="color:#6500FE">&quot;,1,&quot;</span><span style="color:#6500FE">&quot;b&quot;</span><span style="color:#6500FE">&quot;,2,</span> <span style="color:#6500FE">2.5]&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> constJSON_Test2 = <span style="color:#6500FE">&quot;{&quot;</span><span style="color:#6500FE">&quot;a&quot;</span><span style="color:#6500FE">&quot;:1,</span> <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;b&quot;</span><span style="color:#6500FE">&quot;:2}&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> constJSON_Test3 = <span style="color:#6500FE">&quot;[\r</span>      <span style="color:#6500FE">{\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;id&quot;</span><span style="color:#6500FE">&quot;:127,\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;name&quot;</span><span style="color:#6500FE">&quot;:&quot;</span><span style="color:#6500FE">&quot;Meier&quot;</span><span style="color:#6500FE">&quot;,\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;prename&quot;</span><span style="color:#6500FE">&quot;:&quot;</span><span style="color:#6500FE">&quot;Anna&quot;</span><span style="color:#6500FE">&quot;,\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;age&quot;</span><span style="color:#6500FE">&quot;:13,\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;birthdate&quot;</span><span style="color:#6500FE">&quot;:&quot;</span><span style="color:#6500FE">&quot;20071208&quot;</span><span style="color:#6500FE">&quot;\r</span>      <span style="color:#6500FE">},\r</span>      <span style="color:#6500FE">{\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;id&quot;</span><span style="color:#6500FE">&quot;:142,\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;name&quot;</span><span style="color:#6500FE">&quot;:&quot;</span><span style="color:#6500FE">&quot;Meier&quot;</span><span style="color:#6500FE">&quot;,\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;prename&quot;</span><span style="color:#6500FE">&quot;:&quot;</span><span style="color:#6500FE">&quot;Patrick&quot;</span><span style="color:#6500FE">&quot;,\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;age&quot;</span><span style="color:#6500FE">&quot;:12,\r</span>        <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;birthdate&quot;</span><span style="color:#6500FE">&quot;:&quot;</span><span style="color:#6500FE">&quot;20081127&quot;</span><span style="color:#6500FE">&quot;\r</span>      <span style="color:#6500FE">}\r</span>    <span style="color:#6500FE">]&quot;</span></div>
<div class="RB_MainItem">
<div class="RB_Code">		Control TextArea1 <span style="color:#0000FF;font-weight: bold">Inherits</span> TextArea</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance TextArea1 <span style="color:#0000FF;font-weight: bold">Inherits</span> TextArea</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnJSONItem <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnJSONItem <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">Dim</span> j <span style="color:#0000FF;font-weight: bold">As</span> JSONItem
				<span style="color:#0000FF;font-weight: bold">Dim</span> s() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
				s.Append(<span style="color:#6500FE">&quot;JSONItem&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				
				s.Append(constJSON_Test1)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem(constJSON_Test1)
				
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> j.Count-<span style="color:#326598">1</span>
					s.Append(<span style="color:#6500FE">&quot;Value(&quot;</span> + Str(i) + <span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + j.Value(i).StringValue)
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(constJSON_Test2)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem(constJSON_Test2)
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				s.Append(<span style="color:#6500FE">&quot;Count:</span> <span style="color:#6500FE">&quot;</span> + Str(j.Count))
				s.Append(<span style="color:#6500FE">&quot;a:</span> <span style="color:#6500FE">&quot;</span> + j.Value(<span style="color:#6500FE">&quot;a&quot;</span>))
				s.Append(<span style="color:#6500FE">&quot;b:</span> <span style="color:#6500FE">&quot;</span> + j.Value(<span style="color:#6500FE">&quot;b&quot;</span>))
				s.Append(<span style="color:#6500FE">&quot;HasName(&quot;</span><span style="color:#6500FE">&quot;a&quot;</span><span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + Str(j.HasName(<span style="color:#6500FE">&quot;a&quot;</span>)))
				s.Append(<span style="color:#6500FE">&quot;HasName(&quot;</span><span style="color:#6500FE">&quot;A&quot;</span><span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + Str(j.HasName(<span style="color:#6500FE">&quot;A&quot;</span>)))
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(constJSON_Test3)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem(constJSON_Test3)
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> j.Count-<span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">Dim</span> k <span style="color:#0000FF;font-weight: bold">As</span> JSONItem = j.Child(i)
					s.Append(<span style="color:#6500FE">&quot;Value(&quot;</span> + Str(i) + <span style="color:#6500FE">&quot;).id/prename:</span> <span style="color:#6500FE">&quot;</span> + k.Lookup(<span style="color:#6500FE">&quot;id&quot;</span>, <span style="color:#326598">0</span>) + <span style="color:#6500FE">&quot;/&quot;</span> + k.Lookup(<span style="color:#6500FE">&quot;prename&quot;</span>, <span style="color:#6500FE">&quot;&quot;</span>))
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;own</span> <span style="color:#6500FE">new</span> <span style="color:#6500FE">JSONItem</span> <span style="color:#6500FE">with</span> <span style="color:#6500FE">DecimalFormat:</span> <span style="color:#6500FE">-0.0##&quot;</span>)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem
				j.DecimalFormat = <span style="color:#6500FE">&quot;-0.0##&quot;</span>
				j.Value(<span style="color:#6500FE">&quot;1&quot;</span>) = <span style="color:#006532">23.67</span>
				j.Value(<span style="color:#6500FE">&quot;2&quot;</span>) = -<span style="color:#006532">2.7</span>
				j.Value(<span style="color:#6500FE">&quot;3&quot;</span>) = <span style="color:#326598">12</span>
				j.Value(<span style="color:#6500FE">&quot;4&quot;</span>) = <span style="color:#006532">12345.67891</span>
				<span style="color:#0000FF;font-weight: bold">Dim</span> va() <span style="color:#0000FF;font-weight: bold">As</span> Variant
				va.Append(<span style="color:#006532">23.67</span>)
				va.Append(-<span style="color:#006532">2.7</span>)
				va.Append(<span style="color:#326598">12</span>)
				va.Append(<span style="color:#006532">12345.67891</span>)
				j.Value(<span style="color:#6500FE">&quot;a&quot;</span>) = va
				s.Append(j.ToString)
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem
				j.Value(<span style="color:#6500FE">&quot;Hello&quot;</span>) = <span style="color:#6500FE">&quot;World&quot;</span>
				j.Value(<span style="color:#6500FE">&quot;Integer_1&quot;</span>) = <span style="color:#326598">2</span>
				j.Value(<span style="color:#6500FE">&quot;Double_7.5&quot;</span>) = <span style="color:#006532">7.5</span>
				j.Value(<span style="color:#6500FE">&quot;Double_23.67&quot;</span>) = <span style="color:#006532">23.67</span>
				j.Value(<span style="color:#6500FE">&quot;Integer_Array&quot;</span>) = <span style="color:#0000FF;font-weight: bold">Array</span>(<span style="color:#326598">1</span>,<span style="color:#326598">3</span>,<span style="color:#326598">5</span>,<span style="color:#326598">7</span>)
				j.Value(<span style="color:#6500FE">&quot;Double_Array&quot;</span>) = <span style="color:#0000FF;font-weight: bold">Array</span>(<span style="color:#006532">1.5</span>,<span style="color:#006532">3.3</span>,<span style="color:#006532">987.123456</span>)
				s.Append(<span style="color:#6500FE">&quot;own</span> <span style="color:#6500FE">New</span> <span style="color:#6500FE">JSONItem,</span> <span style="color:#6500FE">changing</span> <span style="color:#6500FE">DecimalFormat</span> <span style="color:#6500FE">later&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;Count:</span> <span style="color:#6500FE">&quot;</span> + Str(j.Count))
				s.Append(<span style="color:#6500FE">&quot;ToString:</span> <span style="color:#6500FE">&quot;</span> + j.ToString)
				j.DecimalFormat = <span style="color:#6500FE">&quot;-0.0####&quot;</span>
				s.Append(<span style="color:#6500FE">&quot;ToString</span> <span style="color:#6500FE">(DecimalFormat:</span> <span style="color:#6500FE">&quot;</span> + j.DecimalFormat + <span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + j.ToString)
				
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem
				j.Compact = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i1 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">100</span>
					<span style="color:#0000FF;font-weight: bold">Dim</span> j2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">New</span> JSONItem
					<span style="color:#0000FF;font-weight: bold">for</span> i2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">25</span>
						<span style="color:#0000FF;font-weight: bold">if</span> i2 <span style="color:#0000FF;font-weight: bold">mod</span> <span style="color:#326598">2</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
							j2.Value(Str(i1) + <span style="color:#6500FE">&quot;.&quot;</span> + Str(i2)) = <span style="color:#6500FE">&quot;Value</span> <span style="color:#6500FE">&quot;</span> + Str(i2)
						<span style="color:#0000FF;font-weight: bold">else</span>
							j2.Value(Str(i2)) = i2
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					j.Value(Str(i1)) = j2
				<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">Dim</span> d <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Double</span> = Microseconds
				<span style="color:#0000FF;font-weight: bold">Dim</span> s2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span> = j.ToString
				d = Microseconds - d
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;2500</span> <span style="color:#6500FE">JSON</span> <span style="color:#6500FE">objects</span> <span style="color:#6500FE">.ToString:</span> <span style="color:#6500FE">&quot;</span> + Format(d/<span style="color:#326598">1000</span>, <span style="color:#6500FE">&quot;####0.0##&quot;</span>) + <span style="color:#6500FE">&quot;ms&quot;</span>)
				s.Append(s2)
				
				TextArea1.Text = Join(s, EndOfLine)
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnJSONItem_MBS <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnJSONItem_MBS <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">Dim</span> j <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MBS
				<span style="color:#0000FF;font-weight: bold">Dim</span> s() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
				s.Append(<span style="color:#6500FE">&quot;JSONItem_MBS&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				
				s.Append(constJSON_Test1)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MBS(constJSON_Test1)
				
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> j.Count-<span style="color:#326598">1</span>
					s.Append(<span style="color:#6500FE">&quot;Value(&quot;</span> + Str(i) + <span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + j.Value(i).StringValue)
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(constJSON_Test2)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MBS(constJSON_Test2)
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				s.Append(<span style="color:#6500FE">&quot;Count:</span> <span style="color:#6500FE">&quot;</span> + Str(j.Count))
				s.Append(<span style="color:#6500FE">&quot;a:</span> <span style="color:#6500FE">&quot;</span> + j.Value(<span style="color:#6500FE">&quot;a&quot;</span>))
				s.Append(<span style="color:#6500FE">&quot;b:</span> <span style="color:#6500FE">&quot;</span> + j.Value(<span style="color:#6500FE">&quot;b&quot;</span>))
				s.Append(<span style="color:#6500FE">&quot;HasName(&quot;</span><span style="color:#6500FE">&quot;a&quot;</span><span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + Str(j.HasName(<span style="color:#6500FE">&quot;a&quot;</span>)))
				s.Append(<span style="color:#6500FE">&quot;HasName(&quot;</span><span style="color:#6500FE">&quot;A&quot;</span><span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + Str(j.HasName(<span style="color:#6500FE">&quot;A&quot;</span>)))
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(constJSON_Test3)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MBS(constJSON_Test3)
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> j.Count-<span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">Dim</span> k <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MBS = j.Child(i)
					s.Append(<span style="color:#6500FE">&quot;Value(&quot;</span> + Str(i) + <span style="color:#6500FE">&quot;).id/prename:</span> <span style="color:#6500FE">&quot;</span> + k.Lookup(<span style="color:#6500FE">&quot;id&quot;</span>, <span style="color:#326598">0</span>) + <span style="color:#6500FE">&quot;/&quot;</span> + k.Lookup(<span style="color:#6500FE">&quot;prename&quot;</span>, <span style="color:#6500FE">&quot;&quot;</span>))
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;own</span> <span style="color:#6500FE">new</span> <span style="color:#6500FE">JSONItem</span> <span style="color:#6500FE">with</span> <span style="color:#6500FE">DecimalFormat:</span> <span style="color:#6500FE">-0.0##&quot;</span>)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MBS
				j.DecimalFormat = <span style="color:#6500FE">&quot;-0.0##&quot;</span>
				j.Value(<span style="color:#6500FE">&quot;1&quot;</span>) = <span style="color:#006532">23.67</span>
				j.Value(<span style="color:#6500FE">&quot;2&quot;</span>) = -<span style="color:#006532">2.7</span>
				j.Value(<span style="color:#6500FE">&quot;3&quot;</span>) = <span style="color:#326598">12</span>
				j.Value(<span style="color:#6500FE">&quot;4&quot;</span>) = <span style="color:#006532">12345.67891</span>
				
				<span style="color:#0000FF;font-weight: bold">Dim</span> va() <span style="color:#0000FF;font-weight: bold">As</span> Variant
				va.Append(<span style="color:#006532">23.67</span>)
				va.Append(-<span style="color:#006532">2.7</span>)
				va.Append(<span style="color:#326598">12</span>)
				va.Append(<span style="color:#006532">12345.67891</span>)
				j.Value(<span style="color:#6500FE">&quot;a&quot;</span>) = va
				s.Append(j.ToString)
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MBS
				j.Value(<span style="color:#6500FE">&quot;Hello&quot;</span>) = <span style="color:#6500FE">&quot;World&quot;</span>
				j.Value(<span style="color:#6500FE">&quot;Integer_1&quot;</span>) = <span style="color:#326598">2</span>
				j.Value(<span style="color:#6500FE">&quot;Double_7.5&quot;</span>) = <span style="color:#006532">7.5</span>
				j.Value(<span style="color:#6500FE">&quot;Double_23.67&quot;</span>) = <span style="color:#006532">23.67</span>
				j.Value(<span style="color:#6500FE">&quot;Integer_Array&quot;</span>) = <span style="color:#0000FF;font-weight: bold">Array</span>(<span style="color:#326598">1</span>,<span style="color:#326598">3</span>,<span style="color:#326598">5</span>,<span style="color:#326598">7</span>)
				j.Value(<span style="color:#6500FE">&quot;Double_Array&quot;</span>) = <span style="color:#0000FF;font-weight: bold">Array</span>(<span style="color:#006532">1.5</span>,<span style="color:#006532">3.3</span>,<span style="color:#006532">987.123456</span>)
				s.Append(<span style="color:#6500FE">&quot;own</span> <span style="color:#6500FE">New</span> <span style="color:#6500FE">JSONItem,</span> <span style="color:#6500FE">changing</span> <span style="color:#6500FE">DecimalFormat</span> <span style="color:#6500FE">later&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;Count:</span> <span style="color:#6500FE">&quot;</span> + Str(j.Count))
				s.Append(<span style="color:#6500FE">&quot;ToString:</span> <span style="color:#6500FE">&quot;</span> + j.ToString)
				j.DecimalFormat = <span style="color:#6500FE">&quot;-0.0####&quot;</span>
				s.Append(<span style="color:#6500FE">&quot;ToString</span> <span style="color:#6500FE">(DecimalFormat:</span> <span style="color:#6500FE">&quot;</span> + j.DecimalFormat + <span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + j.ToString)
				
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MBS
				j.Compact = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i1 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">100</span>
					<span style="color:#0000FF;font-weight: bold">Dim</span> j2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MBS
					<span style="color:#0000FF;font-weight: bold">for</span> i2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">25</span>
						<span style="color:#0000FF;font-weight: bold">if</span> i2 <span style="color:#0000FF;font-weight: bold">mod</span> <span style="color:#326598">2</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
							j2.Value(Str(i1) + <span style="color:#6500FE">&quot;.&quot;</span> + Str(i2)) = <span style="color:#6500FE">&quot;Value</span> <span style="color:#6500FE">&quot;</span> + Str(i2)
						<span style="color:#0000FF;font-weight: bold">else</span>
							j2.Value(Str(i2)) = i2
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					j.Value(Str(i1)) = j2
				<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">Dim</span> d <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Double</span> = Microseconds
				<span style="color:#0000FF;font-weight: bold">Dim</span> s2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span> = j.ToString
				d = Microseconds - d
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;2500</span> <span style="color:#6500FE">JSON</span> <span style="color:#6500FE">objects</span> <span style="color:#6500FE">.ToString:</span> <span style="color:#6500FE">&quot;</span> + Format(d/<span style="color:#326598">1000</span>, <span style="color:#6500FE">&quot;####0.0##&quot;</span>) + <span style="color:#6500FE">&quot;ms&quot;</span>)
				s.Append(s2)
				
				TextArea1.Text = Join(s, EndOfLine)
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control btnJSONItem_MTC <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance btnJSONItem_MTC <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">Dim</span> j <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC
				<span style="color:#0000FF;font-weight: bold">Dim</span> s() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
				s.Append(<span style="color:#6500FE">&quot;JSONItem_MTC:</span> <span style="color:#6500FE">https://github.com/ktekinay/JSONItem_MTC&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				
				s.Append(constJSON_Test1)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MTC(constJSON_Test1)
				
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> j.Count-<span style="color:#326598">1</span>
					s.Append(<span style="color:#6500FE">&quot;Value(&quot;</span> + Str(i) + <span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + j.Value(i).StringValue)
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(constJSON_Test2)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MTC(constJSON_Test2)
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				s.Append(<span style="color:#6500FE">&quot;Count:</span> <span style="color:#6500FE">&quot;</span> + Str(j.Count))
				s.Append(<span style="color:#6500FE">&quot;a:</span> <span style="color:#6500FE">&quot;</span> + j.Value(<span style="color:#6500FE">&quot;a&quot;</span>))
				s.Append(<span style="color:#6500FE">&quot;b:</span> <span style="color:#6500FE">&quot;</span> + j.Value(<span style="color:#6500FE">&quot;b&quot;</span>))
				s.Append(<span style="color:#6500FE">&quot;HasName(&quot;</span><span style="color:#6500FE">&quot;a&quot;</span><span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + Str(j.HasName(<span style="color:#6500FE">&quot;a&quot;</span>)))
				s.Append(<span style="color:#6500FE">&quot;HasName(&quot;</span><span style="color:#6500FE">&quot;A&quot;</span><span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + Str(j.HasName(<span style="color:#6500FE">&quot;A&quot;</span>)))
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(constJSON_Test3)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MTC(constJSON_Test3)
				s.Append(<span style="color:#6500FE">&quot;IsArray:</span> <span style="color:#6500FE">&quot;</span> + Str(j.IsArray))
				
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> j.Count-<span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">Dim</span> k <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC = j.Child(i)
					s.Append(<span style="color:#6500FE">&quot;Value(&quot;</span> + Str(i) + <span style="color:#6500FE">&quot;).id/prename:</span> <span style="color:#6500FE">&quot;</span> + k.Lookup(<span style="color:#6500FE">&quot;id&quot;</span>, <span style="color:#326598">0</span>) + <span style="color:#6500FE">&quot;/&quot;</span> + k.Lookup(<span style="color:#6500FE">&quot;prename&quot;</span>, <span style="color:#6500FE">&quot;&quot;</span>))
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;own</span> <span style="color:#6500FE">new</span> <span style="color:#6500FE">JSONItem</span> <span style="color:#6500FE">with</span> <span style="color:#6500FE">DecimalFormat:</span> <span style="color:#6500FE">-0.0##&quot;</span>)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MTC
				j.DecimalFormat = <span style="color:#6500FE">&quot;-0.0##&quot;</span>
				j.Value(<span style="color:#6500FE">&quot;1&quot;</span>) = <span style="color:#006532">23.67</span>
				j.Value(<span style="color:#6500FE">&quot;2&quot;</span>) = -<span style="color:#006532">2.7</span>
				j.Value(<span style="color:#6500FE">&quot;3&quot;</span>) = <span style="color:#326598">12</span>
				j.Value(<span style="color:#6500FE">&quot;4&quot;</span>) = <span style="color:#006532">12345.67891</span>
				<span style="color:#0000FF;font-weight: bold">Dim</span> va() <span style="color:#0000FF;font-weight: bold">As</span> Variant
				va.Append(<span style="color:#006532">23.67</span>)
				va.Append(-<span style="color:#006532">2.7</span>)
				va.Append(<span style="color:#326598">12</span>)
				va.Append(<span style="color:#006532">12345.67891</span>)
				j.Value(<span style="color:#6500FE">&quot;a&quot;</span>) = va
				s.Append(j.ToString)
				
				
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MTC
				j.Value(<span style="color:#6500FE">&quot;Hello&quot;</span>) = <span style="color:#6500FE">&quot;World&quot;</span>
				j.Value(<span style="color:#6500FE">&quot;Integer_1&quot;</span>) = <span style="color:#326598">2</span>
				j.Value(<span style="color:#6500FE">&quot;Double_7.5&quot;</span>) = <span style="color:#006532">7.5</span>
				j.Value(<span style="color:#6500FE">&quot;Double_23.67&quot;</span>) = <span style="color:#006532">23.67</span>
				j.Value(<span style="color:#6500FE">&quot;Integer_Array&quot;</span>) = <span style="color:#0000FF;font-weight: bold">Array</span>(<span style="color:#326598">1</span>,<span style="color:#326598">3</span>,<span style="color:#326598">5</span>,<span style="color:#326598">7</span>)
				j.Value(<span style="color:#6500FE">&quot;Double_Array&quot;</span>) = <span style="color:#0000FF;font-weight: bold">Array</span>(<span style="color:#006532">1.5</span>,<span style="color:#006532">3.3</span>,<span style="color:#006532">987.123456</span>)
				s.Append(<span style="color:#6500FE">&quot;own</span> <span style="color:#6500FE">New</span> <span style="color:#6500FE">JSONItem,</span> <span style="color:#6500FE">changing</span> <span style="color:#6500FE">DecimalFormat</span> <span style="color:#6500FE">later&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;Count:</span> <span style="color:#6500FE">&quot;</span> + Str(j.Count))
				s.Append(<span style="color:#6500FE">&quot;ToString:</span> <span style="color:#6500FE">&quot;</span> + j.ToString)
				j.DecimalFormat = <span style="color:#6500FE">&quot;-0.0####&quot;</span>
				s.Append(<span style="color:#6500FE">&quot;ToString</span> <span style="color:#6500FE">(DecimalFormat:</span> <span style="color:#6500FE">&quot;</span> + j.DecimalFormat + <span style="color:#6500FE">&quot;):</span> <span style="color:#6500FE">&quot;</span> + j.ToString)
				
				j = <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MTC
				j.Compact = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i1 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">100</span>
					<span style="color:#0000FF;font-weight: bold">Dim</span> j2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MTC
					<span style="color:#0000FF;font-weight: bold">for</span> i2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">25</span>
						<span style="color:#0000FF;font-weight: bold">if</span> i2 <span style="color:#0000FF;font-weight: bold">mod</span> <span style="color:#326598">2</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
							j2.Value(Str(i1) + <span style="color:#6500FE">&quot;.&quot;</span> + Str(i2)) = <span style="color:#6500FE">&quot;Value</span> <span style="color:#6500FE">&quot;</span> + Str(i2)
						<span style="color:#0000FF;font-weight: bold">else</span>
							j2.Value(Str(i2)) = i2
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					j.Value(Str(i1)) = j2
				<span style="color:#0000FF;font-weight: bold">next</span>
				<span style="color:#0000FF;font-weight: bold">Dim</span> d <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Double</span> = Microseconds
				<span style="color:#0000FF;font-weight: bold">Dim</span> s2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span> = j.ToString
				d = Microseconds - d
				s.Append(<span style="color:#6500FE">&quot;&quot;</span>)
				s.Append(<span style="color:#6500FE">&quot;2500</span> <span style="color:#6500FE">JSON</span> <span style="color:#6500FE">objects</span> <span style="color:#6500FE">.ToString:</span> <span style="color:#6500FE">&quot;</span> + Format(d/<span style="color:#326598">1000</span>, <span style="color:#6500FE">&quot;####0.0##&quot;</span>) + <span style="color:#6500FE">&quot;ms&quot;</span>)
				s.Append(s2)
				
				TextArea1.Text = Join(s, EndOfLine)
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	MenuBar MainMenuBar</div>
<div class="RB_Code">		MenuItem FileMenu = <span style="color:#6500FE">&quot;&amp;File&quot;</span></div>
<div class="RB_Code">			MenuItem FileQuit = <span style="color:#6500FE">&quot;#App.kFileQuit&quot;</span></div>
<div class="RB_Code">		MenuItem EditMenu = <span style="color:#6500FE">&quot;&amp;Edit&quot;</span></div>
<div class="RB_Code">			MenuItem EditUndo = <span style="color:#6500FE">&quot;&amp;Undo&quot;</span></div>
<div class="RB_Code">			MenuItem EditSeparator1 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditCut = <span style="color:#6500FE">&quot;Cu&amp;t&quot;</span></div>
<div class="RB_Code">			MenuItem EditCopy = <span style="color:#6500FE">&quot;&amp;Copy&quot;</span></div>
<div class="RB_Code">			MenuItem EditPaste = <span style="color:#6500FE">&quot;&amp;Paste&quot;</span></div>
<div class="RB_Code">			MenuItem EditClear = <span style="color:#6500FE">&quot;#App.kEditClear&quot;</span></div>
<div class="RB_Code">			MenuItem EditSeparator2 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditSelectAll = <span style="color:#6500FE">&quot;Select</span> <span style="color:#6500FE">&amp;All&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> MenuBar</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> JSONItem_MBS</div>
<div class="RB_Code">		ComputedProperty Count <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span></div>
<div class="RB_Code">			<span style="color:#0000FF;font-weight: bold">Sub</span> <span style="color:#0000FF;font-weight: bold">Get</span>()
				<span style="color:#0000FF;font-weight: bold">Return</span> mJSON.ArraySize
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Get</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> ComputedProperty</div>
<div class="RB_Code">		ComputedProperty IsArray <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span></div>
<div class="RB_Code">			<span style="color:#0000FF;font-weight: bold">Sub</span> <span style="color:#0000FF;font-weight: bold">Get</span>()
				<span style="color:#0000FF;font-weight: bold">Return</span> (mJSON.Type = JSONMBS.kTypeArray)
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Get</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> ComputedProperty</div>
<div class="RB_Code">		ComputedProperty ToString <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span></div>
<div class="RB_Code">			<span style="color:#0000FF;font-weight: bold">Sub</span> <span style="color:#0000FF;font-weight: bold">Get</span>()
				<span style="color:#0000FF;font-weight: bold">Return</span> mJSON.toString(<span style="color:#0000FF;font-weight: bold">Not</span> <span style="color:#0000FF;font-weight: bold">Me</span>.Compact)
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Get</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> ComputedProperty</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Append(v <span style="color:#0000FF;font-weight: bold">as</span> Variant)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">arrays</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">use</span> <span style="color:#7F0000;text-style:italic">array</span> <span style="color:#7F0000;text-style:italic">node</span> <span style="color:#7F0000;text-style:italic">instead</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">object</span> <span style="color:#7F0000;text-style:italic">node</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">need</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">switch</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">internal</span> <span style="color:#7F0000;text-style:italic">JSONMBS</span> <span style="color:#7F0000;text-style:italic">object</span>
			
			<span style="color:#0000FF;font-weight: bold">If</span> (<span style="color:#0000FF;font-weight: bold">Not</span> <span style="color:#0000FF;font-weight: bold">Me</span>.IsArray) <span style="color:#0000FF;font-weight: bold">Then</span>
				mJSON = JSONMBS.NewArrayNode
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
			
			<span style="color:#0000FF;font-weight: bold">Dim</span> p <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = ToJSON(v)
			mJSON.AddItemToArray(p)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Child(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MBS
			<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">Me</span>.Value(index)
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Constructor()
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">start</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">new</span> <span style="color:#7F0000;text-style:italic">object</span>
			mJSON = JSONMBS.NewObjectNode
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> Constructor(c <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">wrap</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">JSONMBS</span>
			<span style="color:#0000FF;font-weight: bold">Self</span>.mJSON = c
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Constructor(data <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">parse</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">raise</span> <span style="color:#7F0000;text-style:italic">exception</span> <span style="color:#7F0000;text-style:italic">on</span> <span style="color:#7F0000;text-style:italic">error</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">raise</span> <span style="color:#7F0000;text-style:italic">exception</span> <span style="color:#7F0000;text-style:italic">also</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">could</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">parsed</span> <span style="color:#7F0000;text-style:italic">partially</span>
			mJSON = <span style="color:#0000FF;font-weight: bold">New</span> JSONMBS(data)
			
			<span style="color:#0000FF;font-weight: bold">If</span> (mJSON.Handle = <span style="color:#326598">0</span>) <span style="color:#0000FF;font-weight: bold">or</span> (mJSON.ParseError &lt;&gt; <span style="color:#6500FE">&quot;&quot;</span>) <span style="color:#0000FF;font-weight: bold">Then</span>
				<span style="color:#0000FF;font-weight: bold">Raise</span> <span style="color:#0000FF;font-weight: bold">New</span> JSONException(<span style="color:#6500FE">&quot;JSONMBS</span> <span style="color:#6500FE">ParseError:</span> <span style="color:#6500FE">&quot;</span> + mJSON.ParseError, mJSON.Handle)
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> FromJSON(pJSON <span style="color:#0000FF;font-weight: bold">as</span> JSONMBS) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">If</span> (pJSON = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">Nil</span>
			
			<span style="color:#0000FF;font-weight: bold">Select</span> <span style="color:#0000FF;font-weight: bold">Case</span> pJSON.Type
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeArray, JSONMBS.kTypeObject
				<span style="color:#0000FF;font-weight: bold">Dim</span> r <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">New</span> JSONItem_MBS(pJSON)
				r.DecimalFormat = <span style="color:#0000FF;font-weight: bold">Me</span>.DecimalFormat
				<span style="color:#0000FF;font-weight: bold">Return</span> r
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeFalse
				<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">False</span>
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeNull
				<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">Nil</span>
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeNumber
				<span style="color:#0000FF;font-weight: bold">If</span> pJSON.IsInt64 <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> pJSON.ValueInteger
				<span style="color:#0000FF;font-weight: bold">Return</span> pJSON.ValueDouble
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeString
				<span style="color:#0000FF;font-weight: bold">Return</span> pJSON.ValueString
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypetrue
				<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">True</span>
				
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Select</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Hmm...</span>
			Break
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> HasName(psName <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#0000FF;font-weight: bold">Dim</span> c <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = mJSON.ChildNode
			<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">False</span>
			
			<span style="color:#0000FF;font-weight: bold">If</span> (StrComp(c.Name, psName, REALbasic.StrCompCaseSensitive) = <span style="color:#326598">0</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">True</span>
			
			<span style="color:#0000FF;font-weight: bold">While</span> (c &lt;&gt; mJSON.LastChildNode)
				c = c.NextNode
				<span style="color:#0000FF;font-weight: bold">If</span> (StrComp(c.Name, psName, REALbasic.StrCompCaseSensitive) = <span style="color:#326598">0</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">True</span>
			<span style="color:#0000FF;font-weight: bold">Wend</span>
			
			<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">False</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Lookup(key <span style="color:#0000FF;font-weight: bold">as</span> Variant, defaultValue <span style="color:#0000FF;font-weight: bold">as</span> Variant) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">Select</span> <span style="color:#0000FF;font-weight: bold">Case</span> mJSON.Type
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeArray
				<span style="color:#0000FF;font-weight: bold">Dim</span> n <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = key.IntegerValue
				<span style="color:#0000FF;font-weight: bold">Dim</span> c <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = mJSON.ArrayItem(n)
				<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span>
					<span style="color:#0000FF;font-weight: bold">Return</span> defaultValue
				<span style="color:#0000FF;font-weight: bold">Else</span>
					<span style="color:#0000FF;font-weight: bold">Return</span> FromJSON(c)
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeObject
				<span style="color:#0000FF;font-weight: bold">Dim</span> l <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span> = key.StringValue
				<span style="color:#0000FF;font-weight: bold">Dim</span> c <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = mJSON.Child(l)
				<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span>
					<span style="color:#0000FF;font-weight: bold">Return</span> defaultValue
				<span style="color:#0000FF;font-weight: bold">Else</span>
					<span style="color:#0000FF;font-weight: bold">Return</span> FromJSON(c)
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
				
			<span style="color:#0000FF;font-weight: bold">Else</span>
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Hmm...</span>
				Break
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Select</span>
			
			<span style="color:#0000FF;font-weight: bold">Return</span> defaultValue
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Name(index <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#0000FF;font-weight: bold">Dim</span> c <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = mJSON.ChildNode
			
			<span style="color:#0000FF;font-weight: bold">For</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">To</span> index
				<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#6500FE">&quot;&quot;</span>
				c = c.NextNode
			<span style="color:#0000FF;font-weight: bold">Next</span>
			
			<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#6500FE">&quot;&quot;</span>
			<span style="color:#0000FF;font-weight: bold">Return</span> c.Name
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Names() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>()
			<span style="color:#0000FF;font-weight: bold">Dim</span> s() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#0000FF;font-weight: bold">Dim</span> c <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = mJSON.ChildNode
			<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> s
			s.Append(c.Name)
			
			<span style="color:#0000FF;font-weight: bold">While</span> (c &lt;&gt; mJSON.LastChildNode)
				c = c.NextNode
				<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Exit</span> <span style="color:#7F0000;text-style:italic">&#39;Loop</span>
				s.Append(c.Name)
			<span style="color:#0000FF;font-weight: bold">Wend</span>
			
			<span style="color:#0000FF;font-weight: bold">Return</span> s
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> ToJSON(v <span style="color:#0000FF;font-weight: bold">as</span> Variant) <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">get</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">JSONItem</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">Variant</span>
			
			<span style="color:#0000FF;font-weight: bold">If</span> (v = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> JSONMBS.NewNullNode
			<span style="color:#0000FF;font-weight: bold">If</span> (v <span style="color:#0000FF;font-weight: bold">IsA</span> JSONItem_MBS) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> JSONItem_MBS(v).mJSON
			<span style="color:#0000FF;font-weight: bold">If</span> (v <span style="color:#0000FF;font-weight: bold">IsA</span> JSONMBS) <span style="color:#0000FF;font-weight: bold">Then</span> <span style="color:#0000FF;font-weight: bold">Return</span> v
			
			<span style="color:#0000FF;font-weight: bold">Select</span> <span style="color:#0000FF;font-weight: bold">Case</span> v.Type
				
			<span style="color:#0000FF;font-weight: bold">Case</span> Variant.TypeString
				<span style="color:#0000FF;font-weight: bold">Return</span> JSONMBS.NewStringNode(v.StringValue)
				
			<span style="color:#0000FF;font-weight: bold">Case</span> Variant.TypeBoolean
				<span style="color:#0000FF;font-weight: bold">Return</span> JSONMBS.NewBoolNode(v.BooleanValue)
				
			<span style="color:#0000FF;font-weight: bold">Case</span> Variant.TypeDouble, Variant.TypeSingle
				<span style="color:#0000FF;font-weight: bold">Return</span> JSONMBS.NewNumberNode(Str(v.DoubleValue, <span style="color:#0000FF;font-weight: bold">Me</span>.DecimalFormat))
				
			<span style="color:#0000FF;font-weight: bold">Case</span> Variant.TypeInt64, Variant.TypeInt32
				<span style="color:#0000FF;font-weight: bold">Return</span> JSONMBS.NewInt64Node(v.Int64Value)
				
			<span style="color:#0000FF;font-weight: bold">Else</span>
				<span style="color:#0000FF;font-weight: bold">If</span> v.IsArray <span style="color:#0000FF;font-weight: bold">Then</span>
					
					<span style="color:#0000FF;font-weight: bold">Select</span> <span style="color:#0000FF;font-weight: bold">Case</span> v.ArrayElementType
					<span style="color:#0000FF;font-weight: bold">Case</span> Variant.TypeDouble
						<span style="color:#0000FF;font-weight: bold">Dim</span> a <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = JSONMBS.NewArrayNode
						<span style="color:#0000FF;font-weight: bold">Dim</span> arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Double</span> = v
						<span style="color:#0000FF;font-weight: bold">For</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">To</span> arr.Ubound
							a.AddItemToArray(ToJSON(arr(i)))
						<span style="color:#0000FF;font-weight: bold">Next</span>
						<span style="color:#0000FF;font-weight: bold">Return</span> a
						
					<span style="color:#0000FF;font-weight: bold">Case</span> Variant.TypeSingle
						<span style="color:#0000FF;font-weight: bold">Dim</span> a <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = JSONMBS.NewArrayNode
						<span style="color:#0000FF;font-weight: bold">Dim</span> arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Single</span> = v
						<span style="color:#0000FF;font-weight: bold">For</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">To</span> arr.Ubound
							a.AddItemToArray(ToJSON(arr(i)))
						<span style="color:#0000FF;font-weight: bold">Next</span>
						<span style="color:#0000FF;font-weight: bold">Return</span> a
						
					<span style="color:#0000FF;font-weight: bold">Case</span> Variant.TypeObject
						<span style="color:#0000FF;font-weight: bold">Dim</span> a <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = JSONMBS.NewArrayNode
						<span style="color:#0000FF;font-weight: bold">Dim</span> arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Object</span> = v
						<span style="color:#0000FF;font-weight: bold">For</span> i <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">To</span> arr.Ubound
							a.AddItemToArray(ToJSON(arr(i)))
						<span style="color:#0000FF;font-weight: bold">Next</span>
						<span style="color:#0000FF;font-weight: bold">Return</span> a
						
					<span style="color:#0000FF;font-weight: bold">Else</span>
						<span style="color:#7F0000;text-style:italic">//Use</span> <span style="color:#7F0000;text-style:italic">Convert</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">handle</span> <span style="color:#7F0000;text-style:italic">Array</span> <span style="color:#7F0000;text-style:italic">values</span>
						<span style="color:#0000FF;font-weight: bold">Return</span> JSONMBS.Convert(v)
					<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Select</span>
					
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Select</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Hmm...</span> <span style="color:#7F0000;text-style:italic">that</span> <span style="color:#7F0000;text-style:italic">kind</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">Variant</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">(yet)</span> <span style="color:#7F0000;text-style:italic">implemented</span>
			Break
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Value(key <span style="color:#0000FF;font-weight: bold">as</span> Variant) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">Select</span> <span style="color:#0000FF;font-weight: bold">Case</span> mJSON.Type
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeArray
				<span style="color:#0000FF;font-weight: bold">Dim</span> n <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = key
				<span style="color:#0000FF;font-weight: bold">Dim</span> c <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = mJSON.ArrayItem(n)
				<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span>
					<span style="color:#0000FF;font-weight: bold">Dim</span> k <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">New</span> KeyNotFoundException
					k.Message = <span style="color:#6500FE">&quot;Item</span> <span style="color:#6500FE">&quot;</span>+Str(n)+<span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">not</span> <span style="color:#6500FE">found.&quot;</span>
					<span style="color:#0000FF;font-weight: bold">Raise</span> k
				<span style="color:#0000FF;font-weight: bold">Else</span>
					<span style="color:#0000FF;font-weight: bold">Return</span> FromJSON(c)
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
				
			<span style="color:#0000FF;font-weight: bold">Case</span> JSONMBS.kTypeObject
				<span style="color:#0000FF;font-weight: bold">Dim</span> l <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span> = key
				<span style="color:#0000FF;font-weight: bold">Dim</span> c <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS = mJSON.Child(l)
				<span style="color:#0000FF;font-weight: bold">If</span> (c = <span style="color:#0000FF;font-weight: bold">Nil</span>) <span style="color:#0000FF;font-weight: bold">Then</span>
					<span style="color:#0000FF;font-weight: bold">Dim</span> k <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">New</span> KeyNotFoundException
					k.Message = <span style="color:#6500FE">&quot;Key</span> <span style="color:#6500FE">&quot;</span>+l+<span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">not</span> <span style="color:#6500FE">found.&quot;</span>
					<span style="color:#0000FF;font-weight: bold">Raise</span> k
				<span style="color:#0000FF;font-weight: bold">Else</span>
					<span style="color:#0000FF;font-weight: bold">Return</span> FromJSON(c)
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
				
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Select</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Hmm...</span>
			Break
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Value(key <span style="color:#0000FF;font-weight: bold">as</span> Variant, <span style="color:#0000FF;font-weight: bold">assigns</span> value <span style="color:#0000FF;font-weight: bold">as</span> Variant)
			<span style="color:#0000FF;font-weight: bold">Dim</span> KeyString <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span> = key.StringValue
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">remove</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">needed.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">You</span> <span style="color:#7F0000;text-style:italic">can</span> <span style="color:#7F0000;text-style:italic">leave</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">away,</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">you</span> <span style="color:#7F0000;text-style:italic">never</span> <span style="color:#7F0000;text-style:italic">edit</span> <span style="color:#7F0000;text-style:italic">JSON,</span> <span style="color:#7F0000;text-style:italic">but</span> <span style="color:#7F0000;text-style:italic">just</span> <span style="color:#7F0000;text-style:italic">parse+build</span>
			mJSON.DeleteItem(KeyString)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">now</span> <span style="color:#7F0000;text-style:italic">add</span> <span style="color:#7F0000;text-style:italic">new</span> <span style="color:#7F0000;text-style:italic">value</span>
			mJSON.AddItemToObject(KeyString, ToJSON(Value))
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;KnownIssues&quot;</span>
<div class="RB_Comment">			DecimalFormat
			-------------
			- is only respected when adding Double values
			  -> you have to set the DecimalFormat before adding values
			- no effect if you are changing the DecimalFormat later (e.g. before .ToString)</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> Compact <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span> = <span style="color:#0000FF;font-weight: bold">True</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> DecimalFormat <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span> = <span style="color:#6500FE">&quot;-0.0##############&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> mJSON <span style="color:#0000FF;font-weight: bold">As</span> JSONMBS</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> JSONItem_MTC</div>
<div class="RB_Code">		ComputedProperty Count <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span></div>
<div class="RB_Code">			<span style="color:#0000FF;font-weight: bold">Sub</span> <span style="color:#0000FF;font-weight: bold">Get</span>()
				<span style="color:#0000FF;font-weight: bold">if</span> IsArray <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">return</span> ArrayValues.Ubound + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> ObjectValues &lt;&gt; <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">return</span> ObjectValues.Count
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Get</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> ComputedProperty</div>
<div class="RB_Code">		ComputedProperty IsArray <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span></div>
<div class="RB_Code">			<span style="color:#0000FF;font-weight: bold">Sub</span> <span style="color:#0000FF;font-weight: bold">Get</span>()
				<span style="color:#0000FF;font-weight: bold">return</span> HasSetType = kHasSetArray
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Get</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> ComputedProperty</div>
<div class="RB_Code">		ComputedProperty <span style="color:#0000FF;font-weight: bold">Private</span> IsObject <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span></div>
<div class="RB_Code">			<span style="color:#0000FF;font-weight: bold">Sub</span> <span style="color:#0000FF;font-weight: bold">Get</span>()
				<span style="color:#0000FF;font-weight: bold">return</span> HasSetType = kHasSetObject
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Get</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> ComputedProperty</div>
<div class="RB_Code">		ComputedProperty ToNativeValue <span style="color:#0000FF;font-weight: bold">As</span> Variant</div>
<div class="RB_Code">			<span style="color:#0000FF;font-weight: bold">Sub</span> <span style="color:#0000FF;font-weight: bold">Get</span>()
				<span style="color:#0000FF;font-weight: bold">if</span> IsObject <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> Dictionary
					
					<span style="color:#0000FF;font-weight: bold">dim</span> rawKeys() <span style="color:#0000FF;font-weight: bold">as</span> variant = ObjectValues.Keys
					<span style="color:#0000FF;font-weight: bold">dim</span> values() <span style="color:#0000FF;font-weight: bold">as</span> variant = ObjectValues.Values
					
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> rawKeys.Ubound
						<span style="color:#0000FF;font-weight: bold">dim</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = KeyToName( rawKeys( i ) )
						<span style="color:#0000FF;font-weight: bold">dim</span> value <span style="color:#0000FF;font-weight: bold">as</span> variant = values( i )
						
						<span style="color:#0000FF;font-weight: bold">if</span> value <span style="color:#0000FF;font-weight: bold">isa</span> JSONItem_MTC <span style="color:#0000FF;font-weight: bold">then</span>
							value = JSONItem_MTC( value ).ToNativeValue
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						d.Value( name ) = value
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					<span style="color:#0000FF;font-weight: bold">return</span> d
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> IsArray <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> variant
					<span style="color:#0000FF;font-weight: bold">redim</span> arr( ArrayValues.Ubound )
					
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ArrayValues.Ubound
						<span style="color:#0000FF;font-weight: bold">dim</span> value <span style="color:#0000FF;font-weight: bold">as</span> variant = ArrayValues( i )
						<span style="color:#0000FF;font-weight: bold">if</span> value <span style="color:#0000FF;font-weight: bold">isa</span> JSONItem_MTC <span style="color:#0000FF;font-weight: bold">then</span>
							value = JSONItem_MTC( value ).ToNativeValue
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						arr( i ) = value
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					<span style="color:#0000FF;font-weight: bold">return</span> arr
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					
					<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Get</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> ComputedProperty</div>
<div class="RB_Code">		ComputedProperty ToString <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span></div>
<div class="RB_Code">			<span style="color:#0000FF;font-weight: bold">Sub</span> <span style="color:#0000FF;font-weight: bold">Get</span>()
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">self</span>.Serialize( <span style="color:#0000FF;font-weight: bold">self</span> )
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Get</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> ComputedProperty</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> Version = <span style="color:#6500FE">&quot;4.2&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kBackSlash = <span style="color:#326598">92</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kCloseCurlyBrace = <span style="color:#326598">125</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kCloseSquareBracket = <span style="color:#326598">93</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kColon = <span style="color:#326598">58</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kComma = <span style="color:#326598">44</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kDefaultDecimalFormat = <span style="color:#6500FE">&quot;-0.0##############&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kDot = <span style="color:#326598">46</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kForwardSlash = <span style="color:#326598">47</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kHasSetArray = <span style="color:#326598">1</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kHasSetNone = <span style="color:#326598">0</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kHasSetObject = <span style="color:#326598">2</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kHyphen = <span style="color:#326598">45</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kInMBSize = <span style="color:#326598">2048</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kOpenCurlyBrace = <span style="color:#326598">123</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kOpenSquareBracket = <span style="color:#326598">91</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kOutMBSize = <span style="color:#326598">2097152</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kPlus = <span style="color:#326598">43</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kQuote = <span style="color:#326598">34</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Enum</span> EncodeType
			None = <span style="color:#326598">0</span>
			JavaScriptCompatible = <span style="color:#326598">1</span>
			All = <span style="color:#326598">2</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Enum</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> AdvancePastWhiteSpace(inMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>)
			<span style="color:#0000FF;font-weight: bold">dim</span> inPtr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = inMB
			<span style="color:#0000FF;font-weight: bold">dim</span> lastPos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inMB.Size - <span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">if</span> pos &gt; lastPos <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;A</span> <span style="color:#6500FE">parsing</span> <span style="color:#6500FE">error</span> <span style="color:#6500FE">occurred&quot;</span>, <span style="color:#326598">2</span>, pos )
					<span style="color:#0000FF;font-weight: bold">return</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> thisByte <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inPtr.Byte( pos )
				<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> thisByte
				<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">9</span>, <span style="color:#326598">10</span>, <span style="color:#326598">13</span>, <span style="color:#326598">32</span>
					pos = pos + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#0000FF;font-weight: bold">return</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">select</span>
			<span style="color:#0000FF;font-weight: bold">loop</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Append(value <span style="color:#0000FF;font-weight: bold">As</span> Variant)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureArray() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			Validate( value )
			
			HasSetType = kHasSetArray
			ArrayValues.Append value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> AppendOutMB(outMBs() <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> outIndex <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock
			<span style="color:#0000FF;font-weight: bold">dim</span> outMB <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock
			
			outMB = <span style="color:#0000FF;font-weight: bold">new</span> MemoryBlock( kOutMBSize )
			outMBs.Append outMB
			outIndex = <span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> outMB
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Child(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC
			<span style="color:#0000FF;font-weight: bold">dim</span> r <span style="color:#0000FF;font-weight: bold">as</span> JSONItem_MTC = <span style="color:#0000FF;font-weight: bold">self</span>.Value( index )
			<span style="color:#0000FF;font-weight: bold">return</span> r
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Child(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, <span style="color:#0000FF;font-weight: bold">Assigns</span> obj <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC)
			<span style="color:#0000FF;font-weight: bold">self</span>.Value( index ) = obj
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Child(name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>) <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC
			<span style="color:#0000FF;font-weight: bold">dim</span> r <span style="color:#0000FF;font-weight: bold">as</span> JSONItem_MTC = <span style="color:#0000FF;font-weight: bold">self</span>.Value( name )
			<span style="color:#0000FF;font-weight: bold">return</span> r
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Child(name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>, <span style="color:#0000FF;font-weight: bold">Assigns</span> obj <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC)
			<span style="color:#0000FF;font-weight: bold">self</span>.Value( name ) = obj
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Clear()
			ObjectValues = <span style="color:#0000FF;font-weight: bold">new</span> Dictionary
			<span style="color:#0000FF;font-weight: bold">redim</span> ArrayValues( -<span style="color:#326598">1</span> )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Constructor()
			LoadCS = <span style="color:#0000FF;font-weight: bold">new</span> CriticalSection
			
			ObjectValues = <span style="color:#0000FF;font-weight: bold">new</span> Dictionary
			
			DecimalFormat = kDefaultDecimalFormat
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Constructor(JSONString <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>, isStrict <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span> = <span style="color:#0000FF;font-weight: bold">False</span>)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">self</span>.Strict = isStrict
			<span style="color:#0000FF;font-weight: bold">self</span>.Load JSONString
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> DecodeString(inMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, current <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, outMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> lastPos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inMB.Size - <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">if</span> pos &gt; lastPos <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Missing</span> <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;&quot;</span>, <span style="color:#326598">7</span>, pos + <span style="color:#326598">1</span> )
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> inPtr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = inMB
			<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt;&gt; kQuote <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Missing</span> <span style="color:#6500FE">&quot;</span><span style="color:#6500FE">&quot;&quot;</span>, <span style="color:#326598">7</span>, pos + <span style="color:#326598">1</span> )
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> outMB.Size &lt; inMB.Size <span style="color:#0000FF;font-weight: bold">then</span>
				outMB.Size = inMB.Size
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> outPtr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = outMB
			<span style="color:#0000FF;font-weight: bold">dim</span> outIndex <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			pos = pos + <span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> flushStart <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = pos
			<span style="color:#0000FF;font-weight: bold">dim</span> flushEnd <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = -<span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> hasBackSlash <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> surrogatePairFirstHalf <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> surrogatePairLastHalf <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> expectingSurrogate <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> insertCodepoint <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			
			<span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">if</span> pos &gt; lastPos <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> msg <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#0000FF;font-weight: bold">if</span>( current.IsArray, <span style="color:#6500FE">&quot;Missing</span> <span style="color:#6500FE">,</span> <span style="color:#6500FE">or</span> <span style="color:#6500FE">]&quot;</span>, <span style="color:#6500FE">&quot;Missing</span> <span style="color:#6500FE">,</span> <span style="color:#6500FE">or</span> <span style="color:#6500FE">}&quot;</span> )
					<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( msg, <span style="color:#326598">6</span>, pos )
					<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> expectingSurrogate <span style="color:#0000FF;font-weight: bold">and</span> ( inPtr.Byte( pos ) &lt;&gt; kBackSlash <span style="color:#0000FF;font-weight: bold">or</span> ( pos + <span style="color:#326598">1</span> ) &gt; lastPos <span style="color:#0000FF;font-weight: bold">or</span> inPtr.Byte( pos + <span style="color:#326598">1</span> ) &lt;&gt; <span style="color:#326598">117</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Improperly</span> <span style="color:#6500FE">formed</span> <span style="color:#6500FE">JSON</span> <span style="color:#6500FE">string&quot;</span>, <span style="color:#326598">0</span> )
					<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> thisByte <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inPtr.Byte( pos )
				<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> thisByte
					
				<span style="color:#0000FF;font-weight: bold">case</span> kBackSlash
					hasBackSlash = <span style="color:#0000FF;font-weight: bold">true</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> flushEnd &lt;&gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">dim</span> flushLen <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = flushEnd - flushStart + <span style="color:#326598">1</span>
						outMB.StringValue( outIndex, flushLen ) = inMB.StringValue( flushStart, flushLen )
						outIndex = outIndex + flushLen
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">if</span> pos &gt; lastPos <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">continue</span> <span style="color:#0000FF;font-weight: bold">do</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					thisByte = inPtr.Byte( pos )
					<span style="color:#0000FF;font-weight: bold">if</span> Strict <span style="color:#0000FF;font-weight: bold">and</span> thisByte &lt; <span style="color:#326598">32</span> <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">continue</span> <span style="color:#0000FF;font-weight: bold">do</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Deal</span> <span style="color:#7F0000;text-style:italic">on</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">pass</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> thisByte
					<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">114</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">r</span>
						outPtr.Byte( outIndex ) = <span style="color:#326598">13</span>
						outIndex = outIndex + <span style="color:#326598">1</span>
						pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">116</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">t</span>
						outPtr.Byte( outIndex ) = <span style="color:#326598">9</span>
						outIndex = outIndex + <span style="color:#326598">1</span>
						pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">110</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">n</span>
						outPtr.Byte( outIndex ) = <span style="color:#326598">10</span>
						outIndex = outIndex + <span style="color:#326598">1</span>
						pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">98</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">b</span>
						outPtr.Byte( outIndex ) = <span style="color:#326598">8</span>
						outIndex = outIndex + <span style="color:#326598">1</span>
						pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">102</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">f</span>
						outPtr.Byte( outIndex ) = <span style="color:#326598">12</span>
						outIndex = outIndex + <span style="color:#326598">1</span>
						pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">117</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">u</span>
						<span style="color:#0000FF;font-weight: bold">if</span> ( pos + <span style="color:#326598">5</span> ) &gt; lastPos <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Improperly</span> <span style="color:#6500FE">formed</span> <span style="color:#6500FE">JSON</span> <span style="color:#6500FE">string&quot;</span>, <span style="color:#326598">0</span> )
							<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						<span style="color:#0000FF;font-weight: bold">dim</span> codepoint <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
						<span style="color:#0000FF;font-weight: bold">for</span> byteAdder <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">4</span>
							<span style="color:#0000FF;font-weight: bold">dim</span> hexDigit <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inPtr.Byte( pos + byteAdder )
							<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> hexDigit
							<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">48</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">57</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">0</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">9</span>
								codepoint = ( codepoint * <span style="color:#326598">16</span> ) + ( hexDigit - <span style="color:#326598">48</span> )
							<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">65</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">70</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">A</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">F</span>
								codepoint = ( codepoint * <span style="color:#326598">16</span> ) + ( hexDigit - <span style="color:#326598">55</span> )
							<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">97</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">102</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">f</span>
								codepoint = ( codepoint * <span style="color:#326598">16</span> ) + ( hexDigit - <span style="color:#326598">87</span> )
							<span style="color:#0000FF;font-weight: bold">else</span>
								<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Illegal</span> <span style="color:#6500FE">value&quot;</span>, <span style="color:#326598">10</span>, pos )
								<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">select</span>
						<span style="color:#0000FF;font-weight: bold">next</span>
						
						<span style="color:#7F0000;text-style:italic">//</span>
						<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">See</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">surrogate</span> <span style="color:#7F0000;text-style:italic">pair</span>
						<span style="color:#7F0000;text-style:italic">//</span>
						<span style="color:#0000FF;font-weight: bold">if</span> expectingSurrogate <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">if</span> codepoint &lt; <span style="color:#326598">&amp;hDC00</span> <span style="color:#0000FF;font-weight: bold">or</span> codepoint &gt; <span style="color:#326598">&amp;hDFFF</span> <span style="color:#0000FF;font-weight: bold">then</span>
								<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Invalid</span> <span style="color:#6500FE">codepoint&quot;</span>, <span style="color:#326598">10</span>, pos )
								<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							
							<span style="color:#7F0000;text-style:italic">//</span>
							<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">surrogatePairFirstHalf</span> <span style="color:#7F0000;text-style:italic">holds</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">first</span> <span style="color:#7F0000;text-style:italic">10</span> <span style="color:#7F0000;text-style:italic">bits,</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">codepoint</span> <span style="color:#7F0000;text-style:italic">holds</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">last</span> <span style="color:#7F0000;text-style:italic">10</span>
							<span style="color:#7F0000;text-style:italic">//</span>
							surrogatePairLastHalf = codepoint
							codepoint = Bitwise.ShiftLeft( surrogatePairFirstHalf - <span style="color:#326598">&amp;hD800</span>, <span style="color:#326598">10</span>, <span style="color:#326598">20</span> ) + ( surrogatePairLastHalf - <span style="color:#326598">&amp;hDC00</span> ) + <span style="color:#326598">&amp;h10000</span>
							insertCodepoint = <span style="color:#0000FF;font-weight: bold">true</span>
							expectingSurrogate = <span style="color:#0000FF;font-weight: bold">false</span>
							
						<span style="color:#0000FF;font-weight: bold">elseif</span> codepoint &lt; <span style="color:#326598">128</span> <span style="color:#0000FF;font-weight: bold">then</span>
							outPtr.Byte( outIndex ) = codepoint
							outIndex = outIndex + <span style="color:#326598">1</span>
							
						<span style="color:#0000FF;font-weight: bold">elseif</span> codepoint &lt; <span style="color:#326598">&amp;hD800</span> <span style="color:#0000FF;font-weight: bold">or</span> codepoint &gt; <span style="color:#326598">&amp;hDFFF</span> <span style="color:#0000FF;font-weight: bold">then</span>
							insertCodepoint = <span style="color:#0000FF;font-weight: bold">True</span>
							
						<span style="color:#0000FF;font-weight: bold">elseif</span> codepoint &lt; <span style="color:#326598">&amp;hDC00</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Surrogate</span> <span style="color:#7F0000;text-style:italic">pair</span>
							
							surrogatePairFirstHalf = codepoint
							expectingSurrogate = <span style="color:#0000FF;font-weight: bold">true</span>
							
						<span style="color:#0000FF;font-weight: bold">else</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">It&#39;s</span> <span style="color:#7F0000;text-style:italic">some</span> <span style="color:#7F0000;text-style:italic">codepoint</span> <span style="color:#7F0000;text-style:italic">that</span> <span style="color:#7F0000;text-style:italic">shouldn&#39;t</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">here</span>
							<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Invalid</span> <span style="color:#6500FE">codepoint&quot;</span>, <span style="color:#326598">10</span>, pos )
							<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
							
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						<span style="color:#0000FF;font-weight: bold">if</span> insertCodepoint <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">if</span> codepoint &gt; <span style="color:#326598">&amp;b1111111111111111</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Four</span> <span style="color:#7F0000;text-style:italic">bytes</span>
								outPtr.Byte( outIndex ) = <span style="color:#326598">&amp;b11110000</span> <span style="color:#0000FF;font-weight: bold">or</span> Bitwise.ShiftRight( codepoint, <span style="color:#326598">18</span>, <span style="color:#326598">21</span> )
								outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">&amp;b10000000</span> <span style="color:#0000FF;font-weight: bold">or</span> ( Bitwise.ShiftRight( codepoint, <span style="color:#326598">12</span>, <span style="color:#326598">21</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b111111</span> )
								outPtr.Byte( outIndex + <span style="color:#326598">2</span> ) = <span style="color:#326598">&amp;b10000000</span> <span style="color:#0000FF;font-weight: bold">or</span> ( Bitwise.ShiftRight( codepoint, <span style="color:#326598">6</span>, <span style="color:#326598">21</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b111111</span> )
								outPtr.Byte( outIndex + <span style="color:#326598">3</span> ) = <span style="color:#326598">&amp;b10000000</span> <span style="color:#0000FF;font-weight: bold">or</span> ( codepoint <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b111111</span> )
								
								outIndex = outIndex + <span style="color:#326598">4</span>
							<span style="color:#0000FF;font-weight: bold">elseif</span> codepoint &gt; <span style="color:#326598">&amp;b11111111111</span>  <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Three</span> <span style="color:#7F0000;text-style:italic">bytes</span>
								outPtr.Byte( outIndex ) = <span style="color:#326598">&amp;b11100000</span> <span style="color:#0000FF;font-weight: bold">or</span> Bitwise.ShiftRight( codepoint, <span style="color:#326598">12</span>, <span style="color:#326598">16</span> )
								outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">&amp;b10000000</span> <span style="color:#0000FF;font-weight: bold">or</span> ( BitWise.ShiftRight( codepoint, <span style="color:#326598">6</span>, <span style="color:#326598">16</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b111111</span> )
								outPtr.Byte( outIndex + <span style="color:#326598">2</span> ) = <span style="color:#326598">&amp;b10000000</span> <span style="color:#0000FF;font-weight: bold">or</span> ( codepoint <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b111111</span> )
								
								outIndex = outIndex + <span style="color:#326598">3</span>
							<span style="color:#0000FF;font-weight: bold">else</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">two</span> <span style="color:#7F0000;text-style:italic">bytes</span>
								outPtr.Byte( outIndex ) = <span style="color:#326598">&amp;b11000000</span> <span style="color:#0000FF;font-weight: bold">or</span> Bitwise.ShiftRight( codepoint, <span style="color:#326598">6</span>, <span style="color:#326598">11</span> )
								outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">&amp;b10000000</span> <span style="color:#0000FF;font-weight: bold">or</span> ( codepoint <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b111111</span> )
								
								outIndex = outIndex + <span style="color:#326598">2</span>
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							
							insertCodepoint = <span style="color:#0000FF;font-weight: bold">false</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						pos = pos + <span style="color:#326598">5</span>
						
					<span style="color:#0000FF;font-weight: bold">else</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Some</span> <span style="color:#7F0000;text-style:italic">random</span> <span style="color:#7F0000;text-style:italic">escaped</span> <span style="color:#7F0000;text-style:italic">character</span>
						<span style="color:#0000FF;font-weight: bold">if</span> Strict <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Illegal</span> <span style="color:#6500FE">Character&quot;</span>, <span style="color:#326598">9</span>, pos + <span style="color:#326598">1</span> )
							<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						outPtr.Byte( outIndex ) = inPtr.Byte( pos )
						outIndex = outIndex + <span style="color:#326598">1</span>
						pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">select</span>
					
					flushStart = pos
					flushEnd = -<span style="color:#326598">1</span>
					
				<span style="color:#0000FF;font-weight: bold">case</span> kQuote <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">End</span>
					pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">exit</span>
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">self</span>.Strict <span style="color:#0000FF;font-weight: bold">and</span> thisByte &lt; <span style="color:#326598">32</span> <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Illegal</span> <span style="color:#6500FE">Character&quot;</span>, <span style="color:#326598">9</span>, pos + <span style="color:#326598">1</span> )
						<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					flushEnd = pos
					pos = pos + <span style="color:#326598">1</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">select</span>
			<span style="color:#0000FF;font-weight: bold">loop</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> hasBackSlash <span style="color:#0000FF;font-weight: bold">and</span> flushEnd &lt;&gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> flushLen <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = flushEnd - flushStart + <span style="color:#326598">1</span>
				outMB.StringValue( outIndex, flushLen ) = inMB.StringValue( flushStart, flushLen )
				outIndex = outIndex + flushLen
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> r <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">if</span> hasBackSlash <span style="color:#0000FF;font-weight: bold">then</span>
				r = outMB.StringValue( <span style="color:#326598">0</span>, outIndex )
			<span style="color:#0000FF;font-weight: bold">elseif</span> flushEnd &lt;&gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
				r = inMB.StringValue( flushStart, flushEnd - flushStart + <span style="color:#326598">1</span> )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			r = r.DefineEncoding( Encodings.UTF8 )
			<span style="color:#0000FF;font-weight: bold">return</span> r
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> DecodeValue(inMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, current <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, outMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">static</span> trueValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int32</span>
			<span style="color:#0000FF;font-weight: bold">if</span> trueValue = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> mb <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock = <span style="color:#6500FE">&quot;true&quot;</span>
				mb.LittleEndian = inMB.LittleEndian
				trueValue = mb.Int32Value( <span style="color:#326598">0</span> )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">static</span> nullValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int32</span>
			<span style="color:#0000FF;font-weight: bold">if</span> nullValue = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> mb <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock = <span style="color:#6500FE">&quot;null&quot;</span>
				mb.LittleEndian = inMB.LittleEndian
				nullValue = mb.Int32Value( <span style="color:#326598">0</span> )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">static</span> falsValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int32</span>
			<span style="color:#0000FF;font-weight: bold">if</span> falsValue = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> mb <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock = <span style="color:#6500FE">&quot;fals&quot;</span>
				mb.LittleEndian = inMB.LittleEndian
				falsValue = mb.Int32Value( <span style="color:#326598">0</span> )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> lastPos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inMB.Size - <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">if</span> pos &gt; lastPos <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;A</span> <span style="color:#6500FE">parsing</span> <span style="color:#6500FE">error</span> <span style="color:#6500FE">occurred&quot;</span>, <span style="color:#326598">2</span>, pos + <span style="color:#326598">1</span> )
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> inPtr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = inMB
			
			<span style="color:#0000FF;font-weight: bold">dim</span> thisByte <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inPtr.Byte( pos )
			<span style="color:#0000FF;font-weight: bold">if</span> thisByte = kQuote <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> DecodeString( inMB, pos, current, outMB )
				
			<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = kOpenCurlyBrace <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> child <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONItem_MTC
				child.HasSetType = kHasSetObject
				pos = pos + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">return</span> child
				
			<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = kOpenSquareBracket <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> child <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONItem_MTC
				child.HasSetType = kHasSetArray
				pos = pos + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">return</span> child
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Look</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">ender</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> startPos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = pos
			<span style="color:#0000FF;font-weight: bold">dim</span> endPos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = pos + <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">if</span> endPos &gt; lastPos <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> msg <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#0000FF;font-weight: bold">if</span>( current.IsArray, <span style="color:#6500FE">&quot;Missing</span> <span style="color:#6500FE">,</span> <span style="color:#6500FE">or</span> <span style="color:#6500FE">]&quot;</span>, <span style="color:#6500FE">&quot;Missing</span> <span style="color:#6500FE">,</span> <span style="color:#6500FE">or</span> <span style="color:#6500FE">}&quot;</span> )
					<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( msg, <span style="color:#326598">6</span>, endPos + <span style="color:#326598">1</span> )
					<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				thisByte = inPtr.Byte( endPos )
				<span style="color:#0000FF;font-weight: bold">if</span> thisByte &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = kComma <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = kCloseCurlyBrace <span style="color:#0000FF;font-weight: bold">or</span> thisByte = kCloseSquareBracket <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				endPos = endPos + <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">loop</span>
			
			pos = endPos
			endPos = endPos - <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> valueLen <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = endPos - startPos + <span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> value <span style="color:#0000FF;font-weight: bold">as</span> variant
			<span style="color:#0000FF;font-weight: bold">dim</span> keepChecking <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = valueLen &lt;&gt; <span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> firstByte <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inPtr.Byte( startPos )
			
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">See</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">it&#39;s</span> <span style="color:#7F0000;text-style:italic">true,</span> <span style="color:#7F0000;text-style:italic">false,</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">null</span> <span style="color:#7F0000;text-style:italic">first</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#0000FF;font-weight: bold">if</span> keepChecking <span style="color:#0000FF;font-weight: bold">and</span> valueLen = <span style="color:#326598">5</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">false?</span>
				<span style="color:#0000FF;font-weight: bold">if</span> firstByte = <span style="color:#326598">102</span> <span style="color:#0000FF;font-weight: bold">and</span> inPtr.Byte( startPos + <span style="color:#326598">4</span> ) = <span style="color:#326598">101</span> <span style="color:#0000FF;font-weight: bold">and</span> inMB.Int32Value( startPos ) = falsValue <span style="color:#0000FF;font-weight: bold">then</span>
					value = <span style="color:#0000FF;font-weight: bold">false</span>
					keepChecking = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> keepChecking <span style="color:#0000FF;font-weight: bold">and</span> valueLen = <span style="color:#326598">4</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">true</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">null?</span>
				<span style="color:#0000FF;font-weight: bold">if</span>  firstByte = <span style="color:#326598">116</span> <span style="color:#0000FF;font-weight: bold">and</span> inMB.Int32Value( startPos ) = trueValue <span style="color:#0000FF;font-weight: bold">then</span>
					value = <span style="color:#0000FF;font-weight: bold">true</span>
					keepChecking = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> keepChecking <span style="color:#0000FF;font-weight: bold">and</span> firstByte = <span style="color:#326598">110</span> <span style="color:#0000FF;font-weight: bold">and</span> inMB.Int32Value( startPos ) = nullValue <span style="color:#0000FF;font-weight: bold">then</span>
					value = <span style="color:#0000FF;font-weight: bold">nil</span>
					keepChecking = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Is</span> <span style="color:#7F0000;text-style:italic">it</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">number?</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#0000FF;font-weight: bold">if</span> keepChecking <span style="color:#0000FF;font-weight: bold">and</span> valueLen = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">and</span> firstByte &gt;= <span style="color:#326598">48</span> <span style="color:#0000FF;font-weight: bold">and</span> firstByte &lt;= <span style="color:#326598">57</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Single</span> <span style="color:#7F0000;text-style:italic">digit</span>
				value = firstByte - <span style="color:#326598">48</span>
				keepChecking = <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> keepChecking <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#7F0000;text-style:italic">//</span>
				<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">Only</span> <span style="color:#7F0000;text-style:italic">send</span> <span style="color:#7F0000;text-style:italic">it</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">ParseNumber</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">it&#39;s</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">Strict,</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">firstByte</span> <span style="color:#7F0000;text-style:italic">meets</span> <span style="color:#7F0000;text-style:italic">strict</span> <span style="color:#7F0000;text-style:italic">criteria</span>
				<span style="color:#7F0000;text-style:italic">//</span>
				<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> Strict <span style="color:#0000FF;font-weight: bold">or</span> ( firstByte = kHyphen <span style="color:#0000FF;font-weight: bold">or</span> ( firstByte &gt;= <span style="color:#326598">48</span> <span style="color:#0000FF;font-weight: bold">and</span> firstByte &lt;= <span style="color:#326598">57</span> ) ) <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">if</span> ParseNumber( inMB, startPos, endPos, value ) <span style="color:#0000FF;font-weight: bold">then</span>
						keepChecking = <span style="color:#0000FF;font-weight: bold">false</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Hail</span> <span style="color:#7F0000;text-style:italic">Mary</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#0000FF;font-weight: bold">if</span> keepChecking <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#0000FF;font-weight: bold">not</span> Strict <span style="color:#0000FF;font-weight: bold">then</span>
				keepChecking = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> valueString <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = inMB.StringValue( startPos, valueLen ).DefineEncoding( Encodings.UTF8 )
				<span style="color:#0000FF;font-weight: bold">if</span> valueString = <span style="color:#6500FE">&quot;true&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
					value = <span style="color:#0000FF;font-weight: bold">true</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> valueString = <span style="color:#6500FE">&quot;false&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
					value = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> valueString = <span style="color:#6500FE">&quot;null&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
					value = <span style="color:#0000FF;font-weight: bold">nil</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> IsNumeric( valueString ) <span style="color:#0000FF;font-weight: bold">then</span>
					value = val( valueString )
				<span style="color:#0000FF;font-weight: bold">else</span>
					keepChecking = <span style="color:#0000FF;font-weight: bold">true</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> keepChecking <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Never</span> <span style="color:#7F0000;text-style:italic">found</span> <span style="color:#7F0000;text-style:italic">it</span>
				<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Illegal</span> <span style="color:#6500FE">Value&quot;</span>, <span style="color:#326598">10</span>, startPos )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> EncodeCodepoint(value <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, outPtr <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Ptr</span>, pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">WARNING:</span> <span style="color:#7F0000;text-style:italic">Assumption</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">that</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">destination</span> <span style="color:#7F0000;text-style:italic">has</span> <span style="color:#7F0000;text-style:italic">enough</span> <span style="color:#7F0000;text-style:italic">room</span>
			
			<span style="color:#0000FF;font-weight: bold">static</span> hexByteArr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#0000FF;font-weight: bold">Array</span>( <span style="color:#326598">48</span>, <span style="color:#326598">49</span>, <span style="color:#326598">50</span>, <span style="color:#326598">51</span>, <span style="color:#326598">52</span>, <span style="color:#326598">53</span>, <span style="color:#326598">54</span>, <span style="color:#326598">55</span>, <span style="color:#326598">56</span>, <span style="color:#326598">57</span>, <span style="color:#326598">65</span>, <span style="color:#326598">66</span>, <span style="color:#326598">67</span>, <span style="color:#326598">68</span>, <span style="color:#326598">69</span>, <span style="color:#326598">70</span> ) <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">0-9,</span> <span style="color:#7F0000;text-style:italic">A-</span> <span style="color:#7F0000;text-style:italic">F</span>
			
			outPtr.Byte( pos + <span style="color:#326598">3</span> ) = hexByteArr( value <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;h0F</span> )
			outPtr.Byte( pos + <span style="color:#326598">2</span> ) = hexByteArr( Bitwise.ShiftRight( value, <span style="color:#326598">4</span>, <span style="color:#326598">32</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;h0F</span> )
			outPtr.Byte( pos + <span style="color:#326598">1</span> ) = hexByteArr( Bitwise.ShiftRight( value, <span style="color:#326598">8</span>, <span style="color:#326598">32</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;h0F</span> )
			outPtr.Byte( pos ) = hexByteArr( Bitwise.ShiftRight( value, <span style="color:#326598">12</span>, <span style="color:#326598">32</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;h0F</span> )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> EncodeString(s <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>, settings <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, outMBs() <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> outIndex <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, inMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Encodes</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">string</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">output</span> <span style="color:#7F0000;text-style:italic">during</span> <span style="color:#7F0000;text-style:italic">ToString.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Honors</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">EncodeUnicode</span> <span style="color:#7F0000;text-style:italic">setting,</span> <span style="color:#7F0000;text-style:italic">but</span> <span style="color:#7F0000;text-style:italic">some</span> <span style="color:#7F0000;text-style:italic">characters</span> <span style="color:#7F0000;text-style:italic">must</span> <span style="color:#7F0000;text-style:italic">ALWAYS</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">encoded</span> <span style="color:#7F0000;text-style:italic">for</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Javascript</span> <span style="color:#7F0000;text-style:italic">compatibility.</span> <span style="color:#7F0000;text-style:italic">These</span> <span style="color:#7F0000;text-style:italic">are</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">chr</span> <span style="color:#7F0000;text-style:italic">127</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;h00ad</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;h0600</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">&amp;h0604</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;h070f</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;h17b4</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">&amp;h17b5</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;h200c</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">&amp;h200f</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;h2028</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">&amp;h202f</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;h2060</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">&amp;h206f</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;hfeff</span>
			<span style="color:#7F0000;text-style:italic">//</span>  <span style="color:#7F0000;text-style:italic">&amp;hfff0</span> <span style="color:#7F0000;text-style:italic">-</span> <span style="color:#7F0000;text-style:italic">&amp;hffff</span>
			
			<span style="color:#0000FF;font-weight: bold">static</span> alwaysEncode() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#0000FF;font-weight: bold">Array</span>( _
					<span style="color:#326598">127</span>, <span style="color:#326598">&amp;hAD</span>, _
					<span style="color:#326598">&amp;h600</span>, <span style="color:#326598">&amp;h601</span>, <span style="color:#326598">&amp;h602</span>, <span style="color:#326598">&amp;h603</span>, <span style="color:#326598">&amp;h604</span>, _
					<span style="color:#326598">&amp;h70F</span>, _
					<span style="color:#326598">&amp;h17B4</span>, <span style="color:#326598">&amp;h17B5</span>, _
					<span style="color:#326598">&amp;h200C</span>, <span style="color:#326598">&amp;h200D</span>, <span style="color:#326598">&amp;h200E</span>, <span style="color:#326598">&amp;h200F</span>, _
					<span style="color:#326598">&amp;h2028</span>, <span style="color:#326598">&amp;h2029</span>, <span style="color:#326598">&amp;h202A</span>, <span style="color:#326598">&amp;h202B</span>, <span style="color:#326598">&amp;h202C</span>, <span style="color:#326598">&amp;h202D</span>, <span style="color:#326598">&amp;h202E</span>, <span style="color:#326598">&amp;h202F</span>, _
					<span style="color:#326598">&amp;h2060</span>, <span style="color:#326598">&amp;h2061</span>, <span style="color:#326598">&amp;h2062</span>, <span style="color:#326598">&amp;h2063</span>, <span style="color:#326598">&amp;h2064</span>, <span style="color:#326598">&amp;h2065</span>, <span style="color:#326598">&amp;h2066</span>, <span style="color:#326598">&amp;h2067</span>, <span style="color:#326598">&amp;h2068</span>, <span style="color:#326598">&amp;h2069</span>, _
					<span style="color:#326598">&amp;h206A</span>, <span style="color:#326598">&amp;h206B</span>, <span style="color:#326598">&amp;h206C</span>, <span style="color:#326598">&amp;h206D</span>, <span style="color:#326598">&amp;h206E</span>, <span style="color:#326598">&amp;h206F</span>, _
					<span style="color:#326598">&amp;hFEFF</span>, _
					<span style="color:#326598">&amp;hFFF0</span>, <span style="color:#326598">&amp;hFFF1</span>, <span style="color:#326598">&amp;hFFF2</span>, <span style="color:#326598">&amp;hFFF3</span>, <span style="color:#326598">&amp;hFFF4</span>, <span style="color:#326598">&amp;hFFF5</span>, <span style="color:#326598">&amp;hFFF6</span>, <span style="color:#326598">&amp;hFFF7</span>, <span style="color:#326598">&amp;hfff8</span>, <span style="color:#326598">&amp;hFFF9</span>, _
					<span style="color:#326598">&amp;hFFFA</span>, <span style="color:#326598">&amp;hFFFB</span>, <span style="color:#326598">&amp;hFFFC</span>, <span style="color:#326598">&amp;hFFFD</span>, <span style="color:#326598">&amp;hFFFE</span>, <span style="color:#326598">&amp;hFFFF</span> _
					)
			
			<span style="color:#0000FF;font-weight: bold">const</span> kByteBuffer = <span style="color:#326598">13</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Most</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">encoding</span> <span style="color:#7F0000;text-style:italic">can</span> <span style="color:#7F0000;text-style:italic">use</span> <span style="color:#7F0000;text-style:italic">plus</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">trailing</span> <span style="color:#7F0000;text-style:italic">quote</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> outMB <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock = outMBs( outMBs.Ubound )
			<span style="color:#0000FF;font-weight: bold">dim</span> outSize <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = outMB.Size
			<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - kByteBuffer ) <span style="color:#0000FF;font-weight: bold">then</span>
				outMB = AppendOutMB( outMBs, outIndex )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> outPtr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = outMB
			
			outPtr.Byte( outIndex ) = kQuote
			outIndex = outIndex + <span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> s = <span style="color:#6500FE">&quot;&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
				outPtr.Byte( outIndex ) = kQuote
				outIndex = outIndex + <span style="color:#326598">1</span>
				
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			s = s.ConvertEncoding( Encodings.UTF8 )
			
			<span style="color:#0000FF;font-weight: bold">dim</span> inSize <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = s.LenB
			<span style="color:#0000FF;font-weight: bold">if</span> inMB.Size &lt; inSize <span style="color:#0000FF;font-weight: bold">then</span>
				inMB.Size = inSize
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			inMB.StringValue( <span style="color:#326598">0</span>, inSize ) = s
			
			<span style="color:#0000FF;font-weight: bold">dim</span> inPtr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = inMB
			
			<span style="color:#0000FF;font-weight: bold">dim</span> lastIndex <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inSize - <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> inIndex <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = -<span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> encodeUnicode <span style="color:#0000FF;font-weight: bold">as</span> EncodeType = settings.EncodeUnicode
			<span style="color:#0000FF;font-weight: bold">dim</span> escapeSlashes <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = settings.EscapeSlashes
			
			<span style="color:#0000FF;font-weight: bold">do</span>
				inIndex = inIndex + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">if</span> inIndex &gt; lastIndex <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - kByteBuffer ) <span style="color:#0000FF;font-weight: bold">then</span>
					outMB = AppendOutMB( outMBs, outIndex )
					outSize = outMB.Size
					outPtr = outMB
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> thisByte <span style="color:#0000FF;font-weight: bold">as</span> byte = inPtr.Byte( inIndex )
				
				<span style="color:#0000FF;font-weight: bold">if</span> thisByte = <span style="color:#326598">34</span> <span style="color:#0000FF;font-weight: bold">or</span> thisByte = kBackSlash <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">quote</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">backslash</span>
					outPtr.Byte( outIndex ) = kBackSlash
					outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = thisByte
					outIndex = outIndex + <span style="color:#326598">2</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = <span style="color:#326598">47</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">slash</span>
					<span style="color:#0000FF;font-weight: bold">if</span> escapeSlashes <span style="color:#0000FF;font-weight: bold">then</span>
						outPtr.Byte( outIndex ) = kBackSlash
						outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = thisByte
						outIndex = outIndex + <span style="color:#326598">2</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						outPtr.Byte( outIndex ) = thisByte
						outIndex = outIndex + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = <span style="color:#326598">8</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">backspace</span>
					outPtr.Byte( outIndex ) = kBackSlash
					outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">98</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">b</span>
					outIndex = outIndex + <span style="color:#326598">2</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = <span style="color:#326598">9</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">tab</span>
					outPtr.Byte( outIndex ) = kBackSlash
					outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">116</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">t</span>
					outIndex = outIndex + <span style="color:#326598">2</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = <span style="color:#326598">10</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">linefeed</span>
					outPtr.Byte( outIndex ) = kBackSlash
					outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">110</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">n</span>
					outIndex = outIndex + <span style="color:#326598">2</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = <span style="color:#326598">12</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">formfeed</span>
					outPtr.Byte( outIndex ) = kBackSlash
					outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">102</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">f</span>
					outIndex = outIndex + <span style="color:#326598">2</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = <span style="color:#326598">13</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">return</span>
					outPtr.Byte( outIndex ) = kBackSlash
					outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">114</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">r</span>
					outIndex = outIndex + <span style="color:#326598">2</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte &lt; <span style="color:#326598">32</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">control</span> <span style="color:#7F0000;text-style:italic">character</span>
					outPtr.Byte( outIndex ) = kBackSlash
					outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">117</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">u</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> insertValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = Right( <span style="color:#6500FE">&quot;000&quot;</span> + hex( thisByte ), <span style="color:#326598">4</span> )
					outMB.StringValue( outIndex + <span style="color:#326598">2</span>, <span style="color:#326598">4</span> ) = insertValue
					outIndex = outIndex + <span style="color:#326598">6</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte &gt; <span style="color:#326598">127</span> <span style="color:#0000FF;font-weight: bold">and</span> thisByte &lt; <span style="color:#326598">192</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Continuation</span> <span style="color:#7F0000;text-style:italic">byte</span> <span style="color:#7F0000;text-style:italic">that</span> <span style="color:#7F0000;text-style:italic">wasn&#39;t</span> <span style="color:#7F0000;text-style:italic">encoded,</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">just</span> <span style="color:#7F0000;text-style:italic">add</span> <span style="color:#7F0000;text-style:italic">it</span>
					outPtr.Byte( outIndex ) = thisByte
					outIndex = outIndex + <span style="color:#326598">1</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> encodeUnicode &lt;&gt; EncodeType.None <span style="color:#0000FF;font-weight: bold">and</span> ( thisByte = <span style="color:#326598">127</span> <span style="color:#0000FF;font-weight: bold">or</span> thisByte &gt;= <span style="color:#326598">192</span> ) <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Leading</span> <span style="color:#7F0000;text-style:italic">byte</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> codepoint <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> byteLength <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
					<span style="color:#0000FF;font-weight: bold">if</span> thisByte &gt;= <span style="color:#326598">240</span> <span style="color:#0000FF;font-weight: bold">then</span>
						byteLength = <span style="color:#326598">4</span>
						codepoint = Bitwise.ShiftLeft( thisByte <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00000111</span>, <span style="color:#326598">18</span>, <span style="color:#326598">21</span> )
						codepoint = codepoint + ( Bitwise.ShiftLeft( inPtr.Byte( inIndex + <span style="color:#326598">1</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00111111</span>, <span style="color:#326598">12</span>, <span style="color:#326598">21</span> ) )
						codepoint = codepoint + ( Bitwise.ShiftLeft( inPtr.Byte( inIndex + <span style="color:#326598">2</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00111111</span> , <span style="color:#326598">6</span>, <span style="color:#326598">21</span> ) )
						codepoint = codepoint + ( inPtr.Byte( inIndex + <span style="color:#326598">3</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00111111</span> )
					<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte &gt;= <span style="color:#326598">224</span> <span style="color:#0000FF;font-weight: bold">then</span>
						byteLength = <span style="color:#326598">3</span>
						codepoint = Bitwise.ShiftLeft( thisByte <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00001111</span>, <span style="color:#326598">12</span>, <span style="color:#326598">18</span> )
						codepoint = codepoint + ( Bitwise.ShiftLeft( inPtr.Byte( inIndex + <span style="color:#326598">1</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00111111</span>, <span style="color:#326598">6</span>, <span style="color:#326598">18</span> ) )
						codepoint = codepoint + ( inPtr.Byte( inIndex + <span style="color:#326598">2</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00111111</span> )
					<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte &gt;= <span style="color:#326598">192</span> <span style="color:#0000FF;font-weight: bold">then</span>
						byteLength = <span style="color:#326598">2</span>
						codepoint = Bitwise.ShiftLeft( thisByte <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00011111</span>, <span style="color:#326598">6</span>, <span style="color:#326598">18</span> )
						codepoint = codepoint + ( inPtr.Byte( inIndex + <span style="color:#326598">1</span> ) <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b00111111</span> )
					<span style="color:#0000FF;font-weight: bold">else</span>
						byteLength = <span style="color:#326598">1</span>
						codepoint = thisByte
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					<span style="color:#7F0000;text-style:italic">//</span>
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">See</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">have</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">use</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">surrogate</span> <span style="color:#7F0000;text-style:italic">pair</span>
					<span style="color:#7F0000;text-style:italic">//</span>
					<span style="color:#0000FF;font-weight: bold">if</span> codepoint &gt; <span style="color:#326598">&amp;hFFFF</span> <span style="color:#0000FF;font-weight: bold">and</span> encodeUnicode = EncodeType.All <span style="color:#0000FF;font-weight: bold">then</span>
						codepoint = codepoint - <span style="color:#326598">&amp;h10000</span>
						<span style="color:#0000FF;font-weight: bold">dim</span> surrogateFirst <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">&amp;hD800</span> + Bitwise.ShiftRight( codepoint, <span style="color:#326598">10</span>, <span style="color:#326598">21</span> )
						<span style="color:#0000FF;font-weight: bold">dim</span> surrogateLast <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">&amp;hDC00</span> + ( codepoint <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#326598">&amp;b1111111111</span> )
						
						
						outPtr.Byte( outIndex ) = kBackSlash
						outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">117</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">u</span>
						EncodeCodepoint( surrogateFirst, outPtr, outIndex + <span style="color:#326598">2</span> )
						
						outPtr.Byte( outIndex + <span style="color:#326598">6</span> ) = kBackSlash
						outPtr.Byte( outIndex + <span style="color:#326598">7</span> ) = <span style="color:#326598">117</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">u</span>
						EncodeCodepoint( surrogateLast, outPtr, outIndex + <span style="color:#326598">8</span> )
						
						outIndex = outIndex + <span style="color:#326598">12</span>
						
					<span style="color:#0000FF;font-weight: bold">elseif</span> codepoint &lt;= <span style="color:#326598">&amp;hFFFF</span> <span style="color:#0000FF;font-weight: bold">and</span> ( encodeUnicode = EncodeType.All <span style="color:#0000FF;font-weight: bold">or</span> alwaysEncode.IndexOf( codepoint ) &lt;&gt; -<span style="color:#326598">1</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
						outPtr.Byte( outIndex ) = kBackSlash
						outPtr.Byte( outIndex + <span style="color:#326598">1</span> ) = <span style="color:#326598">117</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">u</span>
						EncodeCodepoint( codepoint, outPtr, outIndex + <span style="color:#326598">2</span> )
						outIndex = outIndex + <span style="color:#326598">6</span>
						
					<span style="color:#0000FF;font-weight: bold">else</span>
						outPtr.Byte( outIndex ) = thisByte
						outIndex = outIndex + <span style="color:#326598">1</span>
						byteLength = <span style="color:#326598">1</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Doesn&#39;t</span> <span style="color:#7F0000;text-style:italic">matter</span> <span style="color:#7F0000;text-style:italic">what</span> <span style="color:#7F0000;text-style:italic">it</span> <span style="color:#7F0000;text-style:italic">really</span> <span style="color:#7F0000;text-style:italic">is,</span> <span style="color:#7F0000;text-style:italic">only</span> <span style="color:#7F0000;text-style:italic">need</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">advance</span> <span style="color:#7F0000;text-style:italic">one</span> <span style="color:#7F0000;text-style:italic">byte</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					inIndex = inIndex + byteLength - <span style="color:#326598">1</span>
					
				<span style="color:#0000FF;font-weight: bold">else</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">thisByte</span> <span style="color:#7F0000;text-style:italic">&gt;</span> <span style="color:#7F0000;text-style:italic">31</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">thisByte</span> <span style="color:#7F0000;text-style:italic">&lt;</span> <span style="color:#7F0000;text-style:italic">127</span>
					outPtr.Byte( outIndex ) = thisByte
					outIndex = outIndex + <span style="color:#326598">1</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
			<span style="color:#0000FF;font-weight: bold">loop</span>
			
			outPtr.Byte( outIndex ) = kQuote
			outIndex = outIndex + <span style="color:#326598">1</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> EncodeValue(value <span style="color:#0000FF;font-weight: bold">As</span> Variant, settings <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, level <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, outMBs() <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> outIndex <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, inMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock)
			<span style="color:#0000FF;font-weight: bold">if</span> value <span style="color:#0000FF;font-weight: bold">IsA</span> JSONItem_MTC <span style="color:#0000FF;font-weight: bold">then</span>
				JSONItem_MTC( value ).Serialize( outMBs, outIndex, settings, level, inMB )
				
			<span style="color:#0000FF;font-weight: bold">elseif</span> value <span style="color:#0000FF;font-weight: bold">IsA</span> Dictionary <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> child <span style="color:#0000FF;font-weight: bold">as</span> JSONItem_MTC = Dictionary( value )
				child.Serialize( outMBs, outIndex, settings, level, inMB )
				
			<span style="color:#0000FF;font-weight: bold">elseif</span> value.Type = Variant.TypeString <span style="color:#0000FF;font-weight: bold">or</span> value.Type = Variant.TypeCString <span style="color:#0000FF;font-weight: bold">or</span> _
					value.Type = Variant.TypePString <span style="color:#0000FF;font-weight: bold">then</span>
				EncodeString( value.StringValue, settings, outMBs, outIndex, inMB )
				
			<span style="color:#0000FF;font-weight: bold">elseif</span> value.Type = Variant.TypeText <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> Text = value.TextValue
				<span style="color:#0000FF;font-weight: bold">dim</span> s <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = t
				EncodeString( s, settings, outMBs, outIndex, inMB )
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> insert <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> value.Type = Variant.TypeDouble <span style="color:#0000FF;font-weight: bold">or</span> value.Type = Variant.TypeSingle <span style="color:#0000FF;font-weight: bold">or</span> _
						value.Type = Variant.TypeCurrency <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> s <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = value.StringValue
					<span style="color:#0000FF;font-weight: bold">if</span> s.InStr( <span style="color:#6500FE">&quot;inf&quot;</span> ) &lt;&gt; <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">if</span> settings.Strict <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Illegal</span> <span style="color:#6500FE">Value</span> <span style="color:#6500FE">&#39;inf&#39;&quot;</span>, <span style="color:#326598">10</span> )
						<span style="color:#0000FF;font-weight: bold">else</span>
							insert = <span style="color:#6500FE">&quot;inf&quot;</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">elseif</span> s.InStr( <span style="color:#6500FE">&quot;nan&quot;</span> ) &lt;&gt; <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">if</span> settings.Strict <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Illegal</span> <span style="color:#6500FE">Value</span> <span style="color:#6500FE">&#39;nan&#39;&quot;</span>, <span style="color:#326598">10</span> )
						<span style="color:#0000FF;font-weight: bold">else</span>
							insert = <span style="color:#6500FE">&quot;nan&quot;</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						insert = Format( value, settings.DecimalFormat )
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> value.Type = Variant.TypeNil <span style="color:#0000FF;font-weight: bold">then</span>
					insert = <span style="color:#6500FE">&quot;null&quot;</span>
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					insert = value.StringValue.Lowercase
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> insertLen <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = insert.LenB
				<span style="color:#0000FF;font-weight: bold">dim</span> outMB <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock = outMBs( outMBs.Ubound )
				<span style="color:#0000FF;font-weight: bold">dim</span> outSize <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = outMB.Size
				<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - insertLen ) <span style="color:#0000FF;font-weight: bold">then</span>
					outMB = AppendOutMB( outMBs, outIndex )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				outMB.StringValue( outIndex, insertLen ) = insert
				outIndex = outIndex + insertLen
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> EnsureArray() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#0000FF;font-weight: bold">if</span> HasSetType &lt;&gt; kHasSetObject <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">true</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;This</span> <span style="color:#6500FE">JSONItem_MTC</span> <span style="color:#6500FE">is</span> <span style="color:#6500FE">an</span> <span style="color:#6500FE">object&quot;</span>, <span style="color:#326598">13</span> )
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">false</span>
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> EnsureObject() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#0000FF;font-weight: bold">if</span> HasSetType &lt;&gt; kHasSetArray <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">true</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;This</span> <span style="color:#6500FE">JSONItem_MTC</span> <span style="color:#6500FE">is</span> <span style="color:#6500FE">an</span> <span style="color:#6500FE">array&quot;</span>, <span style="color:#326598">13</span> )
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">false</span>
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> HasName(name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureObject() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			HasSetType = kHasSetObject
			<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = NameToKey( name )
			<span style="color:#0000FF;font-weight: bold">return</span> ObjectValues.HasKey( key )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Insert(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, value <span style="color:#0000FF;font-weight: bold">As</span> Variant)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureArray() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			HasSetType = kHasSetArray
			ArrayValues.Insert( index, value )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> IsLoading() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#0000FF;font-weight: bold">return</span> mIsLoading
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> JSONStringToUTF8(s <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Ensures</span> <span style="color:#7F0000;text-style:italic">that</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">given</span> <span style="color:#7F0000;text-style:italic">string</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">converted</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">UTF8.</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">A</span> <span style="color:#7F0000;text-style:italic">string</span> <span style="color:#7F0000;text-style:italic">obtained</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">unknown</span> <span style="color:#7F0000;text-style:italic">source</span> <span style="color:#7F0000;text-style:italic">might</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">nil</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">might</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">marked</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">wrong</span> <span style="color:#7F0000;text-style:italic">encoding,</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">won&#39;t</span> <span style="color:#7F0000;text-style:italic">trust</span> <span style="color:#7F0000;text-style:italic">it</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">will</span> <span style="color:#7F0000;text-style:italic">check</span> <span style="color:#7F0000;text-style:italic">ourselves.</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Since</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">string</span> <span style="color:#7F0000;text-style:italic">must</span> <span style="color:#7F0000;text-style:italic">start</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">characters</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">ASCII</span> <span style="color:#7F0000;text-style:italic">range</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">(whitespace,</span> <span style="color:#7F0000;text-style:italic">{,</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">[),</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">only</span> <span style="color:#7F0000;text-style:italic">need</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">first</span> <span style="color:#7F0000;text-style:italic">four</span> <span style="color:#7F0000;text-style:italic">bytes.</span>
			
			<span style="color:#0000FF;font-weight: bold">static</span> null <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = ChrB( <span style="color:#326598">0</span> )
			<span style="color:#0000FF;font-weight: bold">static</span> doubleNull <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>  = null + null
			<span style="color:#0000FF;font-weight: bold">static</span> tripleNull <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = null + null + null
			
			<span style="color:#0000FF;font-weight: bold">dim</span> firstFour <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = s.LeftB( <span style="color:#326598">4</span> )
			<span style="color:#0000FF;font-weight: bold">if</span> firstFour.LenB &lt; <span style="color:#326598">2</span> <span style="color:#0000FF;font-weight: bold">or</span> firstFour.LenB = <span style="color:#326598">3</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> s.DefineEncoding( Encodings.UTF8 )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Check</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">BOM</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">true</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Scope</span>
				<span style="color:#0000FF;font-weight: bold">static</span> bomArr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#0000FF;font-weight: bold">Array</span>( _
						ChrB( <span style="color:#326598">&amp;hFF</span> ) + ChrB( <span style="color:#326598">&amp;hFE</span> ) + doubleNull, _
						doubleNull + ChrB( <span style="color:#326598">&amp;hFE</span> ) + ChrB( <span style="color:#326598">&amp;hFF</span> ), _
						ChrB( <span style="color:#326598">&amp;hEF</span> ) + ChrB( <span style="color:#326598">&amp;hBB</span> ) + ChrB( <span style="color:#326598">&amp;hBF</span> ), _
						ChrB( <span style="color:#326598">&amp;hFF</span> ) + ChrB( <span style="color:#326598">&amp;hFE</span> ), _
						ChrB( <span style="color:#326598">&amp;hFE</span> ) + ChrB( <span style="color:#326598">&amp;hFF</span> ) _
						)
				
				<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> bomArr.Ubound
					<span style="color:#0000FF;font-weight: bold">dim</span> bom <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = bomArr( i )
					<span style="color:#0000FF;font-weight: bold">dim</span> bomLen <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = bom.LenB
					<span style="color:#0000FF;font-weight: bold">if</span> firstFour.LeftB( bomLen ) = bom <span style="color:#0000FF;font-weight: bold">then</span>
						s = s.MidB( bomLen + <span style="color:#326598">1</span> )
						firstFour = s.LeftB( <span style="color:#326598">4</span> )
						<span style="color:#0000FF;font-weight: bold">exit</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">next</span> i
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Check</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">UTF8</span>
			<span style="color:#0000FF;font-weight: bold">if</span> firstFour.InStrB( null ) = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> s.DefineEncoding( Encodings.UTF8 )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">UTF32?</span>
			<span style="color:#0000FF;font-weight: bold">if</span> firstFour.LenB = <span style="color:#326598">4</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">if</span> firstFour.LeftB( <span style="color:#326598">3</span> ) = tripleNull <span style="color:#0000FF;font-weight: bold">then</span>
					s = s.DefineEncoding( Encodings.UTF32BE )
					<span style="color:#0000FF;font-weight: bold">return</span> s.ConvertEncoding( Encodings.UTF8 )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">if</span> firstFour.RightB( <span style="color:#326598">3</span> ) = tripleNull <span style="color:#0000FF;font-weight: bold">then</span>
					s = s.DefineEncoding( Encodings.UTF32LE )
					<span style="color:#0000FF;font-weight: bold">return</span> s.ConvertEncoding( Encodings.UTF8 )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">UTF16?</span>
			<span style="color:#0000FF;font-weight: bold">if</span> firstFour.LeftB( <span style="color:#326598">1</span> ) = null <span style="color:#0000FF;font-weight: bold">then</span>
				s = s.DefineEncoding( Encodings.UTF16BE )
				<span style="color:#0000FF;font-weight: bold">return</span> s.ConvertEncoding( Encodings.UTF8 )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">if</span> firstFour.RightB( <span style="color:#326598">1</span> ) = null <span style="color:#0000FF;font-weight: bold">then</span>
				s = s.DefineEncoding( Encodings.UTF16LE )
				<span style="color:#0000FF;font-weight: bold">return</span> s.ConvertEncoding( Encodings.UTF8 )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">We</span> <span style="color:#7F0000;text-style:italic">don&#39;t</span> <span style="color:#7F0000;text-style:italic">know</span> <span style="color:#7F0000;text-style:italic">what</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">heck</span> <span style="color:#7F0000;text-style:italic">it</span> <span style="color:#7F0000;text-style:italic">is</span>
			<span style="color:#0000FF;font-weight: bold">return</span> s
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> KeyToName(key <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> hex <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = key.NthField( <span style="color:#6500FE">&quot;-&quot;</span>, key.CountFields( <span style="color:#6500FE">&quot;-&quot;</span> ) )
			<span style="color:#0000FF;font-weight: bold">dim</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = key.LeftB( key.LenB - hex.LenB - <span style="color:#326598">1</span> )
			<span style="color:#0000FF;font-weight: bold">return</span> name
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Load(JSONString <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>)
			<span style="color:#0000FF;font-weight: bold">const</span> kNeverStarted = -<span style="color:#326598">1000</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> originalSetType <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = kNeverStarted
			<span style="color:#0000FF;font-weight: bold">dim</span> originalValue <span style="color:#0000FF;font-weight: bold">as</span> variant
			
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> LoadCS.TryEnter <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;This</span> <span style="color:#6500FE">object</span> <span style="color:#6500FE">is</span> <span style="color:#6500FE">currently</span> <span style="color:#6500FE">loading&quot;</span>, <span style="color:#326598">0</span> )
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			JSONString = JSONStringToUTF8( JSONString ).RTrim
			
			<span style="color:#0000FF;font-weight: bold">if</span> JSONString = <span style="color:#6500FE">&quot;&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Do</span> <span style="color:#7F0000;text-style:italic">nothing</span>
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				mIsLoading = <span style="color:#0000FF;font-weight: bold">true</span>
				
				<span style="color:#7F0000;text-style:italic">//</span>
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Save</span> <span style="color:#7F0000;text-style:italic">original</span> <span style="color:#7F0000;text-style:italic">values</span>
				<span style="color:#7F0000;text-style:italic">//</span>
				originalSetType = <span style="color:#0000FF;font-weight: bold">self</span>.HasSetType
				<span style="color:#0000FF;font-weight: bold">if</span> originalSetType = kHasSetArray <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> values() <span style="color:#0000FF;font-weight: bold">as</span> variant
					<span style="color:#0000FF;font-weight: bold">redim</span> values( ArrayValues.Ubound )
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span>  <span style="color:#0000FF;font-weight: bold">to</span> ArrayValues.Ubound
						values( i ) = ArrayValues( i )
					<span style="color:#0000FF;font-weight: bold">next</span> i
					originalValue = values
				<span style="color:#0000FF;font-weight: bold">elseif</span> originalSetType = kHasSetObject <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> Dictionary
					<span style="color:#0000FF;font-weight: bold">dim</span> keys() <span style="color:#0000FF;font-weight: bold">as</span> Variant = ObjectValues.Keys
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> keys.Ubound
						<span style="color:#0000FF;font-weight: bold">dim</span> k <span style="color:#0000FF;font-weight: bold">as</span> variant = keys( i )
						d.Value( k ) = ObjectValues.Value( k )
					<span style="color:#0000FF;font-weight: bold">next</span> i
					originalValue = d
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> inMB <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock = JSONString
				<span style="color:#0000FF;font-weight: bold">dim</span> pos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> inPtr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = inMB
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> proceed <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = <span style="color:#0000FF;font-weight: bold">true</span>
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) = kOpenSquareBracket <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">if</span> IsObject <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Do</span> <span style="color:#7F0000;text-style:italic">nothing</span>
						proceed = <span style="color:#0000FF;font-weight: bold">false</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						HasSetType = kHasSetArray
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> inPtr.Byte( pos ) = kOpenCurlyBrace <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">if</span> IsArray <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Do</span> <span style="color:#7F0000;text-style:italic">nothing</span>
						proceed = <span style="color:#0000FF;font-weight: bold">false</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						HasSetType = kHasSetObject
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> inPtr.Byte( pos ) &lt;&gt; kOpenCurlyBrace <span style="color:#0000FF;font-weight: bold">and</span> inPtr.Byte( pos ) &lt;&gt; kOpenSquareBracket <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Parse</span> <span style="color:#6500FE">Error:</span> <span style="color:#6500FE">Expecting</span> <span style="color:#6500FE">&#39;{&#39;</span> <span style="color:#6500FE">or</span> <span style="color:#6500FE">&#39;[&#39;&quot;</span>, <span style="color:#326598">1</span> )
					<span style="color:#0000FF;font-weight: bold">return</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> proceed <span style="color:#0000FF;font-weight: bold">then</span>
					
					<span style="color:#0000FF;font-weight: bold">dim</span> outMB <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> MemoryBlock( <span style="color:#326598">1024</span> )
					
					pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> stack() <span style="color:#0000FF;font-weight: bold">as</span> JSONItem_MTC
					<span style="color:#0000FF;font-weight: bold">dim</span> current <span style="color:#0000FF;font-weight: bold">as</span> JSONItem_MTC = <span style="color:#0000FF;font-weight: bold">self</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> lastIndex <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = inMB.Size - <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">do</span>
						<span style="color:#0000FF;font-weight: bold">if</span> current.IsArray <span style="color:#0000FF;font-weight: bold">then</span>
							
							<span style="color:#0000FF;font-weight: bold">if</span> pos &lt;= lastIndex <span style="color:#0000FF;font-weight: bold">and</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
								<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							
							<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) = kCloseSquareBracket <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Empty</span> <span style="color:#7F0000;text-style:italic">array</span>
								<span style="color:#0000FF;font-weight: bold">if</span> stack.Ubound &lt;&gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
									current = stack.Pop
								<span style="color:#0000FF;font-weight: bold">else</span>
									current = <span style="color:#0000FF;font-weight: bold">nil</span>
								<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
								pos = pos + <span style="color:#326598">1</span>
								
							<span style="color:#0000FF;font-weight: bold">else</span>
								LoadArray( inMB, pos, current, stack, outMB )
								<span style="color:#0000FF;font-weight: bold">if</span> pos &lt;= lastIndex <span style="color:#0000FF;font-weight: bold">and</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
									<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
								<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
								
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							
						<span style="color:#0000FF;font-weight: bold">else</span>
							
							<span style="color:#0000FF;font-weight: bold">if</span> pos &lt;= lastIndex <span style="color:#0000FF;font-weight: bold">and</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
								<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							
							<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) = kCloseCurlyBrace <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Empty</span> <span style="color:#7F0000;text-style:italic">object</span>
								<span style="color:#0000FF;font-weight: bold">if</span> stack.Ubound &lt;&gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
									current = stack.Pop
								<span style="color:#0000FF;font-weight: bold">else</span>
									current = <span style="color:#0000FF;font-weight: bold">nil</span>
								<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
								pos = pos + <span style="color:#326598">1</span>
								
							<span style="color:#0000FF;font-weight: bold">else</span>
								LoadObject( inMB, pos, current, stack, outMB )
								<span style="color:#0000FF;font-weight: bold">if</span> pos &lt;= lastIndex <span style="color:#0000FF;font-weight: bold">and</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
									<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
								<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
								
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						<span style="color:#0000FF;font-weight: bold">if</span> current <span style="color:#0000FF;font-weight: bold">is</span> <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">if</span> pos &lt;= lastIndex <span style="color:#0000FF;font-weight: bold">then</span>
								<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;A</span> <span style="color:#6500FE">parsing</span> <span style="color:#6500FE">error</span> <span style="color:#6500FE">occurred&quot;</span>, <span style="color:#326598">2</span>, pos )
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
							
						<span style="color:#0000FF;font-weight: bold">elseif</span> pos &gt; lastIndex <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;A</span> <span style="color:#6500FE">parsing</span> <span style="color:#6500FE">error</span> <span style="color:#6500FE">occurred&quot;</span>, <span style="color:#326598">2</span>, pos )
							<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
							
						<span style="color:#0000FF;font-weight: bold">else</span>
							<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt;  <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
								<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) = kComma <span style="color:#0000FF;font-weight: bold">then</span>
								pos = pos + <span style="color:#326598">1</span>
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">loop</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">proceed</span>
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">JSONString</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">&quot;&quot;</span>
			
			mIsLoading = <span style="color:#0000FF;font-weight: bold">false</span>
			LoadCS.Leave
			
			<span style="color:#0000FF;font-weight: bold">Exception</span> err <span style="color:#0000FF;font-weight: bold">as</span> RuntimeException
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Restore</span> <span style="color:#7F0000;text-style:italic">original</span> <span style="color:#7F0000;text-style:italic">values</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#0000FF;font-weight: bold">if</span> originalSetType &lt;&gt; kNeverStarted <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">self</span>.Clear
				<span style="color:#0000FF;font-weight: bold">if</span> originalSetType = kHasSetArray <span style="color:#0000FF;font-weight: bold">then</span>
					ArrayValues = originalValue
				<span style="color:#0000FF;font-weight: bold">elseif</span> originalSetType = kHasSetObject <span style="color:#0000FF;font-weight: bold">then</span>
					ObjectValues = originalValue
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				HasSetType = originalSetType
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			mIsLoading = <span style="color:#0000FF;font-weight: bold">False</span>
			LoadCS.Leave
			
			<span style="color:#0000FF;font-weight: bold">raise</span> err
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> LoadArray(inMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, <span style="color:#0000FF;font-weight: bold">ByRef</span> current <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, stack() <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, outMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock)
			<span style="color:#0000FF;font-weight: bold">dim</span> inPtr <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = inMB
			
			<span style="color:#0000FF;font-weight: bold">dim</span> commaFound <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> value <span style="color:#0000FF;font-weight: bold">as</span> variant
			
			<span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) = kCloseSquareBracket <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">if</span> commaFound <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Illegal</span> <span style="color:#6500FE">Value&quot;</span>, <span style="color:#326598">10</span>, pos )
						<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">if</span> stack.Ubound &lt;&gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						current = stack.Pop
					<span style="color:#0000FF;font-weight: bold">else</span>
						current = <span style="color:#0000FF;font-weight: bold">nil</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				value = DecodeValue( inMB, pos, current, outMB )
				current.ArrayValues.Append value
				
				<span style="color:#0000FF;font-weight: bold">if</span> value <span style="color:#0000FF;font-weight: bold">IsA</span> JSONItem_MTC <span style="color:#0000FF;font-weight: bold">then</span>
					stack.Append current
					current = value
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				commaFound = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) = kComma <span style="color:#0000FF;font-weight: bold">then</span>
					pos = pos + <span style="color:#326598">1</span>
					commaFound = <span style="color:#0000FF;font-weight: bold">true</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> inPtr.Byte( pos ) &lt;&gt; kCloseSquareBracket <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;A</span> <span style="color:#6500FE">parsing</span> <span style="color:#6500FE">error</span> <span style="color:#6500FE">occurred&quot;</span>, <span style="color:#326598">2</span>, pos + <span style="color:#326598">1</span> )
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">loop</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> LoadObject(inMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, <span style="color:#0000FF;font-weight: bold">ByRef</span> current <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, stack() <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, outMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock)
			<span style="color:#0000FF;font-weight: bold">dim</span> inPtr <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = inMB
			
			<span style="color:#0000FF;font-weight: bold">dim</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> value <span style="color:#0000FF;font-weight: bold">as</span> variant
			
			<span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) = kCloseCurlyBrace <span style="color:#0000FF;font-weight: bold">then</span>
					pos = pos + <span style="color:#326598">1</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> stack.Ubound &lt;&gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						current = stack.Pop
					<span style="color:#0000FF;font-weight: bold">else</span>
						current = <span style="color:#0000FF;font-weight: bold">nil</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				name = DecodeString( inMB, pos, current, outMB )
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt;&gt; kColon <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Something</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">wrong</span>
					<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Missing</span> <span style="color:#6500FE">:&quot;</span>, <span style="color:#326598">5</span>, pos + <span style="color:#326598">1</span> )
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				pos = pos + <span style="color:#326598">1</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				value = DecodeValue( inMB, pos, current, outMB )
				key = NameToKey( name )
				current.ObjectValues.Value( key ) = value
				
				<span style="color:#0000FF;font-weight: bold">if</span> value <span style="color:#0000FF;font-weight: bold">IsA</span> JSONItem_MTC <span style="color:#0000FF;font-weight: bold">then</span>
					stack.Append current
					current = value
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) &lt; <span style="color:#326598">33</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">self</span>.AdvancePastWhiteSpace( inMB, pos )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> inPtr.Byte( pos ) = kComma <span style="color:#0000FF;font-weight: bold">then</span>
					pos = pos + <span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">loop</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Lookup(name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>, defaultValue <span style="color:#0000FF;font-weight: bold">As</span> Variant) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureObject() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = NameToKey( name )
			<span style="color:#0000FF;font-weight: bold">return</span> ObjectValues.Lookup( key, defaultValue )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Name(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureObject() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#6500FE">&quot;&quot;</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = ObjectValues.Key( index ).StringValue
			<span style="color:#0000FF;font-weight: bold">dim</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = KeyToName( key )
			
			<span style="color:#0000FF;font-weight: bold">return</span> name
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> NameToKey(name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			name = name.ConvertEncoding( Encodings.UTF8 )
			<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = name + <span style="color:#6500FE">&quot;-&quot;</span> + EncodeHex( name )
			<span style="color:#0000FF;font-weight: bold">return</span> key
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Names() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>()
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureObject() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> Dictionary = ObjectValues
			<span style="color:#0000FF;font-weight: bold">dim</span> keys() <span style="color:#0000FF;font-weight: bold">as</span> variant = d.Keys
			<span style="color:#0000FF;font-weight: bold">dim</span> r() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">redim</span> r( keys.Ubound )
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> keys.Ubound
				<span style="color:#0000FF;font-weight: bold">dim</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = keys( i )
				name = KeyToName( name )
				r( i ) = name
			<span style="color:#0000FF;font-weight: bold">next</span> i
			
			<span style="color:#0000FF;font-weight: bold">return</span> r
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> Currency)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> currency <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(d <span style="color:#0000FF;font-weight: bold">As</span> Dictionary)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">dim</span> keys() <span style="color:#0000FF;font-weight: bold">as</span> variant = d.Keys
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> <span style="color:#0000FF;font-weight: bold">in</span> keys
				<span style="color:#0000FF;font-weight: bold">self</span>.Value( name ) = d.Value( name )
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Double</span>)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Int32</span>)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int32</span> <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Int64</span>)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int64</span> <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Object</span>)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">object</span> <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Single</span>)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">single</span> <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> Text)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> text <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Convert(arr() <span style="color:#0000FF;font-weight: bold">As</span> Variant)
			<span style="color:#0000FF;font-weight: bold">self</span>.Constructor()
			
			<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> v <span style="color:#0000FF;font-weight: bold">as</span> variant <span style="color:#0000FF;font-weight: bold">in</span> arr
				<span style="color:#0000FF;font-weight: bold">self</span>.Append v
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Operator_Subscript(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">self</span>.Value( index )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Operator_Subscript(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, <span style="color:#0000FF;font-weight: bold">Assigns</span> value <span style="color:#0000FF;font-weight: bold">As</span> Variant)
			<span style="color:#0000FF;font-weight: bold">self</span>.Value( index ) = value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Shared</span> <span style="color:#0000FF;font-weight: bold">Function</span> ParseJSON(s <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">dim</span> j <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONItem_MTC( s )
			<span style="color:#0000FF;font-weight: bold">return</span> j.ToNativeValue
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Function</span> ParseNumber(mb <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, startPos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, endPos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, <span style="color:#0000FF;font-weight: bold">ByRef</span> result <span style="color:#0000FF;font-weight: bold">As</span> Variant) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
			<span style="color:#0000FF;font-weight: bold">if</span> endPos &gt;= mb.Size <span style="color:#0000FF;font-weight: bold">then</span>
				endPos = mb.Size - <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> endPos &lt;= startPos <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = mb
			
			<span style="color:#0000FF;font-weight: bold">dim</span> dotFound <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> inExponent <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> r <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = <span style="color:#0000FF;font-weight: bold">true</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> pos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = startPos
			<span style="color:#0000FF;font-weight: bold">dim</span> thisByte <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = p.Byte( pos )
			
			<span style="color:#0000FF;font-weight: bold">dim</span> isNegative <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">if</span> thisByte = kHyphen <span style="color:#0000FF;font-weight: bold">then</span>
				isNegative = <span style="color:#0000FF;font-weight: bold">true</span>
				pos = pos + <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">elseif</span> thisByte = kPlus <span style="color:#0000FF;font-weight: bold">then</span>
				pos = pos + <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> total <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int64</span>
			
			<span style="color:#0000FF;font-weight: bold">do</span>
				thisByte = p.Byte( pos )
				<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> thisByte
				<span style="color:#0000FF;font-weight: bold">case</span> kDot
					<span style="color:#0000FF;font-weight: bold">if</span> dotFound <span style="color:#0000FF;font-weight: bold">or</span> inExponent <span style="color:#0000FF;font-weight: bold">then</span>
						r = <span style="color:#0000FF;font-weight: bold">false</span>
						<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						dotFound = <span style="color:#0000FF;font-weight: bold">true</span>
						pos = pos + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">48</span> <span style="color:#0000FF;font-weight: bold">to</span> <span style="color:#326598">57</span>
					<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> dotFound <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#0000FF;font-weight: bold">not</span> inExponent <span style="color:#0000FF;font-weight: bold">then</span>
						total = ( total * <span style="color:#326598">10</span> ) + ( thisByte - <span style="color:#326598">48</span> )
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					pos = pos + <span style="color:#326598">1</span>
					
				<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#326598">101</span>, <span style="color:#326598">69</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">e,</span> <span style="color:#7F0000;text-style:italic">E</span>
					<span style="color:#0000FF;font-weight: bold">if</span> inExponent <span style="color:#0000FF;font-weight: bold">then</span>
						r = <span style="color:#0000FF;font-weight: bold">false</span>
						<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
					<span style="color:#0000FF;font-weight: bold">elseif</span> Strict <span style="color:#0000FF;font-weight: bold">and</span> dotFound <span style="color:#0000FF;font-weight: bold">and</span> p.Byte( pos - <span style="color:#326598">1</span> ) = kDot <span style="color:#0000FF;font-weight: bold">then</span>
						r = <span style="color:#0000FF;font-weight: bold">false</span>
						<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						inExponent = <span style="color:#0000FF;font-weight: bold">true</span>
						pos = pos + <span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">if</span> pos &gt; endPos <span style="color:#0000FF;font-weight: bold">then</span>
							r = <span style="color:#0000FF;font-weight: bold">false</span>
							<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
						<span style="color:#0000FF;font-weight: bold">else</span>
							thisByte = p.Byte( pos )
							<span style="color:#0000FF;font-weight: bold">if</span> thisByte = <span style="color:#326598">45</span> <span style="color:#0000FF;font-weight: bold">or</span> thisByte = <span style="color:#326598">43</span> <span style="color:#0000FF;font-weight: bold">then</span>
								pos = pos + <span style="color:#326598">1</span>
								<span style="color:#0000FF;font-weight: bold">if</span> pos &gt; endPos <span style="color:#0000FF;font-weight: bold">then</span>
									r = <span style="color:#0000FF;font-weight: bold">false</span>
									<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
								<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">end</span>  <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					r = <span style="color:#0000FF;font-weight: bold">false</span>
					<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">do</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">select</span>
			<span style="color:#0000FF;font-weight: bold">loop</span> <span style="color:#0000FF;font-weight: bold">until</span> pos &gt; endPos
			
			<span style="color:#0000FF;font-weight: bold">if</span> r <span style="color:#0000FF;font-weight: bold">and</span> Strict <span style="color:#0000FF;font-weight: bold">and</span> dotFound <span style="color:#0000FF;font-weight: bold">and</span> ( p.Byte( endPos ) &lt; <span style="color:#326598">48</span> <span style="color:#0000FF;font-weight: bold">or</span> p.Byte( endPos ) &gt; <span style="color:#326598">57</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
				r = <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> r <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> dotFound <span style="color:#0000FF;font-weight: bold">and</span> <span style="color:#0000FF;font-weight: bold">not</span> inExponent <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Integer</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> isNegative <span style="color:#0000FF;font-weight: bold">then</span>
						total = <span style="color:#326598">0</span> - total
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					result = total
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					
					<span style="color:#0000FF;font-weight: bold">dim</span> s <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = mb.StringValue( startPos, endPos - startPos + <span style="color:#326598">1</span> )
					result = Val( s )
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> r
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Remove(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureArray() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			ArrayValues.Remove( index )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Remove(name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureObject() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = NameToKey( name )
			ObjectValues.Remove( key )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Serialize(data <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Most</span> <span style="color:#7F0000;text-style:italic">JSON</span> <span style="color:#7F0000;text-style:italic">will</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">rather</span> <span style="color:#7F0000;text-style:italic">small,</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">we&#39;ll</span> <span style="color:#7F0000;text-style:italic">start</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">small</span> <span style="color:#7F0000;text-style:italic">initial</span> <span style="color:#7F0000;text-style:italic">block</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> kInitialMBSize = <span style="color:#326598">10</span> * <span style="color:#326598">1024</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> outMB <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> MemoryBlock( kInitialMBSize )
			<span style="color:#0000FF;font-weight: bold">dim</span> outMBs() <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock
			outMBs.Append outMB
			<span style="color:#0000FF;font-weight: bold">dim</span> outIndex <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> inMB <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> MemoryBlock( kInMBSize )
			
			data.Serialize( outMBs, outIndex, <span style="color:#0000FF;font-weight: bold">self</span>, <span style="color:#326598">0</span>, inMB)
			
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">We</span> <span style="color:#7F0000;text-style:italic">know</span> <span style="color:#7F0000;text-style:italic">exactly</span> <span style="color:#7F0000;text-style:italic">how</span> <span style="color:#7F0000;text-style:italic">long</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">last</span> <span style="color:#7F0000;text-style:italic">MemoryBlock&#39;s</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">is</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">outIndex</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> joiner() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">redim</span> joiner( outMBs.Ubound)
			
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span>  <span style="color:#0000FF;font-weight: bold">to</span> outMBs.Ubound
				<span style="color:#0000FF">#if</span> DebugBuild
					<span style="color:#0000FF;font-weight: bold">if</span> i = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						i = i <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">A</span> <span style="color:#7F0000;text-style:italic">place</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">break</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF">#endif</span>
				
				outMB = outMBs( i )
				outMBs( i ) = <span style="color:#0000FF;font-weight: bold">nil</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> s <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
				<span style="color:#0000FF;font-weight: bold">if</span> i = outMBs.Ubound <span style="color:#0000FF;font-weight: bold">then</span>
					
					s = outMB.StringValue( <span style="color:#326598">0</span>, outIndex )
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#7F0000;text-style:italic">//</span>
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Scan</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">final</span> <span style="color:#7F0000;text-style:italic">null</span>
					<span style="color:#7F0000;text-style:italic">//</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> lastBytePos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = outMB.Size - <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = outMB
					<span style="color:#0000FF;font-weight: bold">for</span> bytePos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = lastBytePos <span style="color:#0000FF;font-weight: bold">downto</span> <span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">if</span> p.Byte( bytePos ) &lt;&gt; <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
							s = outMB.StringValue( <span style="color:#326598">0</span>, bytePos + <span style="color:#326598">1</span> )
							<span style="color:#0000FF;font-weight: bold">exit</span> <span style="color:#0000FF;font-weight: bold">for</span> bytePos
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">next</span> bytePos
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				outMB = <span style="color:#0000FF;font-weight: bold">nil</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> s = <span style="color:#6500FE">&quot;&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Couldn&#39;t</span> <span style="color:#6500FE">find</span> <span style="color:#6500FE">non-null</span> <span style="color:#6500FE">bytes</span> <span style="color:#6500FE">in</span> <span style="color:#6500FE">a</span> <span style="color:#6500FE">MemoryBlock&quot;</span>, <span style="color:#326598">0</span> )
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				s = s.DefineEncoding( Encodings.UTF8 )
				joiner( i ) = s
			<span style="color:#0000FF;font-weight: bold">next</span> i
			
			<span style="color:#0000FF;font-weight: bold">dim</span> r <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = join( joiner, <span style="color:#6500FE">&quot;&quot;</span> )
			<span style="color:#0000FF;font-weight: bold">return</span> r
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> Serialize(outMBs() <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock, <span style="color:#0000FF;font-weight: bold">ByRef</span> outIndex <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, settings <span style="color:#0000FF;font-weight: bold">As</span> JSONItem_MTC, level <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, inMB <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock)
			<span style="color:#0000FF;font-weight: bold">dim</span> outMB <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock = outMBs( outMBs.Ubound )
			
			level = level + <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> notCompact <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = <span style="color:#0000FF;font-weight: bold">not</span>( settings.Compact ) <span style="color:#0000FF;font-weight: bold">and</span> settings.IndentSpacing &gt; <span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">static</span> lotsOfSpaces <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#6500FE">&quot;</span>        <span style="color:#6500FE">&quot;</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> indenter <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> targetLen <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = level * settings.IndentSpacing
				<span style="color:#0000FF;font-weight: bold">while</span> lotsOfSpaces.LenB &lt; targetLen
					lotsOfSpaces = lotsOfSpaces + lotsOfSpaces
				<span style="color:#0000FF;font-weight: bold">wend</span>
				indenter = lotsOfSpaces.LeftB( targetLen )
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Always</span> <span style="color:#7F0000;text-style:italic">keep</span> <span style="color:#7F0000;text-style:italic">at</span> <span style="color:#7F0000;text-style:italic">least</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">1024</span> <span style="color:#7F0000;text-style:italic">byte</span> <span style="color:#7F0000;text-style:italic">buffer</span> <span style="color:#7F0000;text-style:italic">at</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">end</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">outMB</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> outSize <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = outMB.Size
			<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1024</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
				outMB = AppendOutMB( outMBs, outIndex )
				outSize = outMB.Size
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> outPtr <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Ptr</span> = outMB
			
			<span style="color:#0000FF;font-weight: bold">if</span> IsArray <span style="color:#0000FF;font-weight: bold">then</span>
				
				outPtr.Byte( outIndex ) = kOpenSquareBracket
				outIndex = outIndex + <span style="color:#326598">1</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> ArrayValues.Ubound &lt;&gt; -<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF">#if</span> TargetWin32
							outPtr.Byte( outIndex ) = <span style="color:#326598">13</span>
							outIndex = outIndex + <span style="color:#326598">1</span>
						<span style="color:#0000FF">#endif</span>
						outPtr.Byte( outIndex ) = <span style="color:#326598">10</span>
						outIndex = outIndex + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ArrayValues.Ubound
						<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1024</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
							outMB = AppendOutMB( outMBs, outIndex )
							outSize = outMB.Size
							outPtr = outMB
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
							outMB.StringValue( outIndex, indenter.LenB ) = indenter
							outIndex = outIndex + indenter.LenB
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						<span style="color:#0000FF;font-weight: bold">dim</span> value <span style="color:#0000FF;font-weight: bold">as</span> variant = ArrayValues( i )
						EncodeValue( value, settings, level, outMBs, outIndex, inMB )
						
						outMB = outMBs( outMBs.Ubound )
						outSize = outMB.Size
						<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1024</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
							outMB = AppendOutMB( outMBs, outIndex )
							outSize = outMB.Size
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						outPtr = outMB
						
						<span style="color:#0000FF;font-weight: bold">if</span> i &lt; ArrayValues.Ubound <span style="color:#0000FF;font-weight: bold">then</span>
							outPtr.Byte( outIndex ) = kComma
							outIndex = outIndex + <span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF">#if</span> TargetWin32
								outPtr.Byte( outIndex ) = <span style="color:#326598">13</span>
								outIndex = outIndex + <span style="color:#326598">1</span>
							<span style="color:#0000FF">#endif</span>
							outPtr.Byte( outIndex ) = <span style="color:#326598">10</span>
							outIndex = outIndex + <span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">next</span> i
					
					<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1024</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
						outMB = AppendOutMB( outMBs, outIndex )
						outSize = outMB.Size
						outPtr = outMB
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - indenter.LenB ) <span style="color:#0000FF;font-weight: bold">then</span>
							outMB = AppendOutMB( outMBs, outIndex )
							outSize = outMB.Size
							outPtr = outMB
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						outMB.StringValue( outIndex, indenter.LenB - settings.IndentSpacing ) = indenter.LeftB( indenter.LenB - indentSpacing )
						outIndex = outIndex + ( indenter.LenB - settings.IndentSpacing )
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1024</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
					outMB = AppendOutMB( outMBs, outIndex )
					outSize = outMB.Size
					outPtr = outMB
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				outPtr.Byte( outIndex ) = kCloseSquareBracket
				outIndex = outIndex + <span style="color:#326598">1</span>
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> Dictionary = ObjectValues
				
				outPtr.Byte( outIndex ) = kOpenCurlyBrace
				outIndex = outIndex + <span style="color:#326598">1</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> d.Count &lt;&gt; <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF">#if</span> TargetWin32
							outPtr.Byte( outIndex ) = <span style="color:#326598">13</span>
							outIndex = outIndex + <span style="color:#326598">1</span>
						<span style="color:#0000FF">#endif</span>
						outPtr.Byte( outIndex ) = <span style="color:#326598">10</span>
						outIndex = outIndex + <span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					<span style="color:#0000FF;font-weight: bold">dim</span> keys() <span style="color:#0000FF;font-weight: bold">as</span> variant = d.Keys
					<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> keys.Ubound
						<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1024</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
							outMB = AppendOutMB( outMBs, outIndex )
							outSize = outMB.Size
							outPtr = outMB
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
							outMB.StringValue( outIndex, indenter.LenB ) = indenter
							outIndex = outIndex + indenter.LenB
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> variant = keys( i )
						<span style="color:#0000FF;font-weight: bold">dim</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = KeyToName( key )
						EncodeString( name, settings, outMBs, outIndex, inMB )
						
						outMB = outMBs( outMBs.Ubound )
						outSize  = outMB.Size
						<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
							outMB = AppendOutMB( outMBs, outIndex )
							outSize = outMB.Size
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						outPtr = outMB
						
						outPtr.Byte( outIndex ) = kColon
						outIndex = outIndex + <span style="color:#326598">1</span>
						
						<span style="color:#0000FF;font-weight: bold">dim</span> value <span style="color:#0000FF;font-weight: bold">as</span> variant = d.Value( key )
						EncodeValue( value, settings, level, outMBs, outIndex, inMB )
						
						outMB = outMBs( outMBs.Ubound )
						outSize  = outMB.Size
						<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1024</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
							outMB = AppendOutMB( outMBs, outIndex )
							outSize = outMB.Size
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						outPtr = outMB
						
						<span style="color:#0000FF;font-weight: bold">if</span> i &lt; keys.Ubound <span style="color:#0000FF;font-weight: bold">then</span>
							outPtr.Byte( outIndex ) = kComma
							outIndex = outIndex + <span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#0000FF">#if</span> TargetWin32
								outPtr.Byte( outIndex ) = <span style="color:#326598">13</span>
								outIndex = outIndex + <span style="color:#326598">1</span>
							<span style="color:#0000FF">#endif</span>
							outPtr.Byte( outIndex ) = <span style="color:#326598">10</span>
							outIndex = outIndex + <span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> notCompact <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - indenter.LenB ) <span style="color:#0000FF;font-weight: bold">then</span>
							outMB = AppendOutMB( outMBs, outIndex )
							outSize = outMB.Size
							outPtr = outMB
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						
						outMB.StringValue( outIndex, indenter.LenB - settings.IndentSpacing ) = indenter.LeftB( indenter.LenB - indentSpacing )
						outIndex = outIndex + ( indenter.LenB - settings.IndentSpacing )
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> outIndex &gt; ( outSize - <span style="color:#326598">1024</span> ) <span style="color:#0000FF;font-weight: bold">then</span>
					outMB = AppendOutMB( outMBs, outIndex )
					outSize = outMB.Size
					outPtr = outMB
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				outPtr.Byte( outIndex ) = kCloseCurlyBrace
				outIndex = outIndex + <span style="color:#326598">1</span>
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Private</span> <span style="color:#0000FF;font-weight: bold">Sub</span> Validate(<span style="color:#0000FF;font-weight: bold">ByRef</span> value <span style="color:#0000FF;font-weight: bold">As</span> Variant)
			<span style="color:#7F0000;text-style:italic">//</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">If</span> <span style="color:#7F0000;text-style:italic">value</span> <span style="color:#7F0000;text-style:italic">holds</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">Dictionary</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">Array,</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">will</span> <span style="color:#7F0000;text-style:italic">do</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">conversion</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">allow</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">new</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">object</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">raise</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">exception</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">needed</span>
			<span style="color:#7F0000;text-style:italic">//</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> isGood <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = <span style="color:#0000FF;font-weight: bold">true</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Assume</span> <span style="color:#7F0000;text-style:italic">it</span> <span style="color:#7F0000;text-style:italic">is</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> value.IsArray <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> jsonArr <span style="color:#0000FF;font-weight: bold">as</span> JSONItem_MTC
				
				<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> value.ArrayElementType
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeBoolean
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">boolean</span> = value
					jsonArr = arr
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeDouble
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = value
					jsonArr = arr
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeInt32
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int32</span> = value
					jsonArr = arr
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeInt64
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Int64</span> = value
					jsonArr = arr
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeSingle
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">single</span> = value
					jsonArr = arr
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeString
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = value
					jsonArr = arr
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeText
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> text = value
					jsonArr = arr
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeObject
					<span style="color:#0000FF;font-weight: bold">dim</span> arr() <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">object</span> = value
					jsonArr = arr
					
				<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#0000FF;font-weight: bold">else</span>
					isGood = <span style="color:#0000FF;font-weight: bold">false</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">select</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> isGood <span style="color:#0000FF;font-weight: bold">then</span>
					value = jsonArr
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				
				<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> value.Type
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeNil, Variant.TypeBoolean
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeString, Variant.TypeCString, Variant.TypePString, Variant.TypeText
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeDouble, Variant.TypeSingle, Variant.TypeCurrency
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeInt32, Variant.TypeInt64, Variant.TypeInteger
					
				<span style="color:#0000FF;font-weight: bold">case</span> Variant.TypeObject
					<span style="color:#0000FF;font-weight: bold">select</span> <span style="color:#0000FF;font-weight: bold">case</span> value
					<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#0000FF;font-weight: bold">IsA</span> JSONItem_MTC
					<span style="color:#0000FF;font-weight: bold">case</span> <span style="color:#0000FF;font-weight: bold">IsA</span> Dictionary
						<span style="color:#0000FF;font-weight: bold">dim</span> dictJSON <span style="color:#0000FF;font-weight: bold">as</span> JSONItem_MTC = Dictionary( value )
						value = dictJSON
					<span style="color:#0000FF;font-weight: bold">else</span>
						<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Unrecognized</span> <span style="color:#6500FE">Object&quot;</span>, <span style="color:#326598">11</span> )
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">select</span>
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					isGood = <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#0000FF;font-weight: bold">end</span>
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> isGood <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">raise</span> <span style="color:#0000FF;font-weight: bold">new</span> JSONException( <span style="color:#6500FE">&quot;Illegal</span> <span style="color:#6500FE">Value&quot;</span>, <span style="color:#326598">10</span> )
			<span style="color:#0000FF;font-weight: bold">end</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Value(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureArray() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">return</span> ArrayValues( index )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Value(index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, <span style="color:#0000FF;font-weight: bold">Assigns</span> value <span style="color:#0000FF;font-weight: bold">As</span> Variant)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureArray() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			Validate( value )
			
			HasSetType = kHasSetArray
			<span style="color:#0000FF;font-weight: bold">if</span> ArrayValues.Ubound &lt; index <span style="color:#0000FF;font-weight: bold">then</span>
				ArrayValues.Append value
			<span style="color:#0000FF;font-weight: bold">else</span>
				ArrayValues( index ) = value
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Value(name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>) <span style="color:#0000FF;font-weight: bold">As</span> Variant
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureObject() <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span> <span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = NameToKey( name )
			<span style="color:#0000FF;font-weight: bold">return</span> ObjectValues.Value( key )
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Value(name <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span>, <span style="color:#0000FF;font-weight: bold">Assigns</span> value <span style="color:#0000FF;font-weight: bold">As</span> Variant)
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> EnsureObject <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			Validate( value )
			
			HasSetType = kHasSetObject
			<span style="color:#0000FF;font-weight: bold">dim</span> key <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = NameToKey( name )
			ObjectValues.Value( key ) = value
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;About&quot;</span>
<div class="RB_Comment">			JSONItem_MTC
			
			This is a drop-in replacements for the native JSONItem. It emulates all its features but should
			perform certain functions faster.
			
			To use it, search for "JSONItem" within your project and replace it with "JSONItem_MTC". Then
			drag the JSONItem_MTC class into your project.
			
			Differences:
			
			- You can add any object to JSONItem and it will throw an exception when you try to use ToString.
			This class will throw that exception when you try to add the bad object.
			
			- This class has an extra property, EncodeUnicode. By default, it is False to emulate the native class. 
			If set to True, it will encode all characters whose codepoints are greater than 127.
			
			- Some error messages will be different within this class than the native class.
			
			- As of Xojo 2014r21, ToString is significantly faster in this class than the native version.
			
			See the Legal note for licensing information. If you do make useful modifications, please let me 
			know so I can include them in future versions.
			
			Kem Tekinay
			ktekinay@mactechnologies.com
			http://www.mactechnologies.com
			
			Original project at:
			https://github.com/ktekinay/JSONItem_MTC</div>
</div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;Acknowledgements&quot;</span>
<div class="RB_Comment">			With thanks to Jeremy Cowgar for his suggestions and adding the unit testing framework.
			
			With thanks for Paul Lefebvre of Xojo, Inc., for creating the unit testing framework in the first place.</div>
</div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;Legal&quot;</span>
<div class="RB_Comment">			This class was created by Kem Tekinay, MacTechnologies Consulting (ktekinay@mactechnologies.com).
			It is copyright 2015 by Kem Tekinay, all rights reserved.
			
			This project is distributed AS-IS and no warranty of fitness for any particular purpose is expressed or implied.
			The author disavows any responsibility for bad design, poor execution, or any other faults.
			
			You may freely use or modify this project or any part within. You may distribute a modified version as long 
			as this notice or any other legal notice is left undisturbed and all modifications are clearly documented and 
			accredited. The author does not actively support this class, although comments and recommendations are 
			welcome.</div>
</div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;Specs</span> <span style="color:#6500FE">(RFC)&quot;</span>
<div class="RB_Comment">			This class follows the specs in RFC 7159 found, among other places, here:
			
			http://tools.ietf.org/html/rfc7159</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> ArrayValues() <span style="color:#0000FF;font-weight: bold">As</span> Variant</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> Compact <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span> = <span style="color:#0000FF;font-weight: bold">True</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> DecimalFormat <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">String</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> EncodeUnicode <span style="color:#0000FF;font-weight: bold">As</span> EncodeType = EncodeType.JavaScriptCompatible</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> EscapeSlashes <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span> = <span style="color:#0000FF;font-weight: bold">True</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> HasSetType <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> IndentSpacing <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">2</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> LoadCS <span style="color:#0000FF;font-weight: bold">As</span> CriticalSection</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> ObjectValues <span style="color:#0000FF;font-weight: bold">As</span> Dictionary</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> Strict <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Private</span> mIsLoading <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_Code"><span style="color:#0000FF;font-weight: bold">End</span> Project</div>

</div>
<p>The items on this page are in the following plugins: <a href="plugins-mbsutilplugin.html">MBS Util Plugin</a>.</p>
<!-- Ende Content-->

<br>
<div style="width: 200pt; margin: 0pt; padding: 5pt; border-color:#ccc; border-style:solid; background-color: #eee; border-width: 2pt; border-radius: 10pt; " lang="en">
&#128172; <a href="https://www.monkeybreadsoftware.com/feedback/?what=xojo&path=example-util-json-jsonitemclone">Ask a question or report a problem</a>
</div>

</BODY>
</HTML>

