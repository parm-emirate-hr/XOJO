<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Frameset//EN" >
<HTML>
<HEAD>
<TITLE>Monkeybread Xojo plugin - Example: /ChartDirector/Finance Chart Track Line Retina</TITLE>
<script src="../platforms.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../help.css" >
<link rel="stylesheet" type="text/css" href="../screen.css" media="screen">
<link rel="stylesheet" type="text/css" href="../print.css" media="print">
<link rel="stylesheet" type="text/css" href="../allitems.css" title="Default">
<link rel="alternate stylesheet" type="text/css" href="../macitems.css" title="Mac">
<link rel="alternate stylesheet" type="text/css" href="../winitems.css" title="Win">
<link rel="alternate stylesheet" type="text/css" href="../linuxitems.css" title="Linux">
<link rel="alternate stylesheet" type="text/css" href="../crossitems.css" title="Crossplatform">
<meta http-equiv="content-type" content="text/html; charset=x-mac-roman">
<META NAME="description" CONTENT="Example">
</head>
<BODY BGCOLOR="#FFFFFF">
<H2 lang="en">Example: /ChartDirector/Finance Chart Track Line Retina</h2>
<p><a href="http://www.monkeybreadsoftware.net">Online Documentation</a> &nbsp; - &nbsp; <a href="stats.html">Statistics</a> &nbsp; - &nbsp; <a href="topic-faq.html">FAQ</a> &nbsp; - &nbsp; <a href="parts.html">Plugin Parts</a> (<a href="partsall.html">All</a>, <a href="plugindeps.html">Dependencies</a>) &nbsp; - &nbsp; <a href="hierarchy.html">Class hierarchy</a></p>
<p>New in Version 
<a href="newinversion213.html">21.3</a> 
<a href="newinversion214.html">21.4</a> 
<a href="newinversion215.html">21.5</a> 
<a href="newinversion220.html">22.0</a> 
<a href="newinversion221.html">22.1</a> 
<a href="newinversion222.html">22.2</a> 
<a href="newinversion223.html">22.3</a> 
<a href="newinversion224.html">22.4</a> 
<a href="newinversion225.html">22.5</a> 
<a href="newinversion230.html">23.0</a> 
<a href="newinversion231.html">23.1</a> 
<a href="newinversion232.html">23.2</a> 
</p>
<p>The list of the &nbsp; <a href="themes.html">topics</a>, 
 &nbsp; <a href="classes.html">classes</a>,
 &nbsp; <a href="interfaces.html">interfaces</a>,
 &nbsp; <a href="controls.html">controls</a>,
 &nbsp; <a href="modules.html">modules</a>,
 &nbsp; <a href="globaltopic.html">global methods by category</a>,
 &nbsp; <a href="globalname.html">global methods by name</a>,
 &nbsp; <a href="screenshots.html">screenshots</a>,
 &nbsp; <a href="licenses.html">licenses</a> &nbsp;
 and &nbsp; <a href="examples.html">examples</a>.</p>
<p id=PlatformChooserMBS>Platforms to show: <a class="isA" href="javascript:all();">All</a> <a class="isM" href="javascript:mac();">Mac</a> <a class="isW" href="javascript:win();">Windows</a> <a class="isL" href="javascript:linux();">Linux</a> <a class="isC" href="javascript:crossplatform();">Cross-Platform</a></p>
<div class="">
<b><A name="1">/ChartDirector/Finance Chart Track Line Retina</A></b><br>
<B>Function:</B> 
<br>
Required plugins for this example: MBS ChartDirector Plugin<BR>
You find this example project in your Plugins Download as a Xojo project file within the examples folder: /ChartDirector/Finance Chart Track Line Retina<BR>
This example is the version from Wed, 13th Dec 2016.<BR>

<div class="RB_Code">Project <span style="color:#6500FE">&quot;Finance</span> <span style="color:#6500FE">Chart</span> <span style="color:#6500FE">Track</span> <span style="color:#6500FE">Line</span> <span style="color:#6500FE">Retina.xojo_binary_project&quot;</span></div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> App <span style="color:#0000FF;font-weight: bold">Inherits</span> Application</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kEditClear = <span style="color:#6500FE">&quot;&amp;L&ouml;schen&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kFileQuit = <span style="color:#6500FE">&quot;Beenden&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kFileQuitShortcut = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> Window1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control Canvas1 <span style="color:#0000FF;font-weight: bold">Inherits</span> MyControl</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance Canvas1 <span style="color:#0000FF;font-weight: bold">Inherits</span> MyControl</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	MenuBar MenuBar1</div>
<div class="RB_Code">		MenuItem FileMenu = <span style="color:#6500FE">&quot;&amp;Ablage&quot;</span></div>
<div class="RB_Code">			MenuItem FileQuit = <span style="color:#6500FE">&quot;#App.kFileQuit&quot;</span></div>
<div class="RB_Code">		MenuItem EditMenu = <span style="color:#6500FE">&quot;&amp;Bearbeiten&quot;</span></div>
<div class="RB_Code">			MenuItem EditUndo = <span style="color:#6500FE">&quot;&amp;R&uuml;ckg&auml;ngig&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu1 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditCut = <span style="color:#6500FE">&quot;&amp;Ausschneiden&quot;</span></div>
<div class="RB_Code">			MenuItem EditCopy = <span style="color:#6500FE">&quot;&amp;Kopieren&quot;</span></div>
<div class="RB_Code">			MenuItem EditPaste = <span style="color:#6500FE">&quot;&amp;Einf&uuml;gen&quot;</span></div>
<div class="RB_Code">			MenuItem EditClear = <span style="color:#6500FE">&quot;#App.kEditClear&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu0 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditSelectAll = <span style="color:#6500FE">&quot;&amp;Alles</span> <span style="color:#6500FE">ausw&auml;hlen&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> MenuBar</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> MyControl <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> MouseMove(X <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>, Y <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>)
			trackFinance x
			pic = m.makeChartPicture
			<span style="color:#0000FF;font-weight: bold">me</span>.Invalidate
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			CDBaseChartMBS.ScaleFactor = <span style="color:#326598">2</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Create</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">finance</span> <span style="color:#7F0000;text-style:italic">chart</span> <span style="color:#7F0000;text-style:italic">demo</span> <span style="color:#7F0000;text-style:italic">containing</span> <span style="color:#7F0000;text-style:italic">100</span> <span style="color:#7F0000;text-style:italic">days</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">data</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> noOfDays <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">100</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">To</span> <span style="color:#7F0000;text-style:italic">compute</span> <span style="color:#7F0000;text-style:italic">moving</span> <span style="color:#7F0000;text-style:italic">averages</span> <span style="color:#7F0000;text-style:italic">starting</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">first</span> <span style="color:#7F0000;text-style:italic">day,</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">need</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">get</span> <span style="color:#7F0000;text-style:italic">extra</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">points</span> <span style="color:#7F0000;text-style:italic">before</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">first</span> <span style="color:#7F0000;text-style:italic">day</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> extraDays <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">30</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">In</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">exammple,</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">use</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">random</span> <span style="color:#7F0000;text-style:italic">number</span> <span style="color:#7F0000;text-style:italic">generator</span> <span style="color:#7F0000;text-style:italic">utility</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">simulate</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">data.</span> <span style="color:#7F0000;text-style:italic">We</span> <span style="color:#7F0000;text-style:italic">set</span> <span style="color:#7F0000;text-style:italic">up</span> <span style="color:#7F0000;text-style:italic">the</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">random</span> <span style="color:#7F0000;text-style:italic">table</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">create</span> <span style="color:#7F0000;text-style:italic">6</span> <span style="color:#7F0000;text-style:italic">cols</span> <span style="color:#7F0000;text-style:italic">x</span> <span style="color:#7F0000;text-style:italic">(noOfDays</span> <span style="color:#7F0000;text-style:italic">+</span> <span style="color:#7F0000;text-style:italic">extraDays)</span> <span style="color:#7F0000;text-style:italic">rows,</span> <span style="color:#7F0000;text-style:italic">using</span> <span style="color:#7F0000;text-style:italic">9</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">seed.</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> rantable <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> CDRanTableMBS(<span style="color:#326598">9</span>, <span style="color:#326598">6</span>, noOfDays + extraDays)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Set</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">1st</span> <span style="color:#7F0000;text-style:italic">col</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">timeStamp,</span> <span style="color:#7F0000;text-style:italic">starting</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">Sep</span> <span style="color:#7F0000;text-style:italic">4,</span> <span style="color:#7F0000;text-style:italic">2011,</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">each</span> <span style="color:#7F0000;text-style:italic">row</span> <span style="color:#7F0000;text-style:italic">representing</span> <span style="color:#7F0000;text-style:italic">one</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">day,</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">counting</span> <span style="color:#7F0000;text-style:italic">week</span> <span style="color:#7F0000;text-style:italic">days</span> <span style="color:#7F0000;text-style:italic">only</span> <span style="color:#7F0000;text-style:italic">(jump</span> <span style="color:#7F0000;text-style:italic">over</span> <span style="color:#7F0000;text-style:italic">Sat</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">Sun)</span>
			rantable.setDateCol(<span style="color:#326598">0</span>, CDBaseChartMBS.chartTime(<span style="color:#326598">2011</span>, <span style="color:#326598">9</span>, <span style="color:#326598">4</span>), <span style="color:#326598">86400</span>, <span style="color:#0000FF;font-weight: bold">true</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Set</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">2nd,</span> <span style="color:#7F0000;text-style:italic">3rd,</span> <span style="color:#7F0000;text-style:italic">4th</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">5th</span> <span style="color:#7F0000;text-style:italic">columns</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">high,</span> <span style="color:#7F0000;text-style:italic">low,</span> <span style="color:#7F0000;text-style:italic">open</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">close</span> <span style="color:#7F0000;text-style:italic">data.</span> <span style="color:#7F0000;text-style:italic">The</span> <span style="color:#7F0000;text-style:italic">open</span> <span style="color:#7F0000;text-style:italic">value</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">starts</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">100,</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">daily</span> <span style="color:#7F0000;text-style:italic">change</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">random</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">-5</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">5.</span>
			rantable.setHLOCCols(<span style="color:#326598">1</span>, <span style="color:#326598">100</span>, -<span style="color:#326598">5</span>, <span style="color:#326598">5</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Set</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">6th</span> <span style="color:#7F0000;text-style:italic">column</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">vol</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">5</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">25</span> <span style="color:#7F0000;text-style:italic">million</span>
			rantable.setCol(<span style="color:#326598">5</span>, <span style="color:#326598">50000000</span>, <span style="color:#326598">250000000</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Now</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">read</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">from</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">table</span> <span style="color:#7F0000;text-style:italic">into</span> <span style="color:#7F0000;text-style:italic">arrays</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> timeStamps(-<span style="color:#326598">1</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = rantable.getCol(<span style="color:#326598">0</span>).Values
			<span style="color:#0000FF;font-weight: bold">dim</span> highData(-<span style="color:#326598">1</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = rantable.getCol(<span style="color:#326598">1</span>).Values
			<span style="color:#0000FF;font-weight: bold">dim</span> lowData(-<span style="color:#326598">1</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = rantable.getCol(<span style="color:#326598">2</span>).Values
			<span style="color:#0000FF;font-weight: bold">dim</span> openData(-<span style="color:#326598">1</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = rantable.getCol(<span style="color:#326598">3</span>).Values
			<span style="color:#0000FF;font-weight: bold">dim</span> closeData(-<span style="color:#326598">1</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = rantable.getCol(<span style="color:#326598">4</span>).Values
			<span style="color:#0000FF;font-weight: bold">dim</span> volData(-<span style="color:#326598">1</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = rantable.getCol(<span style="color:#326598">5</span>).Values
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Create</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">FinanceChart</span> <span style="color:#7F0000;text-style:italic">object</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">width</span> <span style="color:#7F0000;text-style:italic">720</span> <span style="color:#7F0000;text-style:italic">pixels</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> CDFinanceChartMBS(<span style="color:#326598">720</span>)
			m = c
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Add</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">title</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">chart</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.addTitle(<span style="color:#6500FE">&quot;Finance</span> <span style="color:#6500FE">Chart</span> <span style="color:#6500FE">Demonstration&quot;</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Disable</span> <span style="color:#7F0000;text-style:italic">default</span> <span style="color:#7F0000;text-style:italic">legend</span> <span style="color:#7F0000;text-style:italic">box,</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">using</span> <span style="color:#7F0000;text-style:italic">dynamic</span> <span style="color:#7F0000;text-style:italic">legend</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.setLegendStyle(<span style="color:#6500FE">&quot;normal&quot;</span>, <span style="color:#326598">8</span>, CDBaseChartMBS.kTransparent, CDBaseChartMBS.kTransparent)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Set</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">into</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">finance</span> <span style="color:#7F0000;text-style:italic">chart</span> <span style="color:#7F0000;text-style:italic">object</span>
			c.setData(timeStamps, highData, lowData, openData, closeData, volData, extraDays)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Add</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">chart</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">240</span> <span style="color:#7F0000;text-style:italic">pixels</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">height</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> main <span style="color:#0000FF;font-weight: bold">as</span> CDXYChartMBS = c.addMainChart(<span style="color:#326598">240</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Add</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">10</span> <span style="color:#7F0000;text-style:italic">period</span> <span style="color:#7F0000;text-style:italic">simple</span> <span style="color:#7F0000;text-style:italic">moving</span> <span style="color:#7F0000;text-style:italic">average</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">chart,</span> <span style="color:#7F0000;text-style:italic">using</span> <span style="color:#7F0000;text-style:italic">brown</span> <span style="color:#7F0000;text-style:italic">color</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.addSimpleMovingAvg(<span style="color:#326598">10</span>, <span style="color:#326598">&amp;h663300</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Add</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">20</span> <span style="color:#7F0000;text-style:italic">period</span> <span style="color:#7F0000;text-style:italic">simple</span> <span style="color:#7F0000;text-style:italic">moving</span> <span style="color:#7F0000;text-style:italic">average</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">chart,</span> <span style="color:#7F0000;text-style:italic">using</span> <span style="color:#7F0000;text-style:italic">purple</span> <span style="color:#7F0000;text-style:italic">color</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.addSimpleMovingAvg(<span style="color:#326598">20</span>, <span style="color:#326598">&amp;h9900ff</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Add</span> <span style="color:#7F0000;text-style:italic">candlestick</span> <span style="color:#7F0000;text-style:italic">symbols</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">chart,</span> <span style="color:#7F0000;text-style:italic">using</span> <span style="color:#7F0000;text-style:italic">green/red</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">up/down</span> <span style="color:#7F0000;text-style:italic">days</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.addCandleStick(<span style="color:#326598">&amp;h00ff00</span>, <span style="color:#326598">&amp;hff0000</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Add</span> <span style="color:#7F0000;text-style:italic">20</span> <span style="color:#7F0000;text-style:italic">days</span> <span style="color:#7F0000;text-style:italic">bollinger</span> <span style="color:#7F0000;text-style:italic">band</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">chart,</span> <span style="color:#7F0000;text-style:italic">using</span> <span style="color:#7F0000;text-style:italic">light</span> <span style="color:#7F0000;text-style:italic">blue</span> <span style="color:#7F0000;text-style:italic">(9999ff)</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">border</span> <span style="color:#7F0000;text-style:italic">and</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">semi-transparent</span> <span style="color:#7F0000;text-style:italic">blue</span> <span style="color:#7F0000;text-style:italic">(c06666ff)</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">fill</span> <span style="color:#7F0000;text-style:italic">color</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.addBollingerBand(<span style="color:#326598">20</span>, <span style="color:#326598">2</span>, <span style="color:#326598">&amp;h9999ff</span>, <span style="color:#326598">&amp;hc06666ff</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Add</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">75</span> <span style="color:#7F0000;text-style:italic">pixels</span> <span style="color:#7F0000;text-style:italic">volume</span> <span style="color:#7F0000;text-style:italic">bars</span> <span style="color:#7F0000;text-style:italic">sub-chart</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">bottom</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">chart,</span> <span style="color:#7F0000;text-style:italic">using</span> <span style="color:#7F0000;text-style:italic">green/red/grey</span> <span style="color:#7F0000;text-style:italic">for</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">up/down/flat</span> <span style="color:#7F0000;text-style:italic">days</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.addVolBars(<span style="color:#326598">75</span>, <span style="color:#326598">&amp;h99ff99</span>, <span style="color:#326598">&amp;hff9999</span>, <span style="color:#326598">&amp;h808080</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Append</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">14-days</span> <span style="color:#7F0000;text-style:italic">RSI</span> <span style="color:#7F0000;text-style:italic">indicator</span> <span style="color:#7F0000;text-style:italic">chart</span> <span style="color:#7F0000;text-style:italic">(75</span> <span style="color:#7F0000;text-style:italic">pixels</span> <span style="color:#7F0000;text-style:italic">high)</span> <span style="color:#7F0000;text-style:italic">after</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">chart.</span> <span style="color:#7F0000;text-style:italic">The</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">RSI</span> <span style="color:#7F0000;text-style:italic">line</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">purple</span> <span style="color:#7F0000;text-style:italic">(800080).</span> <span style="color:#7F0000;text-style:italic">Set</span> <span style="color:#7F0000;text-style:italic">threshold</span> <span style="color:#7F0000;text-style:italic">region</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">+/-</span> <span style="color:#7F0000;text-style:italic">20</span> <span style="color:#7F0000;text-style:italic">(that</span> <span style="color:#7F0000;text-style:italic">is,</span> <span style="color:#7F0000;text-style:italic">RSI</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">50</span> <span style="color:#7F0000;text-style:italic">+/-</span> <span style="color:#7F0000;text-style:italic">25).</span> <span style="color:#7F0000;text-style:italic">The</span> <span style="color:#7F0000;text-style:italic">upper/lower</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">threshold</span> <span style="color:#7F0000;text-style:italic">regions</span> <span style="color:#7F0000;text-style:italic">will</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">filled</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">red</span> <span style="color:#7F0000;text-style:italic">(ff0000)/blue</span> <span style="color:#7F0000;text-style:italic">(0000ff).</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.addRSI(<span style="color:#326598">75</span>, <span style="color:#326598">14</span>, <span style="color:#326598">&amp;h800080</span>, <span style="color:#326598">20</span>, <span style="color:#326598">&amp;hff0000</span>, <span style="color:#326598">&amp;h0000ff</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Append</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">MACD(26,</span> <span style="color:#7F0000;text-style:italic">12)</span> <span style="color:#7F0000;text-style:italic">indicator</span> <span style="color:#7F0000;text-style:italic">chart</span> <span style="color:#7F0000;text-style:italic">(75</span> <span style="color:#7F0000;text-style:italic">pixels</span> <span style="color:#7F0000;text-style:italic">high)</span> <span style="color:#7F0000;text-style:italic">after</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">main</span> <span style="color:#7F0000;text-style:italic">chart,</span> <span style="color:#7F0000;text-style:italic">using</span> <span style="color:#7F0000;text-style:italic">9</span> <span style="color:#7F0000;text-style:italic">days</span> <span style="color:#7F0000;text-style:italic">for</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">computing</span> <span style="color:#7F0000;text-style:italic">divergence.</span>
			<span style="color:#0000FF;font-weight: bold">call</span> c.addMACD(<span style="color:#326598">75</span>, <span style="color:#326598">26</span>, <span style="color:#326598">12</span>, <span style="color:#326598">9</span>, <span style="color:#326598">&amp;h0000ff</span>, <span style="color:#326598">&amp;hff00ff</span>, <span style="color:#326598">&amp;h008000</span>)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Include</span> <span style="color:#7F0000;text-style:italic">track</span> <span style="color:#7F0000;text-style:italic">line</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">legend</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">latest</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">values</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> xchart <span style="color:#0000FF;font-weight: bold">as</span> CDXYChartMBS = CDXYChartMBS(c.getchart(<span style="color:#326598">0</span>))
			trackFinance xchart.getPlotArea.getRightX
			
			pic = c.makeChartPicture
			
			
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">fix</span> <span style="color:#7F0000;text-style:italic">some</span> <span style="color:#7F0000;text-style:italic">properties</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">set</span> <span style="color:#7F0000;text-style:italic">wrong</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">IDE</span>
			
			<span style="color:#0000FF;font-weight: bold">me</span>.DoubleBuffer = <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF;font-weight: bold">me</span>.EraseBackground = <span style="color:#0000FF;font-weight: bold">false</span>
			
			<span style="color:#0000FF">#if</span> RBVersion &gt;= <span style="color:#006532">2013.0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">me</span>.Transparent = <span style="color:#0000FF;font-weight: bold">False</span>
			<span style="color:#0000FF">#endif</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Paint(g <span style="color:#0000FF;font-weight: bold">As</span> Graphics, areas() <span style="color:#0000FF;font-weight: bold">As</span> REALbasic.Rect)
			g.DrawPicture pic, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>, g.Width, g.Height, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>, pic.Width, pic.Height
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> trackFinance(mouseX <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>)
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Clear</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">current</span> <span style="color:#7F0000;text-style:italic">dynamic</span> <span style="color:#7F0000;text-style:italic">layer</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">get</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">DrawArea</span> <span style="color:#7F0000;text-style:italic">object</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">draw</span> <span style="color:#7F0000;text-style:italic">on</span> <span style="color:#7F0000;text-style:italic">it.</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> CDDrawAreaMBS = m.initDynamicLayer
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">It</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">possible</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">FinanceChart</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">empty,</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">need</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">check</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">it.</span>
			<span style="color:#0000FF;font-weight: bold">if</span> m.getChartCount = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Get</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">x-value</span> <span style="color:#7F0000;text-style:italic">that</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">nearest</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">mouse</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> xchart <span style="color:#0000FF;font-weight: bold">as</span> CDXYChartMBS = CDXYChartMBS(m.getChart(<span style="color:#326598">0</span>))
			<span style="color:#0000FF;font-weight: bold">dim</span> xValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = xchart.getNearestXValue(mouseX)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Iterate</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">XY</span> <span style="color:#7F0000;text-style:italic">charts</span> <span style="color:#7F0000;text-style:italic">(main</span> <span style="color:#7F0000;text-style:italic">price</span> <span style="color:#7F0000;text-style:italic">chart</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">indicator</span> <span style="color:#7F0000;text-style:italic">charts)</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">FinanceChart</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> u <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = m.getChartCount-<span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> u
				<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> CDXYChartMBS = CDXYChartMBS(m.getChart(i))
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Variables</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">hold</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">legend</span> <span style="color:#7F0000;text-style:italic">entries</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> ohlcLegend <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> legendEntries(-<span style="color:#326598">1</span>) <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Iterate</span> <span style="color:#7F0000;text-style:italic">through</span> <span style="color:#7F0000;text-style:italic">all</span> <span style="color:#7F0000;text-style:italic">layers</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">find</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">highest</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">point</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> lu <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = c.getLayerCount-<span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">for</span> j <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> lu
					<span style="color:#0000FF;font-weight: bold">dim</span> layer <span style="color:#0000FF;font-weight: bold">as</span> CDLayerMBS = c.getLayerByZ(j)
					<span style="color:#0000FF;font-weight: bold">dim</span> xIndex <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = layer.getXIndexOf(xValue)
					<span style="color:#0000FF;font-weight: bold">dim</span> dataSetCount <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = layer.getDataSetCount
					
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">In</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">FinanceChart,</span> <span style="color:#7F0000;text-style:italic">only</span> <span style="color:#7F0000;text-style:italic">layers</span> <span style="color:#7F0000;text-style:italic">showing</span> <span style="color:#7F0000;text-style:italic">OHLC</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">can</span> <span style="color:#7F0000;text-style:italic">have</span> <span style="color:#7F0000;text-style:italic">4</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">sets</span>
					<span style="color:#0000FF;font-weight: bold">if</span> (dataSetCount = <span style="color:#326598">4</span>) <span style="color:#0000FF;font-weight: bold">then</span>
						<span style="color:#0000FF;font-weight: bold">dim</span> highValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = layer.getDataSet(<span style="color:#326598">0</span>).getValue(xIndex)
						<span style="color:#0000FF;font-weight: bold">dim</span> lowValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = layer.getDataSet(<span style="color:#326598">1</span>).getValue(xIndex)
						<span style="color:#0000FF;font-weight: bold">dim</span> openValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = layer.getDataSet(<span style="color:#326598">2</span>).getValue(xIndex)
						<span style="color:#0000FF;font-weight: bold">dim</span> closeValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = layer.getDataSet(<span style="color:#326598">3</span>).getValue(xIndex)
						
						<span style="color:#0000FF;font-weight: bold">if</span> (closeValue &lt;&gt; CDBaseChartMBS.kNoValue) <span style="color:#0000FF;font-weight: bold">then</span>
							<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Build</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">OHLC</span> <span style="color:#7F0000;text-style:italic">legend</span>
							ohlcLegend = <span style="color:#6500FE">&quot;</span>      <span style="color:#6500FE">&lt;*block*&gt;&quot;</span>
							ohlcLegend = ohlcLegend + <span style="color:#6500FE">&quot;Open:</span> <span style="color:#6500FE">&quot;</span> + c.formatValue(openValue, <span style="color:#6500FE">&quot;{value|P4}&quot;</span>)
							ohlcLegend = ohlcLegend + <span style="color:#6500FE">&quot;,</span> <span style="color:#6500FE">High:</span> <span style="color:#6500FE">&quot;</span> + c.formatValue(highValue, <span style="color:#6500FE">&quot;{value|P4}&quot;</span>)
							ohlcLegend = ohlcLegend + <span style="color:#6500FE">&quot;,</span> <span style="color:#6500FE">Low:</span> <span style="color:#6500FE">&quot;</span> + c.formatValue(lowValue, <span style="color:#6500FE">&quot;{value|P4}&quot;</span>)
							ohlcLegend = ohlcLegend + <span style="color:#6500FE">&quot;,</span> <span style="color:#6500FE">Close:</span> <span style="color:#6500FE">&quot;</span> + c.formatValue(closeValue, <span style="color:#6500FE">&quot;{value|P4}&quot;</span>)
							
							<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">We</span> <span style="color:#7F0000;text-style:italic">also</span> <span style="color:#7F0000;text-style:italic">draw</span> <span style="color:#7F0000;text-style:italic">an</span> <span style="color:#7F0000;text-style:italic">upward</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">downward</span> <span style="color:#7F0000;text-style:italic">triangle</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">up</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">down</span> <span style="color:#7F0000;text-style:italic">days</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">%</span>
							<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">change</span>
							<span style="color:#0000FF;font-weight: bold">dim</span> lastCloseValue <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = layer.getDataSet(<span style="color:#326598">3</span>).getValue(xIndex - <span style="color:#326598">1</span>)
							<span style="color:#0000FF;font-weight: bold">if</span> (lastCloseValue &lt;&gt; CDBaseChartMBS.kNoValue) <span style="color:#0000FF;font-weight: bold">then</span>
								<span style="color:#0000FF;font-weight: bold">dim</span> change <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = closeValue - lastCloseValue
								<span style="color:#0000FF;font-weight: bold">dim</span> percent <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = change * <span style="color:#326598">100</span> / closeValue
								<span style="color:#0000FF;font-weight: bold">dim</span> symbol <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = <span style="color:#6500FE">&quot;&lt;*font,color=CC0000*&gt;&lt;*img=@invertedtriangle,width=8,color=CC0000*&gt;&quot;</span>
								<span style="color:#0000FF;font-weight: bold">if</span> change &gt;= <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span> symbol = <span style="color:#6500FE">&quot;&lt;*font,color=008800*&gt;&lt;*img=@triangle,width=8,color=008800*&gt;&quot;</span>
								
								ohlcLegend = ohlcLegend + <span style="color:#6500FE">&quot;</span>  <span style="color:#6500FE">&quot;</span> + symbol + <span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">&quot;</span> + c.formatValue(change, <span style="color:#6500FE">&quot;{value|P4}&quot;</span>)
								ohlcLegend = ohlcLegend + <span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">(&quot;</span> + c.formatValue(percent, <span style="color:#6500FE">&quot;{value|2}&quot;</span>) + <span style="color:#6500FE">&quot;%)&lt;*/font*&gt;&quot;</span>
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							
							ohlcLegend = ohlcLegend + <span style="color:#6500FE">&quot;&lt;*/*&gt;&quot;</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">else</span>
						<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Iterate</span> <span style="color:#7F0000;text-style:italic">through</span> <span style="color:#7F0000;text-style:italic">all</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">sets</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">layer</span>
						<span style="color:#0000FF;font-weight: bold">dim</span> ku <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = layer.getDataSetCount-<span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">for</span> k <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> ku
							<span style="color:#0000FF;font-weight: bold">dim</span> dataSet <span style="color:#0000FF;font-weight: bold">as</span> CDDataSetMBS = layer.getDataSetByZ(k)
							
							<span style="color:#0000FF;font-weight: bold">dim</span> name <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = dataSet.getDataName
							<span style="color:#0000FF;font-weight: bold">dim</span> value <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = dataSet.getValue(xIndex)
							<span style="color:#0000FF;font-weight: bold">if</span> (name.len&gt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">and</span> (value &lt;&gt; CDBaseChartMBS.kNoValue)) <span style="color:#0000FF;font-weight: bold">then</span>
								
								<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">In</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">FinanceChart,</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">set</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">consists</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">indicator</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">its</span>
								<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">latest</span> <span style="color:#7F0000;text-style:italic">value.</span> <span style="color:#7F0000;text-style:italic">It</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">like</span> <span style="color:#7F0000;text-style:italic">&quot;Vol:</span> <span style="color:#7F0000;text-style:italic">123M&quot;</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">&quot;RSI</span> <span style="color:#7F0000;text-style:italic">(14):</span> <span style="color:#7F0000;text-style:italic">55.34&quot;.</span> <span style="color:#7F0000;text-style:italic">As</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">are</span>
								<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">generating</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">values</span> <span style="color:#7F0000;text-style:italic">dynamically,</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">need</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">extract</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">indictor</span> <span style="color:#7F0000;text-style:italic">name</span>
								<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">out,</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">also</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">volume</span> <span style="color:#7F0000;text-style:italic">unit</span> <span style="color:#7F0000;text-style:italic">(if</span> <span style="color:#7F0000;text-style:italic">any).</span>
								
								<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">The</span> <span style="color:#7F0000;text-style:italic">volume</span> <span style="color:#7F0000;text-style:italic">unit</span>
								<span style="color:#0000FF;font-weight: bold">dim</span> unitChar <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
								
								<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">The</span> <span style="color:#7F0000;text-style:italic">indicator</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">part</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">up</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">colon</span> <span style="color:#7F0000;text-style:italic">character.</span>
								<span style="color:#0000FF;font-weight: bold">dim</span> delimiterPosition <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = name.instr(<span style="color:#6500FE">&quot;:&quot;</span>)
								<span style="color:#0000FF;font-weight: bold">if</span> delimiterPosition&gt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
									
									<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">The</span> <span style="color:#7F0000;text-style:italic">unit,</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">any,</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">trailing</span> <span style="color:#7F0000;text-style:italic">non-digit</span> <span style="color:#7F0000;text-style:italic">character(s).</span>
									<span style="color:#0000FF;font-weight: bold">dim</span> lastDigitPos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = name.FindLastOf(<span style="color:#6500FE">&quot;0123456789&quot;</span>)
									<span style="color:#0000FF;font-weight: bold">if</span> (lastDigitPos&gt;<span style="color:#326598">0</span>) <span style="color:#0000FF;font-weight: bold">and</span> (lastDigitPos + <span style="color:#326598">1</span> &lt; len(name)) <span style="color:#0000FF;font-weight: bold">and</span> (lastDigitPos &gt; delimiterPosition) <span style="color:#0000FF;font-weight: bold">then</span>
										unitChar = mid(name, lastDigitPos + <span style="color:#326598">1</span>)
										
										name = left(name, delimiterPosition-<span style="color:#326598">1</span>)
									<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
									
									<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">In</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">FinanceChart,</span> <span style="color:#7F0000;text-style:italic">if</span> <span style="color:#7F0000;text-style:italic">there</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">two</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">sets,</span> <span style="color:#7F0000;text-style:italic">it</span> <span style="color:#7F0000;text-style:italic">must</span> <span style="color:#7F0000;text-style:italic">be</span> <span style="color:#7F0000;text-style:italic">representing</span> <span style="color:#7F0000;text-style:italic">a</span>
									<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">range.</span>
									<span style="color:#0000FF;font-weight: bold">if</span> (dataSetCount = <span style="color:#326598">2</span>) <span style="color:#0000FF;font-weight: bold">then</span>
										<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">We</span> <span style="color:#7F0000;text-style:italic">show</span> <span style="color:#7F0000;text-style:italic">both</span> <span style="color:#7F0000;text-style:italic">values</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">range</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">single</span> <span style="color:#7F0000;text-style:italic">legend</span> <span style="color:#7F0000;text-style:italic">entry</span>
										value = layer.getDataSet(<span style="color:#326598">0</span>).getValue(xIndex)
										<span style="color:#0000FF;font-weight: bold">dim</span> value2 <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span> = layer.getDataSet(<span style="color:#326598">1</span>).getValue(xIndex)
										name = name + <span style="color:#6500FE">&quot;:</span> <span style="color:#6500FE">&quot;</span> + c.formatValue(min(value, value2), <span style="color:#6500FE">&quot;{value|P3}&quot;</span>)
										name = name + <span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">-</span> <span style="color:#6500FE">&quot;</span> + c.formatValue(max(value, value2), <span style="color:#6500FE">&quot;{value|P3}&quot;</span>)
									<span style="color:#0000FF;font-weight: bold">else</span>
										<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">In</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">FinanceChart,</span> <span style="color:#7F0000;text-style:italic">only</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">layer</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">volume</span> <span style="color:#7F0000;text-style:italic">bars</span> <span style="color:#7F0000;text-style:italic">has</span> <span style="color:#7F0000;text-style:italic">3</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">sets</span> <span style="color:#7F0000;text-style:italic">for</span>
										<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">up/down/flat</span> <span style="color:#7F0000;text-style:italic">days</span>
										<span style="color:#0000FF;font-weight: bold">if</span> (dataSetCount = <span style="color:#326598">3</span>) <span style="color:#0000FF;font-weight: bold">then</span>
											<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">The</span> <span style="color:#7F0000;text-style:italic">actual</span> <span style="color:#7F0000;text-style:italic">volume</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">sum</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">3</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">sets.</span>
											value = layer.getDataSet(<span style="color:#326598">0</span>).getValue(xIndex) + layer.getDataSet(<span style="color:#326598">1</span>).getValue(xIndex) + layer.getDataSet(<span style="color:#326598">2</span>).getValue(xIndex)
										<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
										
										<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Create</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">legend</span> <span style="color:#7F0000;text-style:italic">entry</span>
										name = name + <span style="color:#6500FE">&quot;:</span> <span style="color:#6500FE">&quot;</span> + c.formatValue(value, <span style="color:#6500FE">&quot;{value|P3}&quot;</span>) + unitChar
									<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
									
									<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Build</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">legend</span> <span style="color:#7F0000;text-style:italic">entry,</span> <span style="color:#7F0000;text-style:italic">consist</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">colored</span> <span style="color:#7F0000;text-style:italic">square</span> <span style="color:#7F0000;text-style:italic">box</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">name</span> <span style="color:#7F0000;text-style:italic">(with</span>
									<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">data</span> <span style="color:#7F0000;text-style:italic">value</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">it).</span>
									<span style="color:#0000FF;font-weight: bold">dim</span> legendEntry <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
									<span style="color:#0000FF;font-weight: bold">dim</span> h <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = hex(dataSet.getDataColor)
									<span style="color:#0000FF;font-weight: bold">while</span> h.len&lt;<span style="color:#326598">6</span>
										h = <span style="color:#6500FE">&quot;0&quot;</span> + h
									<span style="color:#0000FF;font-weight: bold">wend</span>
									legendEntry = <span style="color:#6500FE">&quot;&lt;*block*&gt;&lt;*img=@square,width=8,edgeColor=000000,color=&quot;</span> + h + <span style="color:#6500FE">&quot;*&gt;</span> <span style="color:#6500FE">&quot;</span> + name + <span style="color:#6500FE">&quot;&lt;*/*&gt;&quot;</span>
									legendEntries.append legendEntry
								<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						<span style="color:#0000FF;font-weight: bold">next</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Get</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">plot</span> <span style="color:#7F0000;text-style:italic">area</span> <span style="color:#7F0000;text-style:italic">position</span> <span style="color:#7F0000;text-style:italic">relative</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">entire</span> <span style="color:#7F0000;text-style:italic">FinanceChart</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> plotArea <span style="color:#0000FF;font-weight: bold">as</span> CDPlotAreaMBS = c.getPlotArea
				<span style="color:#0000FF;font-weight: bold">dim</span> plotAreaLeftX <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = plotArea.getLeftX + c.getAbsOffsetX
				<span style="color:#0000FF;font-weight: bold">dim</span> plotAreaTopY <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = plotArea.getTopY + c.getAbsOffsetY
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">The</span> <span style="color:#7F0000;text-style:italic">legend</span> <span style="color:#7F0000;text-style:italic">begins</span> <span style="color:#7F0000;text-style:italic">with</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">date</span> <span style="color:#7F0000;text-style:italic">label,</span> <span style="color:#7F0000;text-style:italic">then</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">ohlcLegend</span> <span style="color:#7F0000;text-style:italic">(if</span> <span style="color:#7F0000;text-style:italic">any),</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">then</span> <span style="color:#7F0000;text-style:italic">the</span>
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">entries</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">indicators.</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> legendText <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
				legendText = <span style="color:#6500FE">&quot;&lt;*block,valign=top,maxWidth=&quot;</span> + str(plotArea.getWidth - <span style="color:#326598">5</span>) + <span style="color:#6500FE">&quot;*&gt;&lt;*font=arialbd.ttf*&gt;[&quot;</span> + c.xAxis.getFormattedLabel(xValue, <span style="color:#6500FE">&quot;mmm</span> <span style="color:#6500FE">dd,</span> <span style="color:#6500FE">yyyy&quot;</span>) + <span style="color:#6500FE">&quot;]&lt;*/font*&gt;&quot;</span> + ohlcLegend
				<span style="color:#0000FF;font-weight: bold">for</span> ii <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = UBound(legendEntries) <span style="color:#0000FF;font-weight: bold">downto</span> <span style="color:#326598">0</span>
					legendText = legendText + <span style="color:#6500FE">&quot;</span>      <span style="color:#6500FE">&quot;</span> + legendEntries(ii)
				<span style="color:#0000FF;font-weight: bold">next</span>
				legendText = legendText + <span style="color:#6500FE">&quot;&lt;*/*&gt;&quot;</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Draw</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">vertical</span> <span style="color:#7F0000;text-style:italic">track</span> <span style="color:#7F0000;text-style:italic">line</span> <span style="color:#7F0000;text-style:italic">at</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">x-position</span>
				d.vline(plotAreaTopY, plotAreaTopY + plotArea.getHeight, c.getXCoor(xValue) + c.getAbsOffsetX, d.dashLineColor(<span style="color:#326598">&amp;h000000</span>, <span style="color:#326598">&amp;h0101</span>))
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Display</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">legend</span> <span style="color:#7F0000;text-style:italic">on</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">top</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">plot</span> <span style="color:#7F0000;text-style:italic">area</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> t <span style="color:#0000FF;font-weight: bold">as</span> CDTTFTextMBS = d.text(legendText, <span style="color:#6500FE">&quot;arial.ttf&quot;</span>, <span style="color:#326598">8</span>)
				t.draw(plotAreaLeftX + <span style="color:#326598">5</span>, plotAreaTopY + <span style="color:#326598">3</span>, <span style="color:#326598">&amp;h000000</span>, CDBaseChartMBS.kTopLeft)
				t.destroy
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;Notes&quot;</span>
<div class="RB_Comment">			This sample program demonstrates a track cursor for a finance chart programmed with the following features:
			
			* A vertical line that follows the mouse cursor on the plot area and snaps to the nearest trading session.
			* Dynamically updated legend entries that show the price, volume and other technical indicators at the nearest trading session.
			
			The code first draws the finance chart with the legend box set to transparent (so that the default legend box is not displayed). 
			It then sets the track cursor to the right side of the plot area. This ensures the chart initially has a dynamic legend for the latest trading session.
			
			The trackFinance method is the routine that draws the track cursor. Its key elements are:
			
			* To draw dynamic contents on the chart, the code obtains the DrawArea object for drawing on the dynamic layer of the chart using BaseChart.initDynamicLayer.
			* The nearest trading session is obtained from the first XYChart in the FinanceChart using XYChart.getNearestXValue.
			* The code iterates through all the XYChart objects in the FinanceChart. For each XYChart, the code iterates through all the layers to create dynamic legend entries. The FinanceChart creates default static legend entries for all indicators showing their latest values (even though the default static legend box is set to transparent in the chart). The code creates the dynamic legend entries by replacing the values in the static legend entries.
			* If a layer contains 4 data sets, the code assumes it is either a CandleStickLayer or HLOCLayer. It formats a legend entry consisting of the open, high, low, close values, as well as an up/down icon and the percentage change.
			* If a layer contains 2 data sets, the code assumes the layer is for a "band" or "channel" (such as Bollinger Band or Donchian Channel). The code formats a legend entry by replacing the values in the default legend entry (obtained using DataSet.getDataName).
			* If a layer contains 3 data sets, the code assumes the layer is for volume bars, with the 3 data sets representing volume bars of different colors for up, down and flat days. The code computes the volume by adding the values from the three data sets, and formats a legend entry by replacing the value in the default legend entry (obtained using DataSet.getDataName) with the computed value.
			* In all other cases, the code iterates the data sets. For each of them, it formats a legend by replacing the value in the default legend entry (obtained using DataSet.getDataName) with the value for the nearest trading session (obtained using DataSet.getValue).
			* Finally, the code combines all the legend entries into a legend box and draws it on top of the plot area using DrawArea.text. It also draws a vertical line at the nearest trading session using DrawArea.vline.</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> m <span style="color:#0000FF;font-weight: bold">As</span> CDFinanceChartMBS</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> pic <span style="color:#0000FF;font-weight: bold">As</span> Picture</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Module</span> Module1</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> FindLastOf(<span style="color:#0000FF;font-weight: bold">extends</span> x <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>, y <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> last <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> l <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = len(Y)
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> l
				<span style="color:#0000FF;font-weight: bold">dim</span> search <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span> = mid(y,i,<span style="color:#326598">1</span>)
				
				<span style="color:#0000FF;font-weight: bold">dim</span> pos <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = instr(x, search)
				<span style="color:#0000FF;font-weight: bold">if</span> pos&gt;last <span style="color:#0000FF;font-weight: bold">then</span>
					last = pos
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#0000FF;font-weight: bold">Return</span> last
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Module</span></div>
</div>
<div class="RB_Code"><span style="color:#0000FF;font-weight: bold">End</span> Project</div>

<p>See also:<ul>
<li><A href="example-chartdirector-finance.html">/ChartDirector/finance</A></li>
<li><A href="example-chartdirector-financeanimated.html">/ChartDirector/finance animated</A></li>
<li><A href="example-chartdirector-financepdf.html">/ChartDirector/finance pdf</A></li>
<li><A href="example-chartdirector-financewithchartdirectorcontrol.html">/ChartDirector/finance with ChartDirector Control</A></li>
</ul></p>
</div>
<p>The items on this page are in the following plugins: <a href="plugins-mbschartdirectorplugin.html">MBS ChartDirector Plugin</a>.</p>
<!-- Ende Content-->

<br>
<div style="width: 200pt; margin: 0pt; padding: 5pt; border-color:#ccc; border-style:solid; background-color: #eee; border-width: 2pt; border-radius: 10pt; " lang="en">
&#128172; <a href="https://www.monkeybreadsoftware.com/feedback/?what=xojo&path=example-chartdirector-financecharttracklineretina">Ask a question or report a problem</a>
</div>

</BODY>
</HTML>

