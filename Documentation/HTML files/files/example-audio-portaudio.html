<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Frameset//EN" >
<HTML>
<HEAD>
<TITLE>Monkeybread Xojo plugin - Example: /Audio/PortAudio</TITLE>
<script src="../platforms.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../help.css" >
<link rel="stylesheet" type="text/css" href="../screen.css" media="screen">
<link rel="stylesheet" type="text/css" href="../print.css" media="print">
<link rel="stylesheet" type="text/css" href="../allitems.css" title="Default">
<link rel="alternate stylesheet" type="text/css" href="../macitems.css" title="Mac">
<link rel="alternate stylesheet" type="text/css" href="../winitems.css" title="Win">
<link rel="alternate stylesheet" type="text/css" href="../linuxitems.css" title="Linux">
<link rel="alternate stylesheet" type="text/css" href="../crossitems.css" title="Crossplatform">
<meta http-equiv="content-type" content="text/html; charset=x-mac-roman">
<META NAME="description" CONTENT="Example">
</head>
<BODY BGCOLOR="#FFFFFF">
<H2 lang="en">Example: /Audio/PortAudio</h2>
<p><a href="http://www.monkeybreadsoftware.net">Online Documentation</a> &nbsp; - &nbsp; <a href="stats.html">Statistics</a> &nbsp; - &nbsp; <a href="topic-faq.html">FAQ</a> &nbsp; - &nbsp; <a href="parts.html">Plugin Parts</a> (<a href="partsall.html">All</a>, <a href="plugindeps.html">Dependencies</a>) &nbsp; - &nbsp; <a href="hierarchy.html">Class hierarchy</a></p>
<p>New in Version 
<a href="newinversion213.html">21.3</a> 
<a href="newinversion214.html">21.4</a> 
<a href="newinversion215.html">21.5</a> 
<a href="newinversion220.html">22.0</a> 
<a href="newinversion221.html">22.1</a> 
<a href="newinversion222.html">22.2</a> 
<a href="newinversion223.html">22.3</a> 
<a href="newinversion224.html">22.4</a> 
<a href="newinversion225.html">22.5</a> 
<a href="newinversion230.html">23.0</a> 
<a href="newinversion231.html">23.1</a> 
<a href="newinversion232.html">23.2</a> 
</p>
<p>The list of the &nbsp; <a href="themes.html">topics</a>, 
 &nbsp; <a href="classes.html">classes</a>,
 &nbsp; <a href="interfaces.html">interfaces</a>,
 &nbsp; <a href="controls.html">controls</a>,
 &nbsp; <a href="modules.html">modules</a>,
 &nbsp; <a href="globaltopic.html">global methods by category</a>,
 &nbsp; <a href="globalname.html">global methods by name</a>,
 &nbsp; <a href="screenshots.html">screenshots</a>,
 &nbsp; <a href="licenses.html">licenses</a> &nbsp;
 and &nbsp; <a href="examples.html">examples</a>.</p>
<p id=PlatformChooserMBS>Platforms to show: <a class="isA" href="javascript:all();">All</a> <a class="isM" href="javascript:mac();">Mac</a> <a class="isW" href="javascript:win();">Windows</a> <a class="isL" href="javascript:linux();">Linux</a> <a class="isC" href="javascript:crossplatform();">Cross-Platform</a></p>
<div class="">
<b><A name="1">/Audio/PortAudio</A></b><br>
<B>Function:</B> 
<br>
Required plugins for this example: MBS Audio Plugin<BR>
You find this example project in your Plugins Download as a Xojo project file within the examples folder: /Audio/PortAudio<BR>
This example is the version from Tue, 28th Oct 2019.<BR>

<div class="RB_Code">Project <span style="color:#6500FE">&quot;PortAudio.xojo_binary_project&quot;</span></div>
<div class="RB_MainItem">
<div class="RB_Code">	MenuBar Menu</div>
<div class="RB_Code">		MenuItem UntitledMenu3 = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">		MenuItem UntitledMenu2 = <span style="color:#6500FE">&quot;File&quot;</span></div>
<div class="RB_Code">			MenuItem FileQuit = <span style="color:#6500FE">&quot;Quit&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu7 = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">		MenuItem UntitledMenu0 = <span style="color:#6500FE">&quot;Edit&quot;</span></div>
<div class="RB_Code">			MenuItem EditUndo = <span style="color:#6500FE">&quot;Undo&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu1 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditCut = <span style="color:#6500FE">&quot;Cut&quot;</span></div>
<div class="RB_Code">			MenuItem EditCopy = <span style="color:#6500FE">&quot;Copy&quot;</span></div>
<div class="RB_Code">			MenuItem EditPaste = <span style="color:#6500FE">&quot;Paste&quot;</span></div>
<div class="RB_Code">			MenuItem EditClear = <span style="color:#6500FE">&quot;Clear&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu6 = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu5 = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">		MenuItem UntitledMenu4 = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> MenuBar</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> App <span style="color:#0000FF;font-weight: bold">Inherits</span> Application</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> FolderItem = SpecialFolder.Desktop.Child(<span style="color:#6500FE">&quot;test.log&quot;</span>)
			<span style="color:#0000FF;font-weight: bold">if</span> PortAudioMBS.SetDebugLogFile(f) <span style="color:#0000FF;font-weight: bold">then</span>
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				Break
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> InfoWindow <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Listbox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Listbox</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> ExpandRow(row <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>)
				<span style="color:#0000FF;font-weight: bold">dim</span> o <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Object</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> h <span style="color:#0000FF;font-weight: bold">as</span> PortAudioHostApiInfoMBS
				<span style="color:#0000FF;font-weight: bold">dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> PortAudioDeviceInfoMBS
				<span style="color:#0000FF;font-weight: bold">dim</span> i,c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				
				o=<span style="color:#0000FF;font-weight: bold">me</span>.CellTag(row,<span style="color:#326598">0</span>)
				<span style="color:#0000FF;font-weight: bold">if</span> o=<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">Return</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> o <span style="color:#0000FF;font-weight: bold">isa</span> PortAudioHostApiInfoMBS <span style="color:#0000FF;font-weight: bold">then</span>
					h=PortAudioHostApiInfoMBS(o)
					
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;deviceCount:</span> <span style="color:#6500FE">&quot;</span>+str(h.deviceCount)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;defaultInputDevice:</span> <span style="color:#6500FE">&quot;</span>+str(h.defaultInputDevice)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;defaultOutputDevice:</span> <span style="color:#6500FE">&quot;</span>+str(h.defaultOutputDevice)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;type:</span> <span style="color:#6500FE">&quot;</span>+str(h.type)
					
					c=h.deviceCount-<span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> c
						d=p.DeviceInfo(p.HostApiDeviceIndexToDeviceIndex(h.Index, i))
						<span style="color:#0000FF;font-weight: bold">if</span> d&lt;&gt;<span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
							ListBox1.AddFolder d.name
							ListBox1.CellTag(ListBox1.LastIndex,<span style="color:#326598">0</span>)=d
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">next</span>
					
				<span style="color:#0000FF;font-weight: bold">elseif</span> o <span style="color:#0000FF;font-weight: bold">isa</span> PortAudioDeviceInfoMBS <span style="color:#0000FF;font-weight: bold">then</span>
					d=PortAudioDeviceInfoMBS(o)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;DefaultLowInputLatency:</span> <span style="color:#6500FE">&quot;</span>+str(d.DefaultLowInputLatency)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;DefaultHighInputLatency:</span> <span style="color:#6500FE">&quot;</span>+str(d.DefaultHighInputLatency)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;DefaultLowOutputLatency:</span> <span style="color:#6500FE">&quot;</span>+str(d.DefaultLowOutputLatency)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;DefaultHighOutputLatency:</span> <span style="color:#6500FE">&quot;</span>+str(d.DefaultHighOutputLatency)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;DefaultSampleRate:</span> <span style="color:#6500FE">&quot;</span>+str(d.DefaultSampleRate)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;HostApiIndex:</span> <span style="color:#6500FE">&quot;</span>+str(d.HostApiIndex)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;maxInputChannels:</span> <span style="color:#6500FE">&quot;</span>+str(d.maxInputChannels)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;maxOutputChannels:</span> <span style="color:#6500FE">&quot;</span>+str(d.maxOutputChannels)
					<span style="color:#0000FF;font-weight: bold">me</span>.AddRow <span style="color:#6500FE">&quot;Index:</span> <span style="color:#6500FE">&quot;</span>+str(d.index)
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			<span style="color:#0000FF;font-weight: bold">dim</span> i,c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> host <span style="color:#0000FF;font-weight: bold">as</span> PortAudioHostApiInfoMBS
			
			p=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioMBS
			
			ListBox1.AddRow <span style="color:#6500FE">&quot;DefaultHostApiIndexd:</span> <span style="color:#6500FE">&quot;</span>+str(p.DefaultHostApiIndexd)
			ListBox1.AddRow <span style="color:#6500FE">&quot;DefaultInputDeviceID:</span> <span style="color:#6500FE">&quot;</span>+str(p.DefaultInputDeviceID)
			ListBox1.AddRow <span style="color:#6500FE">&quot;DefaultOutputDeviceID:</span> <span style="color:#6500FE">&quot;</span>+str(p.DefaultOutputDeviceID)
			c=p.HostApiCount
			ListBox1.AddRow <span style="color:#6500FE">&quot;HostApiCount:</span> <span style="color:#6500FE">&quot;</span>+str(p.HostApiCount)
			
			<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> c
				host=p.HostApiInfo(i)
				<span style="color:#0000FF;font-weight: bold">if</span> host&lt;&gt;<span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					ListBox1.AddFolder host.name
					ListBox1.CellTag(ListBox1.LastIndex,<span style="color:#326598">0</span>)=host
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> p <span style="color:#0000FF;font-weight: bold">As</span> PortAudioMBS</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> StartWindow <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				InfoWindow.Show
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton2 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton2 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				PlayWindow.Show
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control StaticText1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance StaticText1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Label</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton4 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton4 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				PlayWindowTimer.Show
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton5 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton5 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				InputLevelWindow.Show
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton6 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton6 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				InputLevelWindowTimer.Show
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton3 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton3 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				PlaybackWindow.Show
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton7 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton7 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				PlayBufferedWindow.Show
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton8 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton8 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				RecorderWindow.init
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			<span style="color:#0000FF;font-weight: bold">if</span> TargetMacOS <span style="color:#0000FF;font-weight: bold">THEN</span>
				<span style="color:#0000FF;font-weight: bold">if</span> TargetMachO <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#7F0000;text-style:italic">&#39;ok</span>
				<span style="color:#0000FF;font-weight: bold">else</span>
					MsgBox <span style="color:#6500FE">&quot;PEF</span> <span style="color:#6500FE">targets</span> <span style="color:#6500FE">are</span> <span style="color:#6500FE">not</span> <span style="color:#6500FE">supported</span> <span style="color:#6500FE">for</span> <span style="color:#6500FE">the</span> <span style="color:#6500FE">PortAudio</span> <span style="color:#6500FE">plugin.</span> <span style="color:#6500FE">Please</span> <span style="color:#6500FE">switch</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">MachO.&quot;</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Module</span> Util</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> Str(H <span style="color:#0000FF;font-weight: bold">as</span> PortAudioHosterrorInfoMBS) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>
			<span style="color:#0000FF;font-weight: bold">Return</span> str(h.ErrorCode)+<span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">&quot;</span>+h.ErrorText
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Module</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> PlayWindowTimer <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control Timer1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Timer</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance Timer1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Timer</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF">#pragma</span> DisableBackgroundTasks
				<span style="color:#0000FF">#pragma</span> DisableBoundsChecking
				
				<span style="color:#0000FF;font-weight: bold">const</span> delta=<span style="color:#006532">0.01000</span>
				
				<span style="color:#0000FF;font-weight: bold">dim</span> FrameCount,n,c,i,e,size <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">single</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> m <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock
				
				FrameCount=s.WriteAvailable
				
				<span style="color:#0000FF;font-weight: bold">if</span> FrameCount&gt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					size=FrameCount*<span style="color:#326598">8</span>
					<span style="color:#0000FF;font-weight: bold">if</span> lastm=<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">or</span> lastm.size&lt;&gt;size <span style="color:#0000FF;font-weight: bold">then</span>
						m = <span style="color:#0000FF;font-weight: bold">New</span> MemoryBlock(size)
						lastm=m
					<span style="color:#0000FF;font-weight: bold">else</span>
						m=lastm <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">reuse</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					c=FrameCount-<span style="color:#326598">1</span>
					<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> c
						f= <span style="color:#006532">0.25</span> * sin( timeIndex * <span style="color:#006532">2.0</span> * <span style="color:#006532">3.1415926</span> * <span style="color:#006532">920.0</span> / <span style="color:#006532">48000.0</span>)
						timeIndex=timeIndex+<span style="color:#326598">1</span>
						
						m.SingleValue(n)=f <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">left</span>
						n=n+<span style="color:#326598">4</span>
						m.SingleValue(n)=f <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">right</span>
						n=n+<span style="color:#326598">4</span>
						
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					e=s.Write(m,FrameCount)
					<span style="color:#0000FF;font-weight: bold">if</span> e=-<span style="color:#326598">9980</span> <span style="color:#0000FF;font-weight: bold">then</span>
						ListBox1.AddRow <span style="color:#6500FE">&quot;Write:</span> <span style="color:#6500FE">&quot;</span>+str(e)+<span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">=</span> <span style="color:#6500FE">Buffer</span> <span style="color:#6500FE">Underflow&quot;</span>
					<span style="color:#0000FF;font-weight: bold">elseif</span> e&lt;&gt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
						ListBox1.AddRow <span style="color:#6500FE">&quot;Write:</span> <span style="color:#6500FE">&quot;</span>+str(e)
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Close()
			<span style="color:#0000FF;font-weight: bold">dim</span> e <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">if</span> s&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				e=s.Stop
				e=s.Close
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			run
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> run()
			<span style="color:#0000FF;font-weight: bold">const</span> paFloat32 = <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt32 = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt24 = <span style="color:#326598">4</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt16 = <span style="color:#326598">8</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt8 = <span style="color:#326598">16</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paUInt8 = <span style="color:#326598">32</span>
			
			<span style="color:#0000FF">#if</span> TargetMacOS
				<span style="color:#0000FF;font-weight: bold">const</span> rate = <span style="color:#326598">44100</span>
			<span style="color:#0000FF">#else</span>
				<span style="color:#0000FF;font-weight: bold">const</span> rate=<span style="color:#326598">48000</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">My</span> <span style="color:#7F0000;text-style:italic">Linux</span> <span style="color:#7F0000;text-style:italic">does</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">like</span> <span style="color:#7F0000;text-style:italic">8000!</span>
			<span style="color:#0000FF">#endif</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> e <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			p=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioMBS
			
			s=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioStreamMBS
			
			e=s.OpenDefaultStream(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>,paFloat32, rate, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>)
			ListBox1.AddRow <span style="color:#6500FE">&quot;OpenDefaultStream:</span> <span style="color:#6500FE">&quot;</span>+str(e)
			
			<span style="color:#0000FF;font-weight: bold">if</span> e=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				e=s.Start
				ListBox1.AddRow <span style="color:#6500FE">&quot;Start:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
				e=s.IsStreamActive
				ListBox1.AddRow <span style="color:#6500FE">&quot;Active:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">On</span> <span style="color:#7F0000;text-style:italic">Linux</span> <span style="color:#7F0000;text-style:italic">8000</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">supported?</span>
				
				ListBox1.AddRow <span style="color:#6500FE">&quot;Host</span> <span style="color:#6500FE">Error:</span> <span style="color:#6500FE">&quot;</span>+str(s.HostError)
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> LastM <span style="color:#0000FF;font-weight: bold">As</span> memoryBlock</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> p <span style="color:#0000FF;font-weight: bold">As</span> PortAudioMBS</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> s <span style="color:#0000FF;font-weight: bold">As</span> PortAudioStreamMBS</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> timeIndex <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> InputLevelWindowTimer <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control OutCanvas <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance OutCanvas <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Paint(g <span style="color:#0000FF;font-weight: bold">As</span> Graphics, areas() <span style="color:#0000FF;font-weight: bold">As</span> REALbasic.Rect)
				<span style="color:#0000FF">#Pragma</span> unused areas
				
				<span style="color:#0000FF;font-weight: bold">If</span> out &lt;&gt; <span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">Then</span>
					g.DrawPicture out, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>, g.Width, g.Height, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>, out.Width, out.Height
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control Timer1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Timer</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance Timer1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Timer</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				work
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Close()
			<span style="color:#0000FF;font-weight: bold">If</span> sr &lt;&gt; <span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">Then</span>
				<span style="color:#0000FF;font-weight: bold">Call</span> sr.stop
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			run
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> run()
			<span style="color:#0000FF;font-weight: bold">const</span> paFloat32 = <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt32 = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt24 = <span style="color:#326598">4</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt16 = <span style="color:#326598">8</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt8 = <span style="color:#326598">16</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paUInt8 = <span style="color:#326598">32</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paStereo = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paMono   = <span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paNoDevice=-<span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">Dim</span> e <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>
			
			p=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioMBS
			
			sr=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioStreamMBS
			
			e=sr.OpenDefaultStream(paMono, <span style="color:#326598">0</span>, paFloat32, <span style="color:#326598">44100</span>,<span style="color:#326598">10240</span>,<span style="color:#326598">0</span>)
			ListBox1.AddRow <span style="color:#6500FE">&quot;OpenStream</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
			
			<span style="color:#0000FF;font-weight: bold">if</span> e=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				e=sr.Start
				ListBox1.AddRow <span style="color:#6500FE">&quot;Start</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
				e=sr.IsStreamActive
				ListBox1.AddRow <span style="color:#6500FE">&quot;Active</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">Return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> work()
			<span style="color:#0000FF;font-weight: bold">dim</span> n,e <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> m <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock
			<span style="color:#0000FF;font-weight: bold">dim</span> size <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> sum,f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Single</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> FrameCount,y,h,w <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> g <span style="color:#0000FF;font-weight: bold">as</span> Graphics
			
			FrameCount=<span style="color:#326598">400</span>
			size=FrameCount*<span style="color:#326598">4</span>
			m = <span style="color:#0000FF;font-weight: bold">New</span> MemoryBlock(size)
			e=sr.Read(m,FrameCount)
			
			<span style="color:#0000FF;font-weight: bold">if</span> e=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				n=<span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> FrameCount
					f=m.SingleValue(n)
					<span style="color:#0000FF;font-weight: bold">if</span> f&gt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
						sum=sum+f
					<span style="color:#0000FF;font-weight: bold">else</span>
						sum=sum-f
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					n=n+<span style="color:#326598">4</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				<span style="color:#0000FF;font-weight: bold">If</span> out = <span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">Or</span> out.Width &lt;&gt; OutCanvas.Width <span style="color:#0000FF;font-weight: bold">Or</span> out.Height &lt;&gt; OutCanvas.Height <span style="color:#0000FF;font-weight: bold">Then</span>
					out = <span style="color:#0000FF;font-weight: bold">New</span> Picture(OutCanvas.Width, OutCanvas.Height, <span style="color:#326598">32</span>)
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
				
				g = out.Graphics
				h = g.Height-<span style="color:#326598">1</span>
				w = g.Width-<span style="color:#326598">1</span>
				
				y=h-sum*h/FrameCount
				
				<span style="color:#0000FF;font-weight: bold">if</span> y&lt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					y=<span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> y&gt;h <span style="color:#0000FF;font-weight: bold">then</span>
					y=h
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				g.ForeColor=&amp;c<span style="color:#FF0000">00</span><span style="color:#00FF00">FF</span><span style="color:#0000FF">00</span>
				g.DrawLine pos,y-<span style="color:#326598">1</span>,pos,y+<span style="color:#326598">2</span>
				g.ForeColor=&amp;c<span style="color:#FF0000">00</span><span style="color:#00FF00">00</span><span style="color:#0000FF">00</span>
				g.DrawLine pos,<span style="color:#326598">0</span>,pos,y
				g.ForeColor=&amp;c<span style="color:#FF0000">00</span><span style="color:#00FF00">00</span><span style="color:#0000FF">FF</span>
				g.DrawLine pos,y,pos,h
				
				pos=pos+<span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">if</span> pos=w <span style="color:#0000FF;font-weight: bold">then</span>
					pos=<span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				g.ForeColor=&amp;c<span style="color:#FF0000">FF</span><span style="color:#00FF00">00</span><span style="color:#0000FF">00</span>
				g.DrawLine pos,<span style="color:#326598">0</span>,pos,h
				
				OutCanvas.Invalidate
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> Out <span style="color:#0000FF;font-weight: bold">As</span> Picture</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> p <span style="color:#0000FF;font-weight: bold">As</span> PortAudioMBS</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> sr <span style="color:#0000FF;font-weight: bold">As</span> PortAudioStreamMBS</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> PlaybackWindow <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				Record
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control playbutton <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance playbutton <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				play
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control Timer1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Timer</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance Timer1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Timer</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">if</span> sp&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> sp.IsStreamActive=<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						ListBox1.AddRow <span style="color:#6500FE">&quot;Playing...&quot;</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> sr&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> sr.IsStreamActive=<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
						ListBox1.AddRow <span style="color:#6500FE">&quot;Recording...</span> <span style="color:#6500FE">&quot;</span>+str(sr.SpaceLeft)
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			p=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioMBS
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Record()
			<span style="color:#0000FF;font-weight: bold">const</span> paFloat32 = <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt32 = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt24 = <span style="color:#326598">4</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt16 = <span style="color:#326598">8</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt8 = <span style="color:#326598">16</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paUInt8 = <span style="color:#326598">32</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paStereo = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paMono   = <span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paNoDevice=-<span style="color:#326598">1</span>
			
			channelCount= paMono
			
			<span style="color:#0000FF;font-weight: bold">dim</span> e <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> sp&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">call</span> sp.Abort
				sp=<span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			samples=<span style="color:#326598">10</span>*<span style="color:#326598">44100</span>*channelCount <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">10</span> <span style="color:#7F0000;text-style:italic">Seconds</span> <span style="color:#7F0000;text-style:italic">at</span> <span style="color:#7F0000;text-style:italic">44100</span> <span style="color:#7F0000;text-style:italic">samples</span> <span style="color:#7F0000;text-style:italic">per</span> <span style="color:#7F0000;text-style:italic">second</span>
			size=<span style="color:#326598">4</span>*samples <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">bytes</span> <span style="color:#7F0000;text-style:italic">needed</span>
			data = <span style="color:#0000FF;font-weight: bold">New</span> MemoryBlock(size+<span style="color:#326598">1024</span>) <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">buffer</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">bit</span> <span style="color:#7F0000;text-style:italic">bigger</span>
			
			sr=<span style="color:#0000FF;font-weight: bold">new</span> MyPortAudioRecordStreamMBS
			sr.channelCount=channelCount
			sr.data=data
			sr.size=size
			sr.SpaceLeft=samples
			sr.offset=<span style="color:#326598">0</span>
			sr.UseSafeThreading=<span style="color:#0000FF;font-weight: bold">false</span>
			
			e=sr.OpenDefaultStream(channelCount, <span style="color:#326598">0</span>, paFloat32, <span style="color:#326598">44100</span>,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)
			ListBox1.AddRow <span style="color:#6500FE">&quot;OpenStream</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
			
			<span style="color:#0000FF;font-weight: bold">if</span> e=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				e=sr.Start
				ListBox1.AddRow <span style="color:#6500FE">&quot;Start</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
				e=sr.IsStreamActive
				ListBox1.AddRow <span style="color:#6500FE">&quot;Active</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">Return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			playbutton.enabled=<span style="color:#0000FF;font-weight: bold">True</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> play()
			<span style="color:#0000FF;font-weight: bold">const</span> paFloat32 = <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt32 = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt24 = <span style="color:#326598">4</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt16 = <span style="color:#326598">8</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt8 = <span style="color:#326598">16</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paUInt8 = <span style="color:#326598">32</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paNoDevice=-<span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> e <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> sr&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">stop</span> <span style="color:#7F0000;text-style:italic">recording</span>
				<span style="color:#0000FF;font-weight: bold">call</span> sr.Abort
				sr=<span style="color:#0000FF;font-weight: bold">nil</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			sp=<span style="color:#0000FF;font-weight: bold">new</span> MyPortAudioPlaybackStreamMBS
			sp.data=data
			sp.channelCount=channelCount
			sp.SampleCount=samples
			sp.UseSafeThreading=<span style="color:#0000FF;font-weight: bold">false</span>
			
			e=sp.OpenDefaultStream(<span style="color:#326598">0</span>,channelCount, paFloat32, <span style="color:#326598">44100</span>,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)
			ListBox1.AddRow <span style="color:#6500FE">&quot;OpenStream</span> <span style="color:#6500FE">playback:</span> <span style="color:#6500FE">&quot;</span>+str(e)
			
			<span style="color:#0000FF;font-weight: bold">if</span> e=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				e=sp.Start
				ListBox1.AddRow <span style="color:#6500FE">&quot;Start</span> <span style="color:#6500FE">playback:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
				e=sp.IsStreamActive
				ListBox1.AddRow <span style="color:#6500FE">&quot;Active</span> <span style="color:#6500FE">playback:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">Return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> channelCount <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = <span style="color:#326598">1</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> data <span style="color:#0000FF;font-weight: bold">As</span> memoryBlock</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> p <span style="color:#0000FF;font-weight: bold">As</span> portaudiombs</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> samples <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> size <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> sp <span style="color:#0000FF;font-weight: bold">As</span> MyPortAudioPlaybackStreamMBS</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> sr <span style="color:#0000FF;font-weight: bold">As</span> MyPortAudioRecordStreamMBS</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> MyPortAudioInputLevelStreamMBS <span style="color:#0000FF;font-weight: bold">Inherits</span> PortAudioStreamMBS</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Function</span> Callback(InputBuffer <span style="color:#0000FF;font-weight: bold">as</span> memoryblock, outputBuffer <span style="color:#0000FF;font-weight: bold">as</span> memoryblock, FrameCount <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>, inputBufferAdcTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, currentTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, outputBufferDacTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, statusFlags <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">Dim</span> n <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> m <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock
			<span style="color:#0000FF;font-weight: bold">dim</span> size <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> sum,f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Single</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> y,h,w <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> g&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				
				size=FrameCount*<span style="color:#326598">4</span>
				m=InputBuffer
				
				n=<span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> FrameCount
					f=m.SingleValue(n)
					<span style="color:#0000FF;font-weight: bold">if</span> f&gt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
						sum=sum+f
					<span style="color:#0000FF;font-weight: bold">else</span>
						sum=sum-f
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					n=n+<span style="color:#326598">4</span>
				<span style="color:#0000FF;font-weight: bold">next</span>
				
				h=g.Height-<span style="color:#326598">1</span>
				w=g.Width-<span style="color:#326598">1</span>
				
				y=h-sum*h/FrameCount
				
				<span style="color:#0000FF;font-weight: bold">if</span> y&lt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					y=<span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">elseif</span> y&gt;h <span style="color:#0000FF;font-weight: bold">then</span>
					y=h
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				g.ForeColor=&amp;c<span style="color:#FF0000">00</span><span style="color:#00FF00">FF</span><span style="color:#0000FF">00</span>
				g.DrawLine pos,y-<span style="color:#326598">1</span>,pos,y+<span style="color:#326598">2</span>
				g.ForeColor=&amp;c<span style="color:#FF0000">00</span><span style="color:#00FF00">00</span><span style="color:#0000FF">00</span>
				g.DrawLine pos,<span style="color:#326598">0</span>,pos,y
				g.ForeColor=&amp;c<span style="color:#FF0000">00</span><span style="color:#00FF00">00</span><span style="color:#0000FF">FF</span>
				g.DrawLine pos,y,pos,h
				
				pos=pos+<span style="color:#326598">1</span>
				<span style="color:#0000FF;font-weight: bold">if</span> pos=w <span style="color:#0000FF;font-weight: bold">then</span>
					pos=<span style="color:#326598">0</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				g.ForeColor=&amp;c<span style="color:#FF0000">FF</span><span style="color:#00FF00">00</span><span style="color:#0000FF">00</span>
				g.DrawLine pos,<span style="color:#326598">0</span>,pos,h
				
				OutCanvas.Invalidate
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> OutCanvas <span style="color:#0000FF;font-weight: bold">As</span> Canvas</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> g <span style="color:#0000FF;font-weight: bold">As</span> graphics</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> InputLevelWindow <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control OutCanvas <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance OutCanvas <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Paint(g <span style="color:#0000FF;font-weight: bold">As</span> Graphics, areas() <span style="color:#0000FF;font-weight: bold">As</span> REALbasic.Rect)
				<span style="color:#0000FF">#Pragma</span> unused areas
				
				<span style="color:#0000FF;font-weight: bold">If</span> out &lt;&gt; <span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">Then</span>
					g.DrawPicture out, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>, g.Width, g.Height, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>, out.Width, out.Height
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Close()
			<span style="color:#0000FF;font-weight: bold">If</span> sr &lt;&gt; <span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">Then</span>
				<span style="color:#0000FF;font-weight: bold">Call</span> sr.stop
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			run
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> run()
			<span style="color:#0000FF;font-weight: bold">const</span> paFloat32 = <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt32 = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt24 = <span style="color:#326598">4</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt16 = <span style="color:#326598">8</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt8 = <span style="color:#326598">16</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paUInt8 = <span style="color:#326598">32</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paStereo = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paMono   = <span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paNoDevice=-<span style="color:#326598">1</span>
			
			<span style="color:#0000FF;font-weight: bold">Dim</span> e <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span>
			
			p=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioMBS
			
			sr=<span style="color:#0000FF;font-weight: bold">new</span> MyPortAudioInputLevelStreamMBS
			
			e=sr.OpenDefaultStream(paMono, <span style="color:#326598">0</span>, paFloat32, <span style="color:#326598">44100</span>,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)
			ListBox1.AddRow <span style="color:#6500FE">&quot;OpenStream</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
			
			<span style="color:#0000FF;font-weight: bold">if</span> e=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				e=sr.Start
				ListBox1.AddRow <span style="color:#6500FE">&quot;Start</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
				e=sr.IsStreamActive
				ListBox1.AddRow <span style="color:#6500FE">&quot;Active</span> <span style="color:#6500FE">record:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">Return</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			out = <span style="color:#0000FF;font-weight: bold">New</span> Picture(OutCanvas.Width, OutCanvas.Height, <span style="color:#326598">32</span>)
			
			sr.OutCanvas = <span style="color:#0000FF;font-weight: bold">self</span>.OutCanvas
			sr.g = Out.Graphics
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Sub</span> work()
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> Out <span style="color:#0000FF;font-weight: bold">As</span> Picture</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> p <span style="color:#0000FF;font-weight: bold">As</span> PortAudioMBS</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> pos <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> sr <span style="color:#0000FF;font-weight: bold">As</span> MyPortAudioInputLevelStreamMBS</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> PlayWindow <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Listbox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Listbox</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Close()
			<span style="color:#0000FF;font-weight: bold">dim</span> e <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">if</span> s&lt;&gt;<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				e=s.Stop
				e=s.Close
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			run
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> run()
			<span style="color:#0000FF;font-weight: bold">const</span> paFloat32 = <span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt32 = <span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt24 = <span style="color:#326598">4</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt16 = <span style="color:#326598">8</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paInt8 = <span style="color:#326598">16</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paUInt8 = <span style="color:#326598">32</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> rate=<span style="color:#326598">48000</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">My</span> <span style="color:#7F0000;text-style:italic">Linux</span> <span style="color:#7F0000;text-style:italic">does</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">like</span> <span style="color:#7F0000;text-style:italic">8000!</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> e <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			
			p=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioMBS
			
			s=<span style="color:#0000FF;font-weight: bold">new</span> MyPortAudioGenerateStreamMBS
			
			e=s.OpenDefaultStream(<span style="color:#326598">0</span>,<span style="color:#326598">2</span>,paFloat32, rate, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>)
			ListBox1.AddRow <span style="color:#6500FE">&quot;OpenDefaultStream:</span> <span style="color:#6500FE">&quot;</span>+str(e)
			
			<span style="color:#0000FF;font-weight: bold">if</span> e=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				e=s.Start
				ListBox1.AddRow <span style="color:#6500FE">&quot;Start:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
				e=s.IsStreamActive
				ListBox1.AddRow <span style="color:#6500FE">&quot;Active:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
				s.UseSafeThreading=<span style="color:#0000FF;font-weight: bold">false</span>
				
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">On</span> <span style="color:#7F0000;text-style:italic">Linux</span> <span style="color:#7F0000;text-style:italic">8000</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">supported?</span>
				
				ListBox1.AddRow <span style="color:#6500FE">&quot;Host</span> <span style="color:#6500FE">Error:</span> <span style="color:#6500FE">&quot;</span>+str(s.HostError)
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> p <span style="color:#0000FF;font-weight: bold">As</span> PortAudioMBS</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> s <span style="color:#0000FF;font-weight: bold">As</span> PortAudioStreamMBS</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> MyPortAudioGenerateStreamMBS <span style="color:#0000FF;font-weight: bold">Inherits</span> PortAudioStreamMBS</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Function</span> Callback(InputBuffer <span style="color:#0000FF;font-weight: bold">as</span> memoryblock, outputBuffer <span style="color:#0000FF;font-weight: bold">as</span> memoryblock, FrameCount <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>, inputBufferAdcTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, currentTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, outputBufferDacTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, statusFlags <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF">#pragma</span> StackOverflowChecking <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF">#pragma</span> DisableBackgroundTasks
			<span style="color:#0000FF">#pragma</span> DisableBoundsChecking
			
			<span style="color:#0000FF;font-weight: bold">const</span> delta=<span style="color:#006532">0.01000</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> n,c,i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">single</span>
			
			System.DebugLog str(FrameCount)+<span style="color:#6500FE">&quot;</span> <span style="color:#6500FE">frames&quot;</span>
			
			c=FrameCount-<span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> c
				f= <span style="color:#006532">0.25</span> * sin( timeIndex * <span style="color:#006532">2.0</span> * <span style="color:#006532">3.1415926</span> * <span style="color:#006532">920.0</span> / <span style="color:#006532">48000.0</span>)
				timeIndex=timeIndex+<span style="color:#326598">1</span>
				
				outputBuffer.SingleValue(n)=f <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">left</span>
				n=n+<span style="color:#326598">4</span>
				outputBuffer.SingleValue(n)=f <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">right</span>
				n=n+<span style="color:#326598">4</span>
				
			<span style="color:#0000FF;font-weight: bold">next</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> leftphase <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">single</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> rightphase <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">single</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> timeIndex <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> MyPortAudioRecordStreamMBS <span style="color:#0000FF;font-weight: bold">Inherits</span> PortAudioStreamMBS</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Function</span> Callback(InputBuffer <span style="color:#0000FF;font-weight: bold">as</span> memoryblock, outputBuffer <span style="color:#0000FF;font-weight: bold">as</span> memoryblock, FrameCount <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>, inputBufferAdcTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, currentTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, outputBufferDacTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, statusFlags <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF">#pragma</span> DisableBackgroundTasks
			<span style="color:#0000FF">#pragma</span> DisableBoundsChecking
			<span style="color:#0000FF">#pragma</span> StackOverflowChecking <span style="color:#0000FF;font-weight: bold">false</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Using</span> <span style="color:#7F0000;text-style:italic">unsafe</span> <span style="color:#7F0000;text-style:italic">threading</span> <span style="color:#7F0000;text-style:italic">requires</span> <span style="color:#7F0000;text-style:italic">all</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">pragmas</span> <span style="color:#7F0000;text-style:italic">above</span> <span style="color:#7F0000;text-style:italic">and</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">you</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">now</span> <span style="color:#7F0000;text-style:italic">allowed</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">call</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">function</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">even</span> <span style="color:#7F0000;text-style:italic">object</span> <span style="color:#7F0000;text-style:italic">locking,</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">no</span> <span style="color:#7F0000;text-style:italic">strings!</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paComplete=<span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paContinue=<span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> n,i,o <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Single</span>
			
			FrameCount=FrameCount*channelCount <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">mono</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">stereo?</span>
			
			o=<span style="color:#326598">0</span>
			n=SpaceLeft
			<span style="color:#0000FF;font-weight: bold">if</span> n&gt;FrameCount <span style="color:#0000FF;font-weight: bold">then</span>
				n=FrameCount
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> n
				
				f=InputBuffer.SingleValue(o)
				o=o+<span style="color:#326598">4</span>
				
				data.SingleValue(offset)=f
				offset=offset+<span style="color:#326598">4</span>
				SpaceLeft=SpaceLeft-<span style="color:#326598">1</span>
				
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> SpaceLeft&lt;=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">call</span> <span style="color:#0000FF;font-weight: bold">me</span>.Abort
				<span style="color:#0000FF;font-weight: bold">Return</span> paComplete
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">Return</span> paContinue
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> SpaceLeft <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> channelCount <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> data <span style="color:#0000FF;font-weight: bold">As</span> memoryBlock</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> offset <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> size <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> MyPortAudioPlaybackStreamMBS <span style="color:#0000FF;font-weight: bold">Inherits</span> PortAudioStreamMBS</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Function</span> Callback(InputBuffer <span style="color:#0000FF;font-weight: bold">as</span> memoryblock, outputBuffer <span style="color:#0000FF;font-weight: bold">as</span> memoryblock, FrameCount <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>, inputBufferAdcTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, currentTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, outputBufferDacTime <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">double</span>, statusFlags <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>) <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF">#pragma</span> DisableBackgroundTasks
			<span style="color:#0000FF">#pragma</span> DisableBoundsChecking
			<span style="color:#0000FF">#pragma</span> StackOverflowChecking <span style="color:#0000FF;font-weight: bold">false</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Using</span> <span style="color:#7F0000;text-style:italic">unsafe</span> <span style="color:#7F0000;text-style:italic">threading</span> <span style="color:#7F0000;text-style:italic">requires</span> <span style="color:#7F0000;text-style:italic">all</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">pragmas</span> <span style="color:#7F0000;text-style:italic">above</span> <span style="color:#7F0000;text-style:italic">and</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">you</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">now</span> <span style="color:#7F0000;text-style:italic">allowed</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">call</span> <span style="color:#7F0000;text-style:italic">a</span> <span style="color:#7F0000;text-style:italic">function</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">even</span> <span style="color:#7F0000;text-style:italic">object</span> <span style="color:#7F0000;text-style:italic">locking,</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">no</span> <span style="color:#7F0000;text-style:italic">strings!</span>
			
			<span style="color:#0000FF;font-weight: bold">const</span> paComplete=<span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">const</span> paContinue=<span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> n,i,o <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Single</span>
			
			FrameCount=FrameCount*channelCount <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">mono</span> <span style="color:#7F0000;text-style:italic">or</span> <span style="color:#7F0000;text-style:italic">stereo?</span>
			
			n=FrameCount
			<span style="color:#0000FF;font-weight: bold">if</span> n&gt;SampleCount <span style="color:#0000FF;font-weight: bold">then</span>
				n=SampleCount
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			o=<span style="color:#326598">0</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> n
				
				f=data.SingleValue(Offset)
				Offset=Offset+<span style="color:#326598">4</span>
				SampleCount=SampleCount-<span style="color:#326598">1</span>
				
				outputBuffer.SingleValue(o)=f
				o=o+<span style="color:#326598">4</span>
				
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> SampleCount&lt;<span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">Return</span> paComplete
			<span style="color:#0000FF;font-weight: bold">else</span>
				<span style="color:#0000FF;font-weight: bold">Return</span> paContinue
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> Offset <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> SampleCount <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> channelCount <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> data <span style="color:#0000FF;font-weight: bold">As</span> memoryBlock</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> PlayBufferedWindow <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> timeIndex,totaltime,n,p <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> rate <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Single</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> f <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">single</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> audioBuffer <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock
				<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> PortAudioStreamBufferedMBS
				<span style="color:#0000FF;font-weight: bold">dim</span> lastp <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> e <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				<span style="color:#0000FF;font-weight: bold">dim</span> started <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>
				
				timeIndex = <span style="color:#326598">0</span>
				rate = <span style="color:#006532">8000.0</span>
				totalTime = rate * <span style="color:#326598">10</span>  <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">10</span> <span style="color:#7F0000;text-style:italic">seconds</span>
				f = <span style="color:#006532">440.0</span>
				
				po=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioMBS
				
				c = <span style="color:#0000FF;font-weight: bold">new</span> PortAudioStreamBufferedMBS
				<span style="color:#0000FF;font-weight: bold">dim</span> pasp <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">new</span> PortAudioStreamParametersMBS
				pasp.ChannelCount = <span style="color:#326598">1</span>
				pasp.Device = po.DefaultOutputDeviceID
				pasp.SampleFormat = <span style="color:#326598">1</span>
				pasp.SuggestedLatency = <span style="color:#006532">0.2</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">e</span> <span style="color:#7F0000;text-style:italic">=</span> <span style="color:#7F0000;text-style:italic">c.OpenDefaultStream(1,rate)</span>
				e = c.OpenStream(pasp,rate,<span style="color:#326598">0</span>,<span style="color:#326598">0</span>)
				
				
				ListBox1.AddRow <span style="color:#6500FE">&quot;OpenDefaultStream:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				system.DebugLog <span style="color:#6500FE">&quot;OpenDefaultStream:</span> <span style="color:#6500FE">&quot;</span>+str(e)
				
				<span style="color:#0000FF;font-weight: bold">if</span> e=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">On</span> <span style="color:#7F0000;text-style:italic">Linux</span> <span style="color:#7F0000;text-style:italic">8000</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">not</span> <span style="color:#7F0000;text-style:italic">supported?</span>
					
					ListBox1.AddRow <span style="color:#6500FE">&quot;Host</span> <span style="color:#6500FE">Error:</span> <span style="color:#6500FE">&quot;</span>+str(c.HostError)
					<span style="color:#0000FF;font-weight: bold">Return</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">const</span> BUFSIZE=<span style="color:#326598">4000</span>
				
				started=<span style="color:#0000FF;font-weight: bold">false</span>
				
				audioBuffer = <span style="color:#0000FF;font-weight: bold">New</span> MemoryBlock(BUFSIZE*<span style="color:#326598">4</span>)
				
				<span style="color:#0000FF;font-weight: bold">while</span> (timeIndex &lt; totalTime) <span style="color:#0000FF;font-weight: bold">or</span> c.IsStreamActive=<span style="color:#326598">1</span>
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Output</span> <span style="color:#7F0000;text-style:italic">sound</span> <span style="color:#7F0000;text-style:italic">until</span> <span style="color:#7F0000;text-style:italic">our</span> <span style="color:#7F0000;text-style:italic">ten</span> <span style="color:#7F0000;text-style:italic">seconds</span> <span style="color:#7F0000;text-style:italic">are</span> <span style="color:#7F0000;text-style:italic">up</span>
					
					p=<span style="color:#006532">300.0</span>*c.OutputPosition/totaltime
					<span style="color:#0000FF;font-weight: bold">if</span> p&lt;&gt;lastp <span style="color:#0000FF;font-weight: bold">then</span>
						lastp=p
						ProgressBar1.Value=p
						ProgressBar1.Refresh
						<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">System.DebugLog</span> <span style="color:#7F0000;text-style:italic">&quot;Last</span> <span style="color:#7F0000;text-style:italic">percent:</span> <span style="color:#7F0000;text-style:italic">&quot;+str(p)</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
					<span style="color:#0000FF;font-weight: bold">if</span> (timeIndex &lt; totalTime) <span style="color:#0000FF;font-weight: bold">and</span> (c.FreeSpace&gt;<span style="color:#326598">0</span>) <span style="color:#0000FF;font-weight: bold">then</span>
						p=<span style="color:#326598">0</span>
						<span style="color:#0000FF;font-weight: bold">for</span> n = <span style="color:#326598">1</span> <span style="color:#0000FF;font-weight: bold">to</span> BUFSIZE
							audioBuffer.SingleValue(p) = <span style="color:#006532">0.25</span> * sin(timeIndex * <span style="color:#006532">2.0</span> * <span style="color:#006532">3.1415926</span> * f / rate)
							p=p+<span style="color:#326598">4</span>
							timeIndex=timeIndex+<span style="color:#326598">1</span>
						<span style="color:#0000FF;font-weight: bold">next</span>
						
						<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> c.AddFloatAudio(audioBuffer) <span style="color:#0000FF;font-weight: bold">then</span>
							MsgBox <span style="color:#6500FE">&quot;Failed</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">play</span> <span style="color:#6500FE">audio!&quot;</span>
							<span style="color:#0000FF;font-weight: bold">Return</span>
						<span style="color:#0000FF;font-weight: bold">else</span>
							System.DebugLog <span style="color:#6500FE">&quot;AddFloatAudio</span> <span style="color:#6500FE">ok&quot;</span>
							<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> started <span style="color:#0000FF;font-weight: bold">then</span>
								started=<span style="color:#0000FF;font-weight: bold">true</span>
								
								e=c.Start
								System.DebugLog <span style="color:#6500FE">&quot;Start:</span> <span style="color:#6500FE">&quot;</span>+str(e)
								ListBox1.AddRow <span style="color:#6500FE">&quot;Start:</span> <span style="color:#6500FE">&quot;</span>+str(e)
								
								e=c.IsStreamActive
								System.DebugLog <span style="color:#6500FE">&quot;Active:</span> <span style="color:#6500FE">&quot;</span>+str(e)
								ListBox1.AddRow <span style="color:#6500FE">&quot;Active:</span> <span style="color:#6500FE">&quot;</span>+str(e)
							<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
						<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				<span style="color:#0000FF;font-weight: bold">wend</span>
				
				<span style="color:#0000FF;font-weight: bold">while</span> c.IsStreamActive=<span style="color:#326598">1</span>
					
					
					app.DoEvents
				<span style="color:#0000FF;font-weight: bold">wend</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control ProgressBar1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ProgressBar</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance ProgressBar1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ProgressBar</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance ListBox1 <span style="color:#0000FF;font-weight: bold">Inherits</span> ListBox</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> po <span style="color:#0000FF;font-weight: bold">As</span> PortAudioMBS</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> RecorderWindow <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> Frequency = <span style="color:#326598">8000</span></div>
<div class="RB_MainItem">
<div class="RB_Code">		Control outCanvas <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance outCanvas <span style="color:#0000FF;font-weight: bold">Inherits</span> Canvas</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Paint(g <span style="color:#0000FF;font-weight: bold">As</span> Graphics, areas() <span style="color:#0000FF;font-weight: bold">As</span> REALbasic.Rect)
				<span style="color:#0000FF">#pragma</span> unused areas
				
				<span style="color:#0000FF;font-weight: bold">If</span> out &lt;&gt; <span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">Then</span>
					g.DrawPicture out, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>, g.Width, g.Height, <span style="color:#326598">0</span>, <span style="color:#326598">0</span>, out.Width, out.Height
				<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control Timer1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Timer</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance Timer1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Timer</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				<span style="color:#0000FF;font-weight: bold">dim</span> l <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">ask</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">samples</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">buffer</span>
				l=p.ReadFrames(m, m.Size)
				
				<span style="color:#0000FF;font-weight: bold">if</span> l&gt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					
					<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">process</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">l</span> <span style="color:#7F0000;text-style:italic">frames</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">got</span>
					ProcessFrames m, l
					
					<span style="color:#0000FF;font-weight: bold">if</span> SaveToFile <span style="color:#0000FF;font-weight: bold">then</span>
						AddMemory M, l
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Close()
			Timer1.Mode = <span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> SaveToFile <span style="color:#0000FF;font-weight: bold">then</span>
				save
				
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> AddMemory(m <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock, samples <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>)
			<span style="color:#0000FF;font-weight: bold">dim</span> p,q,c,i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> x <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock
			
			x = <span style="color:#0000FF;font-weight: bold">New</span> MemoryBlock(samples*<span style="color:#326598">2</span>)
			x.LittleEndian=<span style="color:#0000FF;font-weight: bold">true</span>
			
			p=<span style="color:#326598">0</span>
			q=<span style="color:#326598">0</span>
			
			c=samples-<span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">for</span> i=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> c
				x.Short(q)=m.SingleValue(p)*<span style="color:#006532">32767.0</span>
				p=p+<span style="color:#326598">4</span>
				q=q+<span style="color:#326598">2</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			data.Append x
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> ProcessFrames(m <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock, l <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>)
			<span style="color:#0000FF;font-weight: bold">dim</span> b <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Double</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> c <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span> = l-<span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">dim</span> mi,ma <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Double</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">just</span> <span style="color:#7F0000;text-style:italic">find</span> <span style="color:#7F0000;text-style:italic">min</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">max</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">display</span> <span style="color:#7F0000;text-style:italic">it</span> <span style="color:#7F0000;text-style:italic">here</span>
			b=m.SingleValue(<span style="color:#326598">0</span>)
			ma=b
			mi=b
			
			<span style="color:#0000FF;font-weight: bold">for</span> i <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">to</span> c
				b=m.SingleValue(<span style="color:#326598">4</span>*i)
				
				<span style="color:#0000FF;font-weight: bold">if</span> b&gt;ma <span style="color:#0000FF;font-weight: bold">then</span>
					ma=b
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">if</span> b&lt;mi <span style="color:#0000FF;font-weight: bold">then</span>
					mi=b
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">next</span>
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">scale</span> <span style="color:#7F0000;text-style:italic">so</span> <span style="color:#7F0000;text-style:italic">we</span> <span style="color:#7F0000;text-style:italic">see</span> <span style="color:#7F0000;text-style:italic">more</span>
			ma=ma*<span style="color:#326598">2</span>
			mi=mi*<span style="color:#326598">2</span>
			
			ma = abs(ma)
			mi = abs(mi)
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">draw</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">screen</span> <span style="color:#7F0000;text-style:italic">directly</span>
			
			<span style="color:#0000FF;font-weight: bold">Dim</span> w <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = OutCanvas.width
			<span style="color:#0000FF;font-weight: bold">Dim</span> h <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = OutCanvas.Height
			<span style="color:#0000FF;font-weight: bold">Dim</span> h2 <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span> = h/<span style="color:#326598">2</span>
			
			
			
			<span style="color:#0000FF;font-weight: bold">If</span> out = <span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">Or</span> out.Width &lt;&gt; w <span style="color:#0000FF;font-weight: bold">Or</span> out.Height &lt;&gt; h <span style="color:#0000FF;font-weight: bold">Then</span>
				out = <span style="color:#0000FF;font-weight: bold">New</span> Picture(w, h, <span style="color:#326598">32</span>)
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">If</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> g <span style="color:#0000FF;font-weight: bold">as</span> Graphics = out.Graphics
			
			
			g.ForeColor=&amp;c<span style="color:#FF0000">FF</span><span style="color:#00FF00">FF</span><span style="color:#0000FF">FF</span>
			g.DrawLine index, <span style="color:#326598">0</span>, index, h
			
			g.ForeColor=&amp;c<span style="color:#FF0000">FF</span><span style="color:#00FF00">00</span><span style="color:#0000FF">00</span>
			g.DrawLine index, h2, index, h2-ma*h2
			
			g.ForeColor=&amp;c<span style="color:#FF0000">00</span><span style="color:#00FF00">FF</span><span style="color:#0000FF">00</span>
			g.DrawLine index, h2, index, h2+mi*h2
			
			OutCanvas.Invalidate
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">move</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">next</span> <span style="color:#7F0000;text-style:italic">line</span>
			index=index+<span style="color:#326598">1</span>
			<span style="color:#0000FF;font-weight: bold">if</span> index=w <span style="color:#0000FF;font-weight: bold">then</span>
				index=<span style="color:#326598">0</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Shared</span> <span style="color:#0000FF;font-weight: bold">Sub</span> init()
			<span style="color:#0000FF;font-weight: bold">Dim</span> d <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">New</span> MessageDialog <span style="color:#7F0000;text-style:italic">//declare</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">MessageDialog</span> <span style="color:#7F0000;text-style:italic">object</span>
			<span style="color:#0000FF;font-weight: bold">Dim</span> b <span style="color:#0000FF;font-weight: bold">as</span> MessageDialogButton <span style="color:#7F0000;text-style:italic">//for</span> <span style="color:#7F0000;text-style:italic">handling</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">result</span>
			d.icon=MessageDialog.GraphicCaution <span style="color:#7F0000;text-style:italic">//display</span> <span style="color:#7F0000;text-style:italic">warning</span> <span style="color:#7F0000;text-style:italic">icon</span>
			d.ActionButton.Caption=<span style="color:#6500FE">&quot;Save&quot;</span>
			d.CancelButton.Visible=<span style="color:#0000FF;font-weight: bold">True</span>    <span style="color:#7F0000;text-style:italic">//show</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">Cancel</span> <span style="color:#7F0000;text-style:italic">button</span>
			d.AlternateActionButton.Visible=<span style="color:#0000FF;font-weight: bold">True</span>  <span style="color:#7F0000;text-style:italic">//show</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">&ldquo;Don&rsquo;t</span> <span style="color:#7F0000;text-style:italic">Save&rdquo;</span> <span style="color:#7F0000;text-style:italic">button</span>
			d.AlternateActionButton.Caption=<span style="color:#6500FE">&quot;Don&rsquo;t</span> <span style="color:#6500FE">Save&quot;</span>
			d.Message=<span style="color:#6500FE">&quot;Do</span> <span style="color:#6500FE">you</span> <span style="color:#6500FE">want</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">save</span> <span style="color:#6500FE">the</span> <span style="color:#6500FE">recording</span> <span style="color:#6500FE">when</span> <span style="color:#6500FE">you</span> <span style="color:#6500FE">close</span> <span style="color:#6500FE">the</span> <span style="color:#6500FE">window?&quot;</span>
			
			b=d.ShowModal <span style="color:#7F0000;text-style:italic">//display</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">dialog</span>
			<span style="color:#0000FF;font-weight: bold">Select</span> <span style="color:#0000FF;font-weight: bold">Case</span> b <span style="color:#7F0000;text-style:italic">//determine</span> <span style="color:#7F0000;text-style:italic">which</span> <span style="color:#7F0000;text-style:italic">button</span> <span style="color:#7F0000;text-style:italic">was</span> <span style="color:#7F0000;text-style:italic">pressed.</span>
			<span style="color:#0000FF;font-weight: bold">Case</span> d.ActionButton
				RecorderWindow.initialize <span style="color:#0000FF;font-weight: bold">true</span>
			<span style="color:#0000FF;font-weight: bold">Case</span> d.AlternateActionButton
				RecorderWindow.initialize <span style="color:#0000FF;font-weight: bold">false</span>
				<span style="color:#7F0000;text-style:italic">//user</span> <span style="color:#7F0000;text-style:italic">pressed</span> <span style="color:#7F0000;text-style:italic">Don&rsquo;t</span> <span style="color:#7F0000;text-style:italic">Save</span>
			<span style="color:#0000FF;font-weight: bold">Case</span> d.CancelButton
				<span style="color:#0000FF;font-weight: bold">Return</span>
				<span style="color:#7F0000;text-style:italic">//user</span> <span style="color:#7F0000;text-style:italic">pressed</span> <span style="color:#7F0000;text-style:italic">Cancel</span>
			<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">select</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> initialize(b <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">Boolean</span>)
			SaveToFile=b
			
			m = <span style="color:#0000FF;font-weight: bold">New</span> MemoryBlock(<span style="color:#326598">4</span>*<span style="color:#326598">10240</span>) <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">read</span> <span style="color:#7F0000;text-style:italic">10240</span> <span style="color:#7F0000;text-style:italic">samples</span> <span style="color:#7F0000;text-style:italic">per</span> <span style="color:#7F0000;text-style:italic">timer</span> <span style="color:#7F0000;text-style:italic">loop</span>
			
			p=<span style="color:#0000FF;font-weight: bold">new</span> PortAudioStreamRecorderMBS(<span style="color:#326598">1024</span>*<span style="color:#326598">1024</span>)
			
			<span style="color:#0000FF;font-weight: bold">if</span> p.OpenDefaultStream(<span style="color:#326598">1</span>, Frequency)=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				<span style="color:#0000FF;font-weight: bold">if</span> p.Start=<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
					timer1.Mode=timer1.ModeMultiple
				<span style="color:#0000FF;font-weight: bold">else</span>
					MsgBox <span style="color:#6500FE">&quot;Failed</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">start.&quot;</span>
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">else</span>
				MsgBox <span style="color:#6500FE">&quot;Failed</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">initialize.&quot;</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> save()
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">save</span> <span style="color:#7F0000;text-style:italic">as</span> <span style="color:#7F0000;text-style:italic">WAV</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">more</span> <span style="color:#7F0000;text-style:italic">options,</span> <span style="color:#7F0000;text-style:italic">please</span> <span style="color:#7F0000;text-style:italic">use</span> <span style="color:#7F0000;text-style:italic">SoundFileMBS</span> <span style="color:#7F0000;text-style:italic">class</span>
			
			<span style="color:#0000FF;font-weight: bold">dim</span> size <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>=<span style="color:#326598">0</span>
			
			<span style="color:#0000FF;font-weight: bold">Dim</span> f <span style="color:#0000FF;font-weight: bold">As</span> FolderItem = GetSaveFolderItem(FileTypes1.AudioWav,<span style="color:#6500FE">&quot;audio.wav&quot;</span>)
			<span style="color:#0000FF;font-weight: bold">If</span> f &lt;&gt; <span style="color:#0000FF;font-weight: bold">Nil</span> <span style="color:#0000FF;font-weight: bold">Then</span>
				<span style="color:#0000FF;font-weight: bold">Dim</span> b <span style="color:#0000FF;font-weight: bold">As</span> BinaryStream = f.CreateBinaryFile(FileTypes1.AudioWav)
				
				<span style="color:#0000FF;font-weight: bold">if</span> b = <span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
					
					MsgBox <span style="color:#6500FE">&quot;Failed</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">create</span> <span style="color:#6500FE">file</span> <span style="color:#6500FE">&quot;</span> + f.NativePath
					
				<span style="color:#0000FF;font-weight: bold">else</span>
					
					<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> m <span style="color:#0000FF;font-weight: bold">as</span> MemoryBlock <span style="color:#0000FF;font-weight: bold">in</span> data
						size = size + m.size
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					b.LittleEndian=<span style="color:#0000FF;font-weight: bold">true</span>
					
					b.Write <span style="color:#6500FE">&quot;RIFF&quot;</span>
					b.WriteInt32 <span style="color:#326598">6</span>+<span style="color:#326598">4</span>+<span style="color:#326598">16</span>+<span style="color:#326598">4</span>+Size <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">size</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">file</span>
					b.Write <span style="color:#6500FE">&quot;WAVE&quot;</span>
					
					b.Write <span style="color:#6500FE">&quot;fmt</span> <span style="color:#6500FE">&quot;</span>
					b.WriteInt32 <span style="color:#326598">16</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">size</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">following</span> <span style="color:#7F0000;text-style:italic">data</span>
					b.WriteInt16 <span style="color:#326598">1</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">format,</span> <span style="color:#7F0000;text-style:italic">uncompressed</span>
					b.WriteInt16 <span style="color:#326598">1</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">1</span> <span style="color:#7F0000;text-style:italic">Channel</span>
					b.WriteInt32 Frequency <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Samples</span> <span style="color:#7F0000;text-style:italic">per</span> <span style="color:#7F0000;text-style:italic">Second</span>
					b.WriteInt32 Frequency*<span style="color:#326598">2</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Bytes</span> <span style="color:#7F0000;text-style:italic">per</span> <span style="color:#7F0000;text-style:italic">Second</span>
					b.WriteInt16 <span style="color:#326598">2</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">Block</span> <span style="color:#7F0000;text-style:italic">align,</span> <span style="color:#7F0000;text-style:italic">Size</span> <span style="color:#7F0000;text-style:italic">of</span> <span style="color:#7F0000;text-style:italic">Sample</span> <span style="color:#7F0000;text-style:italic">in</span> <span style="color:#7F0000;text-style:italic">Bytes</span>
					b.WriteInt16 <span style="color:#326598">16</span> <span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">bits</span> <span style="color:#7F0000;text-style:italic">per</span> <span style="color:#7F0000;text-style:italic">sample</span>
					
					b.Write <span style="color:#6500FE">&quot;data&quot;</span>
					b.WriteInt32 Size
					
					<span style="color:#0000FF;font-weight: bold">for</span> <span style="color:#0000FF;font-weight: bold">each</span> m <span style="color:#0000FF;font-weight: bold">in</span> data
						b.Write m
					<span style="color:#0000FF;font-weight: bold">next</span>
					
					b.Close
					
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;Frequency&quot;</span>
<div class="RB_Comment">			you can set frequency to 8000 for phone quality or for example to 44100 for HiFi</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> Out <span style="color:#0000FF;font-weight: bold">As</span> Picture</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> SaveToFile <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Boolean</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> <span style="color:#0000FF;font-weight: bold">Protected</span> data() <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> index <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> m <span style="color:#0000FF;font-weight: bold">As</span> MemoryBlock</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> p <span style="color:#0000FF;font-weight: bold">As</span> PortAudioStreamRecorderMBS</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	FileTypes1</div>
<div class="RB_Code">		Filetype audio/wav</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> FileTypes1</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	ExternalFile info</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> ExternalFile</div>
</div>
<div class="RB_Code"><span style="color:#0000FF;font-weight: bold">End</span> Project</div>

<p>See also:<ul>
<li><A href="example-audio-portaudiorecordandplay.html">/Audio/PortAudio Record and Play</A></li>
<li><A href="example-audio-portaudiostreamingreceiver.html">/Audio/PortAudio Streaming Receiver</A></li>
<li><A href="example-audio-portaudiostreamingsender.html">/Audio/PortAudio Streaming Sender</A></li>
</ul></p>
</div>
<p>The items on this page are in the following plugins: <a href="plugins-mbsaudioplugin.html">MBS Audio Plugin</a>.</p>
<!-- Ende Content-->

<br>
<div style="width: 200pt; margin: 0pt; padding: 5pt; border-color:#ccc; border-style:solid; background-color: #eee; border-width: 2pt; border-radius: 10pt; " lang="en">
&#128172; <a href="https://www.monkeybreadsoftware.com/feedback/?what=xojo&path=example-audio-portaudio">Ask a question or report a problem</a>
</div>

</BODY>
</HTML>

