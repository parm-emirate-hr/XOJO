<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Frameset//EN" >
<HTML>
<HEAD>
<TITLE>Monkeybread Xojo plugin - Example: /USB/USBtest</TITLE>
<script src="../platforms.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="../help.css" >
<link rel="stylesheet" type="text/css" href="../screen.css" media="screen">
<link rel="stylesheet" type="text/css" href="../print.css" media="print">
<link rel="stylesheet" type="text/css" href="../allitems.css" title="Default">
<link rel="alternate stylesheet" type="text/css" href="../macitems.css" title="Mac">
<link rel="alternate stylesheet" type="text/css" href="../winitems.css" title="Win">
<link rel="alternate stylesheet" type="text/css" href="../linuxitems.css" title="Linux">
<link rel="alternate stylesheet" type="text/css" href="../crossitems.css" title="Crossplatform">
<meta http-equiv="content-type" content="text/html; charset=x-mac-roman">
<META NAME="description" CONTENT="Example">
</head>
<BODY BGCOLOR="#FFFFFF">
<H2 lang="en">Example: /USB/USBtest</h2>
<p><a href="http://www.monkeybreadsoftware.net">Online Documentation</a> &nbsp; - &nbsp; <a href="stats.html">Statistics</a> &nbsp; - &nbsp; <a href="topic-faq.html">FAQ</a> &nbsp; - &nbsp; <a href="parts.html">Plugin Parts</a> (<a href="partsall.html">All</a>, <a href="plugindeps.html">Dependencies</a>) &nbsp; - &nbsp; <a href="hierarchy.html">Class hierarchy</a></p>
<p>New in Version 
<a href="newinversion213.html">21.3</a> 
<a href="newinversion214.html">21.4</a> 
<a href="newinversion215.html">21.5</a> 
<a href="newinversion220.html">22.0</a> 
<a href="newinversion221.html">22.1</a> 
<a href="newinversion222.html">22.2</a> 
<a href="newinversion223.html">22.3</a> 
<a href="newinversion224.html">22.4</a> 
<a href="newinversion225.html">22.5</a> 
<a href="newinversion230.html">23.0</a> 
<a href="newinversion231.html">23.1</a> 
<a href="newinversion232.html">23.2</a> 
</p>
<p>The list of the &nbsp; <a href="themes.html">topics</a>, 
 &nbsp; <a href="classes.html">classes</a>,
 &nbsp; <a href="interfaces.html">interfaces</a>,
 &nbsp; <a href="controls.html">controls</a>,
 &nbsp; <a href="modules.html">modules</a>,
 &nbsp; <a href="globaltopic.html">global methods by category</a>,
 &nbsp; <a href="globalname.html">global methods by name</a>,
 &nbsp; <a href="screenshots.html">screenshots</a>,
 &nbsp; <a href="licenses.html">licenses</a> &nbsp;
 and &nbsp; <a href="examples.html">examples</a>.</p>
<p id=PlatformChooserMBS>Platforms to show: <a class="isA" href="javascript:all();">All</a> <a class="isM" href="javascript:mac();">Mac</a> <a class="isW" href="javascript:win();">Windows</a> <a class="isL" href="javascript:linux();">Linux</a> <a class="isC" href="javascript:crossplatform();">Cross-Platform</a></p>
<div class="">
<b><A name="1">/USB/USBtest</A></b><br>
<B>Function:</B> 
<br>
Required plugins for this example: MBS USB Plugin<BR>
You find this example project in your Plugins Download as a Xojo project file within the examples folder: /USB/USBtest<BR>
This example is the version from Mon, 5th May 2019.<BR>

<div class="RB_Code">Project <span style="color:#6500FE">&quot;USBtest.xojo_binary_project&quot;</span></div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> App <span style="color:#0000FF;font-weight: bold">Inherits</span> Application</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kEditClear = <span style="color:#6500FE">&quot;&amp;Delete&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kFileQuit = <span style="color:#6500FE">&quot;&amp;Quit&quot;</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Const</span> kFileQuitShortcut = <span style="color:#6500FE">&quot;&quot;</span></div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Open()
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">This</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">the</span> <span style="color:#7F0000;text-style:italic">Custom</span> <span style="color:#7F0000;text-style:italic">Computer</span> <span style="color:#7F0000;text-style:italic">Services</span> <span style="color:#7F0000;text-style:italic">Inc.</span>
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">PIC24</span> <span style="color:#7F0000;text-style:italic">development</span> <span style="color:#7F0000;text-style:italic">board.</span> <span style="color:#7F0000;text-style:italic">http://www.ccsinfo.com/product_info.php?products_id=usb-pic24-kit</span>
			
			
			
			<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">At</span> <span style="color:#7F0000;text-style:italic">present</span> <span style="color:#7F0000;text-style:italic">this</span> <span style="color:#7F0000;text-style:italic">is</span> <span style="color:#7F0000;text-style:italic">for</span> <span style="color:#7F0000;text-style:italic">Mac</span> <span style="color:#7F0000;text-style:italic">only,</span> <span style="color:#7F0000;text-style:italic">will</span> <span style="color:#7F0000;text-style:italic">need</span> <span style="color:#7F0000;text-style:italic">to</span> <span style="color:#7F0000;text-style:italic">add</span> <span style="color:#7F0000;text-style:italic">target</span> <span style="color:#7F0000;text-style:italic">testing</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">Windows</span> <span style="color:#7F0000;text-style:italic">code</span>
			
			App.mycount = <span style="color:#326598">0</span>
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">not</span> InitInstance <span style="color:#0000FF;font-weight: bold">then</span>
				quit
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Protected</span> <span style="color:#0000FF;font-weight: bold">Function</span> FindDevice() <span style="color:#0000FF;font-weight: bold">As</span> MyHID
			<span style="color:#0000FF;font-weight: bold">dim</span> h <span style="color:#0000FF;font-weight: bold">as</span> MyHID
			<span style="color:#0000FF;font-weight: bold">dim</span> p <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>
			
			h=<span style="color:#0000FF;font-weight: bold">new</span> MyHID
			
			<span style="color:#0000FF;font-weight: bold">if</span> h.FindFirstDevice <span style="color:#0000FF;font-weight: bold">then</span>
				
				<span style="color:#7F0000;text-style:italic">//</span> <span style="color:#7F0000;text-style:italic">compare</span> <span style="color:#7F0000;text-style:italic">here</span> <span style="color:#7F0000;text-style:italic">Product</span> <span style="color:#7F0000;text-style:italic">name,</span> <span style="color:#7F0000;text-style:italic">ProductID</span> <span style="color:#7F0000;text-style:italic">and</span> <span style="color:#7F0000;text-style:italic">VendorID</span>
				p=h.Product
				<span style="color:#0000FF;font-weight: bold">if</span> left(p,<span style="color:#326598">3</span>)=<span style="color:#6500FE">&quot;CCS&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
					<span style="color:#0000FF;font-weight: bold">Return</span> h
				<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
				
				<span style="color:#0000FF;font-weight: bold">while</span> h.FindNextDevice
					
					p=h.Product
					<span style="color:#0000FF;font-weight: bold">if</span> left(p,<span style="color:#326598">3</span>)=<span style="color:#6500FE">&quot;CCS&quot;</span> <span style="color:#0000FF;font-weight: bold">then</span>
						Window1.statusField.BackColor = &amp;C<span style="color:#FF0000">00</span><span style="color:#00FF00">FF</span><span style="color:#0000FF">00</span>
						Window1.statusField.Text = <span style="color:#6500FE">&quot;CCS</span> <span style="color:#6500FE">demo</span> <span style="color:#6500FE">Connected&quot;</span>
						<span style="color:#0000FF;font-weight: bold">Return</span> h
					<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
					
				<span style="color:#0000FF;font-weight: bold">wend</span>
				
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> InitInstance() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			<span style="color:#0000FF;font-weight: bold">if</span> OpenUSBDevice = <span style="color:#0000FF;font-weight: bold">False</span> <span style="color:#0000FF;font-weight: bold">Then</span>
				<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">False</span>
			<span style="color:#0000FF;font-weight: bold">Else</span>
				<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">True</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Function</span> OpenUSBDevice() <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">boolean</span>
			h=FindDevice
			
			<span style="color:#0000FF;font-weight: bold">if</span> h=<span style="color:#0000FF;font-weight: bold">nil</span> <span style="color:#0000FF;font-weight: bold">then</span>
				MsgBox <span style="color:#6500FE">&quot;No</span> <span style="color:#6500FE">CCS</span> <span style="color:#6500FE">device</span> <span style="color:#6500FE">found.&quot;</span>
				quit
				<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			h.Connect
			
			<span style="color:#0000FF;font-weight: bold">if</span> h.Lasterror&lt;&gt;<span style="color:#326598">0</span> <span style="color:#0000FF;font-weight: bold">then</span>
				MsgBox <span style="color:#6500FE">&quot;Failed</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">connect</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">CCS</span> <span style="color:#6500FE">Device.&quot;</span>
				quit
				<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">false</span>
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
			
			h.InstallCallback
			
			<span style="color:#0000FF;font-weight: bold">Return</span> <span style="color:#0000FF;font-weight: bold">true</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Function</span></div>
<div class="RB_Note">		Note <span style="color:#6500FE">&quot;Description&quot;</span>
<div class="RB_Comment">			This is a test program that enumerates a USB HID device on a Custom Computer Services Inc PIC24 USB development board. 
			After enumeration a 'Request message' button on Window1 can be used to send a specific character via USB to the 
			development board. On receipt of the 'Request message' character the PIC development board sends five 16 byte packets
			containing the test string. These packets are received and displayed in an edit field in Window1.
			
			Further development hopes to provide a text field to contain user test strings which can be sent to the PIC development 
			board to be displayed on the LCD display.
			
			A version to compile for Windows is also planned.
			
			Written by:
			Vern hardingham
			Resonant Light Technology Inc.
			British Columbia,
			Canada
			vern@resonantlight.com</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> h <span style="color:#0000FF;font-weight: bold">As</span> myHID</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Property</span> myCount <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">Integer</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> Window1 <span style="color:#0000FF;font-weight: bold">Inherits</span> Window</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control statusField <span style="color:#0000FF;font-weight: bold">Inherits</span> TextField</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance statusField <span style="color:#0000FF;font-weight: bold">Inherits</span> TextField</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control RxDataField <span style="color:#0000FF;font-weight: bold">Inherits</span> TextArea</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance RxDataField <span style="color:#0000FF;font-weight: bold">Inherits</span> TextArea</div>
</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">		Control PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
<div class="RB_MainItem">
<div class="RB_Code">			ControlInstance PushButton1 <span style="color:#0000FF;font-weight: bold">Inherits</span> PushButton</div>
</div>
<div class="RB_Code">			EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> Action()
				Window1.RxDataField.Text = Window1.RxDataField.Text + chr(<span style="color:#326598">13</span>)
				App.h.Send chr(<span style="color:#326598">86</span>)
			<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">End</span> Control</div>
</div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	MenuBar MenuBar1</div>
<div class="RB_Code">		MenuItem FileMenu = <span style="color:#6500FE">&quot;&amp;File&quot;</span></div>
<div class="RB_Code">			MenuItem FileQuit = <span style="color:#6500FE">&quot;#App.kFileQuit&quot;</span></div>
<div class="RB_Code">		MenuItem EditMenu = <span style="color:#6500FE">&quot;&amp;Edit&quot;</span></div>
<div class="RB_Code">			MenuItem EditUndo = <span style="color:#6500FE">&quot;&amp;Undo&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu1 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditCut = <span style="color:#6500FE">&quot;Cu&amp;t&quot;</span></div>
<div class="RB_Code">			MenuItem EditCopy = <span style="color:#6500FE">&quot;&amp;Copy&quot;</span></div>
<div class="RB_Code">			MenuItem EditPaste = <span style="color:#6500FE">&quot;&amp;Paste&quot;</span></div>
<div class="RB_Code">			MenuItem EditClear = <span style="color:#6500FE">&quot;#App.kEditClear&quot;</span></div>
<div class="RB_Code">			MenuItem UntitledMenu0 = <span style="color:#6500FE">&quot;-&quot;</span></div>
<div class="RB_Code">			MenuItem EditSelectAll = <span style="color:#6500FE">&quot;Select</span> <span style="color:#6500FE">&amp;All&quot;</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> MenuBar</div>
</div>
<div class="RB_MainItem">
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">Class</span> MyHID <span style="color:#0000FF;font-weight: bold">Inherits</span> MacHIDMBS</div>
<div class="RB_Code">		EventHandler <span style="color:#0000FF;font-weight: bold">Sub</span> ReceivedData(data <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">string</span>, size <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">integer</span>)
			Window1.RxDataField.Text = Window1.RxDataField.Text + data
			App.mycount = App.mycount + <span style="color:#326598">1</span>
		<span style="color:#0000FF;font-weight: bold">End</span> EventHandler</div>
<div class="RB_Code">		<span style="color:#0000FF;font-weight: bold">Sub</span> Send(data <span style="color:#0000FF;font-weight: bold">As</span> <span style="color:#0000FF;font-weight: bold">string</span>)
			<span style="color:#0000FF;font-weight: bold">dim</span> m <span style="color:#0000FF;font-weight: bold">as</span> <span style="color:#0000FF;font-weight: bold">New</span> MemoryBlock(<span style="color:#326598">16</span>)
			
			m.StringValue(<span style="color:#326598">0</span>, <span style="color:#326598">1</span>) = data
			<span style="color:#0000FF;font-weight: bold">me</span>.SendMessageMemory m, <span style="color:#326598">0</span>, <span style="color:#326598">16</span>
			
			<span style="color:#0000FF;font-weight: bold">if</span> <span style="color:#0000FF;font-weight: bold">me</span>.Lasterror = -<span style="color:#326598">536854447</span> <span style="color:#0000FF;font-weight: bold">Then</span>
				MsgBox <span style="color:#6500FE">&quot;The</span> <span style="color:#6500FE">USB</span> <span style="color:#6500FE">Receiver</span> <span style="color:#6500FE">failed</span> <span style="color:#6500FE">with</span> <span style="color:#6500FE">a</span> <span style="color:#6500FE">timeout</span> <span style="color:#6500FE">to</span> <span style="color:#6500FE">send</span> <span style="color:#6500FE">an</span> <span style="color:#6500FE">answer&quot;</span>
				Quit
			<span style="color:#0000FF;font-weight: bold">end</span> <span style="color:#0000FF;font-weight: bold">if</span>
		<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Sub</span></div>
<div class="RB_Code">	<span style="color:#0000FF;font-weight: bold">End</span> <span style="color:#0000FF;font-weight: bold">Class</span></div>
</div>
<div class="RB_Code"><span style="color:#0000FF;font-weight: bold">End</span> Project</div>

</div>
<p>The items on this page are in the following plugins: <a href="plugins-mbsusbplugin.html">MBS USB Plugin</a>.</p>
<!-- Ende Content-->

<br>
<div style="width: 200pt; margin: 0pt; padding: 5pt; border-color:#ccc; border-style:solid; background-color: #eee; border-width: 2pt; border-radius: 10pt; " lang="en">
&#128172; <a href="https://www.monkeybreadsoftware.com/feedback/?what=xojo&path=example-usb-usbtest">Ask a question or report a problem</a>
</div>

</BODY>
</HTML>

